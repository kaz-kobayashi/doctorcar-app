import{c as L,r as o,j as e,b as R,B as E}from"./index-0a82833a.js";import{a_ as f}from"./registryService-eae3f357.js";const B=()=>{const w=L(),[i,N]=o.useState([]),[b,d]=o.useState(!0),[v,m]=o.useState(!1);o.useEffect(()=>{C()},[]);const C=async()=>{d(!0);try{const t=await f.getCompletedRegistries();N(t.sort((a,s)=>{var n,c,h,g,u,l,y,j;const r=((g=(h=(c=(n=a.timelineDoctorCar)==null?void 0:n.awareness)==null?void 0:c.toDate)==null?void 0:h.call(c))==null?void 0:g.getTime())||0;return(((j=(y=(l=(u=s.timelineDoctorCar)==null?void 0:u.awareness)==null?void 0:l.toDate)==null?void 0:y.call(l))==null?void 0:j.getTime())||0)-r}))}catch(t){console.error("Failed to load registries:",t)}finally{d(!1)}},k=async()=>{m(!0);try{const t=await f.exportRegistriesToCSV(i),a=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a"),r=URL.createObjectURL(a);s.setAttribute("href",r),s.setAttribute("download",`doctorcar_registry_${new Date().toISOString().split("T")[0]}.csv`),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}catch(t){console.error("Failed to export CSV:",t),alert("CSVエクスポートに失敗しました")}finally{m(!1)}},D=t=>!t||!t.toDate?"-":t.toDate().toLocaleDateString("ja-JP"),S=t=>!t||!t.toDate?"-":t.toDate().toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),T=t=>{switch(t){case"C":return"bg-red-100 text-red-800";case"T":return"bg-orange-100 text-orange-800";case"S":return"bg-blue-100 text-blue-800";case"M":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},p=t=>{switch(t){case"own-tertiary":return"自院三次";case"own-secondary":return"自院二次";case"other-tertiary":return"他院三次";case"other-secondary":return"他院二次";case"cancel-before-arrival":return"現着前キャンセル";case"cancel-mild":return"軽症キャンセル";case"social-death":return"社会死";case"other":return"その他";default:return"-"}};return b?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(R,{size:"lg"})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>w("/cases"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"レジストリ一覧"}),e.jsxs("p",{className:"text-sm text-gray-500",children:["完了済みレジストリ: ",i.length,"件"]})]})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx(E,{size:"sm",onClick:k,disabled:v||i.length===0,children:"CSVエクスポート"})})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:e.jsx("div",{className:"px-4 py-6 sm:px-0",children:i.length===0?e.jsx("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:e.jsx("p",{className:"text-gray-500",children:"完了済みのレジストリがありません"})}):e.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"レジストリ番号"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"要請日時"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"患者情報"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"推定病名"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"搬送先"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"分類"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"転帰"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"活動時間"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i.map(t=>{var a,s,r,x,n;return e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.registryNumber}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[e.jsx("div",{children:D((a=t.timelineDoctorCar)==null?void 0:a.awareness)}),e.jsx("div",{className:"text-xs",children:S((s=t.timelineDoctorCar)==null?void 0:s.awareness)})]}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[t.patientAge,"歳",t.patientGender==="male"?"男性":t.patientGender==="female"?"女性":"-"]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:e.jsx("div",{className:"max-w-xs truncate",children:((r=t.estimatedDiagnosis)==null?void 0:r.join(", "))||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:p((x=t.destination)==null?void 0:x.type)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${T(t.category||void 0)}`,children:t.category||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:p((n=t.destination)==null?void 0:n.type)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.totalActivityTime?`${t.totalActivityTime}分`:"-"})]},t.id)})})]})})})})})]})};export{B as RegistryListPage};
//# sourceMappingURL=RegistryListPage-429635bb.js.map
