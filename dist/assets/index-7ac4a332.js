var NI=Object.defineProperty;var AI=(t,e,n)=>e in t?NI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Pr=(t,e,n)=>(AI(t,typeof e!="symbol"?e+"":e,n),n);function kI(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in t)){const s=Object.getOwnPropertyDescriptor(r,i);s&&Object.defineProperty(t,i,s.get?s:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();var RI=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Lx(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Mx={exports:{}},Xd={},Vx={exports:{}},je={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yu=Symbol.for("react.element"),jI=Symbol.for("react.portal"),DI=Symbol.for("react.fragment"),LI=Symbol.for("react.strict_mode"),MI=Symbol.for("react.profiler"),VI=Symbol.for("react.provider"),OI=Symbol.for("react.context"),FI=Symbol.for("react.forward_ref"),zI=Symbol.for("react.suspense"),BI=Symbol.for("react.memo"),UI=Symbol.for("react.lazy"),Ov=Symbol.iterator;function $I(t){return t===null||typeof t!="object"?null:(t=Ov&&t[Ov]||t["@@iterator"],typeof t=="function"?t:null)}var Ox={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Fx=Object.assign,zx={};function ll(t,e,n){this.props=t,this.context=e,this.refs=zx,this.updater=n||Ox}ll.prototype.isReactComponent={};ll.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};ll.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Bx(){}Bx.prototype=ll.prototype;function mg(t,e,n){this.props=t,this.context=e,this.refs=zx,this.updater=n||Ox}var pg=mg.prototype=new Bx;pg.constructor=mg;Fx(pg,ll.prototype);pg.isPureReactComponent=!0;var Fv=Array.isArray,Ux=Object.prototype.hasOwnProperty,gg={current:null},$x={key:!0,ref:!0,__self:!0,__source:!0};function qx(t,e,n){var r,i={},s=null,a=null;if(e!=null)for(r in e.ref!==void 0&&(a=e.ref),e.key!==void 0&&(s=""+e.key),e)Ux.call(e,r)&&!$x.hasOwnProperty(r)&&(i[r]=e[r]);var u=arguments.length-2;if(u===1)i.children=n;else if(1<u){for(var h=Array(u),m=0;m<u;m++)h[m]=arguments[m+2];i.children=h}if(t&&t.defaultProps)for(r in u=t.defaultProps,u)i[r]===void 0&&(i[r]=u[r]);return{$$typeof:yu,type:t,key:s,ref:a,props:i,_owner:gg.current}}function qI(t,e){return{$$typeof:yu,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function _g(t){return typeof t=="object"&&t!==null&&t.$$typeof===yu}function GI(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var zv=/\/+/g;function tm(t,e){return typeof t=="object"&&t!==null&&t.key!=null?GI(""+t.key):e.toString(36)}function Bh(t,e,n,r,i){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var a=!1;if(t===null)a=!0;else switch(s){case"string":case"number":a=!0;break;case"object":switch(t.$$typeof){case yu:case jI:a=!0}}if(a)return a=t,i=i(a),t=r===""?"."+tm(a,0):r,Fv(i)?(n="",t!=null&&(n=t.replace(zv,"$&/")+"/"),Bh(i,e,n,"",function(m){return m})):i!=null&&(_g(i)&&(i=qI(i,n+(!i.key||a&&a.key===i.key?"":(""+i.key).replace(zv,"$&/")+"/")+t)),e.push(i)),1;if(a=0,r=r===""?".":r+":",Fv(t))for(var u=0;u<t.length;u++){s=t[u];var h=r+tm(s,u);a+=Bh(s,e,n,h,i)}else if(h=$I(t),typeof h=="function")for(t=h.call(t),u=0;!(s=t.next()).done;)s=s.value,h=r+tm(s,u++),a+=Bh(s,e,n,h,i);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return a}function ph(t,e,n){if(t==null)return t;var r=[],i=0;return Bh(t,r,"","",function(s){return e.call(n,s,i++)}),r}function WI(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var pn={current:null},Uh={transition:null},HI={ReactCurrentDispatcher:pn,ReactCurrentBatchConfig:Uh,ReactCurrentOwner:gg};function Gx(){throw Error("act(...) is not supported in production builds of React.")}je.Children={map:ph,forEach:function(t,e,n){ph(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ph(t,function(){e++}),e},toArray:function(t){return ph(t,function(e){return e})||[]},only:function(t){if(!_g(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};je.Component=ll;je.Fragment=DI;je.Profiler=MI;je.PureComponent=mg;je.StrictMode=LI;je.Suspense=zI;je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=HI;je.act=Gx;je.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Fx({},t.props),i=t.key,s=t.ref,a=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,a=gg.current),e.key!==void 0&&(i=""+e.key),t.type&&t.type.defaultProps)var u=t.type.defaultProps;for(h in e)Ux.call(e,h)&&!$x.hasOwnProperty(h)&&(r[h]=e[h]===void 0&&u!==void 0?u[h]:e[h])}var h=arguments.length-2;if(h===1)r.children=n;else if(1<h){u=Array(h);for(var m=0;m<h;m++)u[m]=arguments[m+2];r.children=u}return{$$typeof:yu,type:t.type,key:i,ref:s,props:r,_owner:a}};je.createContext=function(t){return t={$$typeof:OI,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:VI,_context:t},t.Consumer=t};je.createElement=qx;je.createFactory=function(t){var e=qx.bind(null,t);return e.type=t,e};je.createRef=function(){return{current:null}};je.forwardRef=function(t){return{$$typeof:FI,render:t}};je.isValidElement=_g;je.lazy=function(t){return{$$typeof:UI,_payload:{_status:-1,_result:t},_init:WI}};je.memo=function(t,e){return{$$typeof:BI,type:t,compare:e===void 0?null:e}};je.startTransition=function(t){var e=Uh.transition;Uh.transition={};try{t()}finally{Uh.transition=e}};je.unstable_act=Gx;je.useCallback=function(t,e){return pn.current.useCallback(t,e)};je.useContext=function(t){return pn.current.useContext(t)};je.useDebugValue=function(){};je.useDeferredValue=function(t){return pn.current.useDeferredValue(t)};je.useEffect=function(t,e){return pn.current.useEffect(t,e)};je.useId=function(){return pn.current.useId()};je.useImperativeHandle=function(t,e,n){return pn.current.useImperativeHandle(t,e,n)};je.useInsertionEffect=function(t,e){return pn.current.useInsertionEffect(t,e)};je.useLayoutEffect=function(t,e){return pn.current.useLayoutEffect(t,e)};je.useMemo=function(t,e){return pn.current.useMemo(t,e)};je.useReducer=function(t,e,n){return pn.current.useReducer(t,e,n)};je.useRef=function(t){return pn.current.useRef(t)};je.useState=function(t){return pn.current.useState(t)};je.useSyncExternalStore=function(t,e,n){return pn.current.useSyncExternalStore(t,e,n)};je.useTransition=function(){return pn.current.useTransition()};je.version="18.3.1";Vx.exports=je;var B=Vx.exports;const ys=Lx(B),KI=kI({__proto__:null,default:ys},[B]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var QI=B,ZI=Symbol.for("react.element"),JI=Symbol.for("react.fragment"),YI=Object.prototype.hasOwnProperty,XI=QI.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,eS={key:!0,ref:!0,__self:!0,__source:!0};function Wx(t,e,n){var r,i={},s=null,a=null;n!==void 0&&(s=""+n),e.key!==void 0&&(s=""+e.key),e.ref!==void 0&&(a=e.ref);for(r in e)YI.call(e,r)&&!eS.hasOwnProperty(r)&&(i[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:ZI,type:t,key:s,ref:a,props:i,_owner:XI.current}}Xd.Fragment=JI;Xd.jsx=Wx;Xd.jsxs=Wx;Mx.exports=Xd;var c=Mx.exports,qm={},Hx={exports:{}},Ln={},Kx={exports:{}},Qx={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(W,fe){var X=W.length;W.push(fe);e:for(;0<X;){var Y=X-1>>>1,ce=W[Y];if(0<i(ce,fe))W[Y]=fe,W[X]=ce,X=Y;else break e}}function n(W){return W.length===0?null:W[0]}function r(W){if(W.length===0)return null;var fe=W[0],X=W.pop();if(X!==fe){W[0]=X;e:for(var Y=0,ce=W.length,Ie=ce>>>1;Y<Ie;){var Oe=2*(Y+1)-1,Ne=W[Oe],xe=Oe+1,ut=W[xe];if(0>i(Ne,X))xe<ce&&0>i(ut,Ne)?(W[Y]=ut,W[xe]=X,Y=xe):(W[Y]=Ne,W[Oe]=X,Y=Oe);else if(xe<ce&&0>i(ut,X))W[Y]=ut,W[xe]=X,Y=xe;else break e}}return fe}function i(W,fe){var X=W.sortIndex-fe.sortIndex;return X!==0?X:W.id-fe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;t.unstable_now=function(){return s.now()}}else{var a=Date,u=a.now();t.unstable_now=function(){return a.now()-u}}var h=[],m=[],p=1,_=null,v=3,x=!1,T=!1,E=!1,R=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function A(W){for(var fe=n(m);fe!==null;){if(fe.callback===null)r(m);else if(fe.startTime<=W)r(m),fe.sortIndex=fe.expirationTime,e(h,fe);else break;fe=n(m)}}function U(W){if(E=!1,A(W),!T)if(n(h)!==null)T=!0,Te(Z);else{var fe=n(m);fe!==null&&se(U,fe.startTime-W)}}function Z(W,fe){T=!1,E&&(E=!1,S(N),N=-1),x=!0;var X=v;try{for(A(fe),_=n(h);_!==null&&(!(_.expirationTime>fe)||W&&!F());){var Y=_.callback;if(typeof Y=="function"){_.callback=null,v=_.priorityLevel;var ce=Y(_.expirationTime<=fe);fe=t.unstable_now(),typeof ce=="function"?_.callback=ce:_===n(h)&&r(h),A(fe)}else r(h);_=n(h)}if(_!==null)var Ie=!0;else{var Oe=n(m);Oe!==null&&se(U,Oe.startTime-fe),Ie=!1}return Ie}finally{_=null,v=X,x=!1}}var V=!1,k=null,N=-1,D=5,M=-1;function F(){return!(t.unstable_now()-M<D)}function z(){if(k!==null){var W=t.unstable_now();M=W;var fe=!0;try{fe=k(!0,W)}finally{fe?j():(V=!1,k=null)}}else V=!1}var j;if(typeof C=="function")j=function(){C(z)};else if(typeof MessageChannel<"u"){var me=new MessageChannel,Ve=me.port2;me.port1.onmessage=z,j=function(){Ve.postMessage(null)}}else j=function(){R(z,0)};function Te(W){k=W,V||(V=!0,j())}function se(W,fe){N=R(function(){W(t.unstable_now())},fe)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(W){W.callback=null},t.unstable_continueExecution=function(){T||x||(T=!0,Te(Z))},t.unstable_forceFrameRate=function(W){0>W||125<W?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<W?Math.floor(1e3/W):5},t.unstable_getCurrentPriorityLevel=function(){return v},t.unstable_getFirstCallbackNode=function(){return n(h)},t.unstable_next=function(W){switch(v){case 1:case 2:case 3:var fe=3;break;default:fe=v}var X=v;v=fe;try{return W()}finally{v=X}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(W,fe){switch(W){case 1:case 2:case 3:case 4:case 5:break;default:W=3}var X=v;v=W;try{return fe()}finally{v=X}},t.unstable_scheduleCallback=function(W,fe,X){var Y=t.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?Y+X:Y):X=Y,W){case 1:var ce=-1;break;case 2:ce=250;break;case 5:ce=1073741823;break;case 4:ce=1e4;break;default:ce=5e3}return ce=X+ce,W={id:p++,callback:fe,priorityLevel:W,startTime:X,expirationTime:ce,sortIndex:-1},X>Y?(W.sortIndex=X,e(m,W),n(h)===null&&W===n(m)&&(E?(S(N),N=-1):E=!0,se(U,X-Y))):(W.sortIndex=ce,e(h,W),T||x||(T=!0,Te(Z))),W},t.unstable_shouldYield=F,t.unstable_wrapCallback=function(W){var fe=v;return function(){var X=v;v=fe;try{return W.apply(this,arguments)}finally{v=X}}}})(Qx);Kx.exports=Qx;var tS=Kx.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var nS=B,jn=tS;function re(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Zx=new Set,Oc={};function jo(t,e){Ma(t,e),Ma(t+"Capture",e)}function Ma(t,e){for(Oc[t]=e,t=0;t<e.length;t++)Zx.add(e[t])}var hi=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Gm=Object.prototype.hasOwnProperty,rS=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Bv={},Uv={};function iS(t){return Gm.call(Uv,t)?!0:Gm.call(Bv,t)?!1:rS.test(t)?Uv[t]=!0:(Bv[t]=!0,!1)}function sS(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function oS(t,e,n,r){if(e===null||typeof e>"u"||sS(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function gn(t,e,n,r,i,s,a){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=a}var Yt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Yt[t]=new gn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Yt[e]=new gn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Yt[t]=new gn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Yt[t]=new gn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Yt[t]=new gn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Yt[t]=new gn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Yt[t]=new gn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Yt[t]=new gn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Yt[t]=new gn(t,5,!1,t.toLowerCase(),null,!1,!1)});var vg=/[\-:]([a-z])/g;function yg(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(vg,yg);Yt[e]=new gn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(vg,yg);Yt[e]=new gn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(vg,yg);Yt[e]=new gn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Yt[t]=new gn(t,1,!1,t.toLowerCase(),null,!1,!1)});Yt.xlinkHref=new gn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Yt[t]=new gn(t,1,!1,t.toLowerCase(),null,!0,!0)});function xg(t,e,n,r){var i=Yt.hasOwnProperty(e)?Yt[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(oS(e,n,i,r)&&(n=null),r||i===null?iS(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):i.mustUseProperty?t[i.propertyName]=n===null?i.type===3?!1:"":n:(e=i.attributeName,r=i.attributeNamespace,n===null?t.removeAttribute(e):(i=i.type,n=i===3||i===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var vi=nS.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,gh=Symbol.for("react.element"),ma=Symbol.for("react.portal"),pa=Symbol.for("react.fragment"),wg=Symbol.for("react.strict_mode"),Wm=Symbol.for("react.profiler"),Jx=Symbol.for("react.provider"),Yx=Symbol.for("react.context"),bg=Symbol.for("react.forward_ref"),Hm=Symbol.for("react.suspense"),Km=Symbol.for("react.suspense_list"),Eg=Symbol.for("react.memo"),Ji=Symbol.for("react.lazy"),Xx=Symbol.for("react.offscreen"),$v=Symbol.iterator;function Yl(t){return t===null||typeof t!="object"?null:(t=$v&&t[$v]||t["@@iterator"],typeof t=="function"?t:null)}var pt=Object.assign,nm;function fc(t){if(nm===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);nm=e&&e[1]||""}return`
`+nm+t}var rm=!1;function im(t,e){if(!t||rm)return"";rm=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(m){var r=m}Reflect.construct(t,[],e)}else{try{e.call()}catch(m){r=m}t.call(e.prototype)}else{try{throw Error()}catch(m){r=m}t()}}catch(m){if(m&&r&&typeof m.stack=="string"){for(var i=m.stack.split(`
`),s=r.stack.split(`
`),a=i.length-1,u=s.length-1;1<=a&&0<=u&&i[a]!==s[u];)u--;for(;1<=a&&0<=u;a--,u--)if(i[a]!==s[u]){if(a!==1||u!==1)do if(a--,u--,0>u||i[a]!==s[u]){var h=`
`+i[a].replace(" at new "," at ");return t.displayName&&h.includes("<anonymous>")&&(h=h.replace("<anonymous>",t.displayName)),h}while(1<=a&&0<=u);break}}}finally{rm=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?fc(t):""}function aS(t){switch(t.tag){case 5:return fc(t.type);case 16:return fc("Lazy");case 13:return fc("Suspense");case 19:return fc("SuspenseList");case 0:case 2:case 15:return t=im(t.type,!1),t;case 11:return t=im(t.type.render,!1),t;case 1:return t=im(t.type,!0),t;default:return""}}function Qm(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case pa:return"Fragment";case ma:return"Portal";case Wm:return"Profiler";case wg:return"StrictMode";case Hm:return"Suspense";case Km:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Yx:return(t.displayName||"Context")+".Consumer";case Jx:return(t._context.displayName||"Context")+".Provider";case bg:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Eg:return e=t.displayName||null,e!==null?e:Qm(t.type)||"Memo";case Ji:e=t._payload,t=t._init;try{return Qm(t(e))}catch{}}return null}function lS(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qm(e);case 8:return e===wg?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function xs(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function ew(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function cS(t){var e=ew(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var i=n.get,s=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return i.call(this)},set:function(a){r=""+a,s.call(this,a)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(a){r=""+a},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function _h(t){t._valueTracker||(t._valueTracker=cS(t))}function tw(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=ew(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function ld(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Zm(t,e){var n=e.checked;return pt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function qv(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=xs(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function nw(t,e){e=e.checked,e!=null&&xg(t,"checked",e,!1)}function Jm(t,e){nw(t,e);var n=xs(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?Ym(t,e.type,n):e.hasOwnProperty("defaultValue")&&Ym(t,e.type,xs(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function Gv(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function Ym(t,e,n){(e!=="number"||ld(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var mc=Array.isArray;function Ca(t,e,n,r){if(t=t.options,e){e={};for(var i=0;i<n.length;i++)e["$"+n[i]]=!0;for(n=0;n<t.length;n++)i=e.hasOwnProperty("$"+t[n].value),t[n].selected!==i&&(t[n].selected=i),i&&r&&(t[n].defaultSelected=!0)}else{for(n=""+xs(n),e=null,i=0;i<t.length;i++){if(t[i].value===n){t[i].selected=!0,r&&(t[i].defaultSelected=!0);return}e!==null||t[i].disabled||(e=t[i])}e!==null&&(e.selected=!0)}}function Xm(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(re(91));return pt({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Wv(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(re(92));if(mc(n)){if(1<n.length)throw Error(re(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:xs(n)}}function rw(t,e){var n=xs(e.value),r=xs(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function Hv(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function iw(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ep(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?iw(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var vh,sw=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,i){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,i)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(vh=vh||document.createElement("div"),vh.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=vh.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Fc(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var bc={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},uS=["Webkit","ms","Moz","O"];Object.keys(bc).forEach(function(t){uS.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),bc[e]=bc[t]})});function ow(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||bc.hasOwnProperty(t)&&bc[t]?(""+e).trim():e+"px"}function aw(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,i=ow(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,i):t[n]=i}}var hS=pt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function tp(t,e){if(e){if(hS[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(re(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(re(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(re(61))}if(e.style!=null&&typeof e.style!="object")throw Error(re(62))}}function np(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var rp=null;function Tg(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var ip=null,Pa=null,Na=null;function Kv(t){if(t=bu(t)){if(typeof ip!="function")throw Error(re(280));var e=t.stateNode;e&&(e=sf(e),ip(t.stateNode,t.type,e))}}function lw(t){Pa?Na?Na.push(t):Na=[t]:Pa=t}function cw(){if(Pa){var t=Pa,e=Na;if(Na=Pa=null,Kv(t),e)for(t=0;t<e.length;t++)Kv(e[t])}}function uw(t,e){return t(e)}function hw(){}var sm=!1;function dw(t,e,n){if(sm)return t(e,n);sm=!0;try{return uw(t,e,n)}finally{sm=!1,(Pa!==null||Na!==null)&&(hw(),cw())}}function zc(t,e){var n=t.stateNode;if(n===null)return null;var r=sf(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(re(231,e,typeof n));return n}var sp=!1;if(hi)try{var Xl={};Object.defineProperty(Xl,"passive",{get:function(){sp=!0}}),window.addEventListener("test",Xl,Xl),window.removeEventListener("test",Xl,Xl)}catch{sp=!1}function dS(t,e,n,r,i,s,a,u,h){var m=Array.prototype.slice.call(arguments,3);try{e.apply(n,m)}catch(p){this.onError(p)}}var Ec=!1,cd=null,ud=!1,op=null,fS={onError:function(t){Ec=!0,cd=t}};function mS(t,e,n,r,i,s,a,u,h){Ec=!1,cd=null,dS.apply(fS,arguments)}function pS(t,e,n,r,i,s,a,u,h){if(mS.apply(this,arguments),Ec){if(Ec){var m=cd;Ec=!1,cd=null}else throw Error(re(198));ud||(ud=!0,op=m)}}function Do(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function fw(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function Qv(t){if(Do(t)!==t)throw Error(re(188))}function gS(t){var e=t.alternate;if(!e){if(e=Do(t),e===null)throw Error(re(188));return e!==t?null:t}for(var n=t,r=e;;){var i=n.return;if(i===null)break;var s=i.alternate;if(s===null){if(r=i.return,r!==null){n=r;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===n)return Qv(i),t;if(s===r)return Qv(i),e;s=s.sibling}throw Error(re(188))}if(n.return!==r.return)n=i,r=s;else{for(var a=!1,u=i.child;u;){if(u===n){a=!0,n=i,r=s;break}if(u===r){a=!0,r=i,n=s;break}u=u.sibling}if(!a){for(u=s.child;u;){if(u===n){a=!0,n=s,r=i;break}if(u===r){a=!0,r=s,n=i;break}u=u.sibling}if(!a)throw Error(re(189))}}if(n.alternate!==r)throw Error(re(190))}if(n.tag!==3)throw Error(re(188));return n.stateNode.current===n?t:e}function mw(t){return t=gS(t),t!==null?pw(t):null}function pw(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=pw(t);if(e!==null)return e;t=t.sibling}return null}var gw=jn.unstable_scheduleCallback,Zv=jn.unstable_cancelCallback,_S=jn.unstable_shouldYield,vS=jn.unstable_requestPaint,Et=jn.unstable_now,yS=jn.unstable_getCurrentPriorityLevel,Ig=jn.unstable_ImmediatePriority,_w=jn.unstable_UserBlockingPriority,hd=jn.unstable_NormalPriority,xS=jn.unstable_LowPriority,vw=jn.unstable_IdlePriority,ef=null,Dr=null;function wS(t){if(Dr&&typeof Dr.onCommitFiberRoot=="function")try{Dr.onCommitFiberRoot(ef,t,void 0,(t.current.flags&128)===128)}catch{}}var mr=Math.clz32?Math.clz32:TS,bS=Math.log,ES=Math.LN2;function TS(t){return t>>>=0,t===0?32:31-(bS(t)/ES|0)|0}var yh=64,xh=4194304;function pc(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function dd(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,i=t.suspendedLanes,s=t.pingedLanes,a=n&268435455;if(a!==0){var u=a&~i;u!==0?r=pc(u):(s&=a,s!==0&&(r=pc(s)))}else a=n&~i,a!==0?r=pc(a):s!==0&&(r=pc(s));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,s=e&-e,i>=s||i===16&&(s&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-mr(e),i=1<<n,r|=t[n],e&=~i;return r}function IS(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function SS(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,i=t.expirationTimes,s=t.pendingLanes;0<s;){var a=31-mr(s),u=1<<a,h=i[a];h===-1?(!(u&n)||u&r)&&(i[a]=IS(u,e)):h<=e&&(t.expiredLanes|=u),s&=~u}}function ap(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function yw(){var t=yh;return yh<<=1,!(yh&4194240)&&(yh=64),t}function om(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function xu(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-mr(e),t[e]=n}function CS(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var i=31-mr(n),s=1<<i;e[i]=0,r[i]=-1,t[i]=-1,n&=~s}}function Sg(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-mr(n),i=1<<r;i&e|t[r]&e&&(t[r]|=e),n&=~i}}var He=0;function xw(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var ww,Cg,bw,Ew,Tw,lp=!1,wh=[],cs=null,us=null,hs=null,Bc=new Map,Uc=new Map,Xi=[],PS="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Jv(t,e){switch(t){case"focusin":case"focusout":cs=null;break;case"dragenter":case"dragleave":us=null;break;case"mouseover":case"mouseout":hs=null;break;case"pointerover":case"pointerout":Bc.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Uc.delete(e.pointerId)}}function ec(t,e,n,r,i,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:s,targetContainers:[i]},e!==null&&(e=bu(e),e!==null&&Cg(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),t)}function NS(t,e,n,r,i){switch(e){case"focusin":return cs=ec(cs,t,e,n,r,i),!0;case"dragenter":return us=ec(us,t,e,n,r,i),!0;case"mouseover":return hs=ec(hs,t,e,n,r,i),!0;case"pointerover":var s=i.pointerId;return Bc.set(s,ec(Bc.get(s)||null,t,e,n,r,i)),!0;case"gotpointercapture":return s=i.pointerId,Uc.set(s,ec(Uc.get(s)||null,t,e,n,r,i)),!0}return!1}function Iw(t){var e=lo(t.target);if(e!==null){var n=Do(e);if(n!==null){if(e=n.tag,e===13){if(e=fw(n),e!==null){t.blockedOn=e,Tw(t.priority,function(){bw(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function $h(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=cp(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);rp=r,n.target.dispatchEvent(r),rp=null}else return e=bu(n),e!==null&&Cg(e),t.blockedOn=n,!1;e.shift()}return!0}function Yv(t,e,n){$h(t)&&n.delete(e)}function AS(){lp=!1,cs!==null&&$h(cs)&&(cs=null),us!==null&&$h(us)&&(us=null),hs!==null&&$h(hs)&&(hs=null),Bc.forEach(Yv),Uc.forEach(Yv)}function tc(t,e){t.blockedOn===e&&(t.blockedOn=null,lp||(lp=!0,jn.unstable_scheduleCallback(jn.unstable_NormalPriority,AS)))}function $c(t){function e(i){return tc(i,t)}if(0<wh.length){tc(wh[0],t);for(var n=1;n<wh.length;n++){var r=wh[n];r.blockedOn===t&&(r.blockedOn=null)}}for(cs!==null&&tc(cs,t),us!==null&&tc(us,t),hs!==null&&tc(hs,t),Bc.forEach(e),Uc.forEach(e),n=0;n<Xi.length;n++)r=Xi[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Xi.length&&(n=Xi[0],n.blockedOn===null);)Iw(n),n.blockedOn===null&&Xi.shift()}var Aa=vi.ReactCurrentBatchConfig,fd=!0;function kS(t,e,n,r){var i=He,s=Aa.transition;Aa.transition=null;try{He=1,Pg(t,e,n,r)}finally{He=i,Aa.transition=s}}function RS(t,e,n,r){var i=He,s=Aa.transition;Aa.transition=null;try{He=4,Pg(t,e,n,r)}finally{He=i,Aa.transition=s}}function Pg(t,e,n,r){if(fd){var i=cp(t,e,n,r);if(i===null)gm(t,e,r,md,n),Jv(t,r);else if(NS(i,t,e,n,r))r.stopPropagation();else if(Jv(t,r),e&4&&-1<PS.indexOf(t)){for(;i!==null;){var s=bu(i);if(s!==null&&ww(s),s=cp(t,e,n,r),s===null&&gm(t,e,r,md,n),s===i)break;i=s}i!==null&&r.stopPropagation()}else gm(t,e,r,null,n)}}var md=null;function cp(t,e,n,r){if(md=null,t=Tg(r),t=lo(t),t!==null)if(e=Do(t),e===null)t=null;else if(n=e.tag,n===13){if(t=fw(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return md=t,null}function Sw(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(yS()){case Ig:return 1;case _w:return 4;case hd:case xS:return 16;case vw:return 536870912;default:return 16}default:return 16}}var ss=null,Ng=null,qh=null;function Cw(){if(qh)return qh;var t,e=Ng,n=e.length,r,i="value"in ss?ss.value:ss.textContent,s=i.length;for(t=0;t<n&&e[t]===i[t];t++);var a=n-t;for(r=1;r<=a&&e[n-r]===i[s-r];r++);return qh=i.slice(t,1<r?1-r:void 0)}function Gh(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function bh(){return!0}function Xv(){return!1}function Mn(t){function e(n,r,i,s,a){this._reactName=n,this._targetInst=i,this.type=r,this.nativeEvent=s,this.target=a,this.currentTarget=null;for(var u in t)t.hasOwnProperty(u)&&(n=t[u],this[u]=n?n(s):s[u]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?bh:Xv,this.isPropagationStopped=Xv,this}return pt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=bh)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=bh)},persist:function(){},isPersistent:bh}),e}var cl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ag=Mn(cl),wu=pt({},cl,{view:0,detail:0}),jS=Mn(wu),am,lm,nc,tf=pt({},wu,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:kg,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==nc&&(nc&&t.type==="mousemove"?(am=t.screenX-nc.screenX,lm=t.screenY-nc.screenY):lm=am=0,nc=t),am)},movementY:function(t){return"movementY"in t?t.movementY:lm}}),ey=Mn(tf),DS=pt({},tf,{dataTransfer:0}),LS=Mn(DS),MS=pt({},wu,{relatedTarget:0}),cm=Mn(MS),VS=pt({},cl,{animationName:0,elapsedTime:0,pseudoElement:0}),OS=Mn(VS),FS=pt({},cl,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),zS=Mn(FS),BS=pt({},cl,{data:0}),ty=Mn(BS),US={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},$S={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},qS={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function GS(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=qS[t])?!!e[t]:!1}function kg(){return GS}var WS=pt({},wu,{key:function(t){if(t.key){var e=US[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Gh(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?$S[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:kg,charCode:function(t){return t.type==="keypress"?Gh(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Gh(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),HS=Mn(WS),KS=pt({},tf,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ny=Mn(KS),QS=pt({},wu,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:kg}),ZS=Mn(QS),JS=pt({},cl,{propertyName:0,elapsedTime:0,pseudoElement:0}),YS=Mn(JS),XS=pt({},tf,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),eC=Mn(XS),tC=[9,13,27,32],Rg=hi&&"CompositionEvent"in window,Tc=null;hi&&"documentMode"in document&&(Tc=document.documentMode);var nC=hi&&"TextEvent"in window&&!Tc,Pw=hi&&(!Rg||Tc&&8<Tc&&11>=Tc),ry=String.fromCharCode(32),iy=!1;function Nw(t,e){switch(t){case"keyup":return tC.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Aw(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ga=!1;function rC(t,e){switch(t){case"compositionend":return Aw(e);case"keypress":return e.which!==32?null:(iy=!0,ry);case"textInput":return t=e.data,t===ry&&iy?null:t;default:return null}}function iC(t,e){if(ga)return t==="compositionend"||!Rg&&Nw(t,e)?(t=Cw(),qh=Ng=ss=null,ga=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Pw&&e.locale!=="ko"?null:e.data;default:return null}}var sC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function sy(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!sC[t.type]:e==="textarea"}function kw(t,e,n,r){lw(r),e=pd(e,"onChange"),0<e.length&&(n=new Ag("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var Ic=null,qc=null;function oC(t){Uw(t,0)}function nf(t){var e=ya(t);if(tw(e))return t}function aC(t,e){if(t==="change")return e}var Rw=!1;if(hi){var um;if(hi){var hm="oninput"in document;if(!hm){var oy=document.createElement("div");oy.setAttribute("oninput","return;"),hm=typeof oy.oninput=="function"}um=hm}else um=!1;Rw=um&&(!document.documentMode||9<document.documentMode)}function ay(){Ic&&(Ic.detachEvent("onpropertychange",jw),qc=Ic=null)}function jw(t){if(t.propertyName==="value"&&nf(qc)){var e=[];kw(e,qc,t,Tg(t)),dw(oC,e)}}function lC(t,e,n){t==="focusin"?(ay(),Ic=e,qc=n,Ic.attachEvent("onpropertychange",jw)):t==="focusout"&&ay()}function cC(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return nf(qc)}function uC(t,e){if(t==="click")return nf(e)}function hC(t,e){if(t==="input"||t==="change")return nf(e)}function dC(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var gr=typeof Object.is=="function"?Object.is:dC;function Gc(t,e){if(gr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var i=n[r];if(!Gm.call(e,i)||!gr(t[i],e[i]))return!1}return!0}function ly(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function cy(t,e){var n=ly(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=ly(n)}}function Dw(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?Dw(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function Lw(){for(var t=window,e=ld();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=ld(t.document)}return e}function jg(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function fC(t){var e=Lw(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&Dw(n.ownerDocument.documentElement,n)){if(r!==null&&jg(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var i=n.textContent.length,s=Math.min(r.start,i);r=r.end===void 0?s:Math.min(r.end,i),!t.extend&&s>r&&(i=r,r=s,s=i),i=cy(n,s);var a=cy(n,r);i&&a&&(t.rangeCount!==1||t.anchorNode!==i.node||t.anchorOffset!==i.offset||t.focusNode!==a.node||t.focusOffset!==a.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),t.removeAllRanges(),s>r?(t.addRange(e),t.extend(a.node,a.offset)):(e.setEnd(a.node,a.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var mC=hi&&"documentMode"in document&&11>=document.documentMode,_a=null,up=null,Sc=null,hp=!1;function uy(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;hp||_a==null||_a!==ld(r)||(r=_a,"selectionStart"in r&&jg(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),Sc&&Gc(Sc,r)||(Sc=r,r=pd(up,"onSelect"),0<r.length&&(e=new Ag("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=_a)))}function Eh(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var va={animationend:Eh("Animation","AnimationEnd"),animationiteration:Eh("Animation","AnimationIteration"),animationstart:Eh("Animation","AnimationStart"),transitionend:Eh("Transition","TransitionEnd")},dm={},Mw={};hi&&(Mw=document.createElement("div").style,"AnimationEvent"in window||(delete va.animationend.animation,delete va.animationiteration.animation,delete va.animationstart.animation),"TransitionEvent"in window||delete va.transitionend.transition);function rf(t){if(dm[t])return dm[t];if(!va[t])return t;var e=va[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in Mw)return dm[t]=e[n];return t}var Vw=rf("animationend"),Ow=rf("animationiteration"),Fw=rf("animationstart"),zw=rf("transitionend"),Bw=new Map,hy="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ns(t,e){Bw.set(t,e),jo(e,[t])}for(var fm=0;fm<hy.length;fm++){var mm=hy[fm],pC=mm.toLowerCase(),gC=mm[0].toUpperCase()+mm.slice(1);Ns(pC,"on"+gC)}Ns(Vw,"onAnimationEnd");Ns(Ow,"onAnimationIteration");Ns(Fw,"onAnimationStart");Ns("dblclick","onDoubleClick");Ns("focusin","onFocus");Ns("focusout","onBlur");Ns(zw,"onTransitionEnd");Ma("onMouseEnter",["mouseout","mouseover"]);Ma("onMouseLeave",["mouseout","mouseover"]);Ma("onPointerEnter",["pointerout","pointerover"]);Ma("onPointerLeave",["pointerout","pointerover"]);jo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));jo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));jo("onBeforeInput",["compositionend","keypress","textInput","paste"]);jo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));jo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));jo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var gc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),_C=new Set("cancel close invalid load scroll toggle".split(" ").concat(gc));function dy(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,pS(r,e,void 0,t),t.currentTarget=null}function Uw(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],i=r.event;r=r.listeners;e:{var s=void 0;if(e)for(var a=r.length-1;0<=a;a--){var u=r[a],h=u.instance,m=u.currentTarget;if(u=u.listener,h!==s&&i.isPropagationStopped())break e;dy(i,u,m),s=h}else for(a=0;a<r.length;a++){if(u=r[a],h=u.instance,m=u.currentTarget,u=u.listener,h!==s&&i.isPropagationStopped())break e;dy(i,u,m),s=h}}}if(ud)throw t=op,ud=!1,op=null,t}function tt(t,e){var n=e[gp];n===void 0&&(n=e[gp]=new Set);var r=t+"__bubble";n.has(r)||($w(e,t,2,!1),n.add(r))}function pm(t,e,n){var r=0;e&&(r|=4),$w(n,t,r,e)}var Th="_reactListening"+Math.random().toString(36).slice(2);function Wc(t){if(!t[Th]){t[Th]=!0,Zx.forEach(function(n){n!=="selectionchange"&&(_C.has(n)||pm(n,!1,t),pm(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Th]||(e[Th]=!0,pm("selectionchange",!1,e))}}function $w(t,e,n,r){switch(Sw(e)){case 1:var i=kS;break;case 4:i=RS;break;default:i=Pg}n=i.bind(null,e,n,t),i=void 0,!sp||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?t.addEventListener(e,n,{capture:!0,passive:i}):t.addEventListener(e,n,!0):i!==void 0?t.addEventListener(e,n,{passive:i}):t.addEventListener(e,n,!1)}function gm(t,e,n,r,i){var s=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var a=r.tag;if(a===3||a===4){var u=r.stateNode.containerInfo;if(u===i||u.nodeType===8&&u.parentNode===i)break;if(a===4)for(a=r.return;a!==null;){var h=a.tag;if((h===3||h===4)&&(h=a.stateNode.containerInfo,h===i||h.nodeType===8&&h.parentNode===i))return;a=a.return}for(;u!==null;){if(a=lo(u),a===null)return;if(h=a.tag,h===5||h===6){r=s=a;continue e}u=u.parentNode}}r=r.return}dw(function(){var m=s,p=Tg(n),_=[];e:{var v=Bw.get(t);if(v!==void 0){var x=Ag,T=t;switch(t){case"keypress":if(Gh(n)===0)break e;case"keydown":case"keyup":x=HS;break;case"focusin":T="focus",x=cm;break;case"focusout":T="blur",x=cm;break;case"beforeblur":case"afterblur":x=cm;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":x=ey;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":x=LS;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":x=ZS;break;case Vw:case Ow:case Fw:x=OS;break;case zw:x=YS;break;case"scroll":x=jS;break;case"wheel":x=eC;break;case"copy":case"cut":case"paste":x=zS;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":x=ny}var E=(e&4)!==0,R=!E&&t==="scroll",S=E?v!==null?v+"Capture":null:v;E=[];for(var C=m,A;C!==null;){A=C;var U=A.stateNode;if(A.tag===5&&U!==null&&(A=U,S!==null&&(U=zc(C,S),U!=null&&E.push(Hc(C,U,A)))),R)break;C=C.return}0<E.length&&(v=new x(v,T,null,n,p),_.push({event:v,listeners:E}))}}if(!(e&7)){e:{if(v=t==="mouseover"||t==="pointerover",x=t==="mouseout"||t==="pointerout",v&&n!==rp&&(T=n.relatedTarget||n.fromElement)&&(lo(T)||T[di]))break e;if((x||v)&&(v=p.window===p?p:(v=p.ownerDocument)?v.defaultView||v.parentWindow:window,x?(T=n.relatedTarget||n.toElement,x=m,T=T?lo(T):null,T!==null&&(R=Do(T),T!==R||T.tag!==5&&T.tag!==6)&&(T=null)):(x=null,T=m),x!==T)){if(E=ey,U="onMouseLeave",S="onMouseEnter",C="mouse",(t==="pointerout"||t==="pointerover")&&(E=ny,U="onPointerLeave",S="onPointerEnter",C="pointer"),R=x==null?v:ya(x),A=T==null?v:ya(T),v=new E(U,C+"leave",x,n,p),v.target=R,v.relatedTarget=A,U=null,lo(p)===m&&(E=new E(S,C+"enter",T,n,p),E.target=A,E.relatedTarget=R,U=E),R=U,x&&T)t:{for(E=x,S=T,C=0,A=E;A;A=ra(A))C++;for(A=0,U=S;U;U=ra(U))A++;for(;0<C-A;)E=ra(E),C--;for(;0<A-C;)S=ra(S),A--;for(;C--;){if(E===S||S!==null&&E===S.alternate)break t;E=ra(E),S=ra(S)}E=null}else E=null;x!==null&&fy(_,v,x,E,!1),T!==null&&R!==null&&fy(_,R,T,E,!0)}}e:{if(v=m?ya(m):window,x=v.nodeName&&v.nodeName.toLowerCase(),x==="select"||x==="input"&&v.type==="file")var Z=aC;else if(sy(v))if(Rw)Z=hC;else{Z=cC;var V=lC}else(x=v.nodeName)&&x.toLowerCase()==="input"&&(v.type==="checkbox"||v.type==="radio")&&(Z=uC);if(Z&&(Z=Z(t,m))){kw(_,Z,n,p);break e}V&&V(t,v,m),t==="focusout"&&(V=v._wrapperState)&&V.controlled&&v.type==="number"&&Ym(v,"number",v.value)}switch(V=m?ya(m):window,t){case"focusin":(sy(V)||V.contentEditable==="true")&&(_a=V,up=m,Sc=null);break;case"focusout":Sc=up=_a=null;break;case"mousedown":hp=!0;break;case"contextmenu":case"mouseup":case"dragend":hp=!1,uy(_,n,p);break;case"selectionchange":if(mC)break;case"keydown":case"keyup":uy(_,n,p)}var k;if(Rg)e:{switch(t){case"compositionstart":var N="onCompositionStart";break e;case"compositionend":N="onCompositionEnd";break e;case"compositionupdate":N="onCompositionUpdate";break e}N=void 0}else ga?Nw(t,n)&&(N="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(N="onCompositionStart");N&&(Pw&&n.locale!=="ko"&&(ga||N!=="onCompositionStart"?N==="onCompositionEnd"&&ga&&(k=Cw()):(ss=p,Ng="value"in ss?ss.value:ss.textContent,ga=!0)),V=pd(m,N),0<V.length&&(N=new ty(N,t,null,n,p),_.push({event:N,listeners:V}),k?N.data=k:(k=Aw(n),k!==null&&(N.data=k)))),(k=nC?rC(t,n):iC(t,n))&&(m=pd(m,"onBeforeInput"),0<m.length&&(p=new ty("onBeforeInput","beforeinput",null,n,p),_.push({event:p,listeners:m}),p.data=k))}Uw(_,e)})}function Hc(t,e,n){return{instance:t,listener:e,currentTarget:n}}function pd(t,e){for(var n=e+"Capture",r=[];t!==null;){var i=t,s=i.stateNode;i.tag===5&&s!==null&&(i=s,s=zc(t,n),s!=null&&r.unshift(Hc(t,s,i)),s=zc(t,e),s!=null&&r.push(Hc(t,s,i))),t=t.return}return r}function ra(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function fy(t,e,n,r,i){for(var s=e._reactName,a=[];n!==null&&n!==r;){var u=n,h=u.alternate,m=u.stateNode;if(h!==null&&h===r)break;u.tag===5&&m!==null&&(u=m,i?(h=zc(n,s),h!=null&&a.unshift(Hc(n,h,u))):i||(h=zc(n,s),h!=null&&a.push(Hc(n,h,u)))),n=n.return}a.length!==0&&t.push({event:e,listeners:a})}var vC=/\r\n?/g,yC=/\u0000|\uFFFD/g;function my(t){return(typeof t=="string"?t:""+t).replace(vC,`
`).replace(yC,"")}function Ih(t,e,n){if(e=my(e),my(t)!==e&&n)throw Error(re(425))}function gd(){}var dp=null,fp=null;function mp(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var pp=typeof setTimeout=="function"?setTimeout:void 0,xC=typeof clearTimeout=="function"?clearTimeout:void 0,py=typeof Promise=="function"?Promise:void 0,wC=typeof queueMicrotask=="function"?queueMicrotask:typeof py<"u"?function(t){return py.resolve(null).then(t).catch(bC)}:pp;function bC(t){setTimeout(function(){throw t})}function _m(t,e){var n=e,r=0;do{var i=n.nextSibling;if(t.removeChild(n),i&&i.nodeType===8)if(n=i.data,n==="/$"){if(r===0){t.removeChild(i),$c(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=i}while(n);$c(e)}function ds(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function gy(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ul=Math.random().toString(36).slice(2),kr="__reactFiber$"+ul,Kc="__reactProps$"+ul,di="__reactContainer$"+ul,gp="__reactEvents$"+ul,EC="__reactListeners$"+ul,TC="__reactHandles$"+ul;function lo(t){var e=t[kr];if(e)return e;for(var n=t.parentNode;n;){if(e=n[di]||n[kr]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=gy(t);t!==null;){if(n=t[kr])return n;t=gy(t)}return e}t=n,n=t.parentNode}return null}function bu(t){return t=t[kr]||t[di],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ya(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(re(33))}function sf(t){return t[Kc]||null}var _p=[],xa=-1;function As(t){return{current:t}}function rt(t){0>xa||(t.current=_p[xa],_p[xa]=null,xa--)}function Ye(t,e){xa++,_p[xa]=t.current,t.current=e}var ws={},hn=As(ws),Tn=As(!1),_o=ws;function Va(t,e){var n=t.type.contextTypes;if(!n)return ws;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},s;for(s in n)i[s]=e[s];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=i),i}function In(t){return t=t.childContextTypes,t!=null}function _d(){rt(Tn),rt(hn)}function _y(t,e,n){if(hn.current!==ws)throw Error(re(168));Ye(hn,e),Ye(Tn,n)}function qw(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(re(108,lS(t)||"Unknown",i));return pt({},n,r)}function vd(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||ws,_o=hn.current,Ye(hn,t),Ye(Tn,Tn.current),!0}function vy(t,e,n){var r=t.stateNode;if(!r)throw Error(re(169));n?(t=qw(t,e,_o),r.__reactInternalMemoizedMergedChildContext=t,rt(Tn),rt(hn),Ye(hn,t)):rt(Tn),Ye(Tn,n)}var si=null,of=!1,vm=!1;function Gw(t){si===null?si=[t]:si.push(t)}function IC(t){of=!0,Gw(t)}function ks(){if(!vm&&si!==null){vm=!0;var t=0,e=He;try{var n=si;for(He=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}si=null,of=!1}catch(i){throw si!==null&&(si=si.slice(t+1)),gw(Ig,ks),i}finally{He=e,vm=!1}}return null}var wa=[],ba=0,yd=null,xd=0,qn=[],Gn=0,vo=null,oi=1,ai="";function eo(t,e){wa[ba++]=xd,wa[ba++]=yd,yd=t,xd=e}function Ww(t,e,n){qn[Gn++]=oi,qn[Gn++]=ai,qn[Gn++]=vo,vo=t;var r=oi;t=ai;var i=32-mr(r)-1;r&=~(1<<i),n+=1;var s=32-mr(e)+i;if(30<s){var a=i-i%5;s=(r&(1<<a)-1).toString(32),r>>=a,i-=a,oi=1<<32-mr(e)+i|n<<i|r,ai=s+t}else oi=1<<s|n<<i|r,ai=t}function Dg(t){t.return!==null&&(eo(t,1),Ww(t,1,0))}function Lg(t){for(;t===yd;)yd=wa[--ba],wa[ba]=null,xd=wa[--ba],wa[ba]=null;for(;t===vo;)vo=qn[--Gn],qn[Gn]=null,ai=qn[--Gn],qn[Gn]=null,oi=qn[--Gn],qn[Gn]=null}var Rn=null,kn=null,ot=!1,dr=null;function Hw(t,e){var n=Wn(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function yy(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Rn=t,kn=ds(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Rn=t,kn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=vo!==null?{id:oi,overflow:ai}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=Wn(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Rn=t,kn=null,!0):!1;default:return!1}}function vp(t){return(t.mode&1)!==0&&(t.flags&128)===0}function yp(t){if(ot){var e=kn;if(e){var n=e;if(!yy(t,e)){if(vp(t))throw Error(re(418));e=ds(n.nextSibling);var r=Rn;e&&yy(t,e)?Hw(r,n):(t.flags=t.flags&-4097|2,ot=!1,Rn=t)}}else{if(vp(t))throw Error(re(418));t.flags=t.flags&-4097|2,ot=!1,Rn=t}}}function xy(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Rn=t}function Sh(t){if(t!==Rn)return!1;if(!ot)return xy(t),ot=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!mp(t.type,t.memoizedProps)),e&&(e=kn)){if(vp(t))throw Kw(),Error(re(418));for(;e;)Hw(t,e),e=ds(e.nextSibling)}if(xy(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(re(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){kn=ds(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}kn=null}}else kn=Rn?ds(t.stateNode.nextSibling):null;return!0}function Kw(){for(var t=kn;t;)t=ds(t.nextSibling)}function Oa(){kn=Rn=null,ot=!1}function Mg(t){dr===null?dr=[t]:dr.push(t)}var SC=vi.ReactCurrentBatchConfig;function rc(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(re(309));var r=n.stateNode}if(!r)throw Error(re(147,t));var i=r,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(a){var u=i.refs;a===null?delete u[s]:u[s]=a},e._stringRef=s,e)}if(typeof t!="string")throw Error(re(284));if(!n._owner)throw Error(re(290,t))}return t}function Ch(t,e){throw t=Object.prototype.toString.call(e),Error(re(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function wy(t){var e=t._init;return e(t._payload)}function Qw(t){function e(S,C){if(t){var A=S.deletions;A===null?(S.deletions=[C],S.flags|=16):A.push(C)}}function n(S,C){if(!t)return null;for(;C!==null;)e(S,C),C=C.sibling;return null}function r(S,C){for(S=new Map;C!==null;)C.key!==null?S.set(C.key,C):S.set(C.index,C),C=C.sibling;return S}function i(S,C){return S=gs(S,C),S.index=0,S.sibling=null,S}function s(S,C,A){return S.index=A,t?(A=S.alternate,A!==null?(A=A.index,A<C?(S.flags|=2,C):A):(S.flags|=2,C)):(S.flags|=1048576,C)}function a(S){return t&&S.alternate===null&&(S.flags|=2),S}function u(S,C,A,U){return C===null||C.tag!==6?(C=Im(A,S.mode,U),C.return=S,C):(C=i(C,A),C.return=S,C)}function h(S,C,A,U){var Z=A.type;return Z===pa?p(S,C,A.props.children,U,A.key):C!==null&&(C.elementType===Z||typeof Z=="object"&&Z!==null&&Z.$$typeof===Ji&&wy(Z)===C.type)?(U=i(C,A.props),U.ref=rc(S,C,A),U.return=S,U):(U=Yh(A.type,A.key,A.props,null,S.mode,U),U.ref=rc(S,C,A),U.return=S,U)}function m(S,C,A,U){return C===null||C.tag!==4||C.stateNode.containerInfo!==A.containerInfo||C.stateNode.implementation!==A.implementation?(C=Sm(A,S.mode,U),C.return=S,C):(C=i(C,A.children||[]),C.return=S,C)}function p(S,C,A,U,Z){return C===null||C.tag!==7?(C=mo(A,S.mode,U,Z),C.return=S,C):(C=i(C,A),C.return=S,C)}function _(S,C,A){if(typeof C=="string"&&C!==""||typeof C=="number")return C=Im(""+C,S.mode,A),C.return=S,C;if(typeof C=="object"&&C!==null){switch(C.$$typeof){case gh:return A=Yh(C.type,C.key,C.props,null,S.mode,A),A.ref=rc(S,null,C),A.return=S,A;case ma:return C=Sm(C,S.mode,A),C.return=S,C;case Ji:var U=C._init;return _(S,U(C._payload),A)}if(mc(C)||Yl(C))return C=mo(C,S.mode,A,null),C.return=S,C;Ch(S,C)}return null}function v(S,C,A,U){var Z=C!==null?C.key:null;if(typeof A=="string"&&A!==""||typeof A=="number")return Z!==null?null:u(S,C,""+A,U);if(typeof A=="object"&&A!==null){switch(A.$$typeof){case gh:return A.key===Z?h(S,C,A,U):null;case ma:return A.key===Z?m(S,C,A,U):null;case Ji:return Z=A._init,v(S,C,Z(A._payload),U)}if(mc(A)||Yl(A))return Z!==null?null:p(S,C,A,U,null);Ch(S,A)}return null}function x(S,C,A,U,Z){if(typeof U=="string"&&U!==""||typeof U=="number")return S=S.get(A)||null,u(C,S,""+U,Z);if(typeof U=="object"&&U!==null){switch(U.$$typeof){case gh:return S=S.get(U.key===null?A:U.key)||null,h(C,S,U,Z);case ma:return S=S.get(U.key===null?A:U.key)||null,m(C,S,U,Z);case Ji:var V=U._init;return x(S,C,A,V(U._payload),Z)}if(mc(U)||Yl(U))return S=S.get(A)||null,p(C,S,U,Z,null);Ch(C,U)}return null}function T(S,C,A,U){for(var Z=null,V=null,k=C,N=C=0,D=null;k!==null&&N<A.length;N++){k.index>N?(D=k,k=null):D=k.sibling;var M=v(S,k,A[N],U);if(M===null){k===null&&(k=D);break}t&&k&&M.alternate===null&&e(S,k),C=s(M,C,N),V===null?Z=M:V.sibling=M,V=M,k=D}if(N===A.length)return n(S,k),ot&&eo(S,N),Z;if(k===null){for(;N<A.length;N++)k=_(S,A[N],U),k!==null&&(C=s(k,C,N),V===null?Z=k:V.sibling=k,V=k);return ot&&eo(S,N),Z}for(k=r(S,k);N<A.length;N++)D=x(k,S,N,A[N],U),D!==null&&(t&&D.alternate!==null&&k.delete(D.key===null?N:D.key),C=s(D,C,N),V===null?Z=D:V.sibling=D,V=D);return t&&k.forEach(function(F){return e(S,F)}),ot&&eo(S,N),Z}function E(S,C,A,U){var Z=Yl(A);if(typeof Z!="function")throw Error(re(150));if(A=Z.call(A),A==null)throw Error(re(151));for(var V=Z=null,k=C,N=C=0,D=null,M=A.next();k!==null&&!M.done;N++,M=A.next()){k.index>N?(D=k,k=null):D=k.sibling;var F=v(S,k,M.value,U);if(F===null){k===null&&(k=D);break}t&&k&&F.alternate===null&&e(S,k),C=s(F,C,N),V===null?Z=F:V.sibling=F,V=F,k=D}if(M.done)return n(S,k),ot&&eo(S,N),Z;if(k===null){for(;!M.done;N++,M=A.next())M=_(S,M.value,U),M!==null&&(C=s(M,C,N),V===null?Z=M:V.sibling=M,V=M);return ot&&eo(S,N),Z}for(k=r(S,k);!M.done;N++,M=A.next())M=x(k,S,N,M.value,U),M!==null&&(t&&M.alternate!==null&&k.delete(M.key===null?N:M.key),C=s(M,C,N),V===null?Z=M:V.sibling=M,V=M);return t&&k.forEach(function(z){return e(S,z)}),ot&&eo(S,N),Z}function R(S,C,A,U){if(typeof A=="object"&&A!==null&&A.type===pa&&A.key===null&&(A=A.props.children),typeof A=="object"&&A!==null){switch(A.$$typeof){case gh:e:{for(var Z=A.key,V=C;V!==null;){if(V.key===Z){if(Z=A.type,Z===pa){if(V.tag===7){n(S,V.sibling),C=i(V,A.props.children),C.return=S,S=C;break e}}else if(V.elementType===Z||typeof Z=="object"&&Z!==null&&Z.$$typeof===Ji&&wy(Z)===V.type){n(S,V.sibling),C=i(V,A.props),C.ref=rc(S,V,A),C.return=S,S=C;break e}n(S,V);break}else e(S,V);V=V.sibling}A.type===pa?(C=mo(A.props.children,S.mode,U,A.key),C.return=S,S=C):(U=Yh(A.type,A.key,A.props,null,S.mode,U),U.ref=rc(S,C,A),U.return=S,S=U)}return a(S);case ma:e:{for(V=A.key;C!==null;){if(C.key===V)if(C.tag===4&&C.stateNode.containerInfo===A.containerInfo&&C.stateNode.implementation===A.implementation){n(S,C.sibling),C=i(C,A.children||[]),C.return=S,S=C;break e}else{n(S,C);break}else e(S,C);C=C.sibling}C=Sm(A,S.mode,U),C.return=S,S=C}return a(S);case Ji:return V=A._init,R(S,C,V(A._payload),U)}if(mc(A))return T(S,C,A,U);if(Yl(A))return E(S,C,A,U);Ch(S,A)}return typeof A=="string"&&A!==""||typeof A=="number"?(A=""+A,C!==null&&C.tag===6?(n(S,C.sibling),C=i(C,A),C.return=S,S=C):(n(S,C),C=Im(A,S.mode,U),C.return=S,S=C),a(S)):n(S,C)}return R}var Fa=Qw(!0),Zw=Qw(!1),wd=As(null),bd=null,Ea=null,Vg=null;function Og(){Vg=Ea=bd=null}function Fg(t){var e=wd.current;rt(wd),t._currentValue=e}function xp(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function ka(t,e){bd=t,Vg=Ea=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(xn=!0),t.firstContext=null)}function Qn(t){var e=t._currentValue;if(Vg!==t)if(t={context:t,memoizedValue:e,next:null},Ea===null){if(bd===null)throw Error(re(308));Ea=t,bd.dependencies={lanes:0,firstContext:t}}else Ea=Ea.next=t;return e}var co=null;function zg(t){co===null?co=[t]:co.push(t)}function Jw(t,e,n,r){var i=e.interleaved;return i===null?(n.next=n,zg(e)):(n.next=i.next,i.next=n),e.interleaved=n,fi(t,r)}function fi(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var Yi=!1;function Bg(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Yw(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function ci(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function fs(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,qe&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,fi(t,n)}return i=r.interleaved,i===null?(e.next=e,zg(r)):(e.next=i.next,i.next=e),r.interleaved=e,fi(t,n)}function Wh(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Sg(t,n)}}function by(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var i=null,s=null;if(n=n.firstBaseUpdate,n!==null){do{var a={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};s===null?i=s=a:s=s.next=a,n=n.next}while(n!==null);s===null?i=s=e:s=s.next=e}else i=s=e;n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Ed(t,e,n,r){var i=t.updateQueue;Yi=!1;var s=i.firstBaseUpdate,a=i.lastBaseUpdate,u=i.shared.pending;if(u!==null){i.shared.pending=null;var h=u,m=h.next;h.next=null,a===null?s=m:a.next=m,a=h;var p=t.alternate;p!==null&&(p=p.updateQueue,u=p.lastBaseUpdate,u!==a&&(u===null?p.firstBaseUpdate=m:u.next=m,p.lastBaseUpdate=h))}if(s!==null){var _=i.baseState;a=0,p=m=h=null,u=s;do{var v=u.lane,x=u.eventTime;if((r&v)===v){p!==null&&(p=p.next={eventTime:x,lane:0,tag:u.tag,payload:u.payload,callback:u.callback,next:null});e:{var T=t,E=u;switch(v=e,x=n,E.tag){case 1:if(T=E.payload,typeof T=="function"){_=T.call(x,_,v);break e}_=T;break e;case 3:T.flags=T.flags&-65537|128;case 0:if(T=E.payload,v=typeof T=="function"?T.call(x,_,v):T,v==null)break e;_=pt({},_,v);break e;case 2:Yi=!0}}u.callback!==null&&u.lane!==0&&(t.flags|=64,v=i.effects,v===null?i.effects=[u]:v.push(u))}else x={eventTime:x,lane:v,tag:u.tag,payload:u.payload,callback:u.callback,next:null},p===null?(m=p=x,h=_):p=p.next=x,a|=v;if(u=u.next,u===null){if(u=i.shared.pending,u===null)break;v=u,u=v.next,v.next=null,i.lastBaseUpdate=v,i.shared.pending=null}}while(1);if(p===null&&(h=_),i.baseState=h,i.firstBaseUpdate=m,i.lastBaseUpdate=p,e=i.shared.interleaved,e!==null){i=e;do a|=i.lane,i=i.next;while(i!==e)}else s===null&&(i.shared.lanes=0);xo|=a,t.lanes=a,t.memoizedState=_}}function Ey(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],i=r.callback;if(i!==null){if(r.callback=null,r=n,typeof i!="function")throw Error(re(191,i));i.call(r)}}}var Eu={},Lr=As(Eu),Qc=As(Eu),Zc=As(Eu);function uo(t){if(t===Eu)throw Error(re(174));return t}function Ug(t,e){switch(Ye(Zc,e),Ye(Qc,t),Ye(Lr,Eu),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:ep(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=ep(e,t)}rt(Lr),Ye(Lr,e)}function za(){rt(Lr),rt(Qc),rt(Zc)}function Xw(t){uo(Zc.current);var e=uo(Lr.current),n=ep(e,t.type);e!==n&&(Ye(Qc,t),Ye(Lr,n))}function $g(t){Qc.current===t&&(rt(Lr),rt(Qc))}var ft=As(0);function Td(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var ym=[];function qg(){for(var t=0;t<ym.length;t++)ym[t]._workInProgressVersionPrimary=null;ym.length=0}var Hh=vi.ReactCurrentDispatcher,xm=vi.ReactCurrentBatchConfig,yo=0,mt=null,Mt=null,Ut=null,Id=!1,Cc=!1,Jc=0,CC=0;function rn(){throw Error(re(321))}function Gg(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!gr(t[n],e[n]))return!1;return!0}function Wg(t,e,n,r,i,s){if(yo=s,mt=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Hh.current=t===null||t.memoizedState===null?kC:RC,t=n(r,i),Cc){s=0;do{if(Cc=!1,Jc=0,25<=s)throw Error(re(301));s+=1,Ut=Mt=null,e.updateQueue=null,Hh.current=jC,t=n(r,i)}while(Cc)}if(Hh.current=Sd,e=Mt!==null&&Mt.next!==null,yo=0,Ut=Mt=mt=null,Id=!1,e)throw Error(re(300));return t}function Hg(){var t=Jc!==0;return Jc=0,t}function Ar(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ut===null?mt.memoizedState=Ut=t:Ut=Ut.next=t,Ut}function Zn(){if(Mt===null){var t=mt.alternate;t=t!==null?t.memoizedState:null}else t=Mt.next;var e=Ut===null?mt.memoizedState:Ut.next;if(e!==null)Ut=e,Mt=t;else{if(t===null)throw Error(re(310));Mt=t,t={memoizedState:Mt.memoizedState,baseState:Mt.baseState,baseQueue:Mt.baseQueue,queue:Mt.queue,next:null},Ut===null?mt.memoizedState=Ut=t:Ut=Ut.next=t}return Ut}function Yc(t,e){return typeof e=="function"?e(t):e}function wm(t){var e=Zn(),n=e.queue;if(n===null)throw Error(re(311));n.lastRenderedReducer=t;var r=Mt,i=r.baseQueue,s=n.pending;if(s!==null){if(i!==null){var a=i.next;i.next=s.next,s.next=a}r.baseQueue=i=s,n.pending=null}if(i!==null){s=i.next,r=r.baseState;var u=a=null,h=null,m=s;do{var p=m.lane;if((yo&p)===p)h!==null&&(h=h.next={lane:0,action:m.action,hasEagerState:m.hasEagerState,eagerState:m.eagerState,next:null}),r=m.hasEagerState?m.eagerState:t(r,m.action);else{var _={lane:p,action:m.action,hasEagerState:m.hasEagerState,eagerState:m.eagerState,next:null};h===null?(u=h=_,a=r):h=h.next=_,mt.lanes|=p,xo|=p}m=m.next}while(m!==null&&m!==s);h===null?a=r:h.next=u,gr(r,e.memoizedState)||(xn=!0),e.memoizedState=r,e.baseState=a,e.baseQueue=h,n.lastRenderedState=r}if(t=n.interleaved,t!==null){i=t;do s=i.lane,mt.lanes|=s,xo|=s,i=i.next;while(i!==t)}else i===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function bm(t){var e=Zn(),n=e.queue;if(n===null)throw Error(re(311));n.lastRenderedReducer=t;var r=n.dispatch,i=n.pending,s=e.memoizedState;if(i!==null){n.pending=null;var a=i=i.next;do s=t(s,a.action),a=a.next;while(a!==i);gr(s,e.memoizedState)||(xn=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),n.lastRenderedState=s}return[s,r]}function e1(){}function t1(t,e){var n=mt,r=Zn(),i=e(),s=!gr(r.memoizedState,i);if(s&&(r.memoizedState=i,xn=!0),r=r.queue,Kg(i1.bind(null,n,r,t),[t]),r.getSnapshot!==e||s||Ut!==null&&Ut.memoizedState.tag&1){if(n.flags|=2048,Xc(9,r1.bind(null,n,r,i,e),void 0,null),qt===null)throw Error(re(349));yo&30||n1(n,e,i)}return i}function n1(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=mt.updateQueue,e===null?(e={lastEffect:null,stores:null},mt.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function r1(t,e,n,r){e.value=n,e.getSnapshot=r,s1(e)&&o1(t)}function i1(t,e,n){return n(function(){s1(e)&&o1(t)})}function s1(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!gr(t,n)}catch{return!0}}function o1(t){var e=fi(t,1);e!==null&&pr(e,t,1,-1)}function Ty(t){var e=Ar();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Yc,lastRenderedState:t},e.queue=t,t=t.dispatch=AC.bind(null,mt,t),[e.memoizedState,t]}function Xc(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=mt.updateQueue,e===null?(e={lastEffect:null,stores:null},mt.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function a1(){return Zn().memoizedState}function Kh(t,e,n,r){var i=Ar();mt.flags|=t,i.memoizedState=Xc(1|e,n,void 0,r===void 0?null:r)}function af(t,e,n,r){var i=Zn();r=r===void 0?null:r;var s=void 0;if(Mt!==null){var a=Mt.memoizedState;if(s=a.destroy,r!==null&&Gg(r,a.deps)){i.memoizedState=Xc(e,n,s,r);return}}mt.flags|=t,i.memoizedState=Xc(1|e,n,s,r)}function Iy(t,e){return Kh(8390656,8,t,e)}function Kg(t,e){return af(2048,8,t,e)}function l1(t,e){return af(4,2,t,e)}function c1(t,e){return af(4,4,t,e)}function u1(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function h1(t,e,n){return n=n!=null?n.concat([t]):null,af(4,4,u1.bind(null,e,t),n)}function Qg(){}function d1(t,e){var n=Zn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Gg(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function f1(t,e){var n=Zn();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&Gg(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function m1(t,e,n){return yo&21?(gr(n,e)||(n=yw(),mt.lanes|=n,xo|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,xn=!0),t.memoizedState=n)}function PC(t,e){var n=He;He=n!==0&&4>n?n:4,t(!0);var r=xm.transition;xm.transition={};try{t(!1),e()}finally{He=n,xm.transition=r}}function p1(){return Zn().memoizedState}function NC(t,e,n){var r=ps(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},g1(t))_1(e,n);else if(n=Jw(t,e,n,r),n!==null){var i=mn();pr(n,t,r,i),v1(n,e,r)}}function AC(t,e,n){var r=ps(t),i={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(g1(t))_1(e,i);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var a=e.lastRenderedState,u=s(a,n);if(i.hasEagerState=!0,i.eagerState=u,gr(u,a)){var h=e.interleaved;h===null?(i.next=i,zg(e)):(i.next=h.next,h.next=i),e.interleaved=i;return}}catch{}finally{}n=Jw(t,e,i,r),n!==null&&(i=mn(),pr(n,t,r,i),v1(n,e,r))}}function g1(t){var e=t.alternate;return t===mt||e!==null&&e===mt}function _1(t,e){Cc=Id=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function v1(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Sg(t,n)}}var Sd={readContext:Qn,useCallback:rn,useContext:rn,useEffect:rn,useImperativeHandle:rn,useInsertionEffect:rn,useLayoutEffect:rn,useMemo:rn,useReducer:rn,useRef:rn,useState:rn,useDebugValue:rn,useDeferredValue:rn,useTransition:rn,useMutableSource:rn,useSyncExternalStore:rn,useId:rn,unstable_isNewReconciler:!1},kC={readContext:Qn,useCallback:function(t,e){return Ar().memoizedState=[t,e===void 0?null:e],t},useContext:Qn,useEffect:Iy,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Kh(4194308,4,u1.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Kh(4194308,4,t,e)},useInsertionEffect:function(t,e){return Kh(4,2,t,e)},useMemo:function(t,e){var n=Ar();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Ar();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=NC.bind(null,mt,t),[r.memoizedState,t]},useRef:function(t){var e=Ar();return t={current:t},e.memoizedState=t},useState:Ty,useDebugValue:Qg,useDeferredValue:function(t){return Ar().memoizedState=t},useTransition:function(){var t=Ty(!1),e=t[0];return t=PC.bind(null,t[1]),Ar().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=mt,i=Ar();if(ot){if(n===void 0)throw Error(re(407));n=n()}else{if(n=e(),qt===null)throw Error(re(349));yo&30||n1(r,e,n)}i.memoizedState=n;var s={value:n,getSnapshot:e};return i.queue=s,Iy(i1.bind(null,r,s,t),[t]),r.flags|=2048,Xc(9,r1.bind(null,r,s,n,e),void 0,null),n},useId:function(){var t=Ar(),e=qt.identifierPrefix;if(ot){var n=ai,r=oi;n=(r&~(1<<32-mr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Jc++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=CC++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},RC={readContext:Qn,useCallback:d1,useContext:Qn,useEffect:Kg,useImperativeHandle:h1,useInsertionEffect:l1,useLayoutEffect:c1,useMemo:f1,useReducer:wm,useRef:a1,useState:function(){return wm(Yc)},useDebugValue:Qg,useDeferredValue:function(t){var e=Zn();return m1(e,Mt.memoizedState,t)},useTransition:function(){var t=wm(Yc)[0],e=Zn().memoizedState;return[t,e]},useMutableSource:e1,useSyncExternalStore:t1,useId:p1,unstable_isNewReconciler:!1},jC={readContext:Qn,useCallback:d1,useContext:Qn,useEffect:Kg,useImperativeHandle:h1,useInsertionEffect:l1,useLayoutEffect:c1,useMemo:f1,useReducer:bm,useRef:a1,useState:function(){return bm(Yc)},useDebugValue:Qg,useDeferredValue:function(t){var e=Zn();return Mt===null?e.memoizedState=t:m1(e,Mt.memoizedState,t)},useTransition:function(){var t=bm(Yc)[0],e=Zn().memoizedState;return[t,e]},useMutableSource:e1,useSyncExternalStore:t1,useId:p1,unstable_isNewReconciler:!1};function ur(t,e){if(t&&t.defaultProps){e=pt({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}function wp(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:pt({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var lf={isMounted:function(t){return(t=t._reactInternals)?Do(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=mn(),i=ps(t),s=ci(r,i);s.payload=e,n!=null&&(s.callback=n),e=fs(t,s,i),e!==null&&(pr(e,t,i,r),Wh(e,t,i))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=mn(),i=ps(t),s=ci(r,i);s.tag=1,s.payload=e,n!=null&&(s.callback=n),e=fs(t,s,i),e!==null&&(pr(e,t,i,r),Wh(e,t,i))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=mn(),r=ps(t),i=ci(n,r);i.tag=2,e!=null&&(i.callback=e),e=fs(t,i,r),e!==null&&(pr(e,t,r,n),Wh(e,t,r))}};function Sy(t,e,n,r,i,s,a){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,s,a):e.prototype&&e.prototype.isPureReactComponent?!Gc(n,r)||!Gc(i,s):!0}function y1(t,e,n){var r=!1,i=ws,s=e.contextType;return typeof s=="object"&&s!==null?s=Qn(s):(i=In(e)?_o:hn.current,r=e.contextTypes,s=(r=r!=null)?Va(t,i):ws),e=new e(n,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=lf,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=s),e}function Cy(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&lf.enqueueReplaceState(e,e.state,null)}function bp(t,e,n,r){var i=t.stateNode;i.props=n,i.state=t.memoizedState,i.refs={},Bg(t);var s=e.contextType;typeof s=="object"&&s!==null?i.context=Qn(s):(s=In(e)?_o:hn.current,i.context=Va(t,s)),i.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(wp(t,e,s,n),i.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&lf.enqueueReplaceState(i,i.state,null),Ed(t,n,i,r),i.state=t.memoizedState),typeof i.componentDidMount=="function"&&(t.flags|=4194308)}function Ba(t,e){try{var n="",r=e;do n+=aS(r),r=r.return;while(r);var i=n}catch(s){i=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:i,digest:null}}function Em(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function Ep(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var DC=typeof WeakMap=="function"?WeakMap:Map;function x1(t,e,n){n=ci(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){Pd||(Pd=!0,jp=r),Ep(t,e)},n}function w1(t,e,n){n=ci(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;n.payload=function(){return r(i)},n.callback=function(){Ep(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(n.callback=function(){Ep(t,e),typeof r!="function"&&(ms===null?ms=new Set([this]):ms.add(this));var a=e.stack;this.componentDidCatch(e.value,{componentStack:a!==null?a:""})}),n}function Py(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new DC;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(n)||(i.add(n),t=KC.bind(null,t,e,n),e.then(t,t))}function Ny(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function Ay(t,e,n,r,i){return t.mode&1?(t.flags|=65536,t.lanes=i,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=ci(-1,1),e.tag=2,fs(n,e,1))),n.lanes|=1),t)}var LC=vi.ReactCurrentOwner,xn=!1;function fn(t,e,n,r){e.child=t===null?Zw(e,null,n,r):Fa(e,t.child,n,r)}function ky(t,e,n,r,i){n=n.render;var s=e.ref;return ka(e,i),r=Wg(t,e,n,r,s,i),n=Hg(),t!==null&&!xn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,mi(t,e,i)):(ot&&n&&Dg(e),e.flags|=1,fn(t,e,r,i),e.child)}function Ry(t,e,n,r,i){if(t===null){var s=n.type;return typeof s=="function"&&!r_(s)&&s.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=s,b1(t,e,s,r,i)):(t=Yh(n.type,null,r,e,e.mode,i),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,!(t.lanes&i)){var a=s.memoizedProps;if(n=n.compare,n=n!==null?n:Gc,n(a,r)&&t.ref===e.ref)return mi(t,e,i)}return e.flags|=1,t=gs(s,r),t.ref=e.ref,t.return=e,e.child=t}function b1(t,e,n,r,i){if(t!==null){var s=t.memoizedProps;if(Gc(s,r)&&t.ref===e.ref)if(xn=!1,e.pendingProps=r=s,(t.lanes&i)!==0)t.flags&131072&&(xn=!0);else return e.lanes=t.lanes,mi(t,e,i)}return Tp(t,e,n,r,i)}function E1(t,e,n){var r=e.pendingProps,i=r.children,s=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ye(Ia,An),An|=n;else{if(!(n&1073741824))return t=s!==null?s.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Ye(Ia,An),An|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=s!==null?s.baseLanes:n,Ye(Ia,An),An|=r}else s!==null?(r=s.baseLanes|n,e.memoizedState=null):r=n,Ye(Ia,An),An|=r;return fn(t,e,i,n),e.child}function T1(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function Tp(t,e,n,r,i){var s=In(n)?_o:hn.current;return s=Va(e,s),ka(e,i),n=Wg(t,e,n,r,s,i),r=Hg(),t!==null&&!xn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~i,mi(t,e,i)):(ot&&r&&Dg(e),e.flags|=1,fn(t,e,n,i),e.child)}function jy(t,e,n,r,i){if(In(n)){var s=!0;vd(e)}else s=!1;if(ka(e,i),e.stateNode===null)Qh(t,e),y1(e,n,r),bp(e,n,r,i),r=!0;else if(t===null){var a=e.stateNode,u=e.memoizedProps;a.props=u;var h=a.context,m=n.contextType;typeof m=="object"&&m!==null?m=Qn(m):(m=In(n)?_o:hn.current,m=Va(e,m));var p=n.getDerivedStateFromProps,_=typeof p=="function"||typeof a.getSnapshotBeforeUpdate=="function";_||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(u!==r||h!==m)&&Cy(e,a,r,m),Yi=!1;var v=e.memoizedState;a.state=v,Ed(e,r,a,i),h=e.memoizedState,u!==r||v!==h||Tn.current||Yi?(typeof p=="function"&&(wp(e,n,p,r),h=e.memoizedState),(u=Yi||Sy(e,n,u,r,v,h,m))?(_||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount()),typeof a.componentDidMount=="function"&&(e.flags|=4194308)):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=h),a.props=r,a.state=h,a.context=m,r=u):(typeof a.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{a=e.stateNode,Yw(t,e),u=e.memoizedProps,m=e.type===e.elementType?u:ur(e.type,u),a.props=m,_=e.pendingProps,v=a.context,h=n.contextType,typeof h=="object"&&h!==null?h=Qn(h):(h=In(n)?_o:hn.current,h=Va(e,h));var x=n.getDerivedStateFromProps;(p=typeof x=="function"||typeof a.getSnapshotBeforeUpdate=="function")||typeof a.UNSAFE_componentWillReceiveProps!="function"&&typeof a.componentWillReceiveProps!="function"||(u!==_||v!==h)&&Cy(e,a,r,h),Yi=!1,v=e.memoizedState,a.state=v,Ed(e,r,a,i);var T=e.memoizedState;u!==_||v!==T||Tn.current||Yi?(typeof x=="function"&&(wp(e,n,x,r),T=e.memoizedState),(m=Yi||Sy(e,n,m,r,v,T,h)||!1)?(p||typeof a.UNSAFE_componentWillUpdate!="function"&&typeof a.componentWillUpdate!="function"||(typeof a.componentWillUpdate=="function"&&a.componentWillUpdate(r,T,h),typeof a.UNSAFE_componentWillUpdate=="function"&&a.UNSAFE_componentWillUpdate(r,T,h)),typeof a.componentDidUpdate=="function"&&(e.flags|=4),typeof a.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof a.componentDidUpdate!="function"||u===t.memoizedProps&&v===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||u===t.memoizedProps&&v===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=T),a.props=r,a.state=T,a.context=h,r=m):(typeof a.componentDidUpdate!="function"||u===t.memoizedProps&&v===t.memoizedState||(e.flags|=4),typeof a.getSnapshotBeforeUpdate!="function"||u===t.memoizedProps&&v===t.memoizedState||(e.flags|=1024),r=!1)}return Ip(t,e,n,r,s,i)}function Ip(t,e,n,r,i,s){T1(t,e);var a=(e.flags&128)!==0;if(!r&&!a)return i&&vy(e,n,!1),mi(t,e,s);r=e.stateNode,LC.current=e;var u=a&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&a?(e.child=Fa(e,t.child,null,s),e.child=Fa(e,null,u,s)):fn(t,e,u,s),e.memoizedState=r.state,i&&vy(e,n,!0),e.child}function I1(t){var e=t.stateNode;e.pendingContext?_y(t,e.pendingContext,e.pendingContext!==e.context):e.context&&_y(t,e.context,!1),Ug(t,e.containerInfo)}function Dy(t,e,n,r,i){return Oa(),Mg(i),e.flags|=256,fn(t,e,n,r),e.child}var Sp={dehydrated:null,treeContext:null,retryLane:0};function Cp(t){return{baseLanes:t,cachePool:null,transitions:null}}function S1(t,e,n){var r=e.pendingProps,i=ft.current,s=!1,a=(e.flags&128)!==0,u;if((u=a)||(u=t!==null&&t.memoizedState===null?!1:(i&2)!==0),u?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(i|=1),Ye(ft,i&1),t===null)return yp(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(a=r.children,t=r.fallback,s?(r=e.mode,s=e.child,a={mode:"hidden",children:a},!(r&1)&&s!==null?(s.childLanes=0,s.pendingProps=a):s=hf(a,r,0,null),t=mo(t,r,n,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=Cp(n),e.memoizedState=Sp,t):Zg(e,a));if(i=t.memoizedState,i!==null&&(u=i.dehydrated,u!==null))return MC(t,e,a,r,u,i,n);if(s){s=r.fallback,a=e.mode,i=t.child,u=i.sibling;var h={mode:"hidden",children:r.children};return!(a&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=h,e.deletions=null):(r=gs(i,h),r.subtreeFlags=i.subtreeFlags&14680064),u!==null?s=gs(u,s):(s=mo(s,a,n,null),s.flags|=2),s.return=e,r.return=e,r.sibling=s,e.child=r,r=s,s=e.child,a=t.child.memoizedState,a=a===null?Cp(n):{baseLanes:a.baseLanes|n,cachePool:null,transitions:a.transitions},s.memoizedState=a,s.childLanes=t.childLanes&~n,e.memoizedState=Sp,r}return s=t.child,t=s.sibling,r=gs(s,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function Zg(t,e){return e=hf({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Ph(t,e,n,r){return r!==null&&Mg(r),Fa(e,t.child,null,n),t=Zg(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function MC(t,e,n,r,i,s,a){if(n)return e.flags&256?(e.flags&=-257,r=Em(Error(re(422))),Ph(t,e,a,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=r.fallback,i=e.mode,r=hf({mode:"visible",children:r.children},i,0,null),s=mo(s,i,a,null),s.flags|=2,r.return=e,s.return=e,r.sibling=s,e.child=r,e.mode&1&&Fa(e,t.child,null,a),e.child.memoizedState=Cp(a),e.memoizedState=Sp,s);if(!(e.mode&1))return Ph(t,e,a,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var u=r.dgst;return r=u,s=Error(re(419)),r=Em(s,r,void 0),Ph(t,e,a,r)}if(u=(a&t.childLanes)!==0,xn||u){if(r=qt,r!==null){switch(a&-a){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|a)?0:i,i!==0&&i!==s.retryLane&&(s.retryLane=i,fi(t,i),pr(r,t,i,-1))}return n_(),r=Em(Error(re(421))),Ph(t,e,a,r)}return i.data==="$?"?(e.flags|=128,e.child=t.child,e=QC.bind(null,t),i._reactRetry=e,null):(t=s.treeContext,kn=ds(i.nextSibling),Rn=e,ot=!0,dr=null,t!==null&&(qn[Gn++]=oi,qn[Gn++]=ai,qn[Gn++]=vo,oi=t.id,ai=t.overflow,vo=e),e=Zg(e,r.children),e.flags|=4096,e)}function Ly(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),xp(t.return,e,n)}function Tm(t,e,n,r,i){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=r,s.tail=n,s.tailMode=i)}function C1(t,e,n){var r=e.pendingProps,i=r.revealOrder,s=r.tail;if(fn(t,e,r.children,n),r=ft.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&Ly(t,n,e);else if(t.tag===19)Ly(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Ye(ft,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(n=e.child,i=null;n!==null;)t=n.alternate,t!==null&&Td(t)===null&&(i=n),n=n.sibling;n=i,n===null?(i=e.child,e.child=null):(i=n.sibling,n.sibling=null),Tm(e,!1,i,n,s);break;case"backwards":for(n=null,i=e.child,e.child=null;i!==null;){if(t=i.alternate,t!==null&&Td(t)===null){e.child=i;break}t=i.sibling,i.sibling=n,n=i,i=t}Tm(e,!0,n,null,s);break;case"together":Tm(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Qh(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function mi(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),xo|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(re(153));if(e.child!==null){for(t=e.child,n=gs(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=gs(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function VC(t,e,n){switch(e.tag){case 3:I1(e),Oa();break;case 5:Xw(e);break;case 1:In(e.type)&&vd(e);break;case 4:Ug(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;Ye(wd,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Ye(ft,ft.current&1),e.flags|=128,null):n&e.child.childLanes?S1(t,e,n):(Ye(ft,ft.current&1),t=mi(t,e,n),t!==null?t.sibling:null);Ye(ft,ft.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return C1(t,e,n);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ye(ft,ft.current),r)break;return null;case 22:case 23:return e.lanes=0,E1(t,e,n)}return mi(t,e,n)}var P1,Pp,N1,A1;P1=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Pp=function(){};N1=function(t,e,n,r){var i=t.memoizedProps;if(i!==r){t=e.stateNode,uo(Lr.current);var s=null;switch(n){case"input":i=Zm(t,i),r=Zm(t,r),s=[];break;case"select":i=pt({},i,{value:void 0}),r=pt({},r,{value:void 0}),s=[];break;case"textarea":i=Xm(t,i),r=Xm(t,r),s=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=gd)}tp(n,r);var a;n=null;for(m in i)if(!r.hasOwnProperty(m)&&i.hasOwnProperty(m)&&i[m]!=null)if(m==="style"){var u=i[m];for(a in u)u.hasOwnProperty(a)&&(n||(n={}),n[a]="")}else m!=="dangerouslySetInnerHTML"&&m!=="children"&&m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&m!=="autoFocus"&&(Oc.hasOwnProperty(m)?s||(s=[]):(s=s||[]).push(m,null));for(m in r){var h=r[m];if(u=i!=null?i[m]:void 0,r.hasOwnProperty(m)&&h!==u&&(h!=null||u!=null))if(m==="style")if(u){for(a in u)!u.hasOwnProperty(a)||h&&h.hasOwnProperty(a)||(n||(n={}),n[a]="");for(a in h)h.hasOwnProperty(a)&&u[a]!==h[a]&&(n||(n={}),n[a]=h[a])}else n||(s||(s=[]),s.push(m,n)),n=h;else m==="dangerouslySetInnerHTML"?(h=h?h.__html:void 0,u=u?u.__html:void 0,h!=null&&u!==h&&(s=s||[]).push(m,h)):m==="children"?typeof h!="string"&&typeof h!="number"||(s=s||[]).push(m,""+h):m!=="suppressContentEditableWarning"&&m!=="suppressHydrationWarning"&&(Oc.hasOwnProperty(m)?(h!=null&&m==="onScroll"&&tt("scroll",t),s||u===h||(s=[])):(s=s||[]).push(m,h))}n&&(s=s||[]).push("style",n);var m=s;(e.updateQueue=m)&&(e.flags|=4)}};A1=function(t,e,n,r){n!==r&&(e.flags|=4)};function ic(t,e){if(!ot)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function sn(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=t,i=i.sibling;else for(i=t.child;i!==null;)n|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=t,i=i.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function OC(t,e,n){var r=e.pendingProps;switch(Lg(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return sn(e),null;case 1:return In(e.type)&&_d(),sn(e),null;case 3:return r=e.stateNode,za(),rt(Tn),rt(hn),qg(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Sh(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,dr!==null&&(Mp(dr),dr=null))),Pp(t,e),sn(e),null;case 5:$g(e);var i=uo(Zc.current);if(n=e.type,t!==null&&e.stateNode!=null)N1(t,e,n,r,i),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(re(166));return sn(e),null}if(t=uo(Lr.current),Sh(e)){r=e.stateNode,n=e.type;var s=e.memoizedProps;switch(r[kr]=e,r[Kc]=s,t=(e.mode&1)!==0,n){case"dialog":tt("cancel",r),tt("close",r);break;case"iframe":case"object":case"embed":tt("load",r);break;case"video":case"audio":for(i=0;i<gc.length;i++)tt(gc[i],r);break;case"source":tt("error",r);break;case"img":case"image":case"link":tt("error",r),tt("load",r);break;case"details":tt("toggle",r);break;case"input":qv(r,s),tt("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},tt("invalid",r);break;case"textarea":Wv(r,s),tt("invalid",r)}tp(n,s),i=null;for(var a in s)if(s.hasOwnProperty(a)){var u=s[a];a==="children"?typeof u=="string"?r.textContent!==u&&(s.suppressHydrationWarning!==!0&&Ih(r.textContent,u,t),i=["children",u]):typeof u=="number"&&r.textContent!==""+u&&(s.suppressHydrationWarning!==!0&&Ih(r.textContent,u,t),i=["children",""+u]):Oc.hasOwnProperty(a)&&u!=null&&a==="onScroll"&&tt("scroll",r)}switch(n){case"input":_h(r),Gv(r,s,!0);break;case"textarea":_h(r),Hv(r);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(r.onclick=gd)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{a=i.nodeType===9?i:i.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=iw(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=a.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=a.createElement(n,{is:r.is}):(t=a.createElement(n),n==="select"&&(a=t,r.multiple?a.multiple=!0:r.size&&(a.size=r.size))):t=a.createElementNS(t,n),t[kr]=e,t[Kc]=r,P1(t,e,!1,!1),e.stateNode=t;e:{switch(a=np(n,r),n){case"dialog":tt("cancel",t),tt("close",t),i=r;break;case"iframe":case"object":case"embed":tt("load",t),i=r;break;case"video":case"audio":for(i=0;i<gc.length;i++)tt(gc[i],t);i=r;break;case"source":tt("error",t),i=r;break;case"img":case"image":case"link":tt("error",t),tt("load",t),i=r;break;case"details":tt("toggle",t),i=r;break;case"input":qv(t,r),i=Zm(t,r),tt("invalid",t);break;case"option":i=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},i=pt({},r,{value:void 0}),tt("invalid",t);break;case"textarea":Wv(t,r),i=Xm(t,r),tt("invalid",t);break;default:i=r}tp(n,i),u=i;for(s in u)if(u.hasOwnProperty(s)){var h=u[s];s==="style"?aw(t,h):s==="dangerouslySetInnerHTML"?(h=h?h.__html:void 0,h!=null&&sw(t,h)):s==="children"?typeof h=="string"?(n!=="textarea"||h!=="")&&Fc(t,h):typeof h=="number"&&Fc(t,""+h):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Oc.hasOwnProperty(s)?h!=null&&s==="onScroll"&&tt("scroll",t):h!=null&&xg(t,s,h,a))}switch(n){case"input":_h(t),Gv(t,r,!1);break;case"textarea":_h(t),Hv(t);break;case"option":r.value!=null&&t.setAttribute("value",""+xs(r.value));break;case"select":t.multiple=!!r.multiple,s=r.value,s!=null?Ca(t,!!r.multiple,s,!1):r.defaultValue!=null&&Ca(t,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(t.onclick=gd)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return sn(e),null;case 6:if(t&&e.stateNode!=null)A1(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(re(166));if(n=uo(Zc.current),uo(Lr.current),Sh(e)){if(r=e.stateNode,n=e.memoizedProps,r[kr]=e,(s=r.nodeValue!==n)&&(t=Rn,t!==null))switch(t.tag){case 3:Ih(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Ih(r.nodeValue,n,(t.mode&1)!==0)}s&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[kr]=e,e.stateNode=r}return sn(e),null;case 13:if(rt(ft),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(ot&&kn!==null&&e.mode&1&&!(e.flags&128))Kw(),Oa(),e.flags|=98560,s=!1;else if(s=Sh(e),r!==null&&r.dehydrated!==null){if(t===null){if(!s)throw Error(re(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(re(317));s[kr]=e}else Oa(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;sn(e),s=!1}else dr!==null&&(Mp(dr),dr=null),s=!0;if(!s)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||ft.current&1?Vt===0&&(Vt=3):n_())),e.updateQueue!==null&&(e.flags|=4),sn(e),null);case 4:return za(),Pp(t,e),t===null&&Wc(e.stateNode.containerInfo),sn(e),null;case 10:return Fg(e.type._context),sn(e),null;case 17:return In(e.type)&&_d(),sn(e),null;case 19:if(rt(ft),s=e.memoizedState,s===null)return sn(e),null;if(r=(e.flags&128)!==0,a=s.rendering,a===null)if(r)ic(s,!1);else{if(Vt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(a=Td(t),a!==null){for(e.flags|=128,ic(s,!1),r=a.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)s=n,t=r,s.flags&=14680066,a=s.alternate,a===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=a.childLanes,s.lanes=a.lanes,s.child=a.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=a.memoizedProps,s.memoizedState=a.memoizedState,s.updateQueue=a.updateQueue,s.type=a.type,t=a.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Ye(ft,ft.current&1|2),e.child}t=t.sibling}s.tail!==null&&Et()>Ua&&(e.flags|=128,r=!0,ic(s,!1),e.lanes=4194304)}else{if(!r)if(t=Td(a),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),ic(s,!0),s.tail===null&&s.tailMode==="hidden"&&!a.alternate&&!ot)return sn(e),null}else 2*Et()-s.renderingStartTime>Ua&&n!==1073741824&&(e.flags|=128,r=!0,ic(s,!1),e.lanes=4194304);s.isBackwards?(a.sibling=e.child,e.child=a):(n=s.last,n!==null?n.sibling=a:e.child=a,s.last=a)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Et(),e.sibling=null,n=ft.current,Ye(ft,r?n&1|2:n&1),e):(sn(e),null);case 22:case 23:return t_(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?An&1073741824&&(sn(e),e.subtreeFlags&6&&(e.flags|=8192)):sn(e),null;case 24:return null;case 25:return null}throw Error(re(156,e.tag))}function FC(t,e){switch(Lg(e),e.tag){case 1:return In(e.type)&&_d(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return za(),rt(Tn),rt(hn),qg(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return $g(e),null;case 13:if(rt(ft),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(re(340));Oa()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return rt(ft),null;case 4:return za(),null;case 10:return Fg(e.type._context),null;case 22:case 23:return t_(),null;case 24:return null;default:return null}}var Nh=!1,ln=!1,zC=typeof WeakSet=="function"?WeakSet:Set,pe=null;function Ta(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){vt(t,e,r)}else n.current=null}function Np(t,e,n){try{n()}catch(r){vt(t,e,r)}}var My=!1;function BC(t,e){if(dp=fd,t=Lw(),jg(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var i=r.anchorOffset,s=r.focusNode;r=r.focusOffset;try{n.nodeType,s.nodeType}catch{n=null;break e}var a=0,u=-1,h=-1,m=0,p=0,_=t,v=null;t:for(;;){for(var x;_!==n||i!==0&&_.nodeType!==3||(u=a+i),_!==s||r!==0&&_.nodeType!==3||(h=a+r),_.nodeType===3&&(a+=_.nodeValue.length),(x=_.firstChild)!==null;)v=_,_=x;for(;;){if(_===t)break t;if(v===n&&++m===i&&(u=a),v===s&&++p===r&&(h=a),(x=_.nextSibling)!==null)break;_=v,v=_.parentNode}_=x}n=u===-1||h===-1?null:{start:u,end:h}}else n=null}n=n||{start:0,end:0}}else n=null;for(fp={focusedElem:t,selectionRange:n},fd=!1,pe=e;pe!==null;)if(e=pe,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,pe=t;else for(;pe!==null;){e=pe;try{var T=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(T!==null){var E=T.memoizedProps,R=T.memoizedState,S=e.stateNode,C=S.getSnapshotBeforeUpdate(e.elementType===e.type?E:ur(e.type,E),R);S.__reactInternalSnapshotBeforeUpdate=C}break;case 3:var A=e.stateNode.containerInfo;A.nodeType===1?A.textContent="":A.nodeType===9&&A.documentElement&&A.removeChild(A.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(re(163))}}catch(U){vt(e,e.return,U)}if(t=e.sibling,t!==null){t.return=e.return,pe=t;break}pe=e.return}return T=My,My=!1,T}function Pc(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&t)===t){var s=i.destroy;i.destroy=void 0,s!==void 0&&Np(e,n,s)}i=i.next}while(i!==r)}}function cf(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Ap(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function k1(t){var e=t.alternate;e!==null&&(t.alternate=null,k1(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[kr],delete e[Kc],delete e[gp],delete e[EC],delete e[TC])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function R1(t){return t.tag===5||t.tag===3||t.tag===4}function Vy(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||R1(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function kp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=gd));else if(r!==4&&(t=t.child,t!==null))for(kp(t,e,n),t=t.sibling;t!==null;)kp(t,e,n),t=t.sibling}function Rp(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(Rp(t,e,n),t=t.sibling;t!==null;)Rp(t,e,n),t=t.sibling}var Kt=null,hr=!1;function Ki(t,e,n){for(n=n.child;n!==null;)j1(t,e,n),n=n.sibling}function j1(t,e,n){if(Dr&&typeof Dr.onCommitFiberUnmount=="function")try{Dr.onCommitFiberUnmount(ef,n)}catch{}switch(n.tag){case 5:ln||Ta(n,e);case 6:var r=Kt,i=hr;Kt=null,Ki(t,e,n),Kt=r,hr=i,Kt!==null&&(hr?(t=Kt,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Kt.removeChild(n.stateNode));break;case 18:Kt!==null&&(hr?(t=Kt,n=n.stateNode,t.nodeType===8?_m(t.parentNode,n):t.nodeType===1&&_m(t,n),$c(t)):_m(Kt,n.stateNode));break;case 4:r=Kt,i=hr,Kt=n.stateNode.containerInfo,hr=!0,Ki(t,e,n),Kt=r,hr=i;break;case 0:case 11:case 14:case 15:if(!ln&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var s=i,a=s.destroy;s=s.tag,a!==void 0&&(s&2||s&4)&&Np(n,e,a),i=i.next}while(i!==r)}Ki(t,e,n);break;case 1:if(!ln&&(Ta(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(u){vt(n,e,u)}Ki(t,e,n);break;case 21:Ki(t,e,n);break;case 22:n.mode&1?(ln=(r=ln)||n.memoizedState!==null,Ki(t,e,n),ln=r):Ki(t,e,n);break;default:Ki(t,e,n)}}function Oy(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new zC),e.forEach(function(r){var i=ZC.bind(null,t,r);n.has(r)||(n.add(r),r.then(i,i))})}}function lr(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var i=n[r];try{var s=t,a=e,u=a;e:for(;u!==null;){switch(u.tag){case 5:Kt=u.stateNode,hr=!1;break e;case 3:Kt=u.stateNode.containerInfo,hr=!0;break e;case 4:Kt=u.stateNode.containerInfo,hr=!0;break e}u=u.return}if(Kt===null)throw Error(re(160));j1(s,a,i),Kt=null,hr=!1;var h=i.alternate;h!==null&&(h.return=null),i.return=null}catch(m){vt(i,e,m)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)D1(e,t),e=e.sibling}function D1(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(lr(e,t),Nr(t),r&4){try{Pc(3,t,t.return),cf(3,t)}catch(E){vt(t,t.return,E)}try{Pc(5,t,t.return)}catch(E){vt(t,t.return,E)}}break;case 1:lr(e,t),Nr(t),r&512&&n!==null&&Ta(n,n.return);break;case 5:if(lr(e,t),Nr(t),r&512&&n!==null&&Ta(n,n.return),t.flags&32){var i=t.stateNode;try{Fc(i,"")}catch(E){vt(t,t.return,E)}}if(r&4&&(i=t.stateNode,i!=null)){var s=t.memoizedProps,a=n!==null?n.memoizedProps:s,u=t.type,h=t.updateQueue;if(t.updateQueue=null,h!==null)try{u==="input"&&s.type==="radio"&&s.name!=null&&nw(i,s),np(u,a);var m=np(u,s);for(a=0;a<h.length;a+=2){var p=h[a],_=h[a+1];p==="style"?aw(i,_):p==="dangerouslySetInnerHTML"?sw(i,_):p==="children"?Fc(i,_):xg(i,p,_,m)}switch(u){case"input":Jm(i,s);break;case"textarea":rw(i,s);break;case"select":var v=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!s.multiple;var x=s.value;x!=null?Ca(i,!!s.multiple,x,!1):v!==!!s.multiple&&(s.defaultValue!=null?Ca(i,!!s.multiple,s.defaultValue,!0):Ca(i,!!s.multiple,s.multiple?[]:"",!1))}i[Kc]=s}catch(E){vt(t,t.return,E)}}break;case 6:if(lr(e,t),Nr(t),r&4){if(t.stateNode===null)throw Error(re(162));i=t.stateNode,s=t.memoizedProps;try{i.nodeValue=s}catch(E){vt(t,t.return,E)}}break;case 3:if(lr(e,t),Nr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{$c(e.containerInfo)}catch(E){vt(t,t.return,E)}break;case 4:lr(e,t),Nr(t);break;case 13:lr(e,t),Nr(t),i=t.child,i.flags&8192&&(s=i.memoizedState!==null,i.stateNode.isHidden=s,!s||i.alternate!==null&&i.alternate.memoizedState!==null||(Xg=Et())),r&4&&Oy(t);break;case 22:if(p=n!==null&&n.memoizedState!==null,t.mode&1?(ln=(m=ln)||p,lr(e,t),ln=m):lr(e,t),Nr(t),r&8192){if(m=t.memoizedState!==null,(t.stateNode.isHidden=m)&&!p&&t.mode&1)for(pe=t,p=t.child;p!==null;){for(_=pe=p;pe!==null;){switch(v=pe,x=v.child,v.tag){case 0:case 11:case 14:case 15:Pc(4,v,v.return);break;case 1:Ta(v,v.return);var T=v.stateNode;if(typeof T.componentWillUnmount=="function"){r=v,n=v.return;try{e=r,T.props=e.memoizedProps,T.state=e.memoizedState,T.componentWillUnmount()}catch(E){vt(r,n,E)}}break;case 5:Ta(v,v.return);break;case 22:if(v.memoizedState!==null){zy(_);continue}}x!==null?(x.return=v,pe=x):zy(_)}p=p.sibling}e:for(p=null,_=t;;){if(_.tag===5){if(p===null){p=_;try{i=_.stateNode,m?(s=i.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(u=_.stateNode,h=_.memoizedProps.style,a=h!=null&&h.hasOwnProperty("display")?h.display:null,u.style.display=ow("display",a))}catch(E){vt(t,t.return,E)}}}else if(_.tag===6){if(p===null)try{_.stateNode.nodeValue=m?"":_.memoizedProps}catch(E){vt(t,t.return,E)}}else if((_.tag!==22&&_.tag!==23||_.memoizedState===null||_===t)&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===t)break e;for(;_.sibling===null;){if(_.return===null||_.return===t)break e;p===_&&(p=null),_=_.return}p===_&&(p=null),_.sibling.return=_.return,_=_.sibling}}break;case 19:lr(e,t),Nr(t),r&4&&Oy(t);break;case 21:break;default:lr(e,t),Nr(t)}}function Nr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(R1(n)){var r=n;break e}n=n.return}throw Error(re(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Fc(i,""),r.flags&=-33);var s=Vy(t);Rp(t,s,i);break;case 3:case 4:var a=r.stateNode.containerInfo,u=Vy(t);kp(t,u,a);break;default:throw Error(re(161))}}catch(h){vt(t,t.return,h)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function UC(t,e,n){pe=t,L1(t)}function L1(t,e,n){for(var r=(t.mode&1)!==0;pe!==null;){var i=pe,s=i.child;if(i.tag===22&&r){var a=i.memoizedState!==null||Nh;if(!a){var u=i.alternate,h=u!==null&&u.memoizedState!==null||ln;u=Nh;var m=ln;if(Nh=a,(ln=h)&&!m)for(pe=i;pe!==null;)a=pe,h=a.child,a.tag===22&&a.memoizedState!==null?By(i):h!==null?(h.return=a,pe=h):By(i);for(;s!==null;)pe=s,L1(s),s=s.sibling;pe=i,Nh=u,ln=m}Fy(t)}else i.subtreeFlags&8772&&s!==null?(s.return=i,pe=s):Fy(t)}}function Fy(t){for(;pe!==null;){var e=pe;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ln||cf(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!ln)if(n===null)r.componentDidMount();else{var i=e.elementType===e.type?n.memoizedProps:ur(e.type,n.memoizedProps);r.componentDidUpdate(i,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&Ey(e,s,r);break;case 3:var a=e.updateQueue;if(a!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}Ey(e,a,n)}break;case 5:var u=e.stateNode;if(n===null&&e.flags&4){n=u;var h=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":h.autoFocus&&n.focus();break;case"img":h.src&&(n.src=h.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var m=e.alternate;if(m!==null){var p=m.memoizedState;if(p!==null){var _=p.dehydrated;_!==null&&$c(_)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(re(163))}ln||e.flags&512&&Ap(e)}catch(v){vt(e,e.return,v)}}if(e===t){pe=null;break}if(n=e.sibling,n!==null){n.return=e.return,pe=n;break}pe=e.return}}function zy(t){for(;pe!==null;){var e=pe;if(e===t){pe=null;break}var n=e.sibling;if(n!==null){n.return=e.return,pe=n;break}pe=e.return}}function By(t){for(;pe!==null;){var e=pe;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{cf(4,e)}catch(h){vt(e,n,h)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(h){vt(e,i,h)}}var s=e.return;try{Ap(e)}catch(h){vt(e,s,h)}break;case 5:var a=e.return;try{Ap(e)}catch(h){vt(e,a,h)}}}catch(h){vt(e,e.return,h)}if(e===t){pe=null;break}var u=e.sibling;if(u!==null){u.return=e.return,pe=u;break}pe=e.return}}var $C=Math.ceil,Cd=vi.ReactCurrentDispatcher,Jg=vi.ReactCurrentOwner,Hn=vi.ReactCurrentBatchConfig,qe=0,qt=null,jt=null,Jt=0,An=0,Ia=As(0),Vt=0,eu=null,xo=0,uf=0,Yg=0,Nc=null,vn=null,Xg=0,Ua=1/0,ii=null,Pd=!1,jp=null,ms=null,Ah=!1,os=null,Nd=0,Ac=0,Dp=null,Zh=-1,Jh=0;function mn(){return qe&6?Et():Zh!==-1?Zh:Zh=Et()}function ps(t){return t.mode&1?qe&2&&Jt!==0?Jt&-Jt:SC.transition!==null?(Jh===0&&(Jh=yw()),Jh):(t=He,t!==0||(t=window.event,t=t===void 0?16:Sw(t.type)),t):1}function pr(t,e,n,r){if(50<Ac)throw Ac=0,Dp=null,Error(re(185));xu(t,n,r),(!(qe&2)||t!==qt)&&(t===qt&&(!(qe&2)&&(uf|=n),Vt===4&&es(t,Jt)),Sn(t,r),n===1&&qe===0&&!(e.mode&1)&&(Ua=Et()+500,of&&ks()))}function Sn(t,e){var n=t.callbackNode;SS(t,e);var r=dd(t,t===qt?Jt:0);if(r===0)n!==null&&Zv(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&Zv(n),e===1)t.tag===0?IC(Uy.bind(null,t)):Gw(Uy.bind(null,t)),wC(function(){!(qe&6)&&ks()}),n=null;else{switch(xw(r)){case 1:n=Ig;break;case 4:n=_w;break;case 16:n=hd;break;case 536870912:n=vw;break;default:n=hd}n=$1(n,M1.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function M1(t,e){if(Zh=-1,Jh=0,qe&6)throw Error(re(327));var n=t.callbackNode;if(Ra()&&t.callbackNode!==n)return null;var r=dd(t,t===qt?Jt:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Ad(t,r);else{e=r;var i=qe;qe|=2;var s=O1();(qt!==t||Jt!==e)&&(ii=null,Ua=Et()+500,fo(t,e));do try{WC();break}catch(u){V1(t,u)}while(1);Og(),Cd.current=s,qe=i,jt!==null?e=0:(qt=null,Jt=0,e=Vt)}if(e!==0){if(e===2&&(i=ap(t),i!==0&&(r=i,e=Lp(t,i))),e===1)throw n=eu,fo(t,0),es(t,r),Sn(t,Et()),n;if(e===6)es(t,r);else{if(i=t.current.alternate,!(r&30)&&!qC(i)&&(e=Ad(t,r),e===2&&(s=ap(t),s!==0&&(r=s,e=Lp(t,s))),e===1))throw n=eu,fo(t,0),es(t,r),Sn(t,Et()),n;switch(t.finishedWork=i,t.finishedLanes=r,e){case 0:case 1:throw Error(re(345));case 2:to(t,vn,ii);break;case 3:if(es(t,r),(r&130023424)===r&&(e=Xg+500-Et(),10<e)){if(dd(t,0)!==0)break;if(i=t.suspendedLanes,(i&r)!==r){mn(),t.pingedLanes|=t.suspendedLanes&i;break}t.timeoutHandle=pp(to.bind(null,t,vn,ii),e);break}to(t,vn,ii);break;case 4:if(es(t,r),(r&4194240)===r)break;for(e=t.eventTimes,i=-1;0<r;){var a=31-mr(r);s=1<<a,a=e[a],a>i&&(i=a),r&=~s}if(r=i,r=Et()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*$C(r/1960))-r,10<r){t.timeoutHandle=pp(to.bind(null,t,vn,ii),r);break}to(t,vn,ii);break;case 5:to(t,vn,ii);break;default:throw Error(re(329))}}}return Sn(t,Et()),t.callbackNode===n?M1.bind(null,t):null}function Lp(t,e){var n=Nc;return t.current.memoizedState.isDehydrated&&(fo(t,e).flags|=256),t=Ad(t,e),t!==2&&(e=vn,vn=n,e!==null&&Mp(e)),t}function Mp(t){vn===null?vn=t:vn.push.apply(vn,t)}function qC(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var i=n[r],s=i.getSnapshot;i=i.value;try{if(!gr(s(),i))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function es(t,e){for(e&=~Yg,e&=~uf,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-mr(e),r=1<<n;t[n]=-1,e&=~r}}function Uy(t){if(qe&6)throw Error(re(327));Ra();var e=dd(t,0);if(!(e&1))return Sn(t,Et()),null;var n=Ad(t,e);if(t.tag!==0&&n===2){var r=ap(t);r!==0&&(e=r,n=Lp(t,r))}if(n===1)throw n=eu,fo(t,0),es(t,e),Sn(t,Et()),n;if(n===6)throw Error(re(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,to(t,vn,ii),Sn(t,Et()),null}function e_(t,e){var n=qe;qe|=1;try{return t(e)}finally{qe=n,qe===0&&(Ua=Et()+500,of&&ks())}}function wo(t){os!==null&&os.tag===0&&!(qe&6)&&Ra();var e=qe;qe|=1;var n=Hn.transition,r=He;try{if(Hn.transition=null,He=1,t)return t()}finally{He=r,Hn.transition=n,qe=e,!(qe&6)&&ks()}}function t_(){An=Ia.current,rt(Ia)}function fo(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,xC(n)),jt!==null)for(n=jt.return;n!==null;){var r=n;switch(Lg(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&_d();break;case 3:za(),rt(Tn),rt(hn),qg();break;case 5:$g(r);break;case 4:za();break;case 13:rt(ft);break;case 19:rt(ft);break;case 10:Fg(r.type._context);break;case 22:case 23:t_()}n=n.return}if(qt=t,jt=t=gs(t.current,null),Jt=An=e,Vt=0,eu=null,Yg=uf=xo=0,vn=Nc=null,co!==null){for(e=0;e<co.length;e++)if(n=co[e],r=n.interleaved,r!==null){n.interleaved=null;var i=r.next,s=n.pending;if(s!==null){var a=s.next;s.next=i,r.next=a}n.pending=r}co=null}return t}function V1(t,e){do{var n=jt;try{if(Og(),Hh.current=Sd,Id){for(var r=mt.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}Id=!1}if(yo=0,Ut=Mt=mt=null,Cc=!1,Jc=0,Jg.current=null,n===null||n.return===null){Vt=1,eu=e,jt=null;break}e:{var s=t,a=n.return,u=n,h=e;if(e=Jt,u.flags|=32768,h!==null&&typeof h=="object"&&typeof h.then=="function"){var m=h,p=u,_=p.tag;if(!(p.mode&1)&&(_===0||_===11||_===15)){var v=p.alternate;v?(p.updateQueue=v.updateQueue,p.memoizedState=v.memoizedState,p.lanes=v.lanes):(p.updateQueue=null,p.memoizedState=null)}var x=Ny(a);if(x!==null){x.flags&=-257,Ay(x,a,u,s,e),x.mode&1&&Py(s,m,e),e=x,h=m;var T=e.updateQueue;if(T===null){var E=new Set;E.add(h),e.updateQueue=E}else T.add(h);break e}else{if(!(e&1)){Py(s,m,e),n_();break e}h=Error(re(426))}}else if(ot&&u.mode&1){var R=Ny(a);if(R!==null){!(R.flags&65536)&&(R.flags|=256),Ay(R,a,u,s,e),Mg(Ba(h,u));break e}}s=h=Ba(h,u),Vt!==4&&(Vt=2),Nc===null?Nc=[s]:Nc.push(s),s=a;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var S=x1(s,h,e);by(s,S);break e;case 1:u=h;var C=s.type,A=s.stateNode;if(!(s.flags&128)&&(typeof C.getDerivedStateFromError=="function"||A!==null&&typeof A.componentDidCatch=="function"&&(ms===null||!ms.has(A)))){s.flags|=65536,e&=-e,s.lanes|=e;var U=w1(s,u,e);by(s,U);break e}}s=s.return}while(s!==null)}z1(n)}catch(Z){e=Z,jt===n&&n!==null&&(jt=n=n.return);continue}break}while(1)}function O1(){var t=Cd.current;return Cd.current=Sd,t===null?Sd:t}function n_(){(Vt===0||Vt===3||Vt===2)&&(Vt=4),qt===null||!(xo&268435455)&&!(uf&268435455)||es(qt,Jt)}function Ad(t,e){var n=qe;qe|=2;var r=O1();(qt!==t||Jt!==e)&&(ii=null,fo(t,e));do try{GC();break}catch(i){V1(t,i)}while(1);if(Og(),qe=n,Cd.current=r,jt!==null)throw Error(re(261));return qt=null,Jt=0,Vt}function GC(){for(;jt!==null;)F1(jt)}function WC(){for(;jt!==null&&!_S();)F1(jt)}function F1(t){var e=U1(t.alternate,t,An);t.memoizedProps=t.pendingProps,e===null?z1(t):jt=e,Jg.current=null}function z1(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=FC(n,e),n!==null){n.flags&=32767,jt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Vt=6,jt=null;return}}else if(n=OC(n,e,An),n!==null){jt=n;return}if(e=e.sibling,e!==null){jt=e;return}jt=e=t}while(e!==null);Vt===0&&(Vt=5)}function to(t,e,n){var r=He,i=Hn.transition;try{Hn.transition=null,He=1,HC(t,e,n,r)}finally{Hn.transition=i,He=r}return null}function HC(t,e,n,r){do Ra();while(os!==null);if(qe&6)throw Error(re(327));n=t.finishedWork;var i=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(re(177));t.callbackNode=null,t.callbackPriority=0;var s=n.lanes|n.childLanes;if(CS(t,s),t===qt&&(jt=qt=null,Jt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||Ah||(Ah=!0,$1(hd,function(){return Ra(),null})),s=(n.flags&15990)!==0,n.subtreeFlags&15990||s){s=Hn.transition,Hn.transition=null;var a=He;He=1;var u=qe;qe|=4,Jg.current=null,BC(t,n),D1(n,t),fC(fp),fd=!!dp,fp=dp=null,t.current=n,UC(n),vS(),qe=u,He=a,Hn.transition=s}else t.current=n;if(Ah&&(Ah=!1,os=t,Nd=i),s=t.pendingLanes,s===0&&(ms=null),wS(n.stateNode),Sn(t,Et()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)i=e[n],r(i.value,{componentStack:i.stack,digest:i.digest});if(Pd)throw Pd=!1,t=jp,jp=null,t;return Nd&1&&t.tag!==0&&Ra(),s=t.pendingLanes,s&1?t===Dp?Ac++:(Ac=0,Dp=t):Ac=0,ks(),null}function Ra(){if(os!==null){var t=xw(Nd),e=Hn.transition,n=He;try{if(Hn.transition=null,He=16>t?16:t,os===null)var r=!1;else{if(t=os,os=null,Nd=0,qe&6)throw Error(re(331));var i=qe;for(qe|=4,pe=t.current;pe!==null;){var s=pe,a=s.child;if(pe.flags&16){var u=s.deletions;if(u!==null){for(var h=0;h<u.length;h++){var m=u[h];for(pe=m;pe!==null;){var p=pe;switch(p.tag){case 0:case 11:case 15:Pc(8,p,s)}var _=p.child;if(_!==null)_.return=p,pe=_;else for(;pe!==null;){p=pe;var v=p.sibling,x=p.return;if(k1(p),p===m){pe=null;break}if(v!==null){v.return=x,pe=v;break}pe=x}}}var T=s.alternate;if(T!==null){var E=T.child;if(E!==null){T.child=null;do{var R=E.sibling;E.sibling=null,E=R}while(E!==null)}}pe=s}}if(s.subtreeFlags&2064&&a!==null)a.return=s,pe=a;else e:for(;pe!==null;){if(s=pe,s.flags&2048)switch(s.tag){case 0:case 11:case 15:Pc(9,s,s.return)}var S=s.sibling;if(S!==null){S.return=s.return,pe=S;break e}pe=s.return}}var C=t.current;for(pe=C;pe!==null;){a=pe;var A=a.child;if(a.subtreeFlags&2064&&A!==null)A.return=a,pe=A;else e:for(a=C;pe!==null;){if(u=pe,u.flags&2048)try{switch(u.tag){case 0:case 11:case 15:cf(9,u)}}catch(Z){vt(u,u.return,Z)}if(u===a){pe=null;break e}var U=u.sibling;if(U!==null){U.return=u.return,pe=U;break e}pe=u.return}}if(qe=i,ks(),Dr&&typeof Dr.onPostCommitFiberRoot=="function")try{Dr.onPostCommitFiberRoot(ef,t)}catch{}r=!0}return r}finally{He=n,Hn.transition=e}}return!1}function $y(t,e,n){e=Ba(n,e),e=x1(t,e,1),t=fs(t,e,1),e=mn(),t!==null&&(xu(t,1,e),Sn(t,e))}function vt(t,e,n){if(t.tag===3)$y(t,t,n);else for(;e!==null;){if(e.tag===3){$y(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(ms===null||!ms.has(r))){t=Ba(n,t),t=w1(e,t,1),e=fs(e,t,1),t=mn(),e!==null&&(xu(e,1,t),Sn(e,t));break}}e=e.return}}function KC(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=mn(),t.pingedLanes|=t.suspendedLanes&n,qt===t&&(Jt&n)===n&&(Vt===4||Vt===3&&(Jt&130023424)===Jt&&500>Et()-Xg?fo(t,0):Yg|=n),Sn(t,e)}function B1(t,e){e===0&&(t.mode&1?(e=xh,xh<<=1,!(xh&130023424)&&(xh=4194304)):e=1);var n=mn();t=fi(t,e),t!==null&&(xu(t,e,n),Sn(t,n))}function QC(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),B1(t,n)}function ZC(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,i=t.memoizedState;i!==null&&(n=i.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(re(314))}r!==null&&r.delete(e),B1(t,n)}var U1;U1=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Tn.current)xn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return xn=!1,VC(t,e,n);xn=!!(t.flags&131072)}else xn=!1,ot&&e.flags&1048576&&Ww(e,xd,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Qh(t,e),t=e.pendingProps;var i=Va(e,hn.current);ka(e,n),i=Wg(null,e,r,t,i,n);var s=Hg();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,In(r)?(s=!0,vd(e)):s=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Bg(e),i.updater=lf,e.stateNode=i,i._reactInternals=e,bp(e,r,t,n),e=Ip(null,e,r,!0,s,n)):(e.tag=0,ot&&s&&Dg(e),fn(null,e,i,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Qh(t,e),t=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=YC(r),t=ur(r,t),i){case 0:e=Tp(null,e,r,t,n);break e;case 1:e=jy(null,e,r,t,n);break e;case 11:e=ky(null,e,r,t,n);break e;case 14:e=Ry(null,e,r,ur(r.type,t),n);break e}throw Error(re(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:ur(r,i),Tp(t,e,r,i,n);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:ur(r,i),jy(t,e,r,i,n);case 3:e:{if(I1(e),t===null)throw Error(re(387));r=e.pendingProps,s=e.memoizedState,i=s.element,Yw(t,e),Ed(e,r,null,n);var a=e.memoizedState;if(r=a.element,s.isDehydrated)if(s={element:r,isDehydrated:!1,cache:a.cache,pendingSuspenseBoundaries:a.pendingSuspenseBoundaries,transitions:a.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){i=Ba(Error(re(423)),e),e=Dy(t,e,r,n,i);break e}else if(r!==i){i=Ba(Error(re(424)),e),e=Dy(t,e,r,n,i);break e}else for(kn=ds(e.stateNode.containerInfo.firstChild),Rn=e,ot=!0,dr=null,n=Zw(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Oa(),r===i){e=mi(t,e,n);break e}fn(t,e,r,n)}e=e.child}return e;case 5:return Xw(e),t===null&&yp(e),r=e.type,i=e.pendingProps,s=t!==null?t.memoizedProps:null,a=i.children,mp(r,i)?a=null:s!==null&&mp(r,s)&&(e.flags|=32),T1(t,e),fn(t,e,a,n),e.child;case 6:return t===null&&yp(e),null;case 13:return S1(t,e,n);case 4:return Ug(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Fa(e,null,r,n):fn(t,e,r,n),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:ur(r,i),ky(t,e,r,i,n);case 7:return fn(t,e,e.pendingProps,n),e.child;case 8:return fn(t,e,e.pendingProps.children,n),e.child;case 12:return fn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,s=e.memoizedProps,a=i.value,Ye(wd,r._currentValue),r._currentValue=a,s!==null)if(gr(s.value,a)){if(s.children===i.children&&!Tn.current){e=mi(t,e,n);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var u=s.dependencies;if(u!==null){a=s.child;for(var h=u.firstContext;h!==null;){if(h.context===r){if(s.tag===1){h=ci(-1,n&-n),h.tag=2;var m=s.updateQueue;if(m!==null){m=m.shared;var p=m.pending;p===null?h.next=h:(h.next=p.next,p.next=h),m.pending=h}}s.lanes|=n,h=s.alternate,h!==null&&(h.lanes|=n),xp(s.return,n,e),u.lanes|=n;break}h=h.next}}else if(s.tag===10)a=s.type===e.type?null:s.child;else if(s.tag===18){if(a=s.return,a===null)throw Error(re(341));a.lanes|=n,u=a.alternate,u!==null&&(u.lanes|=n),xp(a,n,e),a=s.sibling}else a=s.child;if(a!==null)a.return=s;else for(a=s;a!==null;){if(a===e){a=null;break}if(s=a.sibling,s!==null){s.return=a.return,a=s;break}a=a.return}s=a}fn(t,e,i.children,n),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,ka(e,n),i=Qn(i),r=r(i),e.flags|=1,fn(t,e,r,n),e.child;case 14:return r=e.type,i=ur(r,e.pendingProps),i=ur(r.type,i),Ry(t,e,r,i,n);case 15:return b1(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:ur(r,i),Qh(t,e),e.tag=1,In(r)?(t=!0,vd(e)):t=!1,ka(e,n),y1(e,r,i),bp(e,r,i,n),Ip(null,e,r,!0,t,n);case 19:return C1(t,e,n);case 22:return E1(t,e,n)}throw Error(re(156,e.tag))};function $1(t,e){return gw(t,e)}function JC(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Wn(t,e,n,r){return new JC(t,e,n,r)}function r_(t){return t=t.prototype,!(!t||!t.isReactComponent)}function YC(t){if(typeof t=="function")return r_(t)?1:0;if(t!=null){if(t=t.$$typeof,t===bg)return 11;if(t===Eg)return 14}return 2}function gs(t,e){var n=t.alternate;return n===null?(n=Wn(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function Yh(t,e,n,r,i,s){var a=2;if(r=t,typeof t=="function")r_(t)&&(a=1);else if(typeof t=="string")a=5;else e:switch(t){case pa:return mo(n.children,i,s,e);case wg:a=8,i|=8;break;case Wm:return t=Wn(12,n,e,i|2),t.elementType=Wm,t.lanes=s,t;case Hm:return t=Wn(13,n,e,i),t.elementType=Hm,t.lanes=s,t;case Km:return t=Wn(19,n,e,i),t.elementType=Km,t.lanes=s,t;case Xx:return hf(n,i,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Jx:a=10;break e;case Yx:a=9;break e;case bg:a=11;break e;case Eg:a=14;break e;case Ji:a=16,r=null;break e}throw Error(re(130,t==null?t:typeof t,""))}return e=Wn(a,n,e,i),e.elementType=t,e.type=r,e.lanes=s,e}function mo(t,e,n,r){return t=Wn(7,t,r,e),t.lanes=n,t}function hf(t,e,n,r){return t=Wn(22,t,r,e),t.elementType=Xx,t.lanes=n,t.stateNode={isHidden:!1},t}function Im(t,e,n){return t=Wn(6,t,null,e),t.lanes=n,t}function Sm(t,e,n){return e=Wn(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function XC(t,e,n,r,i){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=om(0),this.expirationTimes=om(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=om(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function i_(t,e,n,r,i,s,a,u,h){return t=new XC(t,e,n,u,h),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Wn(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Bg(s),t}function eP(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ma,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function q1(t){if(!t)return ws;t=t._reactInternals;e:{if(Do(t)!==t||t.tag!==1)throw Error(re(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(In(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(re(171))}if(t.tag===1){var n=t.type;if(In(n))return qw(t,n,e)}return e}function G1(t,e,n,r,i,s,a,u,h){return t=i_(n,r,!0,t,i,s,a,u,h),t.context=q1(null),n=t.current,r=mn(),i=ps(n),s=ci(r,i),s.callback=e??null,fs(n,s,i),t.current.lanes=i,xu(t,i,r),Sn(t,r),t}function df(t,e,n,r){var i=e.current,s=mn(),a=ps(i);return n=q1(n),e.context===null?e.context=n:e.pendingContext=n,e=ci(s,a),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=fs(i,e,a),t!==null&&(pr(t,i,a,s),Wh(t,i,a)),a}function kd(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function qy(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function s_(t,e){qy(t,e),(t=t.alternate)&&qy(t,e)}function tP(){return null}var W1=typeof reportError=="function"?reportError:function(t){console.error(t)};function o_(t){this._internalRoot=t}ff.prototype.render=o_.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(re(409));df(t,e,null,null)};ff.prototype.unmount=o_.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;wo(function(){df(null,t,null,null)}),e[di]=null}};function ff(t){this._internalRoot=t}ff.prototype.unstable_scheduleHydration=function(t){if(t){var e=Ew();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Xi.length&&e!==0&&e<Xi[n].priority;n++);Xi.splice(n,0,t),n===0&&Iw(t)}};function a_(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function mf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function Gy(){}function nP(t,e,n,r,i){if(i){if(typeof r=="function"){var s=r;r=function(){var m=kd(a);s.call(m)}}var a=G1(e,r,t,0,null,!1,!1,"",Gy);return t._reactRootContainer=a,t[di]=a.current,Wc(t.nodeType===8?t.parentNode:t),wo(),a}for(;i=t.lastChild;)t.removeChild(i);if(typeof r=="function"){var u=r;r=function(){var m=kd(h);u.call(m)}}var h=i_(t,0,!1,null,null,!1,!1,"",Gy);return t._reactRootContainer=h,t[di]=h.current,Wc(t.nodeType===8?t.parentNode:t),wo(function(){df(e,h,n,r)}),h}function pf(t,e,n,r,i){var s=n._reactRootContainer;if(s){var a=s;if(typeof i=="function"){var u=i;i=function(){var h=kd(a);u.call(h)}}df(e,a,t,i)}else a=nP(n,e,t,i,r);return kd(a)}ww=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=pc(e.pendingLanes);n!==0&&(Sg(e,n|1),Sn(e,Et()),!(qe&6)&&(Ua=Et()+500,ks()))}break;case 13:wo(function(){var r=fi(t,1);if(r!==null){var i=mn();pr(r,t,1,i)}}),s_(t,1)}};Cg=function(t){if(t.tag===13){var e=fi(t,134217728);if(e!==null){var n=mn();pr(e,t,134217728,n)}s_(t,134217728)}};bw=function(t){if(t.tag===13){var e=ps(t),n=fi(t,e);if(n!==null){var r=mn();pr(n,t,e,r)}s_(t,e)}};Ew=function(){return He};Tw=function(t,e){var n=He;try{return He=t,e()}finally{He=n}};ip=function(t,e,n){switch(e){case"input":if(Jm(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var i=sf(r);if(!i)throw Error(re(90));tw(r),Jm(r,i)}}}break;case"textarea":rw(t,n);break;case"select":e=n.value,e!=null&&Ca(t,!!n.multiple,e,!1)}};uw=e_;hw=wo;var rP={usingClientEntryPoint:!1,Events:[bu,ya,sf,lw,cw,e_]},sc={findFiberByHostInstance:lo,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},iP={bundleType:sc.bundleType,version:sc.version,rendererPackageName:sc.rendererPackageName,rendererConfig:sc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:vi.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=mw(t),t===null?null:t.stateNode},findFiberByHostInstance:sc.findFiberByHostInstance||tP,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var kh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!kh.isDisabled&&kh.supportsFiber)try{ef=kh.inject(iP),Dr=kh}catch{}}Ln.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=rP;Ln.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!a_(e))throw Error(re(200));return eP(t,e,null,n)};Ln.createRoot=function(t,e){if(!a_(t))throw Error(re(299));var n=!1,r="",i=W1;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=i_(t,1,!1,null,null,n,!1,r,i),t[di]=e.current,Wc(t.nodeType===8?t.parentNode:t),new o_(e)};Ln.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(re(188)):(t=Object.keys(t).join(","),Error(re(268,t)));return t=mw(e),t=t===null?null:t.stateNode,t};Ln.flushSync=function(t){return wo(t)};Ln.hydrate=function(t,e,n){if(!mf(e))throw Error(re(200));return pf(null,t,e,!0,n)};Ln.hydrateRoot=function(t,e,n){if(!a_(t))throw Error(re(405));var r=n!=null&&n.hydratedSources||null,i=!1,s="",a=W1;if(n!=null&&(n.unstable_strictMode===!0&&(i=!0),n.identifierPrefix!==void 0&&(s=n.identifierPrefix),n.onRecoverableError!==void 0&&(a=n.onRecoverableError)),e=G1(e,null,t,1,n??null,i,!1,s,a),t[di]=e.current,Wc(t),r)for(t=0;t<r.length;t++)n=r[t],i=n._getVersion,i=i(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,i]:e.mutableSourceEagerHydrationData.push(n,i);return new ff(e)};Ln.render=function(t,e,n){if(!mf(e))throw Error(re(200));return pf(null,t,e,!1,n)};Ln.unmountComponentAtNode=function(t){if(!mf(t))throw Error(re(40));return t._reactRootContainer?(wo(function(){pf(null,null,t,!1,function(){t._reactRootContainer=null,t[di]=null})}),!0):!1};Ln.unstable_batchedUpdates=e_;Ln.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!mf(n))throw Error(re(200));if(t==null||t._reactInternals===void 0)throw Error(re(38));return pf(t,e,n,!1,r)};Ln.version="18.3.1-next-f1338f8080-20240426";function H1(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(H1)}catch(t){console.error(t)}}H1(),Hx.exports=Ln;var l_=Hx.exports,Wy=l_;qm.createRoot=Wy.createRoot,qm.hydrateRoot=Wy.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function tu(){return tu=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},tu.apply(this,arguments)}var as;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(as||(as={}));const Hy="popstate";function sP(t){t===void 0&&(t={});function e(r,i){let{pathname:s,search:a,hash:u}=r.location;return Vp("",{pathname:s,search:a,hash:u},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function n(r,i){return typeof i=="string"?i:Rd(i)}return aP(e,n,null,t)}function It(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function K1(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function oP(){return Math.random().toString(36).substr(2,8)}function Ky(t,e){return{usr:t.state,key:t.key,idx:e}}function Vp(t,e,n,r){return n===void 0&&(n=null),tu({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?hl(e):e,{state:n,key:e&&e.key||r||oP()})}function Rd(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function hl(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function aP(t,e,n,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:s=!1}=r,a=i.history,u=as.Pop,h=null,m=p();m==null&&(m=0,a.replaceState(tu({},a.state,{idx:m}),""));function p(){return(a.state||{idx:null}).idx}function _(){u=as.Pop;let R=p(),S=R==null?null:R-m;m=R,h&&h({action:u,location:E.location,delta:S})}function v(R,S){u=as.Push;let C=Vp(E.location,R,S);n&&n(C,R),m=p()+1;let A=Ky(C,m),U=E.createHref(C);try{a.pushState(A,"",U)}catch(Z){if(Z instanceof DOMException&&Z.name==="DataCloneError")throw Z;i.location.assign(U)}s&&h&&h({action:u,location:E.location,delta:1})}function x(R,S){u=as.Replace;let C=Vp(E.location,R,S);n&&n(C,R),m=p();let A=Ky(C,m),U=E.createHref(C);a.replaceState(A,"",U),s&&h&&h({action:u,location:E.location,delta:0})}function T(R){let S=i.location.origin!=="null"?i.location.origin:i.location.href,C=typeof R=="string"?R:Rd(R);return C=C.replace(/ $/,"%20"),It(S,"No window.location.(origin|href) available to create URL for href: "+C),new URL(C,S)}let E={get action(){return u},get location(){return t(i,a)},listen(R){if(h)throw new Error("A history only accepts one active listener");return i.addEventListener(Hy,_),h=R,()=>{i.removeEventListener(Hy,_),h=null}},createHref(R){return e(i,R)},createURL:T,encodeLocation(R){let S=T(R);return{pathname:S.pathname,search:S.search,hash:S.hash}},push:v,replace:x,go(R){return a.go(R)}};return E}var Qy;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Qy||(Qy={}));function lP(t,e,n){return n===void 0&&(n="/"),cP(t,e,n,!1)}function cP(t,e,n,r){let i=typeof e=="string"?hl(e):e,s=c_(i.pathname||"/",n);if(s==null)return null;let a=Q1(t);uP(a);let u=null;for(let h=0;u==null&&h<a.length;++h){let m=wP(s);u=yP(a[h],m,r)}return u}function Q1(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let i=(s,a,u)=>{let h={relativePath:u===void 0?s.path||"":u,caseSensitive:s.caseSensitive===!0,childrenIndex:a,route:s};h.relativePath.startsWith("/")&&(It(h.relativePath.startsWith(r),'Absolute route path "'+h.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),h.relativePath=h.relativePath.slice(r.length));let m=_s([r,h.relativePath]),p=n.concat(h);s.children&&s.children.length>0&&(It(s.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+m+'".')),Q1(s.children,e,p,m)),!(s.path==null&&!s.index)&&e.push({path:m,score:_P(m,s.index),routesMeta:p})};return t.forEach((s,a)=>{var u;if(s.path===""||!((u=s.path)!=null&&u.includes("?")))i(s,a);else for(let h of Z1(s.path))i(s,a,h)}),e}function Z1(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,i=n.endsWith("?"),s=n.replace(/\?$/,"");if(r.length===0)return i?[s,""]:[s];let a=Z1(r.join("/")),u=[];return u.push(...a.map(h=>h===""?s:[s,h].join("/"))),i&&u.push(...a),u.map(h=>t.startsWith("/")&&h===""?"/":h)}function uP(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:vP(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const hP=/^:[\w-]+$/,dP=3,fP=2,mP=1,pP=10,gP=-2,Zy=t=>t==="*";function _P(t,e){let n=t.split("/"),r=n.length;return n.some(Zy)&&(r+=gP),e&&(r+=fP),n.filter(i=>!Zy(i)).reduce((i,s)=>i+(hP.test(s)?dP:s===""?mP:pP),r)}function vP(t,e){return t.length===e.length&&t.slice(0,-1).every((r,i)=>r===e[i])?t[t.length-1]-e[e.length-1]:0}function yP(t,e,n){n===void 0&&(n=!1);let{routesMeta:r}=t,i={},s="/",a=[];for(let u=0;u<r.length;++u){let h=r[u],m=u===r.length-1,p=s==="/"?e:e.slice(s.length)||"/",_=Jy({path:h.relativePath,caseSensitive:h.caseSensitive,end:m},p),v=h.route;if(!_&&m&&n&&!r[r.length-1].route.index&&(_=Jy({path:h.relativePath,caseSensitive:h.caseSensitive,end:!1},p)),!_)return null;Object.assign(i,_.params),a.push({params:i,pathname:_s([s,_.pathname]),pathnameBase:IP(_s([s,_.pathnameBase])),route:v}),_.pathnameBase!=="/"&&(s=_s([s,_.pathnameBase]))}return a}function Jy(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=xP(t.path,t.caseSensitive,t.end),i=e.match(n);if(!i)return null;let s=i[0],a=s.replace(/(.)\/+$/,"$1"),u=i.slice(1);return{params:r.reduce((m,p,_)=>{let{paramName:v,isOptional:x}=p;if(v==="*"){let E=u[_]||"";a=s.slice(0,s.length-E.length).replace(/(.)\/+$/,"$1")}const T=u[_];return x&&!T?m[v]=void 0:m[v]=(T||"").replace(/%2F/g,"/"),m},{}),pathname:s,pathnameBase:a,pattern:t}}function xP(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),K1(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],i="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(a,u,h)=>(r.push({paramName:u,isOptional:h!=null}),h?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),i+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?i+="\\/*$":t!==""&&t!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function wP(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return K1(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function c_(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function bP(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:i=""}=typeof t=="string"?hl(t):t;return{pathname:n?n.startsWith("/")?n:EP(n,e):e,search:SP(r),hash:CP(i)}}function EP(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(i=>{i===".."?n.length>1&&n.pop():i!=="."&&n.push(i)}),n.length>1?n.join("/"):"/"}function Cm(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function TP(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function u_(t,e){let n=TP(t);return e?n.map((r,i)=>i===n.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function h_(t,e,n,r){r===void 0&&(r=!1);let i;typeof t=="string"?i=hl(t):(i=tu({},t),It(!i.pathname||!i.pathname.includes("?"),Cm("?","pathname","search",i)),It(!i.pathname||!i.pathname.includes("#"),Cm("#","pathname","hash",i)),It(!i.search||!i.search.includes("#"),Cm("#","search","hash",i)));let s=t===""||i.pathname==="",a=s?"/":i.pathname,u;if(a==null)u=n;else{let _=e.length-1;if(!r&&a.startsWith("..")){let v=a.split("/");for(;v[0]==="..";)v.shift(),_-=1;i.pathname=v.join("/")}u=_>=0?e[_]:"/"}let h=bP(i,u),m=a&&a!=="/"&&a.endsWith("/"),p=(s||a===".")&&n.endsWith("/");return!h.pathname.endsWith("/")&&(m||p)&&(h.pathname+="/"),h}const _s=t=>t.join("/").replace(/\/\/+/g,"/"),IP=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),SP=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,CP=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;function PP(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const J1=["post","put","patch","delete"];new Set(J1);const NP=["get",...J1];new Set(NP);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function nu(){return nu=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},nu.apply(this,arguments)}const d_=B.createContext(null),AP=B.createContext(null),Rs=B.createContext(null),gf=B.createContext(null),yi=B.createContext({outlet:null,matches:[],isDataRoute:!1}),Y1=B.createContext(null);function kP(t,e){let{relative:n}=e===void 0?{}:e;dl()||It(!1);let{basename:r,navigator:i}=B.useContext(Rs),{hash:s,pathname:a,search:u}=tb(t,{relative:n}),h=a;return r!=="/"&&(h=a==="/"?r:_s([r,a])),i.createHref({pathname:h,search:u,hash:s})}function dl(){return B.useContext(gf)!=null}function fl(){return dl()||It(!1),B.useContext(gf).location}function X1(t){B.useContext(Rs).static||B.useLayoutEffect(t)}function js(){let{isDataRoute:t}=B.useContext(yi);return t?qP():RP()}function RP(){dl()||It(!1);let t=B.useContext(d_),{basename:e,future:n,navigator:r}=B.useContext(Rs),{matches:i}=B.useContext(yi),{pathname:s}=fl(),a=JSON.stringify(u_(i,n.v7_relativeSplatPath)),u=B.useRef(!1);return X1(()=>{u.current=!0}),B.useCallback(function(m,p){if(p===void 0&&(p={}),!u.current)return;if(typeof m=="number"){r.go(m);return}let _=h_(m,JSON.parse(a),s,p.relative==="path");t==null&&e!=="/"&&(_.pathname=_.pathname==="/"?e:_s([e,_.pathname])),(p.replace?r.replace:r.push)(_,p.state,p)},[e,r,a,s,t])}function eb(){let{matches:t}=B.useContext(yi),e=t[t.length-1];return e?e.params:{}}function tb(t,e){let{relative:n}=e===void 0?{}:e,{future:r}=B.useContext(Rs),{matches:i}=B.useContext(yi),{pathname:s}=fl(),a=JSON.stringify(u_(i,r.v7_relativeSplatPath));return B.useMemo(()=>h_(t,JSON.parse(a),s,n==="path"),[t,a,s,n])}function jP(t,e){return DP(t,e)}function DP(t,e,n,r){dl()||It(!1);let{navigator:i}=B.useContext(Rs),{matches:s}=B.useContext(yi),a=s[s.length-1],u=a?a.params:{};a&&a.pathname;let h=a?a.pathnameBase:"/";a&&a.route;let m=fl(),p;if(e){var _;let R=typeof e=="string"?hl(e):e;h==="/"||(_=R.pathname)!=null&&_.startsWith(h)||It(!1),p=R}else p=m;let v=p.pathname||"/",x=v;if(h!=="/"){let R=h.replace(/^\//,"").split("/");x="/"+v.replace(/^\//,"").split("/").slice(R.length).join("/")}let T=lP(t,{pathname:x}),E=FP(T&&T.map(R=>Object.assign({},R,{params:Object.assign({},u,R.params),pathname:_s([h,i.encodeLocation?i.encodeLocation(R.pathname).pathname:R.pathname]),pathnameBase:R.pathnameBase==="/"?h:_s([h,i.encodeLocation?i.encodeLocation(R.pathnameBase).pathname:R.pathnameBase])})),s,n,r);return e&&E?B.createElement(gf.Provider,{value:{location:nu({pathname:"/",search:"",hash:"",state:null,key:"default"},p),navigationType:as.Pop}},E):E}function LP(){let t=$P(),e=PP(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},s=null;return B.createElement(B.Fragment,null,B.createElement("h2",null,"Unexpected Application Error!"),B.createElement("h3",{style:{fontStyle:"italic"}},e),n?B.createElement("pre",{style:i},n):null,s)}const MP=B.createElement(LP,null);class VP extends B.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?B.createElement(yi.Provider,{value:this.props.routeContext},B.createElement(Y1.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function OP(t){let{routeContext:e,match:n,children:r}=t,i=B.useContext(d_);return i&&i.static&&i.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=n.route.id),B.createElement(yi.Provider,{value:e},r)}function FP(t,e,n,r){var i;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var s;if(!n)return null;if(n.errors)t=n.matches;else if((s=r)!=null&&s.v7_partialHydration&&e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let a=t,u=(i=n)==null?void 0:i.errors;if(u!=null){let p=a.findIndex(_=>_.route.id&&(u==null?void 0:u[_.route.id])!==void 0);p>=0||It(!1),a=a.slice(0,Math.min(a.length,p+1))}let h=!1,m=-1;if(n&&r&&r.v7_partialHydration)for(let p=0;p<a.length;p++){let _=a[p];if((_.route.HydrateFallback||_.route.hydrateFallbackElement)&&(m=p),_.route.id){let{loaderData:v,errors:x}=n,T=_.route.loader&&v[_.route.id]===void 0&&(!x||x[_.route.id]===void 0);if(_.route.lazy||T){h=!0,m>=0?a=a.slice(0,m+1):a=[a[0]];break}}}return a.reduceRight((p,_,v)=>{let x,T=!1,E=null,R=null;n&&(x=u&&_.route.id?u[_.route.id]:void 0,E=_.route.errorElement||MP,h&&(m<0&&v===0?(GP("route-fallback",!1),T=!0,R=null):m===v&&(T=!0,R=_.route.hydrateFallbackElement||null)));let S=e.concat(a.slice(0,v+1)),C=()=>{let A;return x?A=E:T?A=R:_.route.Component?A=B.createElement(_.route.Component,null):_.route.element?A=_.route.element:A=p,B.createElement(OP,{match:_,routeContext:{outlet:p,matches:S,isDataRoute:n!=null},children:A})};return n&&(_.route.ErrorBoundary||_.route.errorElement||v===0)?B.createElement(VP,{location:n.location,revalidation:n.revalidation,component:E,error:x,children:C(),routeContext:{outlet:null,matches:S,isDataRoute:!0}}):C()},null)}var nb=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(nb||{}),jd=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(jd||{});function zP(t){let e=B.useContext(d_);return e||It(!1),e}function BP(t){let e=B.useContext(AP);return e||It(!1),e}function UP(t){let e=B.useContext(yi);return e||It(!1),e}function rb(t){let e=UP(),n=e.matches[e.matches.length-1];return n.route.id||It(!1),n.route.id}function $P(){var t;let e=B.useContext(Y1),n=BP(jd.UseRouteError),r=rb(jd.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function qP(){let{router:t}=zP(nb.UseNavigateStable),e=rb(jd.UseNavigateStable),n=B.useRef(!1);return X1(()=>{n.current=!0}),B.useCallback(function(i,s){s===void 0&&(s={}),n.current&&(typeof i=="number"?t.navigate(i):t.navigate(i,nu({fromRouteId:e},s)))},[t,e])}const Yy={};function GP(t,e,n){!e&&!Yy[t]&&(Yy[t]=!0)}function WP(t,e){t==null||t.v7_startTransition,(t==null?void 0:t.v7_relativeSplatPath)===void 0&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}function $a(t){let{to:e,replace:n,state:r,relative:i}=t;dl()||It(!1);let{future:s,static:a}=B.useContext(Rs),{matches:u}=B.useContext(yi),{pathname:h}=fl(),m=js(),p=h_(e,u_(u,s.v7_relativeSplatPath),h,i==="path"),_=JSON.stringify(p);return B.useEffect(()=>m(JSON.parse(_),{replace:n,state:r,relative:i}),[m,_,i,n,r]),null}function cr(t){It(!1)}function HP(t){let{basename:e="/",children:n=null,location:r,navigationType:i=as.Pop,navigator:s,static:a=!1,future:u}=t;dl()&&It(!1);let h=e.replace(/^\/*/,"/"),m=B.useMemo(()=>({basename:h,navigator:s,static:a,future:nu({v7_relativeSplatPath:!1},u)}),[h,u,s,a]);typeof r=="string"&&(r=hl(r));let{pathname:p="/",search:_="",hash:v="",state:x=null,key:T="default"}=r,E=B.useMemo(()=>{let R=c_(p,h);return R==null?null:{location:{pathname:R,search:_,hash:v,state:x,key:T},navigationType:i}},[h,p,_,v,x,T,i]);return E==null?null:B.createElement(Rs.Provider,{value:m},B.createElement(gf.Provider,{children:n,value:E}))}function KP(t){let{children:e,location:n}=t;return jP(Op(e),n)}new Promise(()=>{});function Op(t,e){e===void 0&&(e=[]);let n=[];return B.Children.forEach(t,(r,i)=>{if(!B.isValidElement(r))return;let s=[...e,i];if(r.type===B.Fragment){n.push.apply(n,Op(r.props.children,s));return}r.type!==cr&&It(!1),!r.props.index||!r.props.children||It(!1);let a={id:r.props.id||s.join("-"),caseSensitive:r.props.caseSensitive,element:r.props.element,Component:r.props.Component,index:r.props.index,path:r.props.path,loader:r.props.loader,action:r.props.action,errorElement:r.props.errorElement,ErrorBoundary:r.props.ErrorBoundary,hasErrorBoundary:r.props.ErrorBoundary!=null||r.props.errorElement!=null,shouldRevalidate:r.props.shouldRevalidate,handle:r.props.handle,lazy:r.props.lazy};r.props.children&&(a.children=Op(r.props.children,s)),n.push(a)}),n}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Fp(){return Fp=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Fp.apply(this,arguments)}function QP(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,s;for(s=0;s<r.length;s++)i=r[s],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function ZP(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function JP(t,e){return t.button===0&&(!e||e==="_self")&&!ZP(t)}function zp(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let r=t[n];return e.concat(Array.isArray(r)?r.map(i=>[n,i]):[[n,r]])},[]))}function YP(t,e){let n=zp(t);return e&&e.forEach((r,i)=>{n.has(i)||e.getAll(i).forEach(s=>{n.append(i,s)})}),n}const XP=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],eN="6";try{window.__reactRouterVersion=eN}catch{}const tN="startTransition",Xy=KI[tN];function nN(t){let{basename:e,children:n,future:r,window:i}=t,s=B.useRef();s.current==null&&(s.current=sP({window:i,v5Compat:!0}));let a=s.current,[u,h]=B.useState({action:a.action,location:a.location}),{v7_startTransition:m}=r||{},p=B.useCallback(_=>{m&&Xy?Xy(()=>h(_)):h(_)},[h,m]);return B.useLayoutEffect(()=>a.listen(p),[a,p]),B.useEffect(()=>WP(r),[r]),B.createElement(HP,{basename:e,children:n,location:u.location,navigationType:u.action,navigator:a,future:r})}const rN=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",iN=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Rh=B.forwardRef(function(e,n){let{onClick:r,relative:i,reloadDocument:s,replace:a,state:u,target:h,to:m,preventScrollReset:p,viewTransition:_}=e,v=QP(e,XP),{basename:x}=B.useContext(Rs),T,E=!1;if(typeof m=="string"&&iN.test(m)&&(T=m,rN))try{let A=new URL(window.location.href),U=m.startsWith("//")?new URL(A.protocol+m):new URL(m),Z=c_(U.pathname,x);U.origin===A.origin&&Z!=null?m=Z+U.search+U.hash:E=!0}catch{}let R=kP(m,{relative:i}),S=sN(m,{replace:a,state:u,target:h,preventScrollReset:p,relative:i,viewTransition:_});function C(A){r&&r(A),A.defaultPrevented||S(A)}return B.createElement("a",Fp({},v,{href:T||R,onClick:E||s?r:C,ref:n,target:h}))});var e0;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(e0||(e0={}));var t0;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(t0||(t0={}));function sN(t,e){let{target:n,replace:r,state:i,preventScrollReset:s,relative:a,viewTransition:u}=e===void 0?{}:e,h=js(),m=fl(),p=tb(t,{relative:a});return B.useCallback(_=>{if(JP(_,n)){_.preventDefault();let v=r!==void 0?r:Rd(m)===Rd(p);h(t,{replace:v,state:i,preventScrollReset:s,relative:a,viewTransition:u})}},[m,h,p,r,i,n,t,s,a,u])}function oN(t){let e=B.useRef(zp(t)),n=B.useRef(!1),r=fl(),i=B.useMemo(()=>YP(r.search,n.current?null:e.current),[r.search]),s=js(),a=B.useCallback((u,h)=>{const m=zp(typeof u=="function"?u(i):u);n.current=!0,s("?"+m,h)},[s,i]);return[i,a]}const n0=t=>{let e;const n=new Set,r=(p,_)=>{const v=typeof p=="function"?p(e):p;if(!Object.is(v,e)){const x=e;e=_??(typeof v!="object"||v===null)?v:Object.assign({},e,v),n.forEach(T=>T(e,x))}},i=()=>e,h={setState:r,getState:i,getInitialState:()=>m,subscribe:p=>(n.add(p),()=>n.delete(p)),destroy:()=>{n.clear()}},m=e=t(r,i,h);return h},aN=t=>t?n0(t):n0;var ib={exports:{}},sb={},ob={exports:{}},ab={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qa=B;function lN(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var cN=typeof Object.is=="function"?Object.is:lN,uN=qa.useState,hN=qa.useEffect,dN=qa.useLayoutEffect,fN=qa.useDebugValue;function mN(t,e){var n=e(),r=uN({inst:{value:n,getSnapshot:e}}),i=r[0].inst,s=r[1];return dN(function(){i.value=n,i.getSnapshot=e,Pm(i)&&s({inst:i})},[t,n,e]),hN(function(){return Pm(i)&&s({inst:i}),t(function(){Pm(i)&&s({inst:i})})},[t]),fN(n),n}function Pm(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!cN(t,n)}catch{return!0}}function pN(t,e){return e()}var gN=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?pN:mN;ab.useSyncExternalStore=qa.useSyncExternalStore!==void 0?qa.useSyncExternalStore:gN;ob.exports=ab;var _N=ob.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _f=B,vN=_N;function yN(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var xN=typeof Object.is=="function"?Object.is:yN,wN=vN.useSyncExternalStore,bN=_f.useRef,EN=_f.useEffect,TN=_f.useMemo,IN=_f.useDebugValue;sb.useSyncExternalStoreWithSelector=function(t,e,n,r,i){var s=bN(null);if(s.current===null){var a={hasValue:!1,value:null};s.current=a}else a=s.current;s=TN(function(){function h(x){if(!m){if(m=!0,p=x,x=r(x),i!==void 0&&a.hasValue){var T=a.value;if(i(T,x))return _=T}return _=x}if(T=_,xN(p,x))return T;var E=r(x);return i!==void 0&&i(T,E)?(p=x,T):(p=x,_=E)}var m=!1,p,_,v=n===void 0?null:n;return[function(){return h(e())},v===null?void 0:function(){return h(v())}]},[e,n,r,i]);var u=wN(t,s[0],s[1]);return EN(function(){a.hasValue=!0,a.value=u},[u]),IN(u),u};ib.exports=sb;var SN=ib.exports;const CN=Lx(SN),{useDebugValue:PN}=ys,{useSyncExternalStoreWithSelector:NN}=CN;const AN=t=>t;function kN(t,e=AN,n){const r=NN(t.subscribe,t.getState,t.getServerState||t.getInitialState,e,n);return PN(r),r}const r0=t=>{const e=typeof t=="function"?aN(t):t,n=(r,i)=>kN(e,r,i);return Object.assign(n,e),n},lb=t=>t?r0(t):r0,RN=t=>(e,n,r)=>{const i=r.subscribe;return r.subscribe=(a,u,h)=>{let m=a;if(u){const p=(h==null?void 0:h.equalityFn)||Object.is;let _=a(r.getState());m=v=>{const x=a(v);if(!p(_,x)){const T=_;u(_=x,T)}},h!=null&&h.fireImmediately&&u(_,_)}return i(m)},t(e,n,r)},cb=RN,jN="modulepreload",DN=function(t){return"/doctorcar/"+t},i0={},LN=function(e,n,r){if(!n||n.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(n.map(s=>{if(s=DN(s),s in i0)return;i0[s]=!0;const a=s.endsWith(".css"),u=a?'[rel="stylesheet"]':"";if(!!r)for(let p=i.length-1;p>=0;p--){const _=i[p];if(_.href===s&&(!a||_.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${s}"]${u}`))return;const m=document.createElement("link");if(m.rel=a?"stylesheet":jN,a||(m.as="script",m.crossOrigin=""),m.href=s,document.head.appendChild(m),a)return new Promise((p,_)=>{m.addEventListener("load",p),m.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>e()).catch(s=>{const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=s,window.dispatchEvent(a),!a.defaultPrevented)throw s})},s0={development:{firebase:{apiKey:"demo-api-key",authDomain:"demo-doctorcar.firebaseapp.com",projectId:"demo-doctorcar",storageBucket:"demo-doctorcar.appspot.com",messagingSenderId:"123456789",appId:"1:123456789:web:demo"},enableEmulator:!0,enableLogging:!0},production:{firebase:{apiKey:"demo-api-key",authDomain:"demo-doctorcar.firebaseapp.com",projectId:"demo-doctorcar",storageBucket:"demo-doctorcar.appspot.com",messagingSenderId:"123456789",appId:"1:123456789:web:demo"},enableEmulator:!1,enableLogging:!1},demo:{firebase:{apiKey:"demo-api-key",authDomain:"demo-doctorcar.firebaseapp.com",projectId:"demo-doctorcar",storageBucket:"demo-doctorcar.appspot.com",messagingSenderId:"123456789",appId:"1:123456789:web:demo"},enableEmulator:!1,enableLogging:!0,demoMode:!0}},ub="production",hb=!0;console.log("Environment check:",{MODE:"production",VITE_MODE:"demo",currentEnv:ub,isDemoMode:hb,allEnvVars:{VITE_MODE:"demo",VITE_FIREBASE_API_KEY:"demo-api-key",VITE_FIREBASE_AUTH_DOMAIN:"demo-doctorcar.firebaseapp.com",VITE_FIREBASE_PROJECT_ID:"demo-doctorcar",VITE_FIREBASE_STORAGE_BUCKET:"demo-doctorcar.appspot.com",VITE_FIREBASE_MESSAGING_SENDER_ID:"123456789",VITE_FIREBASE_APP_ID:"1:123456789:web:demo",VITE_APP_NAME:"Doctor Car App (Demo)",VITE_APP_VERSION:"1.0.0-demo",VITE_LOCATION_UPDATE_INTERVAL:"10000",VITE_USER_NODE_ENV:"development",BASE_URL:"/doctorcar/",MODE:"production",DEV:!1,PROD:!0,SSR:!1}});const ui={...s0[ub]||s0.production,demoMode:hb},kt=(t,e)=>({latitude:t,longitude:e,isEqual:n=>n.latitude===t&&n.longitude===e,toJSON:()=>({latitude:t,longitude:e})}),bt=t=>({toDate:()=>t,toMillis:()=>t.getTime(),seconds:Math.floor(t.getTime()/1e3),nanoseconds:t.getTime()%1e3*1e6}),kc={"doctor-001":{uid:"doctor-001",name:"山田 太郎",role:"doctor_car",team:"東京科学大学病院ドクターカー",email:"doctor@demo.com"},"hospital-001":{uid:"hospital-001",name:"佐藤 花子",role:"hospital",team:"東京科学大学病院",email:"hospital@demo.com"}},ts=[{id:"case-001",caseName:"2024-12-14 新宿駅南口 交通外傷",status:"on_scene",teamId:"doctor-001",patientInfo:{age:45,gender:"male",name:"田中 一郎"},sceneLocation:kt(35.689487,139.691706),hospitalLocation:kt(35.699374,139.762881),createdAt:bt(new Date("2024-12-14T10:00:00Z")),updatedAt:bt(new Date("2024-12-14T10:30:00Z"))},{id:"case-002",caseName:"2024-12-13 信濃町駅前 心肺停止",status:"completed",teamId:"doctor-001",patientInfo:{age:67,gender:"female",name:"鈴木 恵子"},sceneLocation:kt(35.687846,139.719947),hospitalLocation:kt(35.699374,139.762881),createdAt:bt(new Date("2024-12-13T14:00:00Z")),updatedAt:bt(new Date("2024-12-13T16:45:00Z"))},{id:"case-003",caseName:"2024-12-14 四谷三丁目 意識不明",status:"dispatched",teamId:"doctor-001",patientInfo:{age:28,gender:"male"},sceneLocation:kt(35.686611,139.728694),hospitalLocation:kt(35.699374,139.762881),createdAt:bt(new Date("2024-12-14T11:00:00Z")),updatedAt:bt(new Date("2024-12-14T11:00:00Z"))},{id:"case-004",caseName:"2024-12-14 曙橋駅 転落事故",status:"on_scene",teamId:"doctor-001",patientInfo:{age:52,gender:"female",name:"高橋 美奈子"},sceneLocation:kt(35.694611,139.738028),hospitalLocation:kt(35.699374,139.762881),createdAt:bt(new Date("2024-12-14T12:00:00Z")),updatedAt:bt(new Date("2024-12-14T12:15:00Z"))},{id:"case-005",caseName:"2024-12-14 六本木ヒルズ47階 急病",status:"dispatched",teamId:"doctor-001",patientInfo:{age:58,gender:"male",name:"伊藤 健一",buildingInfo:{buildingName:"六本木ヒルズ森タワー",floor:47,description:"エレベーターホール付近",accessNotes:"業務用エレベーター使用可、警備員待機中"}},sceneLocation:kt(35.660419,139.729435),hospitalLocation:kt(35.699374,139.762881),createdAt:bt(new Date("2024-12-14T13:00:00Z")),updatedAt:bt(new Date("2024-12-14T13:05:00Z"))},{id:"case-006",caseName:"2024-12-14 東京駅八重洲中央口 心臓発作",status:"on_scene",teamId:"doctor-001",patientInfo:{age:72,gender:"male",name:"山口 正夫",buildingInfo:{buildingName:"東京駅",floor:1,description:"八重洲中央口改札内、みどりの窓口前",accessNotes:"駅員誘導あり、混雑により搬送経路確保中"}},sceneLocation:kt(35.680889,139.767981),hospitalLocation:kt(35.699374,139.762881),createdAt:bt(new Date("2024-12-14T14:00:00Z")),updatedAt:bt(new Date("2024-12-14T14:10:00Z"))},{id:"case-007",caseName:"2024-12-14 虎ノ門ヒルズ35階 呼吸困難",status:"completed",teamId:"doctor-001",patientInfo:{age:41,gender:"female",name:"村田 由美子",buildingInfo:{buildingName:"虎ノ門ヒルズ森タワー",floor:35,description:"オフィスフロア会議室C",accessNotes:"専用エレベーター使用、ビル管理者対応済"}},sceneLocation:kt(35.666938,139.749444),hospitalLocation:kt(35.699374,139.762881),createdAt:bt(new Date("2024-12-14T09:00:00Z")),updatedAt:bt(new Date("2024-12-14T10:30:00Z"))},{id:"case-008",caseName:"2024-12-14 大手町駅丸の内線ホーム 転倒事故",status:"dispatched",teamId:"doctor-001",patientInfo:{age:35,gender:"female",name:"小林 真由美",buildingInfo:{buildingName:"大手町駅",floor:-2,description:"丸の内線ホーム中央付近",accessNotes:"駅員誘導、エスカレーター停止済、担架搬送ルート確保"}},sceneLocation:kt(35.686292,139.766103),hospitalLocation:kt(35.699374,139.762881),createdAt:bt(new Date("2024-12-14T15:00:00Z")),updatedAt:bt(new Date("2024-12-14T15:00:00Z"))},{id:"case-009",caseName:"2024-12-14 渋谷スクランブルスクエア39階 意識消失",status:"on_scene",teamId:"doctor-001",patientInfo:{age:63,gender:"male",name:"松本 太一",buildingInfo:{buildingName:"渋谷スクランブルスクエア",floor:39,description:"スカイロビー展望エリア",accessNotes:"高速エレベーター優先使用可、スタッフ待機"}},sceneLocation:kt(35.658514,139.702249),hospitalLocation:kt(35.699374,139.762881),createdAt:bt(new Date("2024-12-14T16:00:00Z")),updatedAt:bt(new Date("2024-12-14T16:20:00Z"))}],ca={CURRENT_USER:"demo_current_user",CASES:"demo_cases"},yn={setCurrentUser:t=>{t?localStorage.setItem(ca.CURRENT_USER,JSON.stringify(t)):localStorage.removeItem(ca.CURRENT_USER)},getCurrentUser:()=>{const t=localStorage.getItem(ca.CURRENT_USER);return t?JSON.parse(t):null},setCases:t=>{localStorage.setItem(ca.CASES,JSON.stringify(t))},getCases:()=>{const t=localStorage.getItem(ca.CASES);if(t){const e=JSON.parse(t),n=e.map(s=>s.id);return ts.map(s=>s.id).every(s=>n.includes(s))?e.map(s=>({...s,createdAt:bt(new Date(s.createdAt.seconds*1e3)),updatedAt:bt(new Date(s.updatedAt.seconds*1e3)),sceneLocation:kt(s.sceneLocation.latitude,s.sceneLocation.longitude),hospitalLocation:kt(s.hospitalLocation.latitude,s.hospitalLocation.longitude)})):(yn.setCases(ts),ts)}return yn.setCases(ts),ts}},MN=()=>{localStorage.removeItem(ca.CASES),yn.setCases(ts),console.log("Demo data refreshed with all cases:",ts.map(t=>t.id))},Tu={login:async(t,e)=>{const n=Object.values(kc).find(r=>r.email===t);if(!n||e!=="demo123456")throw new Error("ログイン情報が正しくありません");return yn.setCurrentUser(n),n},logout:async()=>{yn.setCurrentUser(null)},getCurrentUser:()=>yn.getCurrentUser(),loginAsDoctorCarMember:async()=>{const t=kc["doctor-001"];return yn.setCurrentUser(t),t},loginAsHospitalStaff:async()=>{const t=kc["hospital-001"];return yn.setCurrentUser(t),t}},Iu={getAllCases:async()=>(await new Promise(t=>setTimeout(t,500)),yn.getCases()),getCaseById:async t=>(await new Promise(n=>setTimeout(n,300)),yn.getCases().find(n=>n.id===t)||null),updateCaseStatus:async(t,e)=>{await new Promise(i=>setTimeout(i,200));const n=yn.getCases(),r=n.findIndex(i=>i.id===t);r!==-1&&(n[r]={...n[r],status:e,updatedAt:bt(new Date)},yn.setCases(n))}},VN=Object.freeze(Object.defineProperty({__proto__:null,DEMO_CASES:ts,DEMO_USERS:kc,demoAuthService:Tu,demoCaseService:Iu,demoStorage:yn,refreshDemoData:MN},Symbol.toStringTag,{value:"Module"})),ON=async(t,e)=>await Tu.login(t,e),FN=async()=>await Tu.logout(),zN=async()=>await Tu.loginAsDoctorCarMember(),BN=async()=>await Tu.loginAsHospitalStaff(),o0=async t=>kc[t]||null,Ds=lb()(cb(t=>({currentUser:null,userInfo:null,isAuthenticated:!1,loading:!0,error:null,setUser:e=>{t({currentUser:e,isAuthenticated:!!e,loading:!1})},setUserInfo:e=>{t({userInfo:e})},setLoading:e=>{t({loading:e})},setError:e=>{t({error:e})},login:async(e,n)=>{try{t({loading:!0,error:null});const r=await ON(e,n),i=await o0(r.uid);t({currentUser:r,userInfo:i,isAuthenticated:!0,loading:!1,error:null})}catch(r){t({error:r instanceof Error?r.message:"ログインに失敗しました",loading:!1,currentUser:null,userInfo:null,isAuthenticated:!1})}},loginDemo:async e=>{try{t({loading:!0,error:null});const n=e==="doctor_car"?await zN():await BN(),r=await o0(n.uid);t({currentUser:n,userInfo:r,isAuthenticated:!0,loading:!1,error:null})}catch(n){t({error:n instanceof Error?n.message:"デモログインに失敗しました",loading:!1})}},logout:async()=>{try{await FN(),t({currentUser:null,userInfo:null,isAuthenticated:!1,loading:!1,error:null})}catch(e){t({error:e instanceof Error?e.message:"ログアウトに失敗しました"})}},initialize:()=>(console.log("Initializing demo mode authentication"),setTimeout(()=>{try{const e=yn.getCurrentUser();console.log("Stored user:",e),t(e?{currentUser:e,userInfo:e,isAuthenticated:!0,loading:!1,error:null}:{currentUser:null,userInfo:null,isAuthenticated:!1,loading:!1,error:null})}catch(e){console.error("Demo mode initialization error:",e),t({currentUser:null,userInfo:null,isAuthenticated:!1,loading:!1,error:null})}},0),()=>{}),reset:()=>{t({currentUser:null,userInfo:null,isAuthenticated:!1,loading:!0,error:null})}}))),UN=async()=>await Iu.getAllCases(),$N=async t=>await Iu.getCaseById(t),qN=(t,e)=>{{let n=!1;return Iu.getCaseById(t).then(r=>{n||e(r)}).catch(r=>{n||(console.error("Demo observeCase error:",r),e(null))}),()=>{n=!0}}},GN=async(t,e)=>await Iu.updateCaseStatus(t,e),WN=async t=>{{const e=`demo-case-${Date.now()}`,n={...t,id:e},{demoStorage:r}=await LN(()=>Promise.resolve().then(()=>VN),void 0),i=r.getCases(),s=[n,...i];return r.setCases(s),e}},vf=lb()(cb((t,e)=>({cases:[],currentCase:null,loading:!1,error:null,caseObserver:null,setCases:n=>t({cases:n}),setCurrentCase:n=>t({currentCase:n}),setLoading:n=>t({loading:n}),setError:n=>t({error:n}),loadCases:async()=>{try{t({loading:!0,error:null});const n=await UN();t({cases:n,loading:!1})}catch(n){t({error:n instanceof Error?n.message:"事案の取得に失敗しました",loading:!1})}},loadCurrentCase:async n=>{try{t({loading:!0,error:null});const r=await $N(n);e().loading&&t({currentCase:r,loading:!1})}catch(r){e().loading&&t({error:r instanceof Error?r.message:"事案の取得に失敗しました",loading:!1})}},updateStatus:async(n,r)=>{try{t({error:null}),await GN(n,r);const{currentCase:i,cases:s}=e();i&&i.id===n&&t({currentCase:{...i,status:r}});const a=s.map(u=>u.id===n?{...u,status:r}:u);t({cases:a})}catch(i){t({error:i instanceof Error?i.message:"ステータス更新に失敗しました"})}},createCase:async n=>{try{t({loading:!0,error:null});const r=await WN(n);return await e().loadCases(),r}catch(r){throw t({error:r instanceof Error?r.message:"事案の作成に失敗しました",loading:!1}),r}},startObservingCase:n=>{try{e().stopObservingCase();const r=qN(n,i=>{e().caseObserver&&t({currentCase:i})});t({caseObserver:r})}catch(r){console.error("Failed to start observing case:",r),t({error:r instanceof Error?r.message:"事案の監視に失敗しました"})}},stopObservingCase:()=>{try{const{caseObserver:n}=e();n&&(n(),t({caseObserver:null}))}catch(n){console.error("Failed to stop observing case:",n),t({caseObserver:null})}},reset:()=>{e().stopObservingCase(),t({cases:[],currentCase:null,loading:!1,error:null,caseObserver:null})}}))),HN=()=>{const{initialize:t}=Ds();return{initialize:()=>{const e=t();return()=>{e()}}}},_r=({size:t="md",className:e=""})=>{const n={sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"};return c.jsx("div",{"data-testid":"loading-spinner",className:`animate-spin rounded-full border-b-2 border-medical-primary ${n[t]} ${e}`})},Le=({variant:t="primary",size:e="md",loading:n=!1,disabled:r,children:i,className:s="",...a})=>{const u="inline-flex items-center justify-center font-medium rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2",h={primary:"bg-medical-primary text-white hover:bg-blue-700 focus:ring-blue-500",secondary:"bg-gray-200 text-gray-900 hover:bg-gray-300 focus:ring-gray-500",danger:"bg-medical-danger text-white hover:bg-red-700 focus:ring-red-500",outline:"border-2 border-medical-primary text-medical-primary hover:bg-medical-primary hover:text-white focus:ring-blue-500"},m={sm:"px-3 py-1 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"},p=r||n,_=p?"opacity-50 cursor-not-allowed":"",v=[u,h[t],m[e],_,s].filter(Boolean).join(" ");return c.jsxs("button",{...a,disabled:p,className:v,children:[n&&c.jsx(_r,{size:"sm",className:"mr-2"}),i]})},ue=({label:t,error:e,helperText:n,className:r="",required:i,disabled:s,...a})=>{const u=ys.useId(),_=["block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-1 transition-colors",e?"border-red-300 focus:border-red-500 focus:ring-red-500":"border-gray-300 focus:border-medical-primary focus:ring-medical-primary",s?"bg-gray-100 cursor-not-allowed":"bg-white",r].filter(Boolean).join(" ");return c.jsxs("div",{className:"space-y-1",children:[t&&c.jsxs("label",{htmlFor:u,className:"block text-sm font-medium text-gray-700",children:[t,i&&c.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),c.jsx("input",{...a,id:u,disabled:s,className:_}),e&&c.jsx("p",{className:"text-sm text-red-600",children:e}),n&&!e&&c.jsx("p",{className:"text-sm text-gray-500",children:n})]})};class KN extends ys.Component{constructor(n){super(n);Pr(this,"handleReload",()=>{window.location.reload()});this.state={hasError:!1}}static getDerivedStateFromError(n){return{hasError:!0,error:n}}componentDidCatch(n,r){this.setState({error:n,errorInfo:r}),console.error("ErrorBoundary caught an error:",{error:n,message:n.message,stack:n.stack,errorInfo:r,componentStack:r.componentStack,timestamp:new Date().toISOString(),url:window.location.href}),this.props.onError&&this.props.onError(n,r)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 px-4",children:c.jsxs("div",{className:"max-w-md w-full bg-white rounded-lg shadow-lg p-6 text-center",children:[c.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-red-100 rounded-full flex items-center justify-center",children:c.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.96-.833-2.73 0L3.084 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),c.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"エラーが発生しました"}),c.jsx("p",{className:"text-gray-600 mb-6",children:"予期しないエラーが発生しました。ページを再読み込みしてください。"}),c.jsx(Le,{onClick:this.handleReload,className:"w-full mb-4",children:"ページを再読み込み"}),!1]})}):this.props.children}}const QN=({isOpen:t,onClose:e,title:n,children:r,size:i="md",showCloseButton:s=!0})=>{if(B.useEffect(()=>{const h=m=>{m.key==="Escape"&&e()};return t&&(document.addEventListener("keydown",h),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",h),document.body.style.overflow="unset"}},[t,e]),!t)return null;const a=()=>{switch(i){case"sm":return"max-w-md";case"md":return"max-w-lg";case"lg":return"max-w-4xl";case"xl":return"max-w-6xl";case"full":return"w-full h-full max-w-none m-0";default:return"max-w-lg"}},u=c.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:e}),c.jsx("div",{className:i==="full"?"h-full":"flex items-center justify-center min-h-screen p-4",children:c.jsxs("div",{className:`relative bg-white ${i==="full"?"h-full":"rounded-lg"} shadow-xl ${a()} ${i==="full"?"h-full":"max-h-[90vh]"}`,onClick:h=>h.stopPropagation(),children:[(n||s)&&c.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:n}),s&&c.jsx("button",{onClick:e,className:"p-2 text-gray-400 hover:text-gray-600 transition-colors rounded-lg hover:bg-gray-100",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsx("div",{className:`${i==="full"?n||s?"h-[calc(100vh-5rem)]":"h-full":"max-h-[calc(90vh-8rem)] overflow-y-auto"} ${n||s?"":"p-6"}`,children:r})]})})]});return l_.createPortal(u,document.body)},ia=({children:t,requiredRole:e})=>{const{isAuthenticated:n,userInfo:r,loading:i}=Ds();return i?c.jsx("div",{className:"min-h-screen flex items-center justify-center",children:c.jsx(_r,{size:"lg"})}):n?e&&(r==null?void 0:r.role)!==e?c.jsx($a,{to:"/unauthorized",replace:!0}):c.jsx(c.Fragment,{children:t}):c.jsx($a,{to:"/login",replace:!0})},ZN=()=>{const[t,e]=B.useState(""),[n,r]=B.useState(""),[i,s]=B.useState({}),{login:a,loginDemo:u,loading:h,error:m,isAuthenticated:p}=Ds();if(p)return c.jsx($a,{to:"/cases",replace:!0});const _=()=>{const T={};return t?/\S+@\S+\.\S+/.test(t)||(T.email="有効なメールアドレスを入力してください"):T.email="メールアドレスを入力してください",n?n.length<6&&(T.password="パスワードは6文字以上で入力してください"):T.password="パスワードを入力してください",s(T),Object.keys(T).length===0},v=async T=>{T.preventDefault(),_()&&await a(t,n)},x=async T=>{await u(T)};return c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:c.jsxs("div",{className:"max-w-md w-full space-y-8",children:[c.jsxs("div",{children:[c.jsx("div",{className:"mx-auto h-12 w-12 bg-medical-primary rounded-full flex items-center justify-center",children:c.jsx("svg",{className:"h-8 w-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})}),c.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Doctor Car App"}),c.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"ドクターカー運用支援システム"})]}),c.jsxs("form",{className:"mt-8 space-y-6",onSubmit:v,children:[c.jsxs("div",{className:"space-y-4",children:[c.jsx(ue,{label:"メールアドレス",type:"email",value:t,onChange:T=>e(T.target.value),error:i.email,placeholder:"doctor@example.com",required:!0}),c.jsx(ue,{label:"パスワード",type:"password",value:n,onChange:T=>r(T.target.value),error:i.password,placeholder:"••••••••",required:!0})]}),m&&c.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-3",children:c.jsx("p",{className:"text-sm text-red-600",children:m})}),c.jsx(Le,{type:"submit",className:"w-full",loading:h,disabled:h,children:"ログイン"}),c.jsxs("div",{className:"mt-6",children:[c.jsxs("div",{className:"relative",children:[c.jsx("div",{className:"absolute inset-0 flex items-center",children:c.jsx("div",{className:"w-full border-t border-gray-300"})}),c.jsx("div",{className:"relative flex justify-center text-sm",children:c.jsx("span",{className:"px-2 bg-gray-50 text-gray-500",children:"デモ用アカウント"})})]}),c.jsxs("div",{className:"mt-6 grid grid-cols-1 gap-3",children:[c.jsx(Le,{variant:"outline",onClick:()=>x("doctor_car"),disabled:h,className:"w-full",children:"デモ用: ドクターカー隊員でログイン"}),c.jsx(Le,{variant:"outline",onClick:()=>x("hospital"),disabled:h,className:"w-full",children:"デモ用: 病院スタッフでログイン"})]})]})]})]})})},fr={DISPATCHED:"dispatched",ON_SCENE:"on_scene",TRANSPORTING:"transporting",COMPLETED:"completed"},JN=t=>{try{return t&&typeof t.toDate=="function"?t.toDate().toLocaleDateString("ja-JP"):t?t.seconds?new Date(t.seconds*1e3).toLocaleDateString("ja-JP"):new Date(t).toLocaleDateString("ja-JP"):"日付不明"}catch(e){return console.error("Date formatting error:",e),"日付不明"}},YN=t=>{const n={[fr.DISPATCHED]:{label:"出動中",className:"badge badge-warning"},[fr.ON_SCENE]:{label:"現場活動中",className:"badge badge-info"},[fr.TRANSPORTING]:{label:"搬送中",className:"badge badge-warning"},[fr.COMPLETED]:{label:"完了",className:"badge badge-success"}}[t]||{label:t,className:"badge"};return c.jsx("span",{className:n.className,children:n.label})},XN=()=>{const{cases:t,loading:e,error:n,loadCases:r}=vf(),{userInfo:i,logout:s}=Ds();B.useEffect(()=>{r()},[r]);const a=async()=>{await s()};return c.jsxs("div",{className:"min-h-screen bg-gray-50",children:[c.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:c.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:c.jsxs("div",{className:"flex justify-between items-center h-16",children:[c.jsxs("div",{className:"flex items-center",children:[c.jsx("div",{className:"h-8 w-8 bg-medical-primary rounded-full flex items-center justify-center mr-3",children:c.jsx("svg",{className:"h-5 w-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})}),c.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"Doctor Car App"})]}),c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsxs("div",{className:"text-sm text-gray-700",children:[c.jsx("span",{className:"font-medium",children:i==null?void 0:i.name}),c.jsxs("span",{className:"text-gray-500 ml-2",children:["(",i==null?void 0:i.team,")"]})]}),c.jsx(Le,{variant:"outline",size:"sm",onClick:a,children:"ログアウト"})]})]})})}),c.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:c.jsxs("div",{className:"px-4 py-6 sm:px-0",children:[c.jsxs("div",{className:"mb-6 flex justify-between items-start",children:[c.jsxs("div",{children:[c.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"事案一覧"}),c.jsx("p",{className:"mt-1 text-sm text-gray-600",children:"現在の出動事案と過去の記録を確認できます"})]}),c.jsxs("div",{className:"flex space-x-3",children:[c.jsx(Rh,{to:"/route-optimization",className:"bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors flex items-center",children:"🚗 xROAD ルート最適化"}),c.jsxs(Rh,{to:"/registries",className:"bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors flex items-center",children:[c.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),"レジストリ一覧"]}),c.jsxs(Rh,{to:"/cases/create",className:"bg-medical-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[c.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),"新規事案作成"]})]})]}),n&&c.jsx("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-md p-4",children:c.jsx("p",{className:"text-sm text-red-600",children:n})}),e?c.jsx("div",{className:"flex justify-center items-center py-12",children:c.jsx(_r,{size:"lg"})}):c.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-md",children:c.jsx("ul",{className:"divide-y divide-gray-200",children:t.length===0?c.jsx("li",{className:"px-6 py-12 text-center",children:c.jsx("p",{className:"text-gray-500",children:"事案がありません"})}):t.map(u=>c.jsx("li",{children:c.jsx(Rh,{to:`/cases/${u.id}`,className:"block hover:bg-gray-50 px-6 py-4 transition-colors",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex-1 min-w-0",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("p",{className:"text-lg font-medium text-gray-900 truncate",children:u.caseName}),YN(u.status)]}),c.jsxs("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[c.jsxs("svg",{className:"flex-shrink-0 mr-1.5 h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),c.jsxs("span",{children:["チーム: ",u.teamId]}),u.patientInfo.age&&c.jsxs(c.Fragment,{children:[c.jsx("span",{className:"mx-2",children:"•"}),c.jsxs("span",{children:["患者: ",u.patientInfo.age,"歳 ",u.patientInfo.gender==="male"?"男性":u.patientInfo.gender==="female"?"女性":""]})]}),c.jsx("span",{className:"mx-2",children:"•"}),c.jsx("span",{children:JN(u.createdAt)})]})]}),c.jsx("div",{className:"ml-2 flex-shrink-0",children:c.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})})]})})},u.id))})})]})})]})};function db(t,e){const n=B.useRef(e);B.useEffect(function(){e!==n.current&&t.attributionControl!=null&&(n.current!=null&&t.attributionControl.removeAttribution(n.current),e!=null&&t.attributionControl.addAttribution(e)),n.current=e},[t,e])}const eA=1;function tA(t){return Object.freeze({__version:eA,map:t})}function fb(t,e){return Object.freeze({...t,...e})}const mb=B.createContext(null),pb=mb.Provider;function yf(){const t=B.useContext(mb);if(t==null)throw new Error("No context provided: useLeafletContext() can only be used in a descendant of <MapContainer>");return t}function gb(t){function e(n,r){const{instance:i,context:s}=t(n).current;return B.useImperativeHandle(r,()=>i),n.children==null?null:ys.createElement(pb,{value:s},n.children)}return B.forwardRef(e)}function nA(t){function e(n,r){const[i,s]=B.useState(!1),{instance:a}=t(n,s).current;B.useImperativeHandle(r,()=>a),B.useEffect(function(){i&&a.update()},[a,i,n.children]);const u=a._contentNode;return u?l_.createPortal(n.children,u):null}return B.forwardRef(e)}function rA(t){function e(n,r){const{instance:i}=t(n).current;return B.useImperativeHandle(r,()=>i),null}return B.forwardRef(e)}function f_(t,e){const n=B.useRef();B.useEffect(function(){return e!=null&&t.instance.on(e),n.current=e,function(){n.current!=null&&t.instance.off(n.current),n.current=null}},[t,e])}function xf(t,e){const n=t.pane??e.pane;return n?{...t,pane:n}:t}function iA(t,e){return function(r,i){const s=yf(),a=t(xf(r,s),s);return db(s.map,r.attribution),f_(a.current,r.eventHandlers),e(a.current,s,r,i),a}}var Bp={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(t,e){(function(n,r){r(e)})(RI,function(n){var r="1.9.4";function i(o){var l,f,g,w;for(f=1,g=arguments.length;f<g;f++){w=arguments[f];for(l in w)o[l]=w[l]}return o}var s=Object.create||function(){function o(){}return function(l){return o.prototype=l,new o}}();function a(o,l){var f=Array.prototype.slice;if(o.bind)return o.bind.apply(o,f.call(arguments,1));var g=f.call(arguments,2);return function(){return o.apply(l,g.length?g.concat(f.call(arguments)):arguments)}}var u=0;function h(o){return"_leaflet_id"in o||(o._leaflet_id=++u),o._leaflet_id}function m(o,l,f){var g,w,I,O;return O=function(){g=!1,w&&(I.apply(f,w),w=!1)},I=function(){g?w=arguments:(o.apply(f,arguments),setTimeout(O,l),g=!0)},I}function p(o,l,f){var g=l[1],w=l[0],I=g-w;return o===g&&f?o:((o-w)%I+I)%I+w}function _(){return!1}function v(o,l){if(l===!1)return o;var f=Math.pow(10,l===void 0?6:l);return Math.round(o*f)/f}function x(o){return o.trim?o.trim():o.replace(/^\s+|\s+$/g,"")}function T(o){return x(o).split(/\s+/)}function E(o,l){Object.prototype.hasOwnProperty.call(o,"options")||(o.options=o.options?s(o.options):{});for(var f in l)o.options[f]=l[f];return o.options}function R(o,l,f){var g=[];for(var w in o)g.push(encodeURIComponent(f?w.toUpperCase():w)+"="+encodeURIComponent(o[w]));return(!l||l.indexOf("?")===-1?"?":"&")+g.join("&")}var S=/\{ *([\w_ -]+) *\}/g;function C(o,l){return o.replace(S,function(f,g){var w=l[g];if(w===void 0)throw new Error("No value provided for variable "+f);return typeof w=="function"&&(w=w(l)),w})}var A=Array.isArray||function(o){return Object.prototype.toString.call(o)==="[object Array]"};function U(o,l){for(var f=0;f<o.length;f++)if(o[f]===l)return f;return-1}var Z="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function V(o){return window["webkit"+o]||window["moz"+o]||window["ms"+o]}var k=0;function N(o){var l=+new Date,f=Math.max(0,16-(l-k));return k=l+f,window.setTimeout(o,f)}var D=window.requestAnimationFrame||V("RequestAnimationFrame")||N,M=window.cancelAnimationFrame||V("CancelAnimationFrame")||V("CancelRequestAnimationFrame")||function(o){window.clearTimeout(o)};function F(o,l,f){if(f&&D===N)o.call(l);else return D.call(window,a(o,l))}function z(o){o&&M.call(window,o)}var j={__proto__:null,extend:i,create:s,bind:a,get lastId(){return u},stamp:h,throttle:m,wrapNum:p,falseFn:_,formatNum:v,trim:x,splitWords:T,setOptions:E,getParamString:R,template:C,isArray:A,indexOf:U,emptyImageUrl:Z,requestFn:D,cancelFn:M,requestAnimFrame:F,cancelAnimFrame:z};function me(){}me.extend=function(o){var l=function(){E(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},f=l.__super__=this.prototype,g=s(f);g.constructor=l,l.prototype=g;for(var w in this)Object.prototype.hasOwnProperty.call(this,w)&&w!=="prototype"&&w!=="__super__"&&(l[w]=this[w]);return o.statics&&i(l,o.statics),o.includes&&(Ve(o.includes),i.apply(null,[g].concat(o.includes))),i(g,o),delete g.statics,delete g.includes,g.options&&(g.options=f.options?s(f.options):{},i(g.options,o.options)),g._initHooks=[],g.callInitHooks=function(){if(!this._initHooksCalled){f.callInitHooks&&f.callInitHooks.call(this),this._initHooksCalled=!0;for(var I=0,O=g._initHooks.length;I<O;I++)g._initHooks[I].call(this)}},l},me.include=function(o){var l=this.prototype.options;return i(this.prototype,o),o.options&&(this.prototype.options=l,this.mergeOptions(o.options)),this},me.mergeOptions=function(o){return i(this.prototype.options,o),this},me.addInitHook=function(o){var l=Array.prototype.slice.call(arguments,1),f=typeof o=="function"?o:function(){this[o].apply(this,l)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(f),this};function Ve(o){if(!(typeof L>"u"||!L||!L.Mixin)){o=A(o)?o:[o];for(var l=0;l<o.length;l++)o[l]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var Te={on:function(o,l,f){if(typeof o=="object")for(var g in o)this._on(g,o[g],l);else{o=T(o);for(var w=0,I=o.length;w<I;w++)this._on(o[w],l,f)}return this},off:function(o,l,f){if(!arguments.length)delete this._events;else if(typeof o=="object")for(var g in o)this._off(g,o[g],l);else{o=T(o);for(var w=arguments.length===1,I=0,O=o.length;I<O;I++)w?this._off(o[I]):this._off(o[I],l,f)}return this},_on:function(o,l,f,g){if(typeof l!="function"){console.warn("wrong listener type: "+typeof l);return}if(this._listens(o,l,f)===!1){f===this&&(f=void 0);var w={fn:l,ctx:f};g&&(w.once=!0),this._events=this._events||{},this._events[o]=this._events[o]||[],this._events[o].push(w)}},_off:function(o,l,f){var g,w,I;if(this._events&&(g=this._events[o],!!g)){if(arguments.length===1){if(this._firingCount)for(w=0,I=g.length;w<I;w++)g[w].fn=_;delete this._events[o];return}if(typeof l!="function"){console.warn("wrong listener type: "+typeof l);return}var O=this._listens(o,l,f);if(O!==!1){var G=g[O];this._firingCount&&(G.fn=_,this._events[o]=g=g.slice()),g.splice(O,1)}}},fire:function(o,l,f){if(!this.listens(o,f))return this;var g=i({},l,{type:o,target:this,sourceTarget:l&&l.sourceTarget||this});if(this._events){var w=this._events[o];if(w){this._firingCount=this._firingCount+1||1;for(var I=0,O=w.length;I<O;I++){var G=w[I],K=G.fn;G.once&&this.off(o,K,G.ctx),K.call(G.ctx||this,g)}this._firingCount--}}return f&&this._propagateEvent(g),this},listens:function(o,l,f,g){typeof o!="string"&&console.warn('"string" type argument expected');var w=l;typeof l!="function"&&(g=!!l,w=void 0,f=void 0);var I=this._events&&this._events[o];if(I&&I.length&&this._listens(o,w,f)!==!1)return!0;if(g){for(var O in this._eventParents)if(this._eventParents[O].listens(o,l,f,g))return!0}return!1},_listens:function(o,l,f){if(!this._events)return!1;var g=this._events[o]||[];if(!l)return!!g.length;f===this&&(f=void 0);for(var w=0,I=g.length;w<I;w++)if(g[w].fn===l&&g[w].ctx===f)return w;return!1},once:function(o,l,f){if(typeof o=="object")for(var g in o)this._on(g,o[g],l,!0);else{o=T(o);for(var w=0,I=o.length;w<I;w++)this._on(o[w],l,f,!0)}return this},addEventParent:function(o){return this._eventParents=this._eventParents||{},this._eventParents[h(o)]=o,this},removeEventParent:function(o){return this._eventParents&&delete this._eventParents[h(o)],this},_propagateEvent:function(o){for(var l in this._eventParents)this._eventParents[l].fire(o.type,i({layer:o.target,propagatedFrom:o.target},o),!0)}};Te.addEventListener=Te.on,Te.removeEventListener=Te.clearAllEventListeners=Te.off,Te.addOneTimeEventListener=Te.once,Te.fireEvent=Te.fire,Te.hasEventListeners=Te.listens;var se=me.extend(Te);function W(o,l,f){this.x=f?Math.round(o):o,this.y=f?Math.round(l):l}var fe=Math.trunc||function(o){return o>0?Math.floor(o):Math.ceil(o)};W.prototype={clone:function(){return new W(this.x,this.y)},add:function(o){return this.clone()._add(X(o))},_add:function(o){return this.x+=o.x,this.y+=o.y,this},subtract:function(o){return this.clone()._subtract(X(o))},_subtract:function(o){return this.x-=o.x,this.y-=o.y,this},divideBy:function(o){return this.clone()._divideBy(o)},_divideBy:function(o){return this.x/=o,this.y/=o,this},multiplyBy:function(o){return this.clone()._multiplyBy(o)},_multiplyBy:function(o){return this.x*=o,this.y*=o,this},scaleBy:function(o){return new W(this.x*o.x,this.y*o.y)},unscaleBy:function(o){return new W(this.x/o.x,this.y/o.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=fe(this.x),this.y=fe(this.y),this},distanceTo:function(o){o=X(o);var l=o.x-this.x,f=o.y-this.y;return Math.sqrt(l*l+f*f)},equals:function(o){return o=X(o),o.x===this.x&&o.y===this.y},contains:function(o){return o=X(o),Math.abs(o.x)<=Math.abs(this.x)&&Math.abs(o.y)<=Math.abs(this.y)},toString:function(){return"Point("+v(this.x)+", "+v(this.y)+")"}};function X(o,l,f){return o instanceof W?o:A(o)?new W(o[0],o[1]):o==null?o:typeof o=="object"&&"x"in o&&"y"in o?new W(o.x,o.y):new W(o,l,f)}function Y(o,l){if(o)for(var f=l?[o,l]:o,g=0,w=f.length;g<w;g++)this.extend(f[g])}Y.prototype={extend:function(o){var l,f;if(!o)return this;if(o instanceof W||typeof o[0]=="number"||"x"in o)l=f=X(o);else if(o=ce(o),l=o.min,f=o.max,!l||!f)return this;return!this.min&&!this.max?(this.min=l.clone(),this.max=f.clone()):(this.min.x=Math.min(l.x,this.min.x),this.max.x=Math.max(f.x,this.max.x),this.min.y=Math.min(l.y,this.min.y),this.max.y=Math.max(f.y,this.max.y)),this},getCenter:function(o){return X((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,o)},getBottomLeft:function(){return X(this.min.x,this.max.y)},getTopRight:function(){return X(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(o){var l,f;return typeof o[0]=="number"||o instanceof W?o=X(o):o=ce(o),o instanceof Y?(l=o.min,f=o.max):l=f=o,l.x>=this.min.x&&f.x<=this.max.x&&l.y>=this.min.y&&f.y<=this.max.y},intersects:function(o){o=ce(o);var l=this.min,f=this.max,g=o.min,w=o.max,I=w.x>=l.x&&g.x<=f.x,O=w.y>=l.y&&g.y<=f.y;return I&&O},overlaps:function(o){o=ce(o);var l=this.min,f=this.max,g=o.min,w=o.max,I=w.x>l.x&&g.x<f.x,O=w.y>l.y&&g.y<f.y;return I&&O},isValid:function(){return!!(this.min&&this.max)},pad:function(o){var l=this.min,f=this.max,g=Math.abs(l.x-f.x)*o,w=Math.abs(l.y-f.y)*o;return ce(X(l.x-g,l.y-w),X(f.x+g,f.y+w))},equals:function(o){return o?(o=ce(o),this.min.equals(o.getTopLeft())&&this.max.equals(o.getBottomRight())):!1}};function ce(o,l){return!o||o instanceof Y?o:new Y(o,l)}function Ie(o,l){if(o)for(var f=l?[o,l]:o,g=0,w=f.length;g<w;g++)this.extend(f[g])}Ie.prototype={extend:function(o){var l=this._southWest,f=this._northEast,g,w;if(o instanceof Ne)g=o,w=o;else if(o instanceof Ie){if(g=o._southWest,w=o._northEast,!g||!w)return this}else return o?this.extend(xe(o)||Oe(o)):this;return!l&&!f?(this._southWest=new Ne(g.lat,g.lng),this._northEast=new Ne(w.lat,w.lng)):(l.lat=Math.min(g.lat,l.lat),l.lng=Math.min(g.lng,l.lng),f.lat=Math.max(w.lat,f.lat),f.lng=Math.max(w.lng,f.lng)),this},pad:function(o){var l=this._southWest,f=this._northEast,g=Math.abs(l.lat-f.lat)*o,w=Math.abs(l.lng-f.lng)*o;return new Ie(new Ne(l.lat-g,l.lng-w),new Ne(f.lat+g,f.lng+w))},getCenter:function(){return new Ne((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new Ne(this.getNorth(),this.getWest())},getSouthEast:function(){return new Ne(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(o){typeof o[0]=="number"||o instanceof Ne||"lat"in o?o=xe(o):o=Oe(o);var l=this._southWest,f=this._northEast,g,w;return o instanceof Ie?(g=o.getSouthWest(),w=o.getNorthEast()):g=w=o,g.lat>=l.lat&&w.lat<=f.lat&&g.lng>=l.lng&&w.lng<=f.lng},intersects:function(o){o=Oe(o);var l=this._southWest,f=this._northEast,g=o.getSouthWest(),w=o.getNorthEast(),I=w.lat>=l.lat&&g.lat<=f.lat,O=w.lng>=l.lng&&g.lng<=f.lng;return I&&O},overlaps:function(o){o=Oe(o);var l=this._southWest,f=this._northEast,g=o.getSouthWest(),w=o.getNorthEast(),I=w.lat>l.lat&&g.lat<f.lat,O=w.lng>l.lng&&g.lng<f.lng;return I&&O},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(o,l){return o?(o=Oe(o),this._southWest.equals(o.getSouthWest(),l)&&this._northEast.equals(o.getNorthEast(),l)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function Oe(o,l){return o instanceof Ie?o:new Ie(o,l)}function Ne(o,l,f){if(isNaN(o)||isNaN(l))throw new Error("Invalid LatLng object: ("+o+", "+l+")");this.lat=+o,this.lng=+l,f!==void 0&&(this.alt=+f)}Ne.prototype={equals:function(o,l){if(!o)return!1;o=xe(o);var f=Math.max(Math.abs(this.lat-o.lat),Math.abs(this.lng-o.lng));return f<=(l===void 0?1e-9:l)},toString:function(o){return"LatLng("+v(this.lat,o)+", "+v(this.lng,o)+")"},distanceTo:function(o){return Cn.distance(this,xe(o))},wrap:function(){return Cn.wrapLatLng(this)},toBounds:function(o){var l=180*o/40075017,f=l/Math.cos(Math.PI/180*this.lat);return Oe([this.lat-l,this.lng-f],[this.lat+l,this.lng+f])},clone:function(){return new Ne(this.lat,this.lng,this.alt)}};function xe(o,l,f){return o instanceof Ne?o:A(o)&&typeof o[0]!="object"?o.length===3?new Ne(o[0],o[1],o[2]):o.length===2?new Ne(o[0],o[1]):null:o==null?o:typeof o=="object"&&"lat"in o?new Ne(o.lat,"lng"in o?o.lng:o.lon,o.alt):l===void 0?null:new Ne(o,l,f)}var ut={latLngToPoint:function(o,l){var f=this.projection.project(o),g=this.scale(l);return this.transformation._transform(f,g)},pointToLatLng:function(o,l){var f=this.scale(l),g=this.transformation.untransform(o,f);return this.projection.unproject(g)},project:function(o){return this.projection.project(o)},unproject:function(o){return this.projection.unproject(o)},scale:function(o){return 256*Math.pow(2,o)},zoom:function(o){return Math.log(o/256)/Math.LN2},getProjectedBounds:function(o){if(this.infinite)return null;var l=this.projection.bounds,f=this.scale(o),g=this.transformation.transform(l.min,f),w=this.transformation.transform(l.max,f);return new Y(g,w)},infinite:!1,wrapLatLng:function(o){var l=this.wrapLng?p(o.lng,this.wrapLng,!0):o.lng,f=this.wrapLat?p(o.lat,this.wrapLat,!0):o.lat,g=o.alt;return new Ne(f,l,g)},wrapLatLngBounds:function(o){var l=o.getCenter(),f=this.wrapLatLng(l),g=l.lat-f.lat,w=l.lng-f.lng;if(g===0&&w===0)return o;var I=o.getSouthWest(),O=o.getNorthEast(),G=new Ne(I.lat-g,I.lng-w),K=new Ne(O.lat-g,O.lng-w);return new Ie(G,K)}},Cn=i({},ut,{wrapLng:[-180,180],R:6371e3,distance:function(o,l){var f=Math.PI/180,g=o.lat*f,w=l.lat*f,I=Math.sin((l.lat-o.lat)*f/2),O=Math.sin((l.lng-o.lng)*f/2),G=I*I+Math.cos(g)*Math.cos(w)*O*O,K=2*Math.atan2(Math.sqrt(G),Math.sqrt(1-G));return this.R*K}}),zs=6378137,Yn={R:zs,MAX_LATITUDE:85.0511287798,project:function(o){var l=Math.PI/180,f=this.MAX_LATITUDE,g=Math.max(Math.min(f,o.lat),-f),w=Math.sin(g*l);return new W(this.R*o.lng*l,this.R*Math.log((1+w)/(1-w))/2)},unproject:function(o){var l=180/Math.PI;return new Ne((2*Math.atan(Math.exp(o.y/this.R))-Math.PI/2)*l,o.x*l/this.R)},bounds:function(){var o=zs*Math.PI;return new Y([-o,-o],[o,o])}()};function Xn(o,l,f,g){if(A(o)){this._a=o[0],this._b=o[1],this._c=o[2],this._d=o[3];return}this._a=o,this._b=l,this._c=f,this._d=g}Xn.prototype={transform:function(o,l){return this._transform(o.clone(),l)},_transform:function(o,l){return l=l||1,o.x=l*(this._a*o.x+this._b),o.y=l*(this._c*o.y+this._d),o},untransform:function(o,l){return l=l||1,new W((o.x/l-this._b)/this._a,(o.y/l-this._d)/this._c)}};function Vn(o,l,f,g){return new Xn(o,l,f,g)}var vr=i({},Cn,{code:"EPSG:3857",projection:Yn,transformation:function(){var o=.5/(Math.PI*Yn.R);return Vn(o,.5,-o,.5)}()}),Ti=i({},vr,{code:"EPSG:900913"});function zr(o){return document.createElementNS("http://www.w3.org/2000/svg",o)}function Ii(o,l){var f="",g,w,I,O,G,K;for(g=0,I=o.length;g<I;g++){for(G=o[g],w=0,O=G.length;w<O;w++)K=G[w],f+=(w?"L":"M")+K.x+" "+K.y;f+=l?ve.svg?"z":"x":""}return f||"M0 0"}var Br=document.documentElement.style,Ur="ActiveXObject"in window,Bs=Ur&&!document.addEventListener,Si="msLaunchUri"in navigator&&!("documentMode"in document),yr=en("webkit"),Ci=en("android"),Us=en("android 2")||en("android 3"),Pi=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Ni=Ci&&en("Google")&&Pi<537&&!("AudioNode"in window),xr=!!window.opera,_t=!Si&&en("chrome"),xt=en("gecko")&&!yr&&!xr&&!Ur,$r=!_t&&en("safari"),Ai=en("phantom"),ki="OTransition"in Br,Fo=navigator.platform.indexOf("Win")===0,er=Ur&&"transition"in Br,qr="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Us,Ri="MozPerspective"in Br,ji=!window.L_DISABLE_3D&&(er||qr||Ri)&&!ki&&!Ai,wr=typeof orientation<"u"||en("mobile"),zo=wr&&yr,Di=wr&&qr,Li=!window.PointerEvent&&window.MSPointerEvent,Mi=!!(window.PointerEvent||Li),tr="ontouchstart"in window||!!window.TouchEvent,Vi=!window.L_NO_TOUCH&&(tr||Mi),Oi=wr&&xr,On=wr&&xt,$s=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Gr=function(){var o=!1;try{var l=Object.defineProperty({},"passive",{get:function(){o=!0}});window.addEventListener("testPassiveEventSupport",_,l),window.removeEventListener("testPassiveEventSupport",_,l)}catch{}return o}(),ae=function(){return!!document.createElement("canvas").getContext}(),J=!!(document.createElementNS&&zr("svg").createSVGRect),Be=!!J&&function(){var o=document.createElement("div");return o.innerHTML="<svg/>",(o.firstChild&&o.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),we=!J&&function(){try{var o=document.createElement("div");o.innerHTML='<v:shape adj="1"/>';var l=o.firstChild;return l.style.behavior="url(#default#VML)",l&&typeof l.adj=="object"}catch{return!1}}(),zu=navigator.platform.indexOf("Mac")===0,qs=navigator.platform.indexOf("Linux")===0;function en(o){return navigator.userAgent.toLowerCase().indexOf(o)>=0}var ve={ie:Ur,ielt9:Bs,edge:Si,webkit:yr,android:Ci,android23:Us,androidStock:Ni,opera:xr,chrome:_t,gecko:xt,safari:$r,phantom:Ai,opera12:ki,win:Fo,ie3d:er,webkit3d:qr,gecko3d:Ri,any3d:ji,mobile:wr,mobileWebkit:zo,mobileWebkit3d:Di,msPointer:Li,pointer:Mi,touch:Vi,touchNative:tr,mobileOpera:Oi,mobileGecko:On,retina:$s,passiveEvents:Gr,canvas:ae,svg:J,vml:we,inlineSvg:Be,mac:zu,linux:qs},Bu=ve.msPointer?"MSPointerDown":"pointerdown",Wr=ve.msPointer?"MSPointerMove":"pointermove",Uu=ve.msPointer?"MSPointerUp":"pointerup",$u=ve.msPointer?"MSPointerCancel":"pointercancel",Fi={touchstart:Bu,touchmove:Wr,touchend:Uu,touchcancel:$u},Sl={touchstart:Kf,touchmove:Ws,touchend:Ws,touchcancel:Ws},br={},Gs=!1;function Er(o,l,f){return l==="touchstart"&&Wu(),Sl[l]?(f=Sl[l].bind(this,f),o.addEventListener(Fi[l],f,!1),f):(console.warn("wrong event specified:",l),_)}function qu(o,l,f){if(!Fi[l]){console.warn("wrong event specified:",l);return}o.removeEventListener(Fi[l],f,!1)}function Gu(o){br[o.pointerId]=o}function Cl(o){br[o.pointerId]&&(br[o.pointerId]=o)}function Bo(o){delete br[o.pointerId]}function Wu(){Gs||(document.addEventListener(Bu,Gu,!0),document.addEventListener(Wr,Cl,!0),document.addEventListener(Uu,Bo,!0),document.addEventListener($u,Bo,!0),Gs=!0)}function Ws(o,l){if(l.pointerType!==(l.MSPOINTER_TYPE_MOUSE||"mouse")){l.touches=[];for(var f in br)l.touches.push(br[f]);l.changedTouches=[l],o(l)}}function Kf(o,l){l.MSPOINTER_TYPE_TOUCH&&l.pointerType===l.MSPOINTER_TYPE_TOUCH&&Nt(l),Ws(o,l)}function Uo(o){var l={},f,g;for(g in o)f=o[g],l[g]=f&&f.bind?f.bind(o):f;return o=l,l.type="dblclick",l.detail=2,l.isTrusted=!1,l._simulated=!0,l}var Hu=200;function Pl(o,l){o.addEventListener("dblclick",l);var f=0,g;function w(I){if(I.detail!==1){g=I.detail;return}if(!(I.pointerType==="mouse"||I.sourceCapabilities&&!I.sourceCapabilities.firesTouchEvents)){var O=$i(I);if(!(O.some(function(K){return K instanceof HTMLLabelElement&&K.attributes.for})&&!O.some(function(K){return K instanceof HTMLInputElement||K instanceof HTMLSelectElement}))){var G=Date.now();G-f<=Hu?(g++,g===2&&l(Uo(I))):g=1,f=G}}}return o.addEventListener("click",w),{dblclick:l,simDblclick:w}}function Hs(o,l){o.removeEventListener("dblclick",l.dblclick),o.removeEventListener("click",l.simDblclick)}var nr=Zr(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Hr=Zr(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Ku=Hr==="webkitTransition"||Hr==="OTransition"?Hr+"End":"transitionend";function Nl(o){return typeof o=="string"?document.getElementById(o):o}function zi(o,l){var f=o.style[l]||o.currentStyle&&o.currentStyle[l];if((!f||f==="auto")&&document.defaultView){var g=document.defaultView.getComputedStyle(o,null);f=g?g[l]:null}return f==="auto"?null:f}function Fe(o,l,f){var g=document.createElement(o);return g.className=l||"",f&&f.appendChild(g),g}function Ze(o){var l=o.parentNode;l&&l.removeChild(o)}function Bi(o){for(;o.firstChild;)o.removeChild(o.firstChild)}function Kr(o){var l=o.parentNode;l&&l.lastChild!==o&&l.appendChild(o)}function Qr(o){var l=o.parentNode;l&&l.firstChild!==o&&l.insertBefore(o,l.firstChild)}function Al(o,l){if(o.classList!==void 0)return o.classList.contains(l);var f=qo(o);return f.length>0&&new RegExp("(^|\\s)"+l+"(\\s|$)").test(f)}function Ce(o,l){if(o.classList!==void 0)for(var f=T(l),g=0,w=f.length;g<w;g++)o.classList.add(f[g]);else if(!Al(o,l)){var I=qo(o);$o(o,(I?I+" ":"")+l)}}function it(o,l){o.classList!==void 0?o.classList.remove(l):$o(o,x((" "+qo(o)+" ").replace(" "+l+" "," ")))}function $o(o,l){o.className.baseVal===void 0?o.className=l:o.className.baseVal=l}function qo(o){return o.correspondingElement&&(o=o.correspondingElement),o.className.baseVal===void 0?o.className:o.className.baseVal}function Pt(o,l){"opacity"in o.style?o.style.opacity=l:"filter"in o.style&&rr(o,l)}function rr(o,l){var f=!1,g="DXImageTransform.Microsoft.Alpha";try{f=o.filters.item(g)}catch{if(l===1)return}l=Math.round(l*100),f?(f.Enabled=l!==100,f.Opacity=l):o.style.filter+=" progid:"+g+"(opacity="+l+")"}function Zr(o){for(var l=document.documentElement.style,f=0;f<o.length;f++)if(o[f]in l)return o[f];return!1}function Fn(o,l,f){var g=l||new W(0,0);o.style[nr]=(ve.ie3d?"translate("+g.x+"px,"+g.y+"px)":"translate3d("+g.x+"px,"+g.y+"px,0)")+(f?" scale("+f+")":"")}function ht(o,l){o._leaflet_pos=l,ve.any3d?Fn(o,l):(o.style.left=l.x+"px",o.style.top=l.y+"px")}function $e(o){return o._leaflet_pos||new W(0,0)}var Tr,ir,Jr;if("onselectstart"in document)Tr=function(){Ee(window,"selectstart",Nt)},ir=function(){Ke(window,"selectstart",Nt)};else{var Ks=Zr(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Tr=function(){if(Ks){var o=document.documentElement.style;Jr=o[Ks],o[Ks]="none"}},ir=function(){Ks&&(document.documentElement.style[Ks]=Jr,Jr=void 0)}}function Go(){Ee(window,"dragstart",Nt)}function kl(){Ke(window,"dragstart",Nt)}var Wo,Rl;function jl(o){for(;o.tabIndex===-1;)o=o.parentNode;o.style&&(Ir(),Wo=o,Rl=o.style.outlineStyle,o.style.outlineStyle="none",Ee(window,"keydown",Ir))}function Ir(){Wo&&(Wo.style.outlineStyle=Rl,Wo=void 0,Rl=void 0,Ke(window,"keydown",Ir))}function sr(o){do o=o.parentNode;while((!o.offsetWidth||!o.offsetHeight)&&o!==document.body);return o}function Ho(o){var l=o.getBoundingClientRect();return{x:l.width/o.offsetWidth||1,y:l.height/o.offsetHeight||1,boundingClientRect:l}}var Qu={__proto__:null,TRANSFORM:nr,TRANSITION:Hr,TRANSITION_END:Ku,get:Nl,getStyle:zi,create:Fe,remove:Ze,empty:Bi,toFront:Kr,toBack:Qr,hasClass:Al,addClass:Ce,removeClass:it,setClass:$o,getClass:qo,setOpacity:Pt,testProp:Zr,setTransform:Fn,setPosition:ht,getPosition:$e,get disableTextSelection(){return Tr},get enableTextSelection(){return ir},disableImageDrag:Go,enableImageDrag:kl,preventOutline:jl,restoreOutline:Ir,getSizedParentNode:sr,getScale:Ho};function Ee(o,l,f,g){if(l&&typeof l=="object")for(var w in l)zn(o,w,l[w],f);else{l=T(l);for(var I=0,O=l.length;I<O;I++)zn(o,l[I],f,g)}return this}var Ht="_leaflet_events";function Ke(o,l,f,g){if(arguments.length===1)Zu(o),delete o[Ht];else if(l&&typeof l=="object")for(var w in l)Ll(o,w,l[w],f);else if(l=T(l),arguments.length===2)Zu(o,function(G){return U(l,G)!==-1});else for(var I=0,O=l.length;I<O;I++)Ll(o,l[I],f,g);return this}function Zu(o,l){for(var f in o[Ht]){var g=f.split(/\d/)[0];(!l||l(g))&&Ll(o,g,null,null,f)}}var Dl={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function zn(o,l,f,g){var w=l+h(f)+(g?"_"+h(g):"");if(o[Ht]&&o[Ht][w])return this;var I=function(G){return f.call(g||o,G||window.event)},O=I;!ve.touchNative&&ve.pointer&&l.indexOf("touch")===0?I=Er(o,l,I):ve.touch&&l==="dblclick"?I=Pl(o,I):"addEventListener"in o?l==="touchstart"||l==="touchmove"||l==="wheel"||l==="mousewheel"?o.addEventListener(Dl[l]||l,I,ve.passiveEvents?{passive:!1}:!1):l==="mouseenter"||l==="mouseleave"?(I=function(G){G=G||window.event,Ol(o,G)&&O(G)},o.addEventListener(Dl[l],I,!1)):o.addEventListener(l,O,!1):o.attachEvent("on"+l,I),o[Ht]=o[Ht]||{},o[Ht][w]=I}function Ll(o,l,f,g,w){w=w||l+h(f)+(g?"_"+h(g):"");var I=o[Ht]&&o[Ht][w];if(!I)return this;!ve.touchNative&&ve.pointer&&l.indexOf("touch")===0?qu(o,l,I):ve.touch&&l==="dblclick"?Hs(o,I):"removeEventListener"in o?o.removeEventListener(Dl[l]||l,I,!1):o.detachEvent("on"+l,I),o[Ht][w]=null}function Yr(o){return o.stopPropagation?o.stopPropagation():o.originalEvent?o.originalEvent._stopped=!0:o.cancelBubble=!0,this}function Ui(o){return zn(o,"wheel",Yr),this}function Sr(o){return Ee(o,"mousedown touchstart dblclick contextmenu",Yr),o._leaflet_disable_click=!0,this}function Nt(o){return o.preventDefault?o.preventDefault():o.returnValue=!1,this}function Pn(o){return Nt(o),Yr(o),this}function $i(o){if(o.composedPath)return o.composedPath();for(var l=[],f=o.target;f;)l.push(f),f=f.parentNode;return l}function Ml(o,l){if(!l)return new W(o.clientX,o.clientY);var f=Ho(l),g=f.boundingClientRect;return new W((o.clientX-g.left)/f.x-l.clientLeft,(o.clientY-g.top)/f.y-l.clientTop)}var Vl=ve.linux&&ve.chrome?window.devicePixelRatio:ve.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function et(o){return ve.edge?o.wheelDeltaY/2:o.deltaY&&o.deltaMode===0?-o.deltaY/Vl:o.deltaY&&o.deltaMode===1?-o.deltaY*20:o.deltaY&&o.deltaMode===2?-o.deltaY*60:o.deltaX||o.deltaZ?0:o.wheelDelta?(o.wheelDeltaY||o.wheelDelta)/2:o.detail&&Math.abs(o.detail)<32765?-o.detail*20:o.detail?o.detail/-32765*60:0}function Ol(o,l){var f=l.relatedTarget;if(!f)return!0;try{for(;f&&f!==o;)f=f.parentNode}catch{return!1}return f!==o}var Qf={__proto__:null,on:Ee,off:Ke,stopPropagation:Yr,disableScrollPropagation:Ui,disableClickPropagation:Sr,preventDefault:Nt,stop:Pn,getPropagationPath:$i,getMousePosition:Ml,getWheelDelta:et,isExternalTarget:Ol,addListener:Ee,removeListener:Ke},Fl=se.extend({run:function(o,l,f,g){this.stop(),this._el=o,this._inProgress=!0,this._duration=f||.25,this._easeOutPower=1/Math.max(g||.5,.2),this._startPos=$e(o),this._offset=l.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=F(this._animate,this),this._step()},_step:function(o){var l=+new Date-this._startTime,f=this._duration*1e3;l<f?this._runFrame(this._easeOut(l/f),o):(this._runFrame(1),this._complete())},_runFrame:function(o,l){var f=this._startPos.add(this._offset.multiplyBy(o));l&&f._round(),ht(this._el,f),this.fire("step")},_complete:function(){z(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(o){return 1-Math.pow(1-o,this._easeOutPower)}}),ke=se.extend({options:{crs:vr,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(o,l){l=E(this,l),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(o),this._initLayout(),this._onResize=a(this._onResize,this),this._initEvents(),l.maxBounds&&this.setMaxBounds(l.maxBounds),l.zoom!==void 0&&(this._zoom=this._limitZoom(l.zoom)),l.center&&l.zoom!==void 0&&this.setView(xe(l.center),l.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Hr&&ve.any3d&&!ve.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Ee(this._proxy,Ku,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(o,l,f){if(l=l===void 0?this._zoom:this._limitZoom(l),o=this._limitCenter(xe(o),l,this.options.maxBounds),f=f||{},this._stop(),this._loaded&&!f.reset&&f!==!0){f.animate!==void 0&&(f.zoom=i({animate:f.animate},f.zoom),f.pan=i({animate:f.animate,duration:f.duration},f.pan));var g=this._zoom!==l?this._tryAnimatedZoom&&this._tryAnimatedZoom(o,l,f.zoom):this._tryAnimatedPan(o,f.pan);if(g)return clearTimeout(this._sizeTimer),this}return this._resetView(o,l,f.pan&&f.pan.noMoveStart),this},setZoom:function(o,l){return this._loaded?this.setView(this.getCenter(),o,{zoom:l}):(this._zoom=o,this)},zoomIn:function(o,l){return o=o||(ve.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+o,l)},zoomOut:function(o,l){return o=o||(ve.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-o,l)},setZoomAround:function(o,l,f){var g=this.getZoomScale(l),w=this.getSize().divideBy(2),I=o instanceof W?o:this.latLngToContainerPoint(o),O=I.subtract(w).multiplyBy(1-1/g),G=this.containerPointToLatLng(w.add(O));return this.setView(G,l,{zoom:f})},_getBoundsCenterZoom:function(o,l){l=l||{},o=o.getBounds?o.getBounds():Oe(o);var f=X(l.paddingTopLeft||l.padding||[0,0]),g=X(l.paddingBottomRight||l.padding||[0,0]),w=this.getBoundsZoom(o,!1,f.add(g));if(w=typeof l.maxZoom=="number"?Math.min(l.maxZoom,w):w,w===1/0)return{center:o.getCenter(),zoom:w};var I=g.subtract(f).divideBy(2),O=this.project(o.getSouthWest(),w),G=this.project(o.getNorthEast(),w),K=this.unproject(O.add(G).divideBy(2).add(I),w);return{center:K,zoom:w}},fitBounds:function(o,l){if(o=Oe(o),!o.isValid())throw new Error("Bounds are not valid.");var f=this._getBoundsCenterZoom(o,l);return this.setView(f.center,f.zoom,l)},fitWorld:function(o){return this.fitBounds([[-90,-180],[90,180]],o)},panTo:function(o,l){return this.setView(o,this._zoom,{pan:l})},panBy:function(o,l){if(o=X(o).round(),l=l||{},!o.x&&!o.y)return this.fire("moveend");if(l.animate!==!0&&!this.getSize().contains(o))return this._resetView(this.unproject(this.project(this.getCenter()).add(o)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Fl,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),l.noMoveStart||this.fire("movestart"),l.animate!==!1){Ce(this._mapPane,"leaflet-pan-anim");var f=this._getMapPanePos().subtract(o).round();this._panAnim.run(this._mapPane,f,l.duration||.25,l.easeLinearity)}else this._rawPanBy(o),this.fire("move").fire("moveend");return this},flyTo:function(o,l,f){if(f=f||{},f.animate===!1||!ve.any3d)return this.setView(o,l,f);this._stop();var g=this.project(this.getCenter()),w=this.project(o),I=this.getSize(),O=this._zoom;o=xe(o),l=l===void 0?O:l;var G=Math.max(I.x,I.y),K=G*this.getZoomScale(O,l),ne=w.distanceTo(g)||1,he=1.42,ye=he*he;function Ae(At){var mh=At?-1:1,II=At?K:G,SI=K*K-G*G+mh*ye*ye*ne*ne,CI=2*II*ye*ne,em=SI/CI,Vv=Math.sqrt(em*em+1)-em,PI=Vv<1e-9?-18:Math.log(Vv);return PI}function dn(At){return(Math.exp(At)-Math.exp(-At))/2}function zt(At){return(Math.exp(At)+Math.exp(-At))/2}function $n(At){return dn(At)/zt(At)}var _n=Ae(0);function na(At){return G*(zt(_n)/zt(_n+he*At))}function wI(At){return G*(zt(_n)*$n(_n+he*At)-dn(_n))/ye}function bI(At){return 1-Math.pow(1-At,1.5)}var EI=Date.now(),Lv=(Ae(1)-_n)/he,TI=f.duration?1e3*f.duration:1e3*Lv*.8;function Mv(){var At=(Date.now()-EI)/TI,mh=bI(At)*Lv;At<=1?(this._flyToFrame=F(Mv,this),this._move(this.unproject(g.add(w.subtract(g).multiplyBy(wI(mh)/ne)),O),this.getScaleZoom(G/na(mh),O),{flyTo:!0})):this._move(o,l)._moveEnd(!0)}return this._moveStart(!0,f.noMoveStart),Mv.call(this),this},flyToBounds:function(o,l){var f=this._getBoundsCenterZoom(o,l);return this.flyTo(f.center,f.zoom,l)},setMaxBounds:function(o){return o=Oe(o),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),o.isValid()?(this.options.maxBounds=o,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(o){var l=this.options.minZoom;return this.options.minZoom=o,this._loaded&&l!==o&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(o):this},setMaxZoom:function(o){var l=this.options.maxZoom;return this.options.maxZoom=o,this._loaded&&l!==o&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(o):this},panInsideBounds:function(o,l){this._enforcingBounds=!0;var f=this.getCenter(),g=this._limitCenter(f,this._zoom,Oe(o));return f.equals(g)||this.panTo(g,l),this._enforcingBounds=!1,this},panInside:function(o,l){l=l||{};var f=X(l.paddingTopLeft||l.padding||[0,0]),g=X(l.paddingBottomRight||l.padding||[0,0]),w=this.project(this.getCenter()),I=this.project(o),O=this.getPixelBounds(),G=ce([O.min.add(f),O.max.subtract(g)]),K=G.getSize();if(!G.contains(I)){this._enforcingBounds=!0;var ne=I.subtract(G.getCenter()),he=G.extend(I).getSize().subtract(K);w.x+=ne.x<0?-he.x:he.x,w.y+=ne.y<0?-he.y:he.y,this.panTo(this.unproject(w),l),this._enforcingBounds=!1}return this},invalidateSize:function(o){if(!this._loaded)return this;o=i({animate:!1,pan:!0},o===!0?{animate:!0}:o);var l=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var f=this.getSize(),g=l.divideBy(2).round(),w=f.divideBy(2).round(),I=g.subtract(w);return!I.x&&!I.y?this:(o.animate&&o.pan?this.panBy(I):(o.pan&&this._rawPanBy(I),this.fire("move"),o.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(a(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:l,newSize:f}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(o){if(o=this._locateOptions=i({timeout:1e4,watch:!1},o),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var l=a(this._handleGeolocationResponse,this),f=a(this._handleGeolocationError,this);return o.watch?this._locationWatchId=navigator.geolocation.watchPosition(l,f,o):navigator.geolocation.getCurrentPosition(l,f,o),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(o){if(this._container._leaflet_id){var l=o.code,f=o.message||(l===1?"permission denied":l===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:l,message:"Geolocation error: "+f+"."})}},_handleGeolocationResponse:function(o){if(this._container._leaflet_id){var l=o.coords.latitude,f=o.coords.longitude,g=new Ne(l,f),w=g.toBounds(o.coords.accuracy*2),I=this._locateOptions;if(I.setView){var O=this.getBoundsZoom(w);this.setView(g,I.maxZoom?Math.min(O,I.maxZoom):O)}var G={latlng:g,bounds:w,timestamp:o.timestamp};for(var K in o.coords)typeof o.coords[K]=="number"&&(G[K]=o.coords[K]);this.fire("locationfound",G)}},addHandler:function(o,l){if(!l)return this;var f=this[o]=new l(this);return this._handlers.push(f),this.options[o]&&f.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Ze(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(z(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var o;for(o in this._layers)this._layers[o].remove();for(o in this._panes)Ze(this._panes[o]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(o,l){var f="leaflet-pane"+(o?" leaflet-"+o.replace("Pane","")+"-pane":""),g=Fe("div",f,l||this._mapPane);return o&&(this._panes[o]=g),g},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var o=this.getPixelBounds(),l=this.unproject(o.getBottomLeft()),f=this.unproject(o.getTopRight());return new Ie(l,f)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(o,l,f){o=Oe(o),f=X(f||[0,0]);var g=this.getZoom()||0,w=this.getMinZoom(),I=this.getMaxZoom(),O=o.getNorthWest(),G=o.getSouthEast(),K=this.getSize().subtract(f),ne=ce(this.project(G,g),this.project(O,g)).getSize(),he=ve.any3d?this.options.zoomSnap:1,ye=K.x/ne.x,Ae=K.y/ne.y,dn=l?Math.max(ye,Ae):Math.min(ye,Ae);return g=this.getScaleZoom(dn,g),he&&(g=Math.round(g/(he/100))*(he/100),g=l?Math.ceil(g/he)*he:Math.floor(g/he)*he),Math.max(w,Math.min(I,g))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new W(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(o,l){var f=this._getTopLeftPoint(o,l);return new Y(f,f.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(o){return this.options.crs.getProjectedBounds(o===void 0?this.getZoom():o)},getPane:function(o){return typeof o=="string"?this._panes[o]:o},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(o,l){var f=this.options.crs;return l=l===void 0?this._zoom:l,f.scale(o)/f.scale(l)},getScaleZoom:function(o,l){var f=this.options.crs;l=l===void 0?this._zoom:l;var g=f.zoom(o*f.scale(l));return isNaN(g)?1/0:g},project:function(o,l){return l=l===void 0?this._zoom:l,this.options.crs.latLngToPoint(xe(o),l)},unproject:function(o,l){return l=l===void 0?this._zoom:l,this.options.crs.pointToLatLng(X(o),l)},layerPointToLatLng:function(o){var l=X(o).add(this.getPixelOrigin());return this.unproject(l)},latLngToLayerPoint:function(o){var l=this.project(xe(o))._round();return l._subtract(this.getPixelOrigin())},wrapLatLng:function(o){return this.options.crs.wrapLatLng(xe(o))},wrapLatLngBounds:function(o){return this.options.crs.wrapLatLngBounds(Oe(o))},distance:function(o,l){return this.options.crs.distance(xe(o),xe(l))},containerPointToLayerPoint:function(o){return X(o).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(o){return X(o).add(this._getMapPanePos())},containerPointToLatLng:function(o){var l=this.containerPointToLayerPoint(X(o));return this.layerPointToLatLng(l)},latLngToContainerPoint:function(o){return this.layerPointToContainerPoint(this.latLngToLayerPoint(xe(o)))},mouseEventToContainerPoint:function(o){return Ml(o,this._container)},mouseEventToLayerPoint:function(o){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(o))},mouseEventToLatLng:function(o){return this.layerPointToLatLng(this.mouseEventToLayerPoint(o))},_initContainer:function(o){var l=this._container=Nl(o);if(l){if(l._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Ee(l,"scroll",this._onScroll,this),this._containerId=h(l)},_initLayout:function(){var o=this._container;this._fadeAnimated=this.options.fadeAnimation&&ve.any3d,Ce(o,"leaflet-container"+(ve.touch?" leaflet-touch":"")+(ve.retina?" leaflet-retina":"")+(ve.ielt9?" leaflet-oldie":"")+(ve.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var l=zi(o,"position");l!=="absolute"&&l!=="relative"&&l!=="fixed"&&l!=="sticky"&&(o.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var o=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),ht(this._mapPane,new W(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(Ce(o.markerPane,"leaflet-zoom-hide"),Ce(o.shadowPane,"leaflet-zoom-hide"))},_resetView:function(o,l,f){ht(this._mapPane,new W(0,0));var g=!this._loaded;this._loaded=!0,l=this._limitZoom(l),this.fire("viewprereset");var w=this._zoom!==l;this._moveStart(w,f)._move(o,l)._moveEnd(w),this.fire("viewreset"),g&&this.fire("load")},_moveStart:function(o,l){return o&&this.fire("zoomstart"),l||this.fire("movestart"),this},_move:function(o,l,f,g){l===void 0&&(l=this._zoom);var w=this._zoom!==l;return this._zoom=l,this._lastCenter=o,this._pixelOrigin=this._getNewPixelOrigin(o),g?f&&f.pinch&&this.fire("zoom",f):((w||f&&f.pinch)&&this.fire("zoom",f),this.fire("move",f)),this},_moveEnd:function(o){return o&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return z(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(o){ht(this._mapPane,this._getMapPanePos().subtract(o))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(o){this._targets={},this._targets[h(this._container)]=this;var l=o?Ke:Ee;l(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&l(window,"resize",this._onResize,this),ve.any3d&&this.options.transform3DLimit&&(o?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){z(this._resizeRequest),this._resizeRequest=F(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var o=this._getMapPanePos();Math.max(Math.abs(o.x),Math.abs(o.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(o,l){for(var f=[],g,w=l==="mouseout"||l==="mouseover",I=o.target||o.srcElement,O=!1;I;){if(g=this._targets[h(I)],g&&(l==="click"||l==="preclick")&&this._draggableMoved(g)){O=!0;break}if(g&&g.listens(l,!0)&&(w&&!Ol(I,o)||(f.push(g),w))||I===this._container)break;I=I.parentNode}return!f.length&&!O&&!w&&this.listens(l,!0)&&(f=[this]),f},_isClickDisabled:function(o){for(;o&&o!==this._container;){if(o._leaflet_disable_click)return!0;o=o.parentNode}},_handleDOMEvent:function(o){var l=o.target||o.srcElement;if(!(!this._loaded||l._leaflet_disable_events||o.type==="click"&&this._isClickDisabled(l))){var f=o.type;f==="mousedown"&&jl(l),this._fireDOMEvent(o,f)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(o,l,f){if(o.type==="click"){var g=i({},o);g.type="preclick",this._fireDOMEvent(g,g.type,f)}var w=this._findEventTargets(o,l);if(f){for(var I=[],O=0;O<f.length;O++)f[O].listens(l,!0)&&I.push(f[O]);w=I.concat(w)}if(w.length){l==="contextmenu"&&Nt(o);var G=w[0],K={originalEvent:o};if(o.type!=="keypress"&&o.type!=="keydown"&&o.type!=="keyup"){var ne=G.getLatLng&&(!G._radius||G._radius<=10);K.containerPoint=ne?this.latLngToContainerPoint(G.getLatLng()):this.mouseEventToContainerPoint(o),K.layerPoint=this.containerPointToLayerPoint(K.containerPoint),K.latlng=ne?G.getLatLng():this.layerPointToLatLng(K.layerPoint)}for(O=0;O<w.length;O++)if(w[O].fire(l,K,!0),K.originalEvent._stopped||w[O].options.bubblingMouseEvents===!1&&U(this._mouseEvents,l)!==-1)return}},_draggableMoved:function(o){return o=o.dragging&&o.dragging.enabled()?o:this,o.dragging&&o.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var o=0,l=this._handlers.length;o<l;o++)this._handlers[o].disable()},whenReady:function(o,l){return this._loaded?o.call(l||this,{target:this}):this.on("load",o,l),this},_getMapPanePos:function(){return $e(this._mapPane)||new W(0,0)},_moved:function(){var o=this._getMapPanePos();return o&&!o.equals([0,0])},_getTopLeftPoint:function(o,l){var f=o&&l!==void 0?this._getNewPixelOrigin(o,l):this.getPixelOrigin();return f.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(o,l){var f=this.getSize()._divideBy(2);return this.project(o,l)._subtract(f)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(o,l,f){var g=this._getNewPixelOrigin(f,l);return this.project(o,l)._subtract(g)},_latLngBoundsToNewLayerBounds:function(o,l,f){var g=this._getNewPixelOrigin(f,l);return ce([this.project(o.getSouthWest(),l)._subtract(g),this.project(o.getNorthWest(),l)._subtract(g),this.project(o.getSouthEast(),l)._subtract(g),this.project(o.getNorthEast(),l)._subtract(g)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(o){return this.latLngToLayerPoint(o).subtract(this._getCenterLayerPoint())},_limitCenter:function(o,l,f){if(!f)return o;var g=this.project(o,l),w=this.getSize().divideBy(2),I=new Y(g.subtract(w),g.add(w)),O=this._getBoundsOffset(I,f,l);return Math.abs(O.x)<=1&&Math.abs(O.y)<=1?o:this.unproject(g.add(O),l)},_limitOffset:function(o,l){if(!l)return o;var f=this.getPixelBounds(),g=new Y(f.min.add(o),f.max.add(o));return o.add(this._getBoundsOffset(g,l))},_getBoundsOffset:function(o,l,f){var g=ce(this.project(l.getNorthEast(),f),this.project(l.getSouthWest(),f)),w=g.min.subtract(o.min),I=g.max.subtract(o.max),O=this._rebound(w.x,-I.x),G=this._rebound(w.y,-I.y);return new W(O,G)},_rebound:function(o,l){return o+l>0?Math.round(o-l)/2:Math.max(0,Math.ceil(o))-Math.max(0,Math.floor(l))},_limitZoom:function(o){var l=this.getMinZoom(),f=this.getMaxZoom(),g=ve.any3d?this.options.zoomSnap:1;return g&&(o=Math.round(o/g)*g),Math.max(l,Math.min(f,o))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){it(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(o,l){var f=this._getCenterOffset(o)._trunc();return(l&&l.animate)!==!0&&!this.getSize().contains(f)?!1:(this.panBy(f,l),!0)},_createAnimProxy:function(){var o=this._proxy=Fe("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(o),this.on("zoomanim",function(l){var f=nr,g=this._proxy.style[f];Fn(this._proxy,this.project(l.center,l.zoom),this.getZoomScale(l.zoom,1)),g===this._proxy.style[f]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Ze(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var o=this.getCenter(),l=this.getZoom();Fn(this._proxy,this.project(o,l),this.getZoomScale(l,1))},_catchTransitionEnd:function(o){this._animatingZoom&&o.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(o,l,f){if(this._animatingZoom)return!0;if(f=f||{},!this._zoomAnimated||f.animate===!1||this._nothingToAnimate()||Math.abs(l-this._zoom)>this.options.zoomAnimationThreshold)return!1;var g=this.getZoomScale(l),w=this._getCenterOffset(o)._divideBy(1-1/g);return f.animate!==!0&&!this.getSize().contains(w)?!1:(F(function(){this._moveStart(!0,f.noMoveStart||!1)._animateZoom(o,l,!0)},this),!0)},_animateZoom:function(o,l,f,g){this._mapPane&&(f&&(this._animatingZoom=!0,this._animateToCenter=o,this._animateToZoom=l,Ce(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:o,zoom:l,noUpdate:g}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(a(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&it(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Ju(o,l){return new ke(o,l)}var tn=me.extend({options:{position:"topright"},initialize:function(o){E(this,o)},getPosition:function(){return this.options.position},setPosition:function(o){var l=this._map;return l&&l.removeControl(this),this.options.position=o,l&&l.addControl(this),this},getContainer:function(){return this._container},addTo:function(o){this.remove(),this._map=o;var l=this._container=this.onAdd(o),f=this.getPosition(),g=o._controlCorners[f];return Ce(l,"leaflet-control"),f.indexOf("bottom")!==-1?g.insertBefore(l,g.firstChild):g.appendChild(l),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Ze(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(o){this._map&&o&&o.screenX>0&&o.screenY>0&&this._map.getContainer().focus()}}),qi=function(o){return new tn(o)};ke.include({addControl:function(o){return o.addTo(this),this},removeControl:function(o){return o.remove(),this},_initControlPos:function(){var o=this._controlCorners={},l="leaflet-",f=this._controlContainer=Fe("div",l+"control-container",this._container);function g(w,I){var O=l+w+" "+l+I;o[w+I]=Fe("div",O,f)}g("top","left"),g("top","right"),g("bottom","left"),g("bottom","right")},_clearControlPos:function(){for(var o in this._controlCorners)Ze(this._controlCorners[o]);Ze(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Bn=tn.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(o,l,f,g){return f<g?-1:g<f?1:0}},initialize:function(o,l,f){E(this,f),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var g in o)this._addLayer(o[g],g);for(g in l)this._addLayer(l[g],g,!0)},onAdd:function(o){this._initLayout(),this._update(),this._map=o,o.on("zoomend",this._checkDisabledLayers,this);for(var l=0;l<this._layers.length;l++)this._layers[l].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(o){return tn.prototype.addTo.call(this,o),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var o=0;o<this._layers.length;o++)this._layers[o].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(o,l){return this._addLayer(o,l),this._map?this._update():this},addOverlay:function(o,l){return this._addLayer(o,l,!0),this._map?this._update():this},removeLayer:function(o){o.off("add remove",this._onLayerChange,this);var l=this._getLayer(h(o));return l&&this._layers.splice(this._layers.indexOf(l),1),this._map?this._update():this},expand:function(){Ce(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var o=this._map.getSize().y-(this._container.offsetTop+50);return o<this._section.clientHeight?(Ce(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=o+"px"):it(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return it(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var o="leaflet-control-layers",l=this._container=Fe("div",o),f=this.options.collapsed;l.setAttribute("aria-haspopup",!0),Sr(l),Ui(l);var g=this._section=Fe("section",o+"-list");f&&(this._map.on("click",this.collapse,this),Ee(l,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var w=this._layersLink=Fe("a",o+"-toggle",l);w.href="#",w.title="Layers",w.setAttribute("role","button"),Ee(w,{keydown:function(I){I.keyCode===13&&this._expandSafely()},click:function(I){Nt(I),this._expandSafely()}},this),f||this.expand(),this._baseLayersList=Fe("div",o+"-base",g),this._separator=Fe("div",o+"-separator",g),this._overlaysList=Fe("div",o+"-overlays",g),l.appendChild(g)},_getLayer:function(o){for(var l=0;l<this._layers.length;l++)if(this._layers[l]&&h(this._layers[l].layer)===o)return this._layers[l]},_addLayer:function(o,l,f){this._map&&o.on("add remove",this._onLayerChange,this),this._layers.push({layer:o,name:l,overlay:f}),this.options.sortLayers&&this._layers.sort(a(function(g,w){return this.options.sortFunction(g.layer,w.layer,g.name,w.name)},this)),this.options.autoZIndex&&o.setZIndex&&(this._lastZIndex++,o.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Bi(this._baseLayersList),Bi(this._overlaysList),this._layerControlInputs=[];var o,l,f,g,w=0;for(f=0;f<this._layers.length;f++)g=this._layers[f],this._addItem(g),l=l||g.overlay,o=o||!g.overlay,w+=g.overlay?0:1;return this.options.hideSingleBase&&(o=o&&w>1,this._baseLayersList.style.display=o?"":"none"),this._separator.style.display=l&&o?"":"none",this},_onLayerChange:function(o){this._handlingClick||this._update();var l=this._getLayer(h(o.target)),f=l.overlay?o.type==="add"?"overlayadd":"overlayremove":o.type==="add"?"baselayerchange":null;f&&this._map.fire(f,l)},_createRadioElement:function(o,l){var f='<input type="radio" class="leaflet-control-layers-selector" name="'+o+'"'+(l?' checked="checked"':"")+"/>",g=document.createElement("div");return g.innerHTML=f,g.firstChild},_addItem:function(o){var l=document.createElement("label"),f=this._map.hasLayer(o.layer),g;o.overlay?(g=document.createElement("input"),g.type="checkbox",g.className="leaflet-control-layers-selector",g.defaultChecked=f):g=this._createRadioElement("leaflet-base-layers_"+h(this),f),this._layerControlInputs.push(g),g.layerId=h(o.layer),Ee(g,"click",this._onInputClick,this);var w=document.createElement("span");w.innerHTML=" "+o.name;var I=document.createElement("span");l.appendChild(I),I.appendChild(g),I.appendChild(w);var O=o.overlay?this._overlaysList:this._baseLayersList;return O.appendChild(l),this._checkDisabledLayers(),l},_onInputClick:function(){if(!this._preventClick){var o=this._layerControlInputs,l,f,g=[],w=[];this._handlingClick=!0;for(var I=o.length-1;I>=0;I--)l=o[I],f=this._getLayer(l.layerId).layer,l.checked?g.push(f):l.checked||w.push(f);for(I=0;I<w.length;I++)this._map.hasLayer(w[I])&&this._map.removeLayer(w[I]);for(I=0;I<g.length;I++)this._map.hasLayer(g[I])||this._map.addLayer(g[I]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var o=this._layerControlInputs,l,f,g=this._map.getZoom(),w=o.length-1;w>=0;w--)l=o[w],f=this._getLayer(l.layerId).layer,l.disabled=f.options.minZoom!==void 0&&g<f.options.minZoom||f.options.maxZoom!==void 0&&g>f.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var o=this._section;this._preventClick=!0,Ee(o,"click",Nt),this.expand();var l=this;setTimeout(function(){Ke(o,"click",Nt),l._preventClick=!1})}}),Yu=function(o,l,f){return new Bn(o,l,f)},zl=tn.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(o){var l="leaflet-control-zoom",f=Fe("div",l+" leaflet-bar"),g=this.options;return this._zoomInButton=this._createButton(g.zoomInText,g.zoomInTitle,l+"-in",f,this._zoomIn),this._zoomOutButton=this._createButton(g.zoomOutText,g.zoomOutTitle,l+"-out",f,this._zoomOut),this._updateDisabled(),o.on("zoomend zoomlevelschange",this._updateDisabled,this),f},onRemove:function(o){o.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(o){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(o.shiftKey?3:1))},_zoomOut:function(o){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(o.shiftKey?3:1))},_createButton:function(o,l,f,g,w){var I=Fe("a",f,g);return I.innerHTML=o,I.href="#",I.title=l,I.setAttribute("role","button"),I.setAttribute("aria-label",l),Sr(I),Ee(I,"click",Pn),Ee(I,"click",w,this),Ee(I,"click",this._refocusOnMap,this),I},_updateDisabled:function(){var o=this._map,l="leaflet-disabled";it(this._zoomInButton,l),it(this._zoomOutButton,l),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||o._zoom===o.getMinZoom())&&(Ce(this._zoomOutButton,l),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||o._zoom===o.getMaxZoom())&&(Ce(this._zoomInButton,l),this._zoomInButton.setAttribute("aria-disabled","true"))}});ke.mergeOptions({zoomControl:!0}),ke.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new zl,this.addControl(this.zoomControl))});var Qs=function(o){return new zl(o)},Bl=tn.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(o){var l="leaflet-control-scale",f=Fe("div",l),g=this.options;return this._addScales(g,l+"-line",f),o.on(g.updateWhenIdle?"moveend":"move",this._update,this),o.whenReady(this._update,this),f},onRemove:function(o){o.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(o,l,f){o.metric&&(this._mScale=Fe("div",l,f)),o.imperial&&(this._iScale=Fe("div",l,f))},_update:function(){var o=this._map,l=o.getSize().y/2,f=o.distance(o.containerPointToLatLng([0,l]),o.containerPointToLatLng([this.options.maxWidth,l]));this._updateScales(f)},_updateScales:function(o){this.options.metric&&o&&this._updateMetric(o),this.options.imperial&&o&&this._updateImperial(o)},_updateMetric:function(o){var l=this._getRoundNum(o),f=l<1e3?l+" m":l/1e3+" km";this._updateScale(this._mScale,f,l/o)},_updateImperial:function(o){var l=o*3.2808399,f,g,w;l>5280?(f=l/5280,g=this._getRoundNum(f),this._updateScale(this._iScale,g+" mi",g/f)):(w=this._getRoundNum(l),this._updateScale(this._iScale,w+" ft",w/l))},_updateScale:function(o,l,f){o.style.width=Math.round(this.options.maxWidth*f)+"px",o.innerHTML=l},_getRoundNum:function(o){var l=Math.pow(10,(Math.floor(o)+"").length-1),f=o/l;return f=f>=10?10:f>=5?5:f>=3?3:f>=2?2:1,l*f}}),Ul=function(o){return new Bl(o)},Ko='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Qo=tn.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(ve.inlineSvg?Ko+" ":"")+"Leaflet</a>"},initialize:function(o){E(this,o),this._attributions={}},onAdd:function(o){o.attributionControl=this,this._container=Fe("div","leaflet-control-attribution"),Sr(this._container);for(var l in o._layers)o._layers[l].getAttribution&&this.addAttribution(o._layers[l].getAttribution());return this._update(),o.on("layeradd",this._addAttribution,this),this._container},onRemove:function(o){o.off("layeradd",this._addAttribution,this)},_addAttribution:function(o){o.layer.getAttribution&&(this.addAttribution(o.layer.getAttribution()),o.layer.once("remove",function(){this.removeAttribution(o.layer.getAttribution())},this))},setPrefix:function(o){return this.options.prefix=o,this._update(),this},addAttribution:function(o){return o?(this._attributions[o]||(this._attributions[o]=0),this._attributions[o]++,this._update(),this):this},removeAttribution:function(o){return o?(this._attributions[o]&&(this._attributions[o]--,this._update()),this):this},_update:function(){if(this._map){var o=[];for(var l in this._attributions)this._attributions[l]&&o.push(l);var f=[];this.options.prefix&&f.push(this.options.prefix),o.length&&f.push(o.join(", ")),this._container.innerHTML=f.join(' <span aria-hidden="true">|</span> ')}}});ke.mergeOptions({attributionControl:!0}),ke.addInitHook(function(){this.options.attributionControl&&new Qo().addTo(this)});var Zo=function(o){return new Qo(o)};tn.Layers=Bn,tn.Zoom=zl,tn.Scale=Bl,tn.Attribution=Qo,qi.layers=Yu,qi.zoom=Qs,qi.scale=Ul,qi.attribution=Zo;var Un=me.extend({initialize:function(o){this._map=o},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Un.addTo=function(o,l){return o.addHandler(l,this),this};var Xu={Events:Te},Gi=ve.touch?"touchstart mousedown":"mousedown",or=se.extend({options:{clickTolerance:3},initialize:function(o,l,f,g){E(this,g),this._element=o,this._dragStartTarget=l||o,this._preventOutline=f},enable:function(){this._enabled||(Ee(this._dragStartTarget,Gi,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(or._dragging===this&&this.finishDrag(!0),Ke(this._dragStartTarget,Gi,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(o){if(this._enabled&&(this._moved=!1,!Al(this._element,"leaflet-zoom-anim"))){if(o.touches&&o.touches.length!==1){or._dragging===this&&this.finishDrag();return}if(!(or._dragging||o.shiftKey||o.which!==1&&o.button!==1&&!o.touches)&&(or._dragging=this,this._preventOutline&&jl(this._element),Go(),Tr(),!this._moving)){this.fire("down");var l=o.touches?o.touches[0]:o,f=sr(this._element);this._startPoint=new W(l.clientX,l.clientY),this._startPos=$e(this._element),this._parentScale=Ho(f);var g=o.type==="mousedown";Ee(document,g?"mousemove":"touchmove",this._onMove,this),Ee(document,g?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(o){if(this._enabled){if(o.touches&&o.touches.length>1){this._moved=!0;return}var l=o.touches&&o.touches.length===1?o.touches[0]:o,f=new W(l.clientX,l.clientY)._subtract(this._startPoint);!f.x&&!f.y||Math.abs(f.x)+Math.abs(f.y)<this.options.clickTolerance||(f.x/=this._parentScale.x,f.y/=this._parentScale.y,Nt(o),this._moved||(this.fire("dragstart"),this._moved=!0,Ce(document.body,"leaflet-dragging"),this._lastTarget=o.target||o.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),Ce(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(f),this._moving=!0,this._lastEvent=o,this._updatePosition())}},_updatePosition:function(){var o={originalEvent:this._lastEvent};this.fire("predrag",o),ht(this._element,this._newPos),this.fire("drag",o)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(o){it(document.body,"leaflet-dragging"),this._lastTarget&&(it(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),Ke(document,"mousemove touchmove",this._onMove,this),Ke(document,"mouseup touchend touchcancel",this._onUp,this),kl(),ir();var l=this._moved&&this._moving;this._moving=!1,or._dragging=!1,l&&this.fire("dragend",{noInertia:o,distance:this._newPos.distanceTo(this._startPos)})}});function $l(o,l,f){var g,w=[1,4,2,8],I,O,G,K,ne,he,ye,Ae;for(I=0,he=o.length;I<he;I++)o[I]._code=wt(o[I],l);for(G=0;G<4;G++){for(ye=w[G],g=[],I=0,he=o.length,O=he-1;I<he;O=I++)K=o[I],ne=o[O],K._code&ye?ne._code&ye||(Ae=ei(ne,K,ye,l,f),Ae._code=wt(Ae,l),g.push(Ae)):(ne._code&ye&&(Ae=ei(ne,K,ye,l,f),Ae._code=wt(Ae,l),g.push(Ae)),g.push(K));o=g}return o}function Jo(o,l){var f,g,w,I,O,G,K,ne,he;if(!o||o.length===0)throw new Error("latlngs not passed");Dt(o)||(console.warn("latlngs are not flat! Only the first ring will be used"),o=o[0]);var ye=xe([0,0]),Ae=Oe(o),dn=Ae.getNorthWest().distanceTo(Ae.getSouthWest())*Ae.getNorthEast().distanceTo(Ae.getNorthWest());dn<1700&&(ye=Zs(o));var zt=o.length,$n=[];for(f=0;f<zt;f++){var _n=xe(o[f]);$n.push(l.project(xe([_n.lat-ye.lat,_n.lng-ye.lng])))}for(G=K=ne=0,f=0,g=zt-1;f<zt;g=f++)w=$n[f],I=$n[g],O=w.y*I.x-I.y*w.x,K+=(w.x+I.x)*O,ne+=(w.y+I.y)*O,G+=O*3;G===0?he=$n[0]:he=[K/G,ne/G];var na=l.unproject(X(he));return xe([na.lat+ye.lat,na.lng+ye.lng])}function Zs(o){for(var l=0,f=0,g=0,w=0;w<o.length;w++){var I=xe(o[w]);l+=I.lat,f+=I.lng,g++}return xe([l/g,f/g])}var eh={__proto__:null,clipPolygon:$l,polygonCenter:Jo,centroid:Zs};function Js(o,l){if(!l||!o.length)return o.slice();var f=l*l;return o=nh(o,f),o=Xr(o,f),o}function ql(o,l,f){return Math.sqrt(Wi(o,l,f,!0))}function th(o,l,f){return Wi(o,l,f)}function Xr(o,l){var f=o.length,g=typeof Uint8Array!=void 0+""?Uint8Array:Array,w=new g(f);w[0]=w[f-1]=1,Yo(o,w,l,0,f-1);var I,O=[];for(I=0;I<f;I++)w[I]&&O.push(o[I]);return O}function Yo(o,l,f,g,w){var I=0,O,G,K;for(G=g+1;G<=w-1;G++)K=Wi(o[G],o[g],o[w],!0),K>I&&(O=G,I=K);I>f&&(l[O]=1,Yo(o,l,f,g,O),Yo(o,l,f,O,w))}function nh(o,l){for(var f=[o[0]],g=1,w=0,I=o.length;g<I;g++)rh(o[g],o[w])>l&&(f.push(o[g]),w=g);return w<I-1&&f.push(o[I-1]),f}var Gl;function Wl(o,l,f,g,w){var I=g?Gl:wt(o,f),O=wt(l,f),G,K,ne;for(Gl=O;;){if(!(I|O))return[o,l];if(I&O)return!1;G=I||O,K=ei(o,l,G,f,w),ne=wt(K,f),G===I?(o=K,I=ne):(l=K,O=ne)}}function ei(o,l,f,g,w){var I=l.x-o.x,O=l.y-o.y,G=g.min,K=g.max,ne,he;return f&8?(ne=o.x+I*(K.y-o.y)/O,he=K.y):f&4?(ne=o.x+I*(G.y-o.y)/O,he=G.y):f&2?(ne=K.x,he=o.y+O*(K.x-o.x)/I):f&1&&(ne=G.x,he=o.y+O*(G.x-o.x)/I),new W(ne,he,w)}function wt(o,l){var f=0;return o.x<l.min.x?f|=1:o.x>l.max.x&&(f|=2),o.y<l.min.y?f|=4:o.y>l.max.y&&(f|=8),f}function rh(o,l){var f=l.x-o.x,g=l.y-o.y;return f*f+g*g}function Wi(o,l,f,g){var w=l.x,I=l.y,O=f.x-w,G=f.y-I,K=O*O+G*G,ne;return K>0&&(ne=((o.x-w)*O+(o.y-I)*G)/K,ne>1?(w=f.x,I=f.y):ne>0&&(w+=O*ne,I+=G*ne)),O=o.x-w,G=o.y-I,g?O*O+G*G:new W(w,I)}function Dt(o){return!A(o[0])||typeof o[0][0]!="object"&&typeof o[0][0]<"u"}function d(o){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Dt(o)}function y(o,l){var f,g,w,I,O,G,K,ne;if(!o||o.length===0)throw new Error("latlngs not passed");Dt(o)||(console.warn("latlngs are not flat! Only the first ring will be used"),o=o[0]);var he=xe([0,0]),ye=Oe(o),Ae=ye.getNorthWest().distanceTo(ye.getSouthWest())*ye.getNorthEast().distanceTo(ye.getNorthWest());Ae<1700&&(he=Zs(o));var dn=o.length,zt=[];for(f=0;f<dn;f++){var $n=xe(o[f]);zt.push(l.project(xe([$n.lat-he.lat,$n.lng-he.lng])))}for(f=0,g=0;f<dn-1;f++)g+=zt[f].distanceTo(zt[f+1])/2;if(g===0)ne=zt[0];else for(f=0,I=0;f<dn-1;f++)if(O=zt[f],G=zt[f+1],w=O.distanceTo(G),I+=w,I>g){K=(I-g)/w,ne=[G.x-K*(G.x-O.x),G.y-K*(G.y-O.y)];break}var _n=l.unproject(X(ne));return xe([_n.lat+he.lat,_n.lng+he.lng])}var b={__proto__:null,simplify:Js,pointToSegmentDistance:ql,closestPointOnSegment:th,clipSegment:Wl,_getEdgeIntersection:ei,_getBitCode:wt,_sqClosestPointOnSegment:Wi,isFlat:Dt,_flat:d,polylineCenter:y},P={project:function(o){return new W(o.lng,o.lat)},unproject:function(o){return new Ne(o.y,o.x)},bounds:new Y([-180,-90],[180,90])},$={R:6378137,R_MINOR:6356752314245179e-9,bounds:new Y([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(o){var l=Math.PI/180,f=this.R,g=o.lat*l,w=this.R_MINOR/f,I=Math.sqrt(1-w*w),O=I*Math.sin(g),G=Math.tan(Math.PI/4-g/2)/Math.pow((1-O)/(1+O),I/2);return g=-f*Math.log(Math.max(G,1e-10)),new W(o.lng*l*f,g)},unproject:function(o){for(var l=180/Math.PI,f=this.R,g=this.R_MINOR/f,w=Math.sqrt(1-g*g),I=Math.exp(-o.y/f),O=Math.PI/2-2*Math.atan(I),G=0,K=.1,ne;G<15&&Math.abs(K)>1e-7;G++)ne=w*Math.sin(O),ne=Math.pow((1-ne)/(1+ne),w/2),K=Math.PI/2-2*Math.atan(I*ne)-O,O+=K;return new Ne(O*l,o.x*l/f)}},Q={__proto__:null,LonLat:P,Mercator:$,SphericalMercator:Yn},ie=i({},Cn,{code:"EPSG:3395",projection:$,transformation:function(){var o=.5/(Math.PI*$.R);return Vn(o,.5,-o,.5)}()}),Ge=i({},Cn,{code:"EPSG:4326",projection:P,transformation:Vn(1/180,1,-1/180,.5)}),Lt=i({},ut,{projection:P,transformation:Vn(1,0,-1,0),scale:function(o){return Math.pow(2,o)},zoom:function(o){return Math.log(o)/Math.LN2},distance:function(o,l){var f=l.lng-o.lng,g=l.lat-o.lat;return Math.sqrt(f*f+g*g)},infinite:!0});ut.Earth=Cn,ut.EPSG3395=ie,ut.EPSG3857=vr,ut.EPSG900913=Ti,ut.EPSG4326=Ge,ut.Simple=Lt;var Se=se.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(o){return o.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(o){return o&&o.removeLayer(this),this},getPane:function(o){return this._map.getPane(o?this.options[o]||o:this.options.pane)},addInteractiveTarget:function(o){return this._map._targets[h(o)]=this,this},removeInteractiveTarget:function(o){return delete this._map._targets[h(o)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(o){var l=o.target;if(l.hasLayer(this)){if(this._map=l,this._zoomAnimated=l._zoomAnimated,this.getEvents){var f=this.getEvents();l.on(f,this),this.once("remove",function(){l.off(f,this)},this)}this.onAdd(l),this.fire("add"),l.fire("layeradd",{layer:this})}}});ke.include({addLayer:function(o){if(!o._layerAdd)throw new Error("The provided object is not a Layer.");var l=h(o);return this._layers[l]?this:(this._layers[l]=o,o._mapToAdd=this,o.beforeAdd&&o.beforeAdd(this),this.whenReady(o._layerAdd,o),this)},removeLayer:function(o){var l=h(o);return this._layers[l]?(this._loaded&&o.onRemove(this),delete this._layers[l],this._loaded&&(this.fire("layerremove",{layer:o}),o.fire("remove")),o._map=o._mapToAdd=null,this):this},hasLayer:function(o){return h(o)in this._layers},eachLayer:function(o,l){for(var f in this._layers)o.call(l,this._layers[f]);return this},_addLayers:function(o){o=o?A(o)?o:[o]:[];for(var l=0,f=o.length;l<f;l++)this.addLayer(o[l])},_addZoomLimit:function(o){(!isNaN(o.options.maxZoom)||!isNaN(o.options.minZoom))&&(this._zoomBoundLayers[h(o)]=o,this._updateZoomLevels())},_removeZoomLimit:function(o){var l=h(o);this._zoomBoundLayers[l]&&(delete this._zoomBoundLayers[l],this._updateZoomLevels())},_updateZoomLevels:function(){var o=1/0,l=-1/0,f=this._getZoomSpan();for(var g in this._zoomBoundLayers){var w=this._zoomBoundLayers[g].options;o=w.minZoom===void 0?o:Math.min(o,w.minZoom),l=w.maxZoom===void 0?l:Math.max(l,w.maxZoom)}this._layersMaxZoom=l===-1/0?void 0:l,this._layersMinZoom=o===1/0?void 0:o,f!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var dt=Se.extend({initialize:function(o,l){E(this,l),this._layers={};var f,g;if(o)for(f=0,g=o.length;f<g;f++)this.addLayer(o[f])},addLayer:function(o){var l=this.getLayerId(o);return this._layers[l]=o,this._map&&this._map.addLayer(o),this},removeLayer:function(o){var l=o in this._layers?o:this.getLayerId(o);return this._map&&this._layers[l]&&this._map.removeLayer(this._layers[l]),delete this._layers[l],this},hasLayer:function(o){var l=typeof o=="number"?o:this.getLayerId(o);return l in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(o){var l=Array.prototype.slice.call(arguments,1),f,g;for(f in this._layers)g=this._layers[f],g[o]&&g[o].apply(g,l);return this},onAdd:function(o){this.eachLayer(o.addLayer,o)},onRemove:function(o){this.eachLayer(o.removeLayer,o)},eachLayer:function(o,l){for(var f in this._layers)o.call(l,this._layers[f]);return this},getLayer:function(o){return this._layers[o]},getLayers:function(){var o=[];return this.eachLayer(o.push,o),o},setZIndex:function(o){return this.invoke("setZIndex",o)},getLayerId:function(o){return h(o)}}),Ft=function(o,l){return new dt(o,l)},nn=dt.extend({addLayer:function(o){return this.hasLayer(o)?this:(o.addEventParent(this),dt.prototype.addLayer.call(this,o),this.fire("layeradd",{layer:o}))},removeLayer:function(o){return this.hasLayer(o)?(o in this._layers&&(o=this._layers[o]),o.removeEventParent(this),dt.prototype.removeLayer.call(this,o),this.fire("layerremove",{layer:o})):this},setStyle:function(o){return this.invoke("setStyle",o)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var o=new Ie;for(var l in this._layers){var f=this._layers[l];o.extend(f.getBounds?f.getBounds():f.getLatLng())}return o}}),Nn=function(o,l){return new nn(o,l)},ar=me.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(o){E(this,o)},createIcon:function(o){return this._createIcon("icon",o)},createShadow:function(o){return this._createIcon("shadow",o)},_createIcon:function(o,l){var f=this._getIconUrl(o);if(!f){if(o==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var g=this._createImg(f,l&&l.tagName==="IMG"?l:null);return this._setIconStyles(g,o),(this.options.crossOrigin||this.options.crossOrigin==="")&&(g.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),g},_setIconStyles:function(o,l){var f=this.options,g=f[l+"Size"];typeof g=="number"&&(g=[g,g]);var w=X(g),I=X(l==="shadow"&&f.shadowAnchor||f.iconAnchor||w&&w.divideBy(2,!0));o.className="leaflet-marker-"+l+" "+(f.className||""),I&&(o.style.marginLeft=-I.x+"px",o.style.marginTop=-I.y+"px"),w&&(o.style.width=w.x+"px",o.style.height=w.y+"px")},_createImg:function(o,l){return l=l||document.createElement("img"),l.src=o,l},_getIconUrl:function(o){return ve.retina&&this.options[o+"RetinaUrl"]||this.options[o+"Url"]}});function Hl(o){return new ar(o)}var Kl=ar.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(o){return typeof Kl.imagePath!="string"&&(Kl.imagePath=this._detectIconPath()),(this.options.imagePath||Kl.imagePath)+ar.prototype._getIconUrl.call(this,o)},_stripUrl:function(o){var l=function(f,g,w){var I=g.exec(f);return I&&I[w]};return o=l(o,/^url\((['"])?(.+)\1\)$/,2),o&&l(o,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var o=Fe("div","leaflet-default-icon-path",document.body),l=zi(o,"background-image")||zi(o,"backgroundImage");if(document.body.removeChild(o),l=this._stripUrl(l),l)return l;var f=document.querySelector('link[href$="leaflet.css"]');return f?f.href.substring(0,f.href.length-11-1):""}}),gv=Un.extend({initialize:function(o){this._marker=o},addHooks:function(){var o=this._marker._icon;this._draggable||(this._draggable=new or(o,o,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),Ce(o,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&it(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(o){var l=this._marker,f=l._map,g=this._marker.options.autoPanSpeed,w=this._marker.options.autoPanPadding,I=$e(l._icon),O=f.getPixelBounds(),G=f.getPixelOrigin(),K=ce(O.min._subtract(G).add(w),O.max._subtract(G).subtract(w));if(!K.contains(I)){var ne=X((Math.max(K.max.x,I.x)-K.max.x)/(O.max.x-K.max.x)-(Math.min(K.min.x,I.x)-K.min.x)/(O.min.x-K.min.x),(Math.max(K.max.y,I.y)-K.max.y)/(O.max.y-K.max.y)-(Math.min(K.min.y,I.y)-K.min.y)/(O.min.y-K.min.y)).multiplyBy(g);f.panBy(ne,{animate:!1}),this._draggable._newPos._add(ne),this._draggable._startPos._add(ne),ht(l._icon,this._draggable._newPos),this._onDrag(o),this._panRequest=F(this._adjustPan.bind(this,o))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(o){this._marker.options.autoPan&&(z(this._panRequest),this._panRequest=F(this._adjustPan.bind(this,o)))},_onDrag:function(o){var l=this._marker,f=l._shadow,g=$e(l._icon),w=l._map.layerPointToLatLng(g);f&&ht(f,g),l._latlng=w,o.latlng=w,o.oldLatLng=this._oldLatLng,l.fire("move",o).fire("drag",o)},_onDragEnd:function(o){z(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",o)}}),ih=Se.extend({options:{icon:new Kl,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(o,l){E(this,l),this._latlng=xe(o)},onAdd:function(o){this._zoomAnimated=this._zoomAnimated&&o.options.markerZoomAnimation,this._zoomAnimated&&o.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(o){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&o.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(o){var l=this._latlng;return this._latlng=xe(o),this.update(),this.fire("move",{oldLatLng:l,latlng:this._latlng})},setZIndexOffset:function(o){return this.options.zIndexOffset=o,this.update()},getIcon:function(){return this.options.icon},setIcon:function(o){return this.options.icon=o,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var o=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(o)}return this},_initIcon:function(){var o=this.options,l="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),f=o.icon.createIcon(this._icon),g=!1;f!==this._icon&&(this._icon&&this._removeIcon(),g=!0,o.title&&(f.title=o.title),f.tagName==="IMG"&&(f.alt=o.alt||"")),Ce(f,l),o.keyboard&&(f.tabIndex="0",f.setAttribute("role","button")),this._icon=f,o.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ee(f,"focus",this._panOnFocus,this);var w=o.icon.createShadow(this._shadow),I=!1;w!==this._shadow&&(this._removeShadow(),I=!0),w&&(Ce(w,l),w.alt=""),this._shadow=w,o.opacity<1&&this._updateOpacity(),g&&this.getPane().appendChild(this._icon),this._initInteraction(),w&&I&&this.getPane(o.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Ke(this._icon,"focus",this._panOnFocus,this),Ze(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Ze(this._shadow),this._shadow=null},_setPos:function(o){this._icon&&ht(this._icon,o),this._shadow&&ht(this._shadow,o),this._zIndex=o.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(o){this._icon&&(this._icon.style.zIndex=this._zIndex+o)},_animateZoom:function(o){var l=this._map._latLngToNewLayerPoint(this._latlng,o.zoom,o.center).round();this._setPos(l)},_initInteraction:function(){if(this.options.interactive&&(Ce(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),gv)){var o=this.options.draggable;this.dragging&&(o=this.dragging.enabled(),this.dragging.disable()),this.dragging=new gv(this),o&&this.dragging.enable()}},setOpacity:function(o){return this.options.opacity=o,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var o=this.options.opacity;this._icon&&Pt(this._icon,o),this._shadow&&Pt(this._shadow,o)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var o=this._map;if(o){var l=this.options.icon.options,f=l.iconSize?X(l.iconSize):X(0,0),g=l.iconAnchor?X(l.iconAnchor):X(0,0);o.panInside(this._latlng,{paddingTopLeft:g,paddingBottomRight:f.subtract(g)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function rI(o,l){return new ih(o,l)}var Hi=Se.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(o){this._renderer=o.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(o){return E(this,o),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&o&&Object.prototype.hasOwnProperty.call(o,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),sh=Hi.extend({options:{fill:!0,radius:10},initialize:function(o,l){E(this,l),this._latlng=xe(o),this._radius=this.options.radius},setLatLng:function(o){var l=this._latlng;return this._latlng=xe(o),this.redraw(),this.fire("move",{oldLatLng:l,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(o){return this.options.radius=this._radius=o,this.redraw()},getRadius:function(){return this._radius},setStyle:function(o){var l=o&&o.radius||this._radius;return Hi.prototype.setStyle.call(this,o),this.setRadius(l),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var o=this._radius,l=this._radiusY||o,f=this._clickTolerance(),g=[o+f,l+f];this._pxBounds=new Y(this._point.subtract(g),this._point.add(g))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(o){return o.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function iI(o,l){return new sh(o,l)}var Zf=sh.extend({initialize:function(o,l,f){if(typeof l=="number"&&(l=i({},f,{radius:l})),E(this,l),this._latlng=xe(o),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(o){return this._mRadius=o,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var o=[this._radius,this._radiusY||this._radius];return new Ie(this._map.layerPointToLatLng(this._point.subtract(o)),this._map.layerPointToLatLng(this._point.add(o)))},setStyle:Hi.prototype.setStyle,_project:function(){var o=this._latlng.lng,l=this._latlng.lat,f=this._map,g=f.options.crs;if(g.distance===Cn.distance){var w=Math.PI/180,I=this._mRadius/Cn.R/w,O=f.project([l+I,o]),G=f.project([l-I,o]),K=O.add(G).divideBy(2),ne=f.unproject(K).lat,he=Math.acos((Math.cos(I*w)-Math.sin(l*w)*Math.sin(ne*w))/(Math.cos(l*w)*Math.cos(ne*w)))/w;(isNaN(he)||he===0)&&(he=I/Math.cos(Math.PI/180*l)),this._point=K.subtract(f.getPixelOrigin()),this._radius=isNaN(he)?0:K.x-f.project([ne,o-he]).x,this._radiusY=K.y-O.y}else{var ye=g.unproject(g.project(this._latlng).subtract([this._mRadius,0]));this._point=f.latLngToLayerPoint(this._latlng),this._radius=this._point.x-f.latLngToLayerPoint(ye).x}this._updateBounds()}});function sI(o,l,f){return new Zf(o,l,f)}var ti=Hi.extend({options:{smoothFactor:1,noClip:!1},initialize:function(o,l){E(this,l),this._setLatLngs(o)},getLatLngs:function(){return this._latlngs},setLatLngs:function(o){return this._setLatLngs(o),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(o){for(var l=1/0,f=null,g=Wi,w,I,O=0,G=this._parts.length;O<G;O++)for(var K=this._parts[O],ne=1,he=K.length;ne<he;ne++){w=K[ne-1],I=K[ne];var ye=g(o,w,I,!0);ye<l&&(l=ye,f=g(o,w,I))}return f&&(f.distance=Math.sqrt(l)),f},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return y(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(o,l){return l=l||this._defaultShape(),o=xe(o),l.push(o),this._bounds.extend(o),this.redraw()},_setLatLngs:function(o){this._bounds=new Ie,this._latlngs=this._convertLatLngs(o)},_defaultShape:function(){return Dt(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(o){for(var l=[],f=Dt(o),g=0,w=o.length;g<w;g++)f?(l[g]=xe(o[g]),this._bounds.extend(l[g])):l[g]=this._convertLatLngs(o[g]);return l},_project:function(){var o=new Y;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,o),this._bounds.isValid()&&o.isValid()&&(this._rawPxBounds=o,this._updateBounds())},_updateBounds:function(){var o=this._clickTolerance(),l=new W(o,o);this._rawPxBounds&&(this._pxBounds=new Y([this._rawPxBounds.min.subtract(l),this._rawPxBounds.max.add(l)]))},_projectLatlngs:function(o,l,f){var g=o[0]instanceof Ne,w=o.length,I,O;if(g){for(O=[],I=0;I<w;I++)O[I]=this._map.latLngToLayerPoint(o[I]),f.extend(O[I]);l.push(O)}else for(I=0;I<w;I++)this._projectLatlngs(o[I],l,f)},_clipPoints:function(){var o=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(o))){if(this.options.noClip){this._parts=this._rings;return}var l=this._parts,f,g,w,I,O,G,K;for(f=0,w=0,I=this._rings.length;f<I;f++)for(K=this._rings[f],g=0,O=K.length;g<O-1;g++)G=Wl(K[g],K[g+1],o,g,!0),G&&(l[w]=l[w]||[],l[w].push(G[0]),(G[1]!==K[g+1]||g===O-2)&&(l[w].push(G[1]),w++))}},_simplifyPoints:function(){for(var o=this._parts,l=this.options.smoothFactor,f=0,g=o.length;f<g;f++)o[f]=Js(o[f],l)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(o,l){var f,g,w,I,O,G,K=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(o))return!1;for(f=0,I=this._parts.length;f<I;f++)for(G=this._parts[f],g=0,O=G.length,w=O-1;g<O;w=g++)if(!(!l&&g===0)&&ql(o,G[w],G[g])<=K)return!0;return!1}});function oI(o,l){return new ti(o,l)}ti._flat=d;var Xo=ti.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return Jo(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(o){var l=ti.prototype._convertLatLngs.call(this,o),f=l.length;return f>=2&&l[0]instanceof Ne&&l[0].equals(l[f-1])&&l.pop(),l},_setLatLngs:function(o){ti.prototype._setLatLngs.call(this,o),Dt(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Dt(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var o=this._renderer._bounds,l=this.options.weight,f=new W(l,l);if(o=new Y(o.min.subtract(f),o.max.add(f)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(o))){if(this.options.noClip){this._parts=this._rings;return}for(var g=0,w=this._rings.length,I;g<w;g++)I=$l(this._rings[g],o,!0),I.length&&this._parts.push(I)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(o){var l=!1,f,g,w,I,O,G,K,ne;if(!this._pxBounds||!this._pxBounds.contains(o))return!1;for(I=0,K=this._parts.length;I<K;I++)for(f=this._parts[I],O=0,ne=f.length,G=ne-1;O<ne;G=O++)g=f[O],w=f[G],g.y>o.y!=w.y>o.y&&o.x<(w.x-g.x)*(o.y-g.y)/(w.y-g.y)+g.x&&(l=!l);return l||ti.prototype._containsPoint.call(this,o,!0)}});function aI(o,l){return new Xo(o,l)}var ni=nn.extend({initialize:function(o,l){E(this,l),this._layers={},o&&this.addData(o)},addData:function(o){var l=A(o)?o:o.features,f,g,w;if(l){for(f=0,g=l.length;f<g;f++)w=l[f],(w.geometries||w.geometry||w.features||w.coordinates)&&this.addData(w);return this}var I=this.options;if(I.filter&&!I.filter(o))return this;var O=oh(o,I);return O?(O.feature=ch(o),O.defaultOptions=O.options,this.resetStyle(O),I.onEachFeature&&I.onEachFeature(o,O),this.addLayer(O)):this},resetStyle:function(o){return o===void 0?this.eachLayer(this.resetStyle,this):(o.options=i({},o.defaultOptions),this._setLayerStyle(o,this.options.style),this)},setStyle:function(o){return this.eachLayer(function(l){this._setLayerStyle(l,o)},this)},_setLayerStyle:function(o,l){o.setStyle&&(typeof l=="function"&&(l=l(o.feature)),o.setStyle(l))}});function oh(o,l){var f=o.type==="Feature"?o.geometry:o,g=f?f.coordinates:null,w=[],I=l&&l.pointToLayer,O=l&&l.coordsToLatLng||Jf,G,K,ne,he;if(!g&&!f)return null;switch(f.type){case"Point":return G=O(g),_v(I,o,G,l);case"MultiPoint":for(ne=0,he=g.length;ne<he;ne++)G=O(g[ne]),w.push(_v(I,o,G,l));return new nn(w);case"LineString":case"MultiLineString":return K=ah(g,f.type==="LineString"?0:1,O),new ti(K,l);case"Polygon":case"MultiPolygon":return K=ah(g,f.type==="Polygon"?1:2,O),new Xo(K,l);case"GeometryCollection":for(ne=0,he=f.geometries.length;ne<he;ne++){var ye=oh({geometry:f.geometries[ne],type:"Feature",properties:o.properties},l);ye&&w.push(ye)}return new nn(w);case"FeatureCollection":for(ne=0,he=f.features.length;ne<he;ne++){var Ae=oh(f.features[ne],l);Ae&&w.push(Ae)}return new nn(w);default:throw new Error("Invalid GeoJSON object.")}}function _v(o,l,f,g){return o?o(l,f):new ih(f,g&&g.markersInheritOptions&&g)}function Jf(o){return new Ne(o[1],o[0],o[2])}function ah(o,l,f){for(var g=[],w=0,I=o.length,O;w<I;w++)O=l?ah(o[w],l-1,f):(f||Jf)(o[w]),g.push(O);return g}function Yf(o,l){return o=xe(o),o.alt!==void 0?[v(o.lng,l),v(o.lat,l),v(o.alt,l)]:[v(o.lng,l),v(o.lat,l)]}function lh(o,l,f,g){for(var w=[],I=0,O=o.length;I<O;I++)w.push(l?lh(o[I],Dt(o[I])?0:l-1,f,g):Yf(o[I],g));return!l&&f&&w.length>0&&w.push(w[0].slice()),w}function ea(o,l){return o.feature?i({},o.feature,{geometry:l}):ch(l)}function ch(o){return o.type==="Feature"||o.type==="FeatureCollection"?o:{type:"Feature",properties:{},geometry:o}}var Xf={toGeoJSON:function(o){return ea(this,{type:"Point",coordinates:Yf(this.getLatLng(),o)})}};ih.include(Xf),Zf.include(Xf),sh.include(Xf),ti.include({toGeoJSON:function(o){var l=!Dt(this._latlngs),f=lh(this._latlngs,l?1:0,!1,o);return ea(this,{type:(l?"Multi":"")+"LineString",coordinates:f})}}),Xo.include({toGeoJSON:function(o){var l=!Dt(this._latlngs),f=l&&!Dt(this._latlngs[0]),g=lh(this._latlngs,f?2:l?1:0,!0,o);return l||(g=[g]),ea(this,{type:(f?"Multi":"")+"Polygon",coordinates:g})}}),dt.include({toMultiPoint:function(o){var l=[];return this.eachLayer(function(f){l.push(f.toGeoJSON(o).geometry.coordinates)}),ea(this,{type:"MultiPoint",coordinates:l})},toGeoJSON:function(o){var l=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(l==="MultiPoint")return this.toMultiPoint(o);var f=l==="GeometryCollection",g=[];return this.eachLayer(function(w){if(w.toGeoJSON){var I=w.toGeoJSON(o);if(f)g.push(I.geometry);else{var O=ch(I);O.type==="FeatureCollection"?g.push.apply(g,O.features):g.push(O)}}}),f?ea(this,{geometries:g,type:"GeometryCollection"}):{type:"FeatureCollection",features:g}}});function vv(o,l){return new ni(o,l)}var lI=vv,uh=Se.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(o,l,f){this._url=o,this._bounds=Oe(l),E(this,f)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(Ce(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Ze(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(o){return this.options.opacity=o,this._image&&this._updateOpacity(),this},setStyle:function(o){return o.opacity&&this.setOpacity(o.opacity),this},bringToFront:function(){return this._map&&Kr(this._image),this},bringToBack:function(){return this._map&&Qr(this._image),this},setUrl:function(o){return this._url=o,this._image&&(this._image.src=o),this},setBounds:function(o){return this._bounds=Oe(o),this._map&&this._reset(),this},getEvents:function(){var o={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(o.zoomanim=this._animateZoom),o},setZIndex:function(o){return this.options.zIndex=o,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var o=this._url.tagName==="IMG",l=this._image=o?this._url:Fe("img");if(Ce(l,"leaflet-image-layer"),this._zoomAnimated&&Ce(l,"leaflet-zoom-animated"),this.options.className&&Ce(l,this.options.className),l.onselectstart=_,l.onmousemove=_,l.onload=a(this.fire,this,"load"),l.onerror=a(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(l.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),o){this._url=l.src;return}l.src=this._url,l.alt=this.options.alt},_animateZoom:function(o){var l=this._map.getZoomScale(o.zoom),f=this._map._latLngBoundsToNewLayerBounds(this._bounds,o.zoom,o.center).min;Fn(this._image,f,l)},_reset:function(){var o=this._image,l=new Y(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),f=l.getSize();ht(o,l.min),o.style.width=f.x+"px",o.style.height=f.y+"px"},_updateOpacity:function(){Pt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var o=this.options.errorOverlayUrl;o&&this._url!==o&&(this._url=o,this._image.src=o)},getCenter:function(){return this._bounds.getCenter()}}),cI=function(o,l,f){return new uh(o,l,f)},yv=uh.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var o=this._url.tagName==="VIDEO",l=this._image=o?this._url:Fe("video");if(Ce(l,"leaflet-image-layer"),this._zoomAnimated&&Ce(l,"leaflet-zoom-animated"),this.options.className&&Ce(l,this.options.className),l.onselectstart=_,l.onmousemove=_,l.onloadeddata=a(this.fire,this,"load"),o){for(var f=l.getElementsByTagName("source"),g=[],w=0;w<f.length;w++)g.push(f[w].src);this._url=f.length>0?g:[l.src];return}A(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(l.style,"objectFit")&&(l.style.objectFit="fill"),l.autoplay=!!this.options.autoplay,l.loop=!!this.options.loop,l.muted=!!this.options.muted,l.playsInline=!!this.options.playsInline;for(var I=0;I<this._url.length;I++){var O=Fe("source");O.src=this._url[I],l.appendChild(O)}}});function uI(o,l,f){return new yv(o,l,f)}var xv=uh.extend({_initImage:function(){var o=this._image=this._url;Ce(o,"leaflet-image-layer"),this._zoomAnimated&&Ce(o,"leaflet-zoom-animated"),this.options.className&&Ce(o,this.options.className),o.onselectstart=_,o.onmousemove=_}});function hI(o,l,f){return new xv(o,l,f)}var Cr=Se.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(o,l){o&&(o instanceof Ne||A(o))?(this._latlng=xe(o),E(this,l)):(E(this,o),this._source=l),this.options.content&&(this._content=this.options.content)},openOn:function(o){return o=arguments.length?o:this._source._map,o.hasLayer(this)||o.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(o){return this._map?this.close():(arguments.length?this._source=o:o=this._source,this._prepareOpen(),this.openOn(o._map)),this},onAdd:function(o){this._zoomAnimated=o._zoomAnimated,this._container||this._initLayout(),o._fadeAnimated&&Pt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),o._fadeAnimated&&Pt(this._container,1),this.bringToFront(),this.options.interactive&&(Ce(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(o){o._fadeAnimated?(Pt(this._container,0),this._removeTimeout=setTimeout(a(Ze,void 0,this._container),200)):Ze(this._container),this.options.interactive&&(it(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(o){return this._latlng=xe(o),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(o){return this._content=o,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var o={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(o.zoomanim=this._animateZoom),o},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Kr(this._container),this},bringToBack:function(){return this._map&&Qr(this._container),this},_prepareOpen:function(o){var l=this._source;if(!l._map)return!1;if(l instanceof nn){l=null;var f=this._source._layers;for(var g in f)if(f[g]._map){l=f[g];break}if(!l)return!1;this._source=l}if(!o)if(l.getCenter)o=l.getCenter();else if(l.getLatLng)o=l.getLatLng();else if(l.getBounds)o=l.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(o),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var o=this._contentNode,l=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof l=="string")o.innerHTML=l;else{for(;o.hasChildNodes();)o.removeChild(o.firstChild);o.appendChild(l)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var o=this._map.latLngToLayerPoint(this._latlng),l=X(this.options.offset),f=this._getAnchor();this._zoomAnimated?ht(this._container,o.add(f)):l=l.add(o).add(f);var g=this._containerBottom=-l.y,w=this._containerLeft=-Math.round(this._containerWidth/2)+l.x;this._container.style.bottom=g+"px",this._container.style.left=w+"px"}},_getAnchor:function(){return[0,0]}});ke.include({_initOverlay:function(o,l,f,g){var w=l;return w instanceof o||(w=new o(g).setContent(l)),f&&w.setLatLng(f),w}}),Se.include({_initOverlay:function(o,l,f,g){var w=f;return w instanceof o?(E(w,g),w._source=this):(w=l&&!g?l:new o(g,this),w.setContent(f)),w}});var hh=Cr.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(o){return o=arguments.length?o:this._source._map,!o.hasLayer(this)&&o._popup&&o._popup.options.autoClose&&o.removeLayer(o._popup),o._popup=this,Cr.prototype.openOn.call(this,o)},onAdd:function(o){Cr.prototype.onAdd.call(this,o),o.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Hi||this._source.on("preclick",Yr))},onRemove:function(o){Cr.prototype.onRemove.call(this,o),o.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Hi||this._source.off("preclick",Yr))},getEvents:function(){var o=Cr.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(o.preclick=this.close),this.options.keepInView&&(o.moveend=this._adjustPan),o},_initLayout:function(){var o="leaflet-popup",l=this._container=Fe("div",o+" "+(this.options.className||"")+" leaflet-zoom-animated"),f=this._wrapper=Fe("div",o+"-content-wrapper",l);if(this._contentNode=Fe("div",o+"-content",f),Sr(l),Ui(this._contentNode),Ee(l,"contextmenu",Yr),this._tipContainer=Fe("div",o+"-tip-container",l),this._tip=Fe("div",o+"-tip",this._tipContainer),this.options.closeButton){var g=this._closeButton=Fe("a",o+"-close-button",l);g.setAttribute("role","button"),g.setAttribute("aria-label","Close popup"),g.href="#close",g.innerHTML='<span aria-hidden="true">&#215;</span>',Ee(g,"click",function(w){Nt(w),this.close()},this)}},_updateLayout:function(){var o=this._contentNode,l=o.style;l.width="",l.whiteSpace="nowrap";var f=o.offsetWidth;f=Math.min(f,this.options.maxWidth),f=Math.max(f,this.options.minWidth),l.width=f+1+"px",l.whiteSpace="",l.height="";var g=o.offsetHeight,w=this.options.maxHeight,I="leaflet-popup-scrolled";w&&g>w?(l.height=w+"px",Ce(o,I)):it(o,I),this._containerWidth=this._container.offsetWidth},_animateZoom:function(o){var l=this._map._latLngToNewLayerPoint(this._latlng,o.zoom,o.center),f=this._getAnchor();ht(this._container,l.add(f))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var o=this._map,l=parseInt(zi(this._container,"marginBottom"),10)||0,f=this._container.offsetHeight+l,g=this._containerWidth,w=new W(this._containerLeft,-f-this._containerBottom);w._add($e(this._container));var I=o.layerPointToContainerPoint(w),O=X(this.options.autoPanPadding),G=X(this.options.autoPanPaddingTopLeft||O),K=X(this.options.autoPanPaddingBottomRight||O),ne=o.getSize(),he=0,ye=0;I.x+g+K.x>ne.x&&(he=I.x+g-ne.x+K.x),I.x-he-G.x<0&&(he=I.x-G.x),I.y+f+K.y>ne.y&&(ye=I.y+f-ne.y+K.y),I.y-ye-G.y<0&&(ye=I.y-G.y),(he||ye)&&(this.options.keepInView&&(this._autopanning=!0),o.fire("autopanstart").panBy([he,ye]))}},_getAnchor:function(){return X(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),dI=function(o,l){return new hh(o,l)};ke.mergeOptions({closePopupOnClick:!0}),ke.include({openPopup:function(o,l,f){return this._initOverlay(hh,o,l,f).openOn(this),this},closePopup:function(o){return o=arguments.length?o:this._popup,o&&o.close(),this}}),Se.include({bindPopup:function(o,l){return this._popup=this._initOverlay(hh,this._popup,o,l),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(o){return this._popup&&(this instanceof nn||(this._popup._source=this),this._popup._prepareOpen(o||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(o){return this._popup&&this._popup.setContent(o),this},getPopup:function(){return this._popup},_openPopup:function(o){if(!(!this._popup||!this._map)){Pn(o);var l=o.layer||o.target;if(this._popup._source===l&&!(l instanceof Hi)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(o.latlng);return}this._popup._source=l,this.openPopup(o.latlng)}},_movePopup:function(o){this._popup.setLatLng(o.latlng)},_onKeyPress:function(o){o.originalEvent.keyCode===13&&this._openPopup(o)}});var dh=Cr.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(o){Cr.prototype.onAdd.call(this,o),this.setOpacity(this.options.opacity),o.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(o){Cr.prototype.onRemove.call(this,o),o.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var o=Cr.prototype.getEvents.call(this);return this.options.permanent||(o.preclick=this.close),o},_initLayout:function(){var o="leaflet-tooltip",l=o+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Fe("div",l),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+h(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(o){var l,f,g=this._map,w=this._container,I=g.latLngToContainerPoint(g.getCenter()),O=g.layerPointToContainerPoint(o),G=this.options.direction,K=w.offsetWidth,ne=w.offsetHeight,he=X(this.options.offset),ye=this._getAnchor();G==="top"?(l=K/2,f=ne):G==="bottom"?(l=K/2,f=0):G==="center"?(l=K/2,f=ne/2):G==="right"?(l=0,f=ne/2):G==="left"?(l=K,f=ne/2):O.x<I.x?(G="right",l=0,f=ne/2):(G="left",l=K+(he.x+ye.x)*2,f=ne/2),o=o.subtract(X(l,f,!0)).add(he).add(ye),it(w,"leaflet-tooltip-right"),it(w,"leaflet-tooltip-left"),it(w,"leaflet-tooltip-top"),it(w,"leaflet-tooltip-bottom"),Ce(w,"leaflet-tooltip-"+G),ht(w,o)},_updatePosition:function(){var o=this._map.latLngToLayerPoint(this._latlng);this._setPosition(o)},setOpacity:function(o){this.options.opacity=o,this._container&&Pt(this._container,o)},_animateZoom:function(o){var l=this._map._latLngToNewLayerPoint(this._latlng,o.zoom,o.center);this._setPosition(l)},_getAnchor:function(){return X(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),fI=function(o,l){return new dh(o,l)};ke.include({openTooltip:function(o,l,f){return this._initOverlay(dh,o,l,f).openOn(this),this},closeTooltip:function(o){return o.close(),this}}),Se.include({bindTooltip:function(o,l){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(dh,this._tooltip,o,l),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(o){if(!(!o&&this._tooltipHandlersAdded)){var l=o?"off":"on",f={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?f.add=this._openTooltip:(f.mouseover=this._openTooltip,f.mouseout=this.closeTooltip,f.click=this._openTooltip,this._map?this._addFocusListeners():f.add=this._addFocusListeners),this._tooltip.options.sticky&&(f.mousemove=this._moveTooltip),this[l](f),this._tooltipHandlersAdded=!o}},openTooltip:function(o){return this._tooltip&&(this instanceof nn||(this._tooltip._source=this),this._tooltip._prepareOpen(o)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(o){return this._tooltip&&this._tooltip.setContent(o),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(o){var l=typeof o.getElement=="function"&&o.getElement();l&&(Ee(l,"focus",function(){this._tooltip._source=o,this.openTooltip()},this),Ee(l,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(o){var l=typeof o.getElement=="function"&&o.getElement();l&&l.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(o){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var l=this;this._map.once("moveend",function(){l._openOnceFlag=!1,l._openTooltip(o)});return}this._tooltip._source=o.layer||o.target,this.openTooltip(this._tooltip.options.sticky?o.latlng:void 0)}},_moveTooltip:function(o){var l=o.latlng,f,g;this._tooltip.options.sticky&&o.originalEvent&&(f=this._map.mouseEventToContainerPoint(o.originalEvent),g=this._map.containerPointToLayerPoint(f),l=this._map.layerPointToLatLng(g)),this._tooltip.setLatLng(l)}});var wv=ar.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(o){var l=o&&o.tagName==="DIV"?o:document.createElement("div"),f=this.options;if(f.html instanceof Element?(Bi(l),l.appendChild(f.html)):l.innerHTML=f.html!==!1?f.html:"",f.bgPos){var g=X(f.bgPos);l.style.backgroundPosition=-g.x+"px "+-g.y+"px"}return this._setIconStyles(l,"icon"),l},createShadow:function(){return null}});function mI(o){return new wv(o)}ar.Default=Kl;var Ql=Se.extend({options:{tileSize:256,opacity:1,updateWhenIdle:ve.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(o){E(this,o)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(o){o._addZoomLimit(this)},onRemove:function(o){this._removeAllTiles(),Ze(this._container),o._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Kr(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(Qr(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(o){return this.options.opacity=o,this._updateOpacity(),this},setZIndex:function(o){return this.options.zIndex=o,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var o=this._clampZoom(this._map.getZoom());o!==this._tileZoom&&(this._tileZoom=o,this._updateLevels()),this._update()}return this},getEvents:function(){var o={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=m(this._onMoveEnd,this.options.updateInterval,this)),o.move=this._onMove),this._zoomAnimated&&(o.zoomanim=this._animateZoom),o},createTile:function(){return document.createElement("div")},getTileSize:function(){var o=this.options.tileSize;return o instanceof W?o:new W(o,o)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(o){for(var l=this.getPane().children,f=-o(-1/0,1/0),g=0,w=l.length,I;g<w;g++)I=l[g].style.zIndex,l[g]!==this._container&&I&&(f=o(f,+I));isFinite(f)&&(this.options.zIndex=f+o(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!ve.ielt9){Pt(this._container,this.options.opacity);var o=+new Date,l=!1,f=!1;for(var g in this._tiles){var w=this._tiles[g];if(!(!w.current||!w.loaded)){var I=Math.min(1,(o-w.loaded)/200);Pt(w.el,I),I<1?l=!0:(w.active?f=!0:this._onOpaqueTile(w),w.active=!0)}}f&&!this._noPrune&&this._pruneTiles(),l&&(z(this._fadeFrame),this._fadeFrame=F(this._updateOpacity,this))}},_onOpaqueTile:_,_initContainer:function(){this._container||(this._container=Fe("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var o=this._tileZoom,l=this.options.maxZoom;if(o!==void 0){for(var f in this._levels)f=Number(f),this._levels[f].el.children.length||f===o?(this._levels[f].el.style.zIndex=l-Math.abs(o-f),this._onUpdateLevel(f)):(Ze(this._levels[f].el),this._removeTilesAtZoom(f),this._onRemoveLevel(f),delete this._levels[f]);var g=this._levels[o],w=this._map;return g||(g=this._levels[o]={},g.el=Fe("div","leaflet-tile-container leaflet-zoom-animated",this._container),g.el.style.zIndex=l,g.origin=w.project(w.unproject(w.getPixelOrigin()),o).round(),g.zoom=o,this._setZoomTransform(g,w.getCenter(),w.getZoom()),_(g.el.offsetWidth),this._onCreateLevel(g)),this._level=g,g}},_onUpdateLevel:_,_onRemoveLevel:_,_onCreateLevel:_,_pruneTiles:function(){if(this._map){var o,l,f=this._map.getZoom();if(f>this.options.maxZoom||f<this.options.minZoom){this._removeAllTiles();return}for(o in this._tiles)l=this._tiles[o],l.retain=l.current;for(o in this._tiles)if(l=this._tiles[o],l.current&&!l.active){var g=l.coords;this._retainParent(g.x,g.y,g.z,g.z-5)||this._retainChildren(g.x,g.y,g.z,g.z+2)}for(o in this._tiles)this._tiles[o].retain||this._removeTile(o)}},_removeTilesAtZoom:function(o){for(var l in this._tiles)this._tiles[l].coords.z===o&&this._removeTile(l)},_removeAllTiles:function(){for(var o in this._tiles)this._removeTile(o)},_invalidateAll:function(){for(var o in this._levels)Ze(this._levels[o].el),this._onRemoveLevel(Number(o)),delete this._levels[o];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(o,l,f,g){var w=Math.floor(o/2),I=Math.floor(l/2),O=f-1,G=new W(+w,+I);G.z=+O;var K=this._tileCoordsToKey(G),ne=this._tiles[K];return ne&&ne.active?(ne.retain=!0,!0):(ne&&ne.loaded&&(ne.retain=!0),O>g?this._retainParent(w,I,O,g):!1)},_retainChildren:function(o,l,f,g){for(var w=2*o;w<2*o+2;w++)for(var I=2*l;I<2*l+2;I++){var O=new W(w,I);O.z=f+1;var G=this._tileCoordsToKey(O),K=this._tiles[G];if(K&&K.active){K.retain=!0;continue}else K&&K.loaded&&(K.retain=!0);f+1<g&&this._retainChildren(w,I,f+1,g)}},_resetView:function(o){var l=o&&(o.pinch||o.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),l,l)},_animateZoom:function(o){this._setView(o.center,o.zoom,!0,o.noUpdate)},_clampZoom:function(o){var l=this.options;return l.minNativeZoom!==void 0&&o<l.minNativeZoom?l.minNativeZoom:l.maxNativeZoom!==void 0&&l.maxNativeZoom<o?l.maxNativeZoom:o},_setView:function(o,l,f,g){var w=Math.round(l);this.options.maxZoom!==void 0&&w>this.options.maxZoom||this.options.minZoom!==void 0&&w<this.options.minZoom?w=void 0:w=this._clampZoom(w);var I=this.options.updateWhenZooming&&w!==this._tileZoom;(!g||I)&&(this._tileZoom=w,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),w!==void 0&&this._update(o),f||this._pruneTiles(),this._noPrune=!!f),this._setZoomTransforms(o,l)},_setZoomTransforms:function(o,l){for(var f in this._levels)this._setZoomTransform(this._levels[f],o,l)},_setZoomTransform:function(o,l,f){var g=this._map.getZoomScale(f,o.zoom),w=o.origin.multiplyBy(g).subtract(this._map._getNewPixelOrigin(l,f)).round();ve.any3d?Fn(o.el,w,g):ht(o.el,w)},_resetGrid:function(){var o=this._map,l=o.options.crs,f=this._tileSize=this.getTileSize(),g=this._tileZoom,w=this._map.getPixelWorldBounds(this._tileZoom);w&&(this._globalTileRange=this._pxBoundsToTileRange(w)),this._wrapX=l.wrapLng&&!this.options.noWrap&&[Math.floor(o.project([0,l.wrapLng[0]],g).x/f.x),Math.ceil(o.project([0,l.wrapLng[1]],g).x/f.y)],this._wrapY=l.wrapLat&&!this.options.noWrap&&[Math.floor(o.project([l.wrapLat[0],0],g).y/f.x),Math.ceil(o.project([l.wrapLat[1],0],g).y/f.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(o){var l=this._map,f=l._animatingZoom?Math.max(l._animateToZoom,l.getZoom()):l.getZoom(),g=l.getZoomScale(f,this._tileZoom),w=l.project(o,this._tileZoom).floor(),I=l.getSize().divideBy(g*2);return new Y(w.subtract(I),w.add(I))},_update:function(o){var l=this._map;if(l){var f=this._clampZoom(l.getZoom());if(o===void 0&&(o=l.getCenter()),this._tileZoom!==void 0){var g=this._getTiledPixelBounds(o),w=this._pxBoundsToTileRange(g),I=w.getCenter(),O=[],G=this.options.keepBuffer,K=new Y(w.getBottomLeft().subtract([G,-G]),w.getTopRight().add([G,-G]));if(!(isFinite(w.min.x)&&isFinite(w.min.y)&&isFinite(w.max.x)&&isFinite(w.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var ne in this._tiles){var he=this._tiles[ne].coords;(he.z!==this._tileZoom||!K.contains(new W(he.x,he.y)))&&(this._tiles[ne].current=!1)}if(Math.abs(f-this._tileZoom)>1){this._setView(o,f);return}for(var ye=w.min.y;ye<=w.max.y;ye++)for(var Ae=w.min.x;Ae<=w.max.x;Ae++){var dn=new W(Ae,ye);if(dn.z=this._tileZoom,!!this._isValidTile(dn)){var zt=this._tiles[this._tileCoordsToKey(dn)];zt?zt.current=!0:O.push(dn)}}if(O.sort(function(_n,na){return _n.distanceTo(I)-na.distanceTo(I)}),O.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var $n=document.createDocumentFragment();for(Ae=0;Ae<O.length;Ae++)this._addTile(O[Ae],$n);this._level.el.appendChild($n)}}}},_isValidTile:function(o){var l=this._map.options.crs;if(!l.infinite){var f=this._globalTileRange;if(!l.wrapLng&&(o.x<f.min.x||o.x>f.max.x)||!l.wrapLat&&(o.y<f.min.y||o.y>f.max.y))return!1}if(!this.options.bounds)return!0;var g=this._tileCoordsToBounds(o);return Oe(this.options.bounds).overlaps(g)},_keyToBounds:function(o){return this._tileCoordsToBounds(this._keyToTileCoords(o))},_tileCoordsToNwSe:function(o){var l=this._map,f=this.getTileSize(),g=o.scaleBy(f),w=g.add(f),I=l.unproject(g,o.z),O=l.unproject(w,o.z);return[I,O]},_tileCoordsToBounds:function(o){var l=this._tileCoordsToNwSe(o),f=new Ie(l[0],l[1]);return this.options.noWrap||(f=this._map.wrapLatLngBounds(f)),f},_tileCoordsToKey:function(o){return o.x+":"+o.y+":"+o.z},_keyToTileCoords:function(o){var l=o.split(":"),f=new W(+l[0],+l[1]);return f.z=+l[2],f},_removeTile:function(o){var l=this._tiles[o];l&&(Ze(l.el),delete this._tiles[o],this.fire("tileunload",{tile:l.el,coords:this._keyToTileCoords(o)}))},_initTile:function(o){Ce(o,"leaflet-tile");var l=this.getTileSize();o.style.width=l.x+"px",o.style.height=l.y+"px",o.onselectstart=_,o.onmousemove=_,ve.ielt9&&this.options.opacity<1&&Pt(o,this.options.opacity)},_addTile:function(o,l){var f=this._getTilePos(o),g=this._tileCoordsToKey(o),w=this.createTile(this._wrapCoords(o),a(this._tileReady,this,o));this._initTile(w),this.createTile.length<2&&F(a(this._tileReady,this,o,null,w)),ht(w,f),this._tiles[g]={el:w,coords:o,current:!0},l.appendChild(w),this.fire("tileloadstart",{tile:w,coords:o})},_tileReady:function(o,l,f){l&&this.fire("tileerror",{error:l,tile:f,coords:o});var g=this._tileCoordsToKey(o);f=this._tiles[g],f&&(f.loaded=+new Date,this._map._fadeAnimated?(Pt(f.el,0),z(this._fadeFrame),this._fadeFrame=F(this._updateOpacity,this)):(f.active=!0,this._pruneTiles()),l||(Ce(f.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:f.el,coords:o})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),ve.ielt9||!this._map._fadeAnimated?F(this._pruneTiles,this):setTimeout(a(this._pruneTiles,this),250)))},_getTilePos:function(o){return o.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(o){var l=new W(this._wrapX?p(o.x,this._wrapX):o.x,this._wrapY?p(o.y,this._wrapY):o.y);return l.z=o.z,l},_pxBoundsToTileRange:function(o){var l=this.getTileSize();return new Y(o.min.unscaleBy(l).floor(),o.max.unscaleBy(l).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var o in this._tiles)if(!this._tiles[o].loaded)return!1;return!0}});function pI(o){return new Ql(o)}var ta=Ql.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(o,l){this._url=o,l=E(this,l),l.detectRetina&&ve.retina&&l.maxZoom>0?(l.tileSize=Math.floor(l.tileSize/2),l.zoomReverse?(l.zoomOffset--,l.minZoom=Math.min(l.maxZoom,l.minZoom+1)):(l.zoomOffset++,l.maxZoom=Math.max(l.minZoom,l.maxZoom-1)),l.minZoom=Math.max(0,l.minZoom)):l.zoomReverse?l.minZoom=Math.min(l.maxZoom,l.minZoom):l.maxZoom=Math.max(l.minZoom,l.maxZoom),typeof l.subdomains=="string"&&(l.subdomains=l.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(o,l){return this._url===o&&l===void 0&&(l=!0),this._url=o,l||this.redraw(),this},createTile:function(o,l){var f=document.createElement("img");return Ee(f,"load",a(this._tileOnLoad,this,l,f)),Ee(f,"error",a(this._tileOnError,this,l,f)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(f.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(f.referrerPolicy=this.options.referrerPolicy),f.alt="",f.src=this.getTileUrl(o),f},getTileUrl:function(o){var l={r:ve.retina?"@2x":"",s:this._getSubdomain(o),x:o.x,y:o.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var f=this._globalTileRange.max.y-o.y;this.options.tms&&(l.y=f),l["-y"]=f}return C(this._url,i(l,this.options))},_tileOnLoad:function(o,l){ve.ielt9?setTimeout(a(o,this,null,l),0):o(null,l)},_tileOnError:function(o,l,f){var g=this.options.errorTileUrl;g&&l.getAttribute("src")!==g&&(l.src=g),o(f,l)},_onTileRemove:function(o){o.tile.onload=null},_getZoomForUrl:function(){var o=this._tileZoom,l=this.options.maxZoom,f=this.options.zoomReverse,g=this.options.zoomOffset;return f&&(o=l-o),o+g},_getSubdomain:function(o){var l=Math.abs(o.x+o.y)%this.options.subdomains.length;return this.options.subdomains[l]},_abortLoading:function(){var o,l;for(o in this._tiles)if(this._tiles[o].coords.z!==this._tileZoom&&(l=this._tiles[o].el,l.onload=_,l.onerror=_,!l.complete)){l.src=Z;var f=this._tiles[o].coords;Ze(l),delete this._tiles[o],this.fire("tileabort",{tile:l,coords:f})}},_removeTile:function(o){var l=this._tiles[o];if(l)return l.el.setAttribute("src",Z),Ql.prototype._removeTile.call(this,o)},_tileReady:function(o,l,f){if(!(!this._map||f&&f.getAttribute("src")===Z))return Ql.prototype._tileReady.call(this,o,l,f)}});function bv(o,l){return new ta(o,l)}var Ev=ta.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(o,l){this._url=o;var f=i({},this.defaultWmsParams);for(var g in l)g in this.options||(f[g]=l[g]);l=E(this,l);var w=l.detectRetina&&ve.retina?2:1,I=this.getTileSize();f.width=I.x*w,f.height=I.y*w,this.wmsParams=f},onAdd:function(o){this._crs=this.options.crs||o.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var l=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[l]=this._crs.code,ta.prototype.onAdd.call(this,o)},getTileUrl:function(o){var l=this._tileCoordsToNwSe(o),f=this._crs,g=ce(f.project(l[0]),f.project(l[1])),w=g.min,I=g.max,O=(this._wmsVersion>=1.3&&this._crs===Ge?[w.y,w.x,I.y,I.x]:[w.x,w.y,I.x,I.y]).join(","),G=ta.prototype.getTileUrl.call(this,o);return G+R(this.wmsParams,G,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+O},setParams:function(o,l){return i(this.wmsParams,o),l||this.redraw(),this}});function gI(o,l){return new Ev(o,l)}ta.WMS=Ev,bv.wms=gI;var ri=Se.extend({options:{padding:.1},initialize:function(o){E(this,o),h(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),Ce(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var o={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(o.zoomanim=this._onAnimZoom),o},_onAnimZoom:function(o){this._updateTransform(o.center,o.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(o,l){var f=this._map.getZoomScale(l,this._zoom),g=this._map.getSize().multiplyBy(.5+this.options.padding),w=this._map.project(this._center,l),I=g.multiplyBy(-f).add(w).subtract(this._map._getNewPixelOrigin(o,l));ve.any3d?Fn(this._container,I,f):ht(this._container,I)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var o in this._layers)this._layers[o]._reset()},_onZoomEnd:function(){for(var o in this._layers)this._layers[o]._project()},_updatePaths:function(){for(var o in this._layers)this._layers[o]._update()},_update:function(){var o=this.options.padding,l=this._map.getSize(),f=this._map.containerPointToLayerPoint(l.multiplyBy(-o)).round();this._bounds=new Y(f,f.add(l.multiplyBy(1+o*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Tv=ri.extend({options:{tolerance:0},getEvents:function(){var o=ri.prototype.getEvents.call(this);return o.viewprereset=this._onViewPreReset,o},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){ri.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var o=this._container=document.createElement("canvas");Ee(o,"mousemove",this._onMouseMove,this),Ee(o,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Ee(o,"mouseout",this._handleMouseOut,this),o._leaflet_disable_events=!0,this._ctx=o.getContext("2d")},_destroyContainer:function(){z(this._redrawRequest),delete this._ctx,Ze(this._container),Ke(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var o;this._redrawBounds=null;for(var l in this._layers)o=this._layers[l],o._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ri.prototype._update.call(this);var o=this._bounds,l=this._container,f=o.getSize(),g=ve.retina?2:1;ht(l,o.min),l.width=g*f.x,l.height=g*f.y,l.style.width=f.x+"px",l.style.height=f.y+"px",ve.retina&&this._ctx.scale(2,2),this._ctx.translate(-o.min.x,-o.min.y),this.fire("update")}},_reset:function(){ri.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(o){this._updateDashArray(o),this._layers[h(o)]=o;var l=o._order={layer:o,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=l),this._drawLast=l,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(o){this._requestRedraw(o)},_removePath:function(o){var l=o._order,f=l.next,g=l.prev;f?f.prev=g:this._drawLast=g,g?g.next=f:this._drawFirst=f,delete o._order,delete this._layers[h(o)],this._requestRedraw(o)},_updatePath:function(o){this._extendRedrawBounds(o),o._project(),o._update(),this._requestRedraw(o)},_updateStyle:function(o){this._updateDashArray(o),this._requestRedraw(o)},_updateDashArray:function(o){if(typeof o.options.dashArray=="string"){var l=o.options.dashArray.split(/[, ]+/),f=[],g,w;for(w=0;w<l.length;w++){if(g=Number(l[w]),isNaN(g))return;f.push(g)}o.options._dashArray=f}else o.options._dashArray=o.options.dashArray},_requestRedraw:function(o){this._map&&(this._extendRedrawBounds(o),this._redrawRequest=this._redrawRequest||F(this._redraw,this))},_extendRedrawBounds:function(o){if(o._pxBounds){var l=(o.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new Y,this._redrawBounds.extend(o._pxBounds.min.subtract([l,l])),this._redrawBounds.extend(o._pxBounds.max.add([l,l]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var o=this._redrawBounds;if(o){var l=o.getSize();this._ctx.clearRect(o.min.x,o.min.y,l.x,l.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var o,l=this._redrawBounds;if(this._ctx.save(),l){var f=l.getSize();this._ctx.beginPath(),this._ctx.rect(l.min.x,l.min.y,f.x,f.y),this._ctx.clip()}this._drawing=!0;for(var g=this._drawFirst;g;g=g.next)o=g.layer,(!l||o._pxBounds&&o._pxBounds.intersects(l))&&o._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(o,l){if(this._drawing){var f,g,w,I,O=o._parts,G=O.length,K=this._ctx;if(G){for(K.beginPath(),f=0;f<G;f++){for(g=0,w=O[f].length;g<w;g++)I=O[f][g],K[g?"lineTo":"moveTo"](I.x,I.y);l&&K.closePath()}this._fillStroke(K,o)}}},_updateCircle:function(o){if(!(!this._drawing||o._empty())){var l=o._point,f=this._ctx,g=Math.max(Math.round(o._radius),1),w=(Math.max(Math.round(o._radiusY),1)||g)/g;w!==1&&(f.save(),f.scale(1,w)),f.beginPath(),f.arc(l.x,l.y/w,g,0,Math.PI*2,!1),w!==1&&f.restore(),this._fillStroke(f,o)}},_fillStroke:function(o,l){var f=l.options;f.fill&&(o.globalAlpha=f.fillOpacity,o.fillStyle=f.fillColor||f.color,o.fill(f.fillRule||"evenodd")),f.stroke&&f.weight!==0&&(o.setLineDash&&o.setLineDash(l.options&&l.options._dashArray||[]),o.globalAlpha=f.opacity,o.lineWidth=f.weight,o.strokeStyle=f.color,o.lineCap=f.lineCap,o.lineJoin=f.lineJoin,o.stroke())},_onClick:function(o){for(var l=this._map.mouseEventToLayerPoint(o),f,g,w=this._drawFirst;w;w=w.next)f=w.layer,f.options.interactive&&f._containsPoint(l)&&(!(o.type==="click"||o.type==="preclick")||!this._map._draggableMoved(f))&&(g=f);this._fireEvent(g?[g]:!1,o)},_onMouseMove:function(o){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var l=this._map.mouseEventToLayerPoint(o);this._handleMouseHover(o,l)}},_handleMouseOut:function(o){var l=this._hoveredLayer;l&&(it(this._container,"leaflet-interactive"),this._fireEvent([l],o,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(o,l){if(!this._mouseHoverThrottled){for(var f,g,w=this._drawFirst;w;w=w.next)f=w.layer,f.options.interactive&&f._containsPoint(l)&&(g=f);g!==this._hoveredLayer&&(this._handleMouseOut(o),g&&(Ce(this._container,"leaflet-interactive"),this._fireEvent([g],o,"mouseover"),this._hoveredLayer=g)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,o),this._mouseHoverThrottled=!0,setTimeout(a(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(o,l,f){this._map._fireDOMEvent(l,f||l.type,o)},_bringToFront:function(o){var l=o._order;if(l){var f=l.next,g=l.prev;if(f)f.prev=g;else return;g?g.next=f:f&&(this._drawFirst=f),l.prev=this._drawLast,this._drawLast.next=l,l.next=null,this._drawLast=l,this._requestRedraw(o)}},_bringToBack:function(o){var l=o._order;if(l){var f=l.next,g=l.prev;if(g)g.next=f;else return;f?f.prev=g:g&&(this._drawLast=g),l.prev=null,l.next=this._drawFirst,this._drawFirst.prev=l,this._drawFirst=l,this._requestRedraw(o)}}});function Iv(o){return ve.canvas?new Tv(o):null}var Zl=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(o){return document.createElement("<lvml:"+o+' class="lvml">')}}catch{}return function(o){return document.createElement("<"+o+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),_I={_initContainer:function(){this._container=Fe("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(ri.prototype._update.call(this),this.fire("update"))},_initPath:function(o){var l=o._container=Zl("shape");Ce(l,"leaflet-vml-shape "+(this.options.className||"")),l.coordsize="1 1",o._path=Zl("path"),l.appendChild(o._path),this._updateStyle(o),this._layers[h(o)]=o},_addPath:function(o){var l=o._container;this._container.appendChild(l),o.options.interactive&&o.addInteractiveTarget(l)},_removePath:function(o){var l=o._container;Ze(l),o.removeInteractiveTarget(l),delete this._layers[h(o)]},_updateStyle:function(o){var l=o._stroke,f=o._fill,g=o.options,w=o._container;w.stroked=!!g.stroke,w.filled=!!g.fill,g.stroke?(l||(l=o._stroke=Zl("stroke")),w.appendChild(l),l.weight=g.weight+"px",l.color=g.color,l.opacity=g.opacity,g.dashArray?l.dashStyle=A(g.dashArray)?g.dashArray.join(" "):g.dashArray.replace(/( *, *)/g," "):l.dashStyle="",l.endcap=g.lineCap.replace("butt","flat"),l.joinstyle=g.lineJoin):l&&(w.removeChild(l),o._stroke=null),g.fill?(f||(f=o._fill=Zl("fill")),w.appendChild(f),f.color=g.fillColor||g.color,f.opacity=g.fillOpacity):f&&(w.removeChild(f),o._fill=null)},_updateCircle:function(o){var l=o._point.round(),f=Math.round(o._radius),g=Math.round(o._radiusY||f);this._setPath(o,o._empty()?"M0 0":"AL "+l.x+","+l.y+" "+f+","+g+" 0,"+65535*360)},_setPath:function(o,l){o._path.v=l},_bringToFront:function(o){Kr(o._container)},_bringToBack:function(o){Qr(o._container)}},fh=ve.vml?Zl:zr,Jl=ri.extend({_initContainer:function(){this._container=fh("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=fh("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Ze(this._container),Ke(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){ri.prototype._update.call(this);var o=this._bounds,l=o.getSize(),f=this._container;(!this._svgSize||!this._svgSize.equals(l))&&(this._svgSize=l,f.setAttribute("width",l.x),f.setAttribute("height",l.y)),ht(f,o.min),f.setAttribute("viewBox",[o.min.x,o.min.y,l.x,l.y].join(" ")),this.fire("update")}},_initPath:function(o){var l=o._path=fh("path");o.options.className&&Ce(l,o.options.className),o.options.interactive&&Ce(l,"leaflet-interactive"),this._updateStyle(o),this._layers[h(o)]=o},_addPath:function(o){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(o._path),o.addInteractiveTarget(o._path)},_removePath:function(o){Ze(o._path),o.removeInteractiveTarget(o._path),delete this._layers[h(o)]},_updatePath:function(o){o._project(),o._update()},_updateStyle:function(o){var l=o._path,f=o.options;l&&(f.stroke?(l.setAttribute("stroke",f.color),l.setAttribute("stroke-opacity",f.opacity),l.setAttribute("stroke-width",f.weight),l.setAttribute("stroke-linecap",f.lineCap),l.setAttribute("stroke-linejoin",f.lineJoin),f.dashArray?l.setAttribute("stroke-dasharray",f.dashArray):l.removeAttribute("stroke-dasharray"),f.dashOffset?l.setAttribute("stroke-dashoffset",f.dashOffset):l.removeAttribute("stroke-dashoffset")):l.setAttribute("stroke","none"),f.fill?(l.setAttribute("fill",f.fillColor||f.color),l.setAttribute("fill-opacity",f.fillOpacity),l.setAttribute("fill-rule",f.fillRule||"evenodd")):l.setAttribute("fill","none"))},_updatePoly:function(o,l){this._setPath(o,Ii(o._parts,l))},_updateCircle:function(o){var l=o._point,f=Math.max(Math.round(o._radius),1),g=Math.max(Math.round(o._radiusY),1)||f,w="a"+f+","+g+" 0 1,0 ",I=o._empty()?"M0 0":"M"+(l.x-f)+","+l.y+w+f*2+",0 "+w+-f*2+",0 ";this._setPath(o,I)},_setPath:function(o,l){o._path.setAttribute("d",l)},_bringToFront:function(o){Kr(o._path)},_bringToBack:function(o){Qr(o._path)}});ve.vml&&Jl.include(_I);function Sv(o){return ve.svg||ve.vml?new Jl(o):null}ke.include({getRenderer:function(o){var l=o.options.renderer||this._getPaneRenderer(o.options.pane)||this.options.renderer||this._renderer;return l||(l=this._renderer=this._createRenderer()),this.hasLayer(l)||this.addLayer(l),l},_getPaneRenderer:function(o){if(o==="overlayPane"||o===void 0)return!1;var l=this._paneRenderers[o];return l===void 0&&(l=this._createRenderer({pane:o}),this._paneRenderers[o]=l),l},_createRenderer:function(o){return this.options.preferCanvas&&Iv(o)||Sv(o)}});var Cv=Xo.extend({initialize:function(o,l){Xo.prototype.initialize.call(this,this._boundsToLatLngs(o),l)},setBounds:function(o){return this.setLatLngs(this._boundsToLatLngs(o))},_boundsToLatLngs:function(o){return o=Oe(o),[o.getSouthWest(),o.getNorthWest(),o.getNorthEast(),o.getSouthEast()]}});function vI(o,l){return new Cv(o,l)}Jl.create=fh,Jl.pointsToPath=Ii,ni.geometryToLayer=oh,ni.coordsToLatLng=Jf,ni.coordsToLatLngs=ah,ni.latLngToCoords=Yf,ni.latLngsToCoords=lh,ni.getFeature=ea,ni.asFeature=ch,ke.mergeOptions({boxZoom:!0});var Pv=Un.extend({initialize:function(o){this._map=o,this._container=o._container,this._pane=o._panes.overlayPane,this._resetStateTimeout=0,o.on("unload",this._destroy,this)},addHooks:function(){Ee(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){Ke(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Ze(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(o){if(!o.shiftKey||o.which!==1&&o.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Tr(),Go(),this._startPoint=this._map.mouseEventToContainerPoint(o),Ee(document,{contextmenu:Pn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(o){this._moved||(this._moved=!0,this._box=Fe("div","leaflet-zoom-box",this._container),Ce(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(o);var l=new Y(this._point,this._startPoint),f=l.getSize();ht(this._box,l.min),this._box.style.width=f.x+"px",this._box.style.height=f.y+"px"},_finish:function(){this._moved&&(Ze(this._box),it(this._container,"leaflet-crosshair")),ir(),kl(),Ke(document,{contextmenu:Pn,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(o){if(!(o.which!==1&&o.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(a(this._resetState,this),0);var l=new Ie(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(l).fire("boxzoomend",{boxZoomBounds:l})}},_onKeyDown:function(o){o.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});ke.addInitHook("addHandler","boxZoom",Pv),ke.mergeOptions({doubleClickZoom:!0});var Nv=Un.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(o){var l=this._map,f=l.getZoom(),g=l.options.zoomDelta,w=o.originalEvent.shiftKey?f-g:f+g;l.options.doubleClickZoom==="center"?l.setZoom(w):l.setZoomAround(o.containerPoint,w)}});ke.addInitHook("addHandler","doubleClickZoom",Nv),ke.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Av=Un.extend({addHooks:function(){if(!this._draggable){var o=this._map;this._draggable=new or(o._mapPane,o._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),o.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),o.on("zoomend",this._onZoomEnd,this),o.whenReady(this._onZoomEnd,this))}Ce(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){it(this._map._container,"leaflet-grab"),it(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var o=this._map;if(o._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var l=Oe(this._map.options.maxBounds);this._offsetLimit=ce(this._map.latLngToContainerPoint(l.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(l.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;o.fire("movestart").fire("dragstart"),o.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(o){if(this._map.options.inertia){var l=this._lastTime=+new Date,f=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(f),this._times.push(l),this._prunePositions(l)}this._map.fire("move",o).fire("drag",o)},_prunePositions:function(o){for(;this._positions.length>1&&o-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var o=this._map.getSize().divideBy(2),l=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=l.subtract(o).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(o,l){return o-(o-l)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var o=this._draggable._newPos.subtract(this._draggable._startPos),l=this._offsetLimit;o.x<l.min.x&&(o.x=this._viscousLimit(o.x,l.min.x)),o.y<l.min.y&&(o.y=this._viscousLimit(o.y,l.min.y)),o.x>l.max.x&&(o.x=this._viscousLimit(o.x,l.max.x)),o.y>l.max.y&&(o.y=this._viscousLimit(o.y,l.max.y)),this._draggable._newPos=this._draggable._startPos.add(o)}},_onPreDragWrap:function(){var o=this._worldWidth,l=Math.round(o/2),f=this._initialWorldOffset,g=this._draggable._newPos.x,w=(g-l+f)%o+l-f,I=(g+l+f)%o-l-f,O=Math.abs(w+f)<Math.abs(I+f)?w:I;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=O},_onDragEnd:function(o){var l=this._map,f=l.options,g=!f.inertia||o.noInertia||this._times.length<2;if(l.fire("dragend",o),g)l.fire("moveend");else{this._prunePositions(+new Date);var w=this._lastPos.subtract(this._positions[0]),I=(this._lastTime-this._times[0])/1e3,O=f.easeLinearity,G=w.multiplyBy(O/I),K=G.distanceTo([0,0]),ne=Math.min(f.inertiaMaxSpeed,K),he=G.multiplyBy(ne/K),ye=ne/(f.inertiaDeceleration*O),Ae=he.multiplyBy(-ye/2).round();!Ae.x&&!Ae.y?l.fire("moveend"):(Ae=l._limitOffset(Ae,l.options.maxBounds),F(function(){l.panBy(Ae,{duration:ye,easeLinearity:O,noMoveStart:!0,animate:!0})}))}}});ke.addInitHook("addHandler","dragging",Av),ke.mergeOptions({keyboard:!0,keyboardPanDelta:80});var kv=Un.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(o){this._map=o,this._setPanDelta(o.options.keyboardPanDelta),this._setZoomDelta(o.options.zoomDelta)},addHooks:function(){var o=this._map._container;o.tabIndex<=0&&(o.tabIndex="0"),Ee(o,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),Ke(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var o=document.body,l=document.documentElement,f=o.scrollTop||l.scrollTop,g=o.scrollLeft||l.scrollLeft;this._map._container.focus(),window.scrollTo(g,f)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(o){var l=this._panKeys={},f=this.keyCodes,g,w;for(g=0,w=f.left.length;g<w;g++)l[f.left[g]]=[-1*o,0];for(g=0,w=f.right.length;g<w;g++)l[f.right[g]]=[o,0];for(g=0,w=f.down.length;g<w;g++)l[f.down[g]]=[0,o];for(g=0,w=f.up.length;g<w;g++)l[f.up[g]]=[0,-1*o]},_setZoomDelta:function(o){var l=this._zoomKeys={},f=this.keyCodes,g,w;for(g=0,w=f.zoomIn.length;g<w;g++)l[f.zoomIn[g]]=o;for(g=0,w=f.zoomOut.length;g<w;g++)l[f.zoomOut[g]]=-o},_addHooks:function(){Ee(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){Ke(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(o){if(!(o.altKey||o.ctrlKey||o.metaKey)){var l=o.keyCode,f=this._map,g;if(l in this._panKeys){if(!f._panAnim||!f._panAnim._inProgress)if(g=this._panKeys[l],o.shiftKey&&(g=X(g).multiplyBy(3)),f.options.maxBounds&&(g=f._limitOffset(X(g),f.options.maxBounds)),f.options.worldCopyJump){var w=f.wrapLatLng(f.unproject(f.project(f.getCenter()).add(g)));f.panTo(w)}else f.panBy(g)}else if(l in this._zoomKeys)f.setZoom(f.getZoom()+(o.shiftKey?3:1)*this._zoomKeys[l]);else if(l===27&&f._popup&&f._popup.options.closeOnEscapeKey)f.closePopup();else return;Pn(o)}}});ke.addInitHook("addHandler","keyboard",kv),ke.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Rv=Un.extend({addHooks:function(){Ee(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){Ke(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(o){var l=et(o),f=this._map.options.wheelDebounceTime;this._delta+=l,this._lastMousePos=this._map.mouseEventToContainerPoint(o),this._startTime||(this._startTime=+new Date);var g=Math.max(f-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(a(this._performZoom,this),g),Pn(o)},_performZoom:function(){var o=this._map,l=o.getZoom(),f=this._map.options.zoomSnap||0;o._stop();var g=this._delta/(this._map.options.wheelPxPerZoomLevel*4),w=4*Math.log(2/(1+Math.exp(-Math.abs(g))))/Math.LN2,I=f?Math.ceil(w/f)*f:w,O=o._limitZoom(l+(this._delta>0?I:-I))-l;this._delta=0,this._startTime=null,O&&(o.options.scrollWheelZoom==="center"?o.setZoom(l+O):o.setZoomAround(this._lastMousePos,l+O))}});ke.addInitHook("addHandler","scrollWheelZoom",Rv);var yI=600;ke.mergeOptions({tapHold:ve.touchNative&&ve.safari&&ve.mobile,tapTolerance:15});var jv=Un.extend({addHooks:function(){Ee(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){Ke(this._map._container,"touchstart",this._onDown,this)},_onDown:function(o){if(clearTimeout(this._holdTimeout),o.touches.length===1){var l=o.touches[0];this._startPos=this._newPos=new W(l.clientX,l.clientY),this._holdTimeout=setTimeout(a(function(){this._cancel(),this._isTapValid()&&(Ee(document,"touchend",Nt),Ee(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",l))},this),yI),Ee(document,"touchend touchcancel contextmenu",this._cancel,this),Ee(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function o(){Ke(document,"touchend",Nt),Ke(document,"touchend touchcancel",o)},_cancel:function(){clearTimeout(this._holdTimeout),Ke(document,"touchend touchcancel contextmenu",this._cancel,this),Ke(document,"touchmove",this._onMove,this)},_onMove:function(o){var l=o.touches[0];this._newPos=new W(l.clientX,l.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(o,l){var f=new MouseEvent(o,{bubbles:!0,cancelable:!0,view:window,screenX:l.screenX,screenY:l.screenY,clientX:l.clientX,clientY:l.clientY});f._simulated=!0,l.target.dispatchEvent(f)}});ke.addInitHook("addHandler","tapHold",jv),ke.mergeOptions({touchZoom:ve.touch,bounceAtZoomLimits:!0});var Dv=Un.extend({addHooks:function(){Ce(this._map._container,"leaflet-touch-zoom"),Ee(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){it(this._map._container,"leaflet-touch-zoom"),Ke(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(o){var l=this._map;if(!(!o.touches||o.touches.length!==2||l._animatingZoom||this._zooming)){var f=l.mouseEventToContainerPoint(o.touches[0]),g=l.mouseEventToContainerPoint(o.touches[1]);this._centerPoint=l.getSize()._divideBy(2),this._startLatLng=l.containerPointToLatLng(this._centerPoint),l.options.touchZoom!=="center"&&(this._pinchStartLatLng=l.containerPointToLatLng(f.add(g)._divideBy(2))),this._startDist=f.distanceTo(g),this._startZoom=l.getZoom(),this._moved=!1,this._zooming=!0,l._stop(),Ee(document,"touchmove",this._onTouchMove,this),Ee(document,"touchend touchcancel",this._onTouchEnd,this),Nt(o)}},_onTouchMove:function(o){if(!(!o.touches||o.touches.length!==2||!this._zooming)){var l=this._map,f=l.mouseEventToContainerPoint(o.touches[0]),g=l.mouseEventToContainerPoint(o.touches[1]),w=f.distanceTo(g)/this._startDist;if(this._zoom=l.getScaleZoom(w,this._startZoom),!l.options.bounceAtZoomLimits&&(this._zoom<l.getMinZoom()&&w<1||this._zoom>l.getMaxZoom()&&w>1)&&(this._zoom=l._limitZoom(this._zoom)),l.options.touchZoom==="center"){if(this._center=this._startLatLng,w===1)return}else{var I=f._add(g)._divideBy(2)._subtract(this._centerPoint);if(w===1&&I.x===0&&I.y===0)return;this._center=l.unproject(l.project(this._pinchStartLatLng,this._zoom).subtract(I),this._zoom)}this._moved||(l._moveStart(!0,!1),this._moved=!0),z(this._animRequest);var O=a(l._move,l,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=F(O,this,!0),Nt(o)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,z(this._animRequest),Ke(document,"touchmove",this._onTouchMove,this),Ke(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});ke.addInitHook("addHandler","touchZoom",Dv),ke.BoxZoom=Pv,ke.DoubleClickZoom=Nv,ke.Drag=Av,ke.Keyboard=kv,ke.ScrollWheelZoom=Rv,ke.TapHold=jv,ke.TouchZoom=Dv,n.Bounds=Y,n.Browser=ve,n.CRS=ut,n.Canvas=Tv,n.Circle=Zf,n.CircleMarker=sh,n.Class=me,n.Control=tn,n.DivIcon=wv,n.DivOverlay=Cr,n.DomEvent=Qf,n.DomUtil=Qu,n.Draggable=or,n.Evented=se,n.FeatureGroup=nn,n.GeoJSON=ni,n.GridLayer=Ql,n.Handler=Un,n.Icon=ar,n.ImageOverlay=uh,n.LatLng=Ne,n.LatLngBounds=Ie,n.Layer=Se,n.LayerGroup=dt,n.LineUtil=b,n.Map=ke,n.Marker=ih,n.Mixin=Xu,n.Path=Hi,n.Point=W,n.PolyUtil=eh,n.Polygon=Xo,n.Polyline=ti,n.Popup=hh,n.PosAnimation=Fl,n.Projection=Q,n.Rectangle=Cv,n.Renderer=ri,n.SVG=Jl,n.SVGOverlay=xv,n.TileLayer=ta,n.Tooltip=dh,n.Transformation=Xn,n.Util=j,n.VideoOverlay=yv,n.bind=a,n.bounds=ce,n.canvas=Iv,n.circle=sI,n.circleMarker=iI,n.control=qi,n.divIcon=mI,n.extend=i,n.featureGroup=Nn,n.geoJSON=vv,n.geoJson=lI,n.gridLayer=pI,n.icon=Hl,n.imageOverlay=cI,n.latLng=xe,n.latLngBounds=Oe,n.layerGroup=Ft,n.map=Ju,n.marker=rI,n.point=X,n.polygon=aI,n.polyline=oI,n.popup=dI,n.rectangle=vI,n.setOptions=E,n.stamp=h,n.svg=Sv,n.svgOverlay=hI,n.tileLayer=bv,n.tooltip=fI,n.transformation=Vn,n.version=r,n.videoOverlay=uI;var xI=window.L;n.noConflict=function(){return window.L=xI,this},window.L=n})})(Bp,Bp.exports);var ml=Bp.exports;function wf(t,e,n){return Object.freeze({instance:t,context:e,container:n})}function bf(t,e){return e==null?function(r,i){const s=B.useRef();return s.current||(s.current=t(r,i)),s}:function(r,i){const s=B.useRef();s.current||(s.current=t(r,i));const a=B.useRef(r),{instance:u}=s.current;return B.useEffect(function(){a.current!==r&&(e(u,r,a.current),a.current=r)},[u,r,i]),s}}function _b(t,e){B.useEffect(function(){return(e.layerContainer??e.map).addLayer(t.instance),function(){var s;(s=e.layerContainer)==null||s.removeLayer(t.instance),e.map.removeLayer(t.instance)}},[e,t])}function vb(t){return function(n){const r=yf(),i=t(xf(n,r),r);return db(r.map,n.attribution),f_(i.current,n.eventHandlers),_b(i.current,r),i}}function sA(t,e){const n=B.useRef();B.useEffect(function(){if(e.pathOptions!==n.current){const i=e.pathOptions??{};t.instance.setStyle(i),n.current=i}},[t,e])}function oA(t){return function(n){const r=yf(),i=t(xf(n,r),r);return f_(i.current,n.eventHandlers),_b(i.current,r),sA(i.current,n),i}}function aA(t,e){const n=bf(t,e),r=vb(n);return gb(r)}function lA(t,e){const n=bf(t),r=iA(n,e);return nA(r)}function cA(t,e){const n=bf(t,e),r=oA(n);return gb(r)}function uA(t,e){const n=bf(t,e),r=vb(n);return rA(r)}function hA(t,e,n){const{opacity:r,zIndex:i}=e;r!=null&&r!==n.opacity&&t.setOpacity(r),i!=null&&i!==n.zIndex&&t.setZIndex(i)}function yb(){return yf().map}function Up(){return Up=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},Up.apply(this,arguments)}function dA({bounds:t,boundsOptions:e,center:n,children:r,className:i,id:s,placeholder:a,style:u,whenReady:h,zoom:m,...p},_){const[v]=B.useState({className:i,id:s,style:u}),[x,T]=B.useState(null);B.useImperativeHandle(_,()=>(x==null?void 0:x.map)??null,[x]);const E=B.useCallback(S=>{if(S!==null&&x===null){const C=new ml.Map(S,p);n!=null&&m!=null?C.setView(n,m):t!=null&&C.fitBounds(t,e),h!=null&&C.whenReady(h),T(tA(C))}},[]);B.useEffect(()=>()=>{x==null||x.map.remove()},[x]);const R=x?ys.createElement(pb,{value:x},r):a??null;return ys.createElement("div",Up({},v,{ref:E}),R)}const fA=B.forwardRef(dA),oc=aA(function({position:e,...n},r){const i=new ml.Marker(e,n);return wf(i,fb(r,{overlayContainer:i}))},function(e,n,r){n.position!==r.position&&e.setLatLng(n.position),n.icon!=null&&n.icon!==r.icon&&e.setIcon(n.icon),n.zIndexOffset!=null&&n.zIndexOffset!==r.zIndexOffset&&e.setZIndexOffset(n.zIndexOffset),n.opacity!=null&&n.opacity!==r.opacity&&e.setOpacity(n.opacity),e.dragging!=null&&n.draggable!==r.draggable&&(n.draggable===!0?e.dragging.enable():e.dragging.disable())}),mA=cA(function({positions:e,...n},r){const i=new ml.Polyline(e,n);return wf(i,fb(r,{overlayContainer:i}))},function(e,n,r){n.positions!==r.positions&&e.setLatLngs(n.positions)}),ac=lA(function(e,n){const r=new ml.Popup(e,n.overlayContainer);return wf(r,n)},function(e,n,{position:r},i){B.useEffect(function(){const{instance:a}=e;function u(m){m.popup===a&&(a.update(),i(!0))}function h(m){m.popup===a&&i(!1)}return n.map.on({popupopen:u,popupclose:h}),n.overlayContainer==null?(r!=null&&a.setLatLng(r),a.openOn(n.map)):n.overlayContainer.bindPopup(a),function(){var p;n.map.off({popupopen:u,popupclose:h}),(p=n.overlayContainer)==null||p.unbindPopup(),n.map.removeLayer(a)}},[e,n,i,r])}),pA=uA(function({url:e,...n},r){const i=new ml.TileLayer(e,xf(n,r));return wf(i,r)},function(e,n,r){hA(e,n,r);const{url:i}=n;i!=null&&i!==r.url&&e.setUrl(i)});const ru=t=>new ml.Icon({iconUrl:`data:image/svg+xml;base64,${btoa(`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="${t}">
      <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z"/>
      <circle cx="12" cy="9" r="3" fill="white"/>
    </svg>
  `)}`,iconSize:[30,40],iconAnchor:[15,40],popupAnchor:[0,-40]}),gA=ru("#DC2626"),_A=ru("#2563EB"),vA=ru("#10B981"),yA=({center:t})=>{const e=yb();return B.useEffect(()=>{e.setView(t,e.getZoom())},[t,e]),null},xA=({isFullscreen:t=!1})=>{const e=yb();return B.useEffect(()=>{const n=setTimeout(()=>{e.invalidateSize()},100);return()=>clearTimeout(n)},[e,t]),null},wA=({sceneLocation:t,hospitalLocation:e,currentLocation:n,selectedRoute:r,selectedHospital:i,showFullscreenButton:s=!0,className:a=""})=>{const u=[35.6762,139.6503],[h,m]=B.useState(u),[p,_]=B.useState(!1);B.useEffect(()=>{t?m([t.latitude,t.longitude]):e?m([e.latitude,e.longitude]):n&&m([n.latitude,n.longitude])},[t,e,n]),B.useEffect(()=>{if(p){const x=setTimeout(()=>{},200);return()=>clearTimeout(x)}},[p]);const v=(x=!1)=>{var T;return c.jsxs("div",{className:`h-full w-full relative ${x?"":a}`,children:[c.jsxs(fA,{center:h,zoom:x?15:13,className:`h-full w-full ${x?"":"rounded-lg"}`,style:{minHeight:x?"100vh":"300px"},children:[c.jsx(pA,{attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),c.jsx(yA,{center:h}),c.jsx(xA,{isFullscreen:x}),t&&c.jsx(oc,{position:[t.latitude,t.longitude],icon:gA,children:c.jsx(ac,{children:c.jsxs("div",{className:"text-sm",children:[c.jsx("strong",{children:"現場"}),c.jsx("br",{}),"緯度: ",t.latitude.toFixed(6),c.jsx("br",{}),"経度: ",t.longitude.toFixed(6)]})})}),(e||i)&&c.jsx(oc,{position:[(i==null?void 0:i.latitude)||e.latitude,(i==null?void 0:i.longitude)||e.longitude],icon:_A,children:c.jsx(ac,{children:c.jsxs("div",{className:"text-sm",children:[c.jsx("strong",{children:(i==null?void 0:i.name)||"搬送先病院"}),c.jsx("br",{}),i&&c.jsxs(c.Fragment,{children:[i.address,c.jsx("br",{}),"📞 ",i.phone,c.jsx("br",{}),"🏥 ",i.specialties.slice(0,3).join(", "),c.jsx("br",{})]}),"緯度: ",((i==null?void 0:i.latitude)||e.latitude).toFixed(6),c.jsx("br",{}),"経度: ",((i==null?void 0:i.longitude)||e.longitude).toFixed(6)]})})}),n&&c.jsx(oc,{position:[n.latitude,n.longitude],icon:vA,children:c.jsx(ac,{children:c.jsxs("div",{className:"text-sm",children:[c.jsx("strong",{children:"現在地"}),c.jsx("br",{}),"緯度: ",n.latitude.toFixed(6),c.jsx("br",{}),"経度: ",n.longitude.toFixed(6)]})})}),r&&r.coordinates&&r.coordinates.length>1&&c.jsxs(c.Fragment,{children:[x&&r&&console.log("フルスクリーンでルート表示:",r.coordinates.length,"座標"),c.jsx(mA,{positions:r.coordinates.map(E=>[E.latitude,E.longitude]),color:x?"#FF6B35":"#3B82F6",weight:x?6:4,opacity:.9}),c.jsx(oc,{position:[r.coordinates[0].latitude,r.coordinates[0].longitude],icon:ru("#00FF00"),children:c.jsx(ac,{children:c.jsxs("div",{className:"text-sm",children:[c.jsxs("strong",{children:["ルート開始点 ",x?"(フルスクリーン)":""]}),c.jsx("br",{}),"緯度: ",r.coordinates[0].latitude.toFixed(6),c.jsx("br",{}),"経度: ",r.coordinates[0].longitude.toFixed(6),c.jsx("br",{}),"座標数: ",r.coordinates.length]})})}),c.jsx(oc,{position:[r.coordinates[r.coordinates.length-1].latitude,r.coordinates[r.coordinates.length-1].longitude],icon:ru("#FF0000"),children:c.jsx(ac,{children:c.jsxs("div",{className:"text-sm",children:[c.jsxs("strong",{children:["ルート終了点 ",x?"(フルスクリーン)":""]}),c.jsx("br",{}),"緯度: ",r.coordinates[r.coordinates.length-1].latitude.toFixed(6),c.jsx("br",{}),"経度: ",r.coordinates[r.coordinates.length-1].longitude.toFixed(6),c.jsx("br",{}),"座標数: ",r.coordinates.length]})})})]})]},x?"fullscreen-map":"normal-map"),s&&!x&&c.jsx("button",{onClick:()=>_(!0),className:"absolute top-2 right-2 z-[1000] bg-blue-600 hover:bg-blue-700 text-white shadow-lg rounded-lg p-3 transition-colors border border-blue-600",title:"地図を全画面表示",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})})}),x&&c.jsxs("div",{className:"absolute bottom-4 left-4 z-[1000] bg-white shadow-lg rounded-lg p-3 border border-gray-200",children:[c.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"凡例"}),c.jsxs("div",{className:"space-y-1 text-xs",children:[t&&c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-3 h-3 bg-red-600 rounded-full"}),c.jsx("span",{children:"現場"})]}),(e||i)&&c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full"}),c.jsx("span",{children:"搬送先病院"})]}),n&&c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full"}),c.jsx("span",{children:"現在地"})]}),r&&c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("div",{className:"w-4 h-1 bg-blue-500 rounded"}),c.jsx("span",{children:"最適ルート"})]})]}),c.jsx("div",{className:"mt-3 pt-2 border-t border-gray-200",children:c.jsxs("div",{className:"text-xs text-gray-500 space-y-1",children:[c.jsx("div",{children:"🖱️ ドラッグ: 地図移動"}),c.jsx("div",{children:"🔍 スクロール: ズーム"}),c.jsx("div",{children:"📍 マーカークリック: 詳細表示"})]})})]}),x&&c.jsxs("div",{className:"absolute top-4 right-4 z-[1000] flex flex-col space-y-2",children:[c.jsx("button",{onClick:()=>{m(t?[t.latitude,t.longitude]:u)},className:"bg-white shadow-lg rounded-lg p-2 hover:bg-gray-50 transition-colors border border-gray-200",title:"現場中心に表示",children:c.jsxs("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),c.jsxs("div",{className:"bg-gray-800 text-white text-xs p-2 rounded-lg max-w-48",children:[c.jsxs("div",{children:["ルート: ",r?"✓":"✗"]}),c.jsxs("div",{children:["座標数: ",((T=r==null?void 0:r.coordinates)==null?void 0:T.length)||0]}),!r&&c.jsx("div",{className:"mt-2 text-yellow-300",children:"※ ルート最適化を実行してください"})]})]})]})};return c.jsxs(c.Fragment,{children:[v(!1),c.jsx(QN,{isOpen:p,onClose:()=>_(!1),size:"full",title:"地図 - 全画面表示",children:c.jsx("div",{className:"h-full",children:v(!0)})})]})},Nm=()=>{const t=new Date;return{id:`vital-${Date.now()}`,timestamp:{toDate:()=>t,toMillis:()=>t.getTime(),seconds:Math.floor(t.getTime()/1e3),nanoseconds:0},hr:60+Math.floor(Math.random()*40),bp_s:110+Math.floor(Math.random()*30),bp_d:60+Math.floor(Math.random()*20),spo2:94+Math.floor(Math.random()*6),recordedBy:"demo-user",caseId:""}},bA=({caseId:t,className:e=""})=>{const[n,r]=B.useState([]),[i,s]=B.useState(!1),[a,u]=B.useState({hr:"",bp_s:"",bp_d:"",spo2:""});B.useEffect(()=>{{const p=[Nm(),Nm(),Nm()];r(p)}},[]);const h=()=>{if(!a.hr||!a.bp_s||!a.bp_d||!a.spo2){alert("すべての項目を入力してください");return}const p={id:`vital-${Date.now()}`,timestamp:{toDate:()=>new Date,toMillis:()=>Date.now(),seconds:Math.floor(Date.now()/1e3),nanoseconds:0},hr:parseInt(a.hr),bp_s:parseInt(a.bp_s),bp_d:parseInt(a.bp_d),spo2:parseInt(a.spo2),recordedBy:"current-user",caseId:t};r([p,...n]),u({hr:"",bp_s:"",bp_d:"",spo2:""}),s(!1)},m=p=>(p.toDate?p.toDate():new Date(p.seconds*1e3)).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"});return c.jsxs("div",{className:`${e}`,children:[c.jsxs("div",{className:"flex justify-between items-center mb-4",children:[c.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"バイタルサイン"}),c.jsx(Le,{size:"sm",variant:"outline",onClick:()=>s(!i),children:"記録追加"})]}),i&&c.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"心拍数 (bpm)"}),c.jsx("input",{type:"number",value:a.hr,onChange:p=>u({...a,hr:p.target.value}),className:"w-full px-2 py-1 text-sm border rounded",placeholder:"70"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"SpO2 (%)"}),c.jsx("input",{type:"number",value:a.spo2,onChange:p=>u({...a,spo2:p.target.value}),className:"w-full px-2 py-1 text-sm border rounded",placeholder:"98"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"収縮期血圧"}),c.jsx("input",{type:"number",value:a.bp_s,onChange:p=>u({...a,bp_s:p.target.value}),className:"w-full px-2 py-1 text-sm border rounded",placeholder:"120"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"拡張期血圧"}),c.jsx("input",{type:"number",value:a.bp_d,onChange:p=>u({...a,bp_d:p.target.value}),className:"w-full px-2 py-1 text-sm border rounded",placeholder:"80"})]})]}),c.jsxs("div",{className:"flex justify-end space-x-2 mt-3",children:[c.jsx(Le,{size:"sm",variant:"outline",onClick:()=>{s(!1),u({hr:"",bp_s:"",bp_d:"",spo2:""})},children:"キャンセル"}),c.jsx(Le,{size:"sm",onClick:h,children:"保存"})]})]}),c.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:n.length===0?c.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"バイタルサインの記録がありません"}):n.map(p=>c.jsx("div",{className:"bg-gray-50 rounded p-3 text-sm",children:c.jsxs("div",{className:"flex justify-between items-start",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-600",children:"HR:"})," ",c.jsxs("span",{className:"font-medium",children:[p.hr," bpm"]})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-600",children:"SpO2:"})," ",c.jsxs("span",{className:"font-medium",children:[p.spo2,"%"]})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-600",children:"BP:"})," ",c.jsxs("span",{className:"font-medium",children:[p.bp_s,"/",p.bp_d," mmHg"]})]})]}),c.jsx("span",{className:"text-xs text-gray-500",children:m(p.timestamp)})]})},p.id))})]})},EA=["現場到着しました","患者接触しました","搬送開始します","病院到着しました","処置開始しました","追加支援が必要です"],TA=()=>{const t=new Date;return[{id:"msg-1",timestamp:{toDate:()=>new Date(t.getTime()-15*60*1e3),toMillis:()=>t.getTime()-15*60*1e3,seconds:Math.floor((t.getTime()-15*60*1e3)/1e3),nanoseconds:0},senderId:"doctor-001",senderName:"山田 太郎",text:"現場に向かっています。到着予定時刻は10:15です。",caseId:"",messageType:"text"},{id:"msg-2",timestamp:{toDate:()=>new Date(t.getTime()-10*60*1e3),toMillis:()=>t.getTime()-10*60*1e3,seconds:Math.floor((t.getTime()-10*60*1e3)/1e3),nanoseconds:0},senderId:"hospital-001",senderName:"佐藤 花子",text:"了解しました。受け入れ準備を開始します。",caseId:"",messageType:"text"},{id:"msg-3",timestamp:{toDate:()=>new Date(t.getTime()-5*60*1e3),toMillis:()=>t.getTime()-5*60*1e3,seconds:Math.floor((t.getTime()-5*60*1e3)/1e3),nanoseconds:0},senderId:"doctor-001",senderName:"山田 太郎",text:"現場到着しました",caseId:"",messageType:"preset"}]},IA=({caseId:t,className:e=""})=>{const{userInfo:n}=Ds(),[r,i]=B.useState([]),[s,a]=B.useState(""),[u,h]=B.useState(!1),[m,p]=B.useState(!1),[_,v]=B.useState(null),x=B.useRef(null);B.useEffect(()=>{i(TA())},[]),B.useEffect(()=>{if(typeof window<"u"&&"webkitSpeechRecognition"in window){const A=window.webkitSpeechRecognition,U=new A;U.continuous=!1,U.interimResults=!1,U.lang="ja-JP",U.onresult=Z=>{const V=Z.results[0][0].transcript;a(V),p(!1)},U.onend=()=>{p(!1)},U.onerror=Z=>{console.error("Speech recognition error:",Z.error),p(!1)},v(U)}},[]),B.useEffect(()=>{var A;(A=x.current)==null||A.scrollIntoView({behavior:"smooth"})},[r]);const T=A=>(A.toDate?A.toDate():new Date(A.seconds*1e3)).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),E=(A,U="text")=>{if(!A.trim())return;const Z={id:`msg-${Date.now()}`,timestamp:{toDate:()=>new Date,toMillis:()=>Date.now(),seconds:Math.floor(Date.now()/1e3),nanoseconds:0},senderId:(n==null?void 0:n.uid)||"demo-user",senderName:(n==null?void 0:n.name)||"デモユーザー",text:A.trim(),caseId:t,messageType:U};i([...r,Z]),a(""),h(!1)},R=A=>{A.key==="Enter"&&!A.shiftKey&&(A.preventDefault(),E(s))},S=()=>{_&&!m&&(p(!0),_.start())},C=()=>{_&&m&&(_.stop(),p(!1))};return c.jsxs("div",{className:`flex flex-col h-full ${e}`,children:[c.jsxs("div",{className:"flex-1 overflow-y-auto mb-4 space-y-2 min-h-0",children:[r.length===0?c.jsx("p",{className:"text-sm text-gray-500 text-center py-8",children:"メッセージがありません"}):r.map(A=>{const U=A.senderId===(n==null?void 0:n.uid);return c.jsx("div",{className:`flex ${U?"justify-end":"justify-start"}`,children:c.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${U?"bg-medical-primary text-white":"bg-gray-200 text-gray-900"}`,children:[c.jsxs("div",{className:"text-xs opacity-75 mb-1",children:[A.senderName," - ",T(A.timestamp)]}),c.jsxs("div",{className:"text-sm break-words",children:[A.messageType==="preset"&&c.jsx("span",{className:"inline-block mr-1",children:"📌"}),A.text]})]})},A.id)}),c.jsx("div",{ref:x})]}),u&&c.jsxs("div",{className:"mb-2 p-2 bg-gray-50 rounded-lg",children:[c.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"定型メッセージ:"}),c.jsx("div",{className:"grid grid-cols-2 gap-2",children:EA.map(A=>c.jsx("button",{onClick:()=>E(A,"preset"),className:"text-left text-sm px-3 py-2 bg-white border rounded hover:bg-gray-50 transition-colors",children:A},A))})]}),c.jsxs("div",{className:"border-t pt-4",children:[c.jsxs("div",{className:"flex space-x-2",children:[c.jsx(Le,{size:"sm",variant:"outline",onClick:()=>h(!u),className:"flex-shrink-0",children:"定型"}),_&&c.jsx(Le,{size:"sm",variant:m?"danger":"outline",onClick:m?C:S,className:"flex-shrink-0",title:m?"録音停止":"音声入力",children:m?c.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("rect",{x:"7",y:"7",width:"6",height:"6",rx:"1"})}):c.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{fillRule:"evenodd",d:"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z",clipRule:"evenodd"})})}),c.jsx("input",{type:"text",value:s,onChange:A=>a(A.target.value),onKeyPress:R,placeholder:m?"音声入力中...":"メッセージを入力...",className:"flex-1 px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",disabled:m}),c.jsx(Le,{size:"sm",onClick:()=>E(s),disabled:!s.trim()||m,children:"送信"})]}),m&&c.jsxs("div",{className:"mt-2 text-xs text-gray-600 flex items-center",children:[c.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full mr-2 animate-pulse"}),"音声を認識しています..."]}),!_&&c.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"※ このブラウザでは音声認識がサポートされていません"})]})]})},SA=["バイタル測定","酸素投与開始","静脈路確保","心電図モニタリング開始","体位変換","体温管理","創部処置","疼痛管理","薬剤投与","気道確保"],CA=()=>{const t=new Date;return[{id:"treatment-1",timestamp:{toDate:()=>new Date(t.getTime()-20*60*1e3),toMillis:()=>t.getTime()-20*60*1e3,seconds:Math.floor((t.getTime()-20*60*1e3)/1e3),nanoseconds:0},name:"バイタル測定",details:"HR: 85bpm, BP: 120/80mmHg, SpO2: 98%",recordedBy:"山田 太郎",caseId:""},{id:"treatment-2",timestamp:{toDate:()=>new Date(t.getTime()-15*60*1e3),toMillis:()=>t.getTime()-15*60*1e3,seconds:Math.floor((t.getTime()-15*60*1e3)/1e3),nanoseconds:0},name:"酸素投与開始",details:"マスク 4L/min",recordedBy:"山田 太郎",caseId:""}]},PA=({caseId:t,className:e=""})=>{const[n,r]=B.useState([]),[i,s]=B.useState(!1),[a,u]=B.useState(!1),[h,m]=B.useState({name:"",details:""});B.useEffect(()=>{r(CA())},[]);const p=x=>(x.toDate?x.toDate():new Date(x.seconds*1e3)).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),_=(x,T="")=>{if(!x.trim()){alert("処置名を入力してください");return}const E={id:`treatment-${Date.now()}`,timestamp:{toDate:()=>new Date,toMillis:()=>Date.now(),seconds:Math.floor(Date.now()/1e3),nanoseconds:0},name:x.trim(),details:T.trim(),recordedBy:"current-user",caseId:t};r([E,...n]),m({name:"",details:""}),s(!1),u(!1)},v=x=>{m({...h,name:x}),u(!1)};return c.jsxs("div",{className:`${e}`,children:[c.jsxs("div",{className:"flex justify-between items-center mb-4",children:[c.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"処置記録"}),c.jsx(Le,{size:"sm",variant:"outline",onClick:()=>s(!i),children:"記録追加"})]}),i&&c.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"処置名"}),c.jsxs("div",{className:"flex space-x-2",children:[c.jsx("input",{type:"text",value:h.name,onChange:x=>m({...h,name:x.target.value}),className:"flex-1 px-2 py-1 text-sm border rounded",placeholder:"処置名を入力"}),c.jsx(Le,{size:"sm",variant:"outline",onClick:()=>u(!a),children:"選択"})]}),a&&c.jsxs("div",{className:"mt-2 p-2 bg-white border rounded max-h-32 overflow-y-auto",children:[c.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"処置を選択:"}),c.jsx("div",{className:"space-y-1",children:SA.map(x=>c.jsx("button",{onClick:()=>v(x),className:"block w-full text-left text-sm px-2 py-1 hover:bg-gray-100 rounded",children:x},x))})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"詳細・備考"}),c.jsx("textarea",{value:h.details,onChange:x=>m({...h,details:x.target.value}),className:"w-full px-2 py-1 text-sm border rounded resize-none",rows:2,placeholder:"詳細や数値など"})]})]}),c.jsxs("div",{className:"flex justify-end space-x-2 mt-3",children:[c.jsx(Le,{size:"sm",variant:"outline",onClick:()=>{s(!1),u(!1),m({name:"",details:""})},children:"キャンセル"}),c.jsx(Le,{size:"sm",onClick:()=>_(h.name,h.details),children:"保存"})]})]}),c.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:n.length===0?c.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"処置記録がありません"}):n.map(x=>c.jsxs("div",{className:"bg-gray-50 rounded p-3 text-sm",children:[c.jsxs("div",{className:"flex justify-between items-start mb-1",children:[c.jsx("div",{className:"font-medium text-gray-900",children:x.name}),c.jsx("span",{className:"text-xs text-gray-500",children:p(x.timestamp)})]}),x.details&&c.jsx("div",{className:"text-gray-600 text-xs mb-1",children:x.details}),c.jsxs("div",{className:"text-xs text-gray-500",children:["記録者: ",x.recordedBy]})]},x.id))})]})},NA=(t={})=>{const[e,n]=B.useState({location:null,error:null,loading:!0}),{enableHighAccuracy:r=!0,timeout:i=1e4,maximumAge:s=6e4,watch:a=!1}=t;return B.useEffect(()=>{if(!navigator.geolocation){n({location:null,error:"Geolocation is not supported by this browser.",loading:!1});return}const h=v=>{n({location:{latitude:v.coords.latitude,longitude:v.coords.longitude,accuracy:v.coords.accuracy},error:null,loading:!1})},m=v=>{let x="Unknown error occurred.";switch(v.code){case v.PERMISSION_DENIED:x="位置情報へのアクセスが拒否されました。";break;case v.POSITION_UNAVAILABLE:x="位置情報を取得できませんでした。";break;case v.TIMEOUT:x="位置情報の取得がタイムアウトしました。";break}n({location:null,error:x,loading:!1})},p={enableHighAccuracy:r,timeout:i,maximumAge:s};n(v=>({...v,loading:!0}));let _;return a?_=navigator.geolocation.watchPosition(h,m,p):navigator.geolocation.getCurrentPosition(h,m,p),()=>{_!==void 0&&navigator.geolocation.clearWatch(_)}},[r,i,s,a]),{...e,getCurrentPosition:()=>{if(!navigator.geolocation){n(h=>({...h,error:"Geolocation is not supported by this browser.",loading:!1}));return}n(h=>({...h,loading:!0,error:null})),navigator.geolocation.getCurrentPosition(h=>{n({location:{latitude:h.coords.latitude,longitude:h.coords.longitude,accuracy:h.coords.accuracy},error:null,loading:!1})},h=>{let m="Unknown error occurred.";switch(h.code){case h.PERMISSION_DENIED:m="位置情報へのアクセスが拒否されました。";break;case h.POSITION_UNAVAILABLE:m="位置情報を取得できませんでした。";break;case h.TIMEOUT:m="位置情報の取得がタイムアウトしました。";break}n({location:null,error:m,loading:!1})},{enableHighAccuracy:r,timeout:i,maximumAge:s})}}},AA=({className:t="",onLocationUpdate:e})=>{const[n,r]=B.useState(!1),{location:i,error:s,loading:a,getCurrentPosition:u}=NA({watch:n,enableHighAccuracy:!0,timeout:1e4,maximumAge:3e4});B.useEffect(()=>{i&&e&&e(i)},[i,e]);const h=()=>{r(!n)},m=()=>{u()},p=v=>v.toFixed(6),_=()=>new Date().toLocaleTimeString("ja-JP");return c.jsxs("div",{className:`bg-white rounded-lg border p-4 ${t}`,children:[c.jsxs("div",{className:"flex justify-between items-start mb-4",children:[c.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"現在地追跡"}),c.jsxs("div",{className:"flex space-x-2",children:[c.jsx(Le,{size:"sm",variant:"outline",onClick:m,disabled:a,children:"更新"}),c.jsx(Le,{size:"sm",variant:n?"danger":"primary",onClick:h,children:n?"停止":"開始"})]})]}),a&&c.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"位置情報を取得中..."}),s&&c.jsxs("div",{className:"text-sm text-red-600 mb-2",children:["エラー: ",s]}),i&&c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-600",children:"緯度:"}),c.jsx("div",{className:"font-mono",children:p(i.latitude)})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-600",children:"経度:"}),c.jsx("div",{className:"font-mono",children:p(i.longitude)})]})]}),i.accuracy&&c.jsxs("div",{className:"text-xs text-gray-500",children:["精度: ±",Math.round(i.accuracy),"m"]}),c.jsxs("div",{className:"text-xs text-gray-500",children:["最終更新: ",_()]}),n&&c.jsxs("div",{className:"flex items-center text-xs text-green-600",children:[c.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full mr-2 animate-pulse"}),"追跡中"]})]}),!i&&!a&&!s&&c.jsx("div",{className:"text-sm text-gray-500 text-center py-4",children:"位置情報を取得してください"})]})};class kA{constructor(){Pr(this,"mockData",[{id:"building-1",name:"東京駅",type:"station",address:"東京都千代田区丸の内1丁目",floors:3,basement:4,elevators:[{id:"elv-1",location:"丸の内中央口",capacity:20,maxWeight:1350,floors:[-4,-3,-2,-1,1,2,3],isAccessible:!0,status:"working"},{id:"elv-2",location:"八重洲中央口",capacity:15,maxWeight:1e3,floors:[-2,-1,1,2],isAccessible:!0,status:"working"}],staircases:[{id:"stair-1",location:"丸の内北口階段",type:"normal",floors:[-1,1,2],width:"wide"},{id:"stair-2",location:"八重洲南口階段",type:"normal",floors:[-1,1],width:"standard"}],exits:[{id:"exit-1",name:"丸の内中央口",type:"main",floor:1,direction:"西側",isAccessible:!0,nearbyLandmarks:["皇居","丸ビル"]},{id:"exit-2",name:"八重洲中央口",type:"main",floor:1,direction:"東側",isAccessible:!0,nearbyLandmarks:["大丸東京店","グランルーフ"]},{id:"exit-3",name:"丸の内北口",type:"main",floor:1,direction:"北西",isAccessible:!0,nearbyLandmarks:["KITTE","東京中央郵便局"]}],accessibility:{wheelchairAccessible:!0,elevatorToAllFloors:!0,accessibleParking:!1,accessibleRestrooms:!0,guidanceForVisuallyImpaired:!0},emergencyContact:"03-3212-2345",location:this.createMockGeoPoint(35.6812,139.7671),lastUpdated:new Date("2024-01-15")},{id:"building-2",name:"新宿パークタワー",type:"office",address:"東京都新宿区西新宿3丁目7-1",floors:52,basement:3,elevators:[{id:"elv-3",location:"低層用エレベーター",capacity:20,maxWeight:1350,floors:[-3,-2,-1,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],isAccessible:!0,status:"working"},{id:"elv-4",location:"高層用エレベーター",capacity:20,maxWeight:1350,floors:[1,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52],isAccessible:!0,status:"working"},{id:"elv-5",location:"非常用エレベーター",capacity:17,maxWeight:1150,floors:[-3,-2,-1,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52],isAccessible:!0,status:"working"}],staircases:[{id:"stair-3",location:"北側非常階段",type:"emergency",floors:[-3,-2,-1,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52],width:"standard"},{id:"stair-4",location:"南側非常階段",type:"emergency",floors:[-3,-2,-1,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52],width:"standard"}],exits:[{id:"exit-4",name:"メインエントランス",type:"main",floor:1,direction:"南側",isAccessible:!0,nearbyLandmarks:["新宿中央公園","ハイアットリージェンシー東京"]},{id:"exit-5",name:"北側出口",type:"emergency",floor:1,direction:"北側",isAccessible:!1}],accessibility:{wheelchairAccessible:!0,elevatorToAllFloors:!0,accessibleParking:!0,accessibleRestrooms:!0,guidanceForVisuallyImpaired:!1},emergencyContact:"03-5322-1234",location:this.createMockGeoPoint(35.6879,139.6917),lastUpdated:new Date("2024-02-01")},{id:"building-3",name:"渋谷スカイ",type:"shopping",address:"東京都渋谷区渋谷2丁目24-12",floors:14,basement:2,elevators:[{id:"elv-6",location:"中央エレベーター",capacity:24,maxWeight:1600,floors:[-2,-1,1,2,3,4,5,6,7,8,9,10,11,12,13,14],isAccessible:!0,status:"working"}],staircases:[{id:"stair-5",location:"エスカレーター",type:"escalator",floors:[-2,-1,1,2,3,4,5,6,7,8,9,10,11,12,13,14],width:"wide"}],exits:[{id:"exit-6",name:"JR渋谷駅直結",type:"main",floor:2,direction:"東側",isAccessible:!0,nearbyLandmarks:["渋谷駅","ハチ公"]}],accessibility:{wheelchairAccessible:!0,elevatorToAllFloors:!0,accessibleParking:!1,accessibleRestrooms:!0,guidanceForVisuallyImpaired:!0},location:this.createMockGeoPoint(35.658,139.7016),lastUpdated:new Date("2024-01-20")}])}createMockGeoPoint(e,n){return{latitude:e,longitude:n,isEqual:r=>Math.abs(e-r.latitude)<1e-4&&Math.abs(n-r.longitude)<1e-4}}calculateDistance(e,n){const i=e.latitude*Math.PI/180,s=n.latitude*Math.PI/180,a=(n.latitude-e.latitude)*Math.PI/180,u=(n.longitude-e.longitude)*Math.PI/180,h=Math.sin(a/2)*Math.sin(a/2)+Math.cos(i)*Math.cos(s)*Math.sin(u/2)*Math.sin(u/2);return 6371e3*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}async getBuildingInfoByLocation(e,n={}){console.log("Building service: Getting building info for location",e);try{return ui.demoMode?this.getMockBuildingInfo(e,n):{building:null,confidence:0}}catch(r){return console.error("Failed to get building info:",r),{building:null,confidence:0}}}getMockBuildingInfo(e,n){const r=n.radius||100;let i=null,s=1/0;for(const a of this.mockData){const u=this.calculateDistance(e,a.location);if(u<=r&&u<s){if(n.buildingTypes&&!n.buildingTypes.includes(a.type)||n.requireAccessibility&&!a.accessibility.wheelchairAccessible)continue;i=a,s=u}}return{building:i,distance:i?s:void 0,confidence:i?Math.max(.1,1-s/r):0}}async searchBuildings(e){console.log("Building service: Searching buildings with query",e);try{return ui.demoMode?this.mockData.filter(n=>n.name.toLowerCase().includes(e.toLowerCase())||n.address.toLowerCase().includes(e.toLowerCase())):[]}catch(n){return console.error("Failed to search buildings:",n),[]}}async updateBuildingInfo(e,n){console.log("Building service: Updating building info",e,n);try{if(ui.demoMode){const r=this.mockData.findIndex(i=>i.id===e);r!==-1&&(this.mockData[r]={...this.mockData[r],...n});return}}catch(r){throw console.error("Failed to update building info:",r),r}}}const RA=new kA,jA=({elevator:t})=>{const e=i=>{switch(i){case"working":return"text-green-600 bg-green-50";case"maintenance":return"text-yellow-600 bg-yellow-50";case"unknown":default:return"text-gray-600 bg-gray-50"}},n=i=>{switch(i){case"working":return"稼働中";case"maintenance":return"メンテナンス中";case"unknown":default:return"状況不明"}},r=i=>{const s=[...i].sort((m,p)=>m-p),a=[];let u=s[0],h=s[0];for(let m=1;m<s.length;m++)if(s[m]===h+1)h=s[m];else{if(u===h)a.push(u===0?"G":u<0?`B${Math.abs(u)}`:`${u}`);else{const p=u===0?"G":u<0?`B${Math.abs(u)}`:`${u}`,_=h===0?"G":h<0?`B${Math.abs(h)}`:`${h}`;a.push(`${p}-${_}`)}u=s[m],h=s[m]}if(u===h)a.push(u===0?"G":u<0?`B${Math.abs(u)}`:`${u}`);else{const m=u===0?"G":u<0?`B${Math.abs(u)}`:`${u}`,p=h===0?"G":h<0?`B${Math.abs(h)}`:`${h}`;a.push(`${m}-${p}`)}return a.join(", ")+"F"};return c.jsxs("div",{className:"bg-gray-50 rounded p-3 text-xs",children:[c.jsxs("div",{className:"flex items-start justify-between mb-2",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx("div",{className:"font-medium text-gray-900",children:t.location}),c.jsxs("div",{className:"text-gray-600 mt-1",children:["定員: ",t.capacity,"人 | 最大: ",t.maxWeight,"kg"]})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[t.isAccessible&&c.jsxs("div",{className:"flex items-center text-blue-600",children:[c.jsx("svg",{className:"h-3 w-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),c.jsx("span",{children:"車椅子対応"})]}),t.status&&c.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${e(t.status)}`,children:n(t.status)})]})]}),c.jsxs("div",{className:"text-gray-600",children:[c.jsx("span",{className:"font-medium",children:"停止階:"})," ",r(t.floors)]})]})},DA=({staircase:t})=>{const e=u=>{switch(u){case"escalator":return c.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 7l5 5-5 5M6 12h12"})});case"emergency":return c.jsx("svg",{className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})});default:return c.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 10l7-7m0 0l7 7m-7-7v18"})})}},n=u=>{switch(u){case"escalator":return"エスカレーター";case"emergency":return"非常階段";default:return"一般階段"}},r=u=>{switch(u){case"escalator":return"text-blue-600";case"emergency":return"text-red-600";default:return"text-gray-600"}},i=u=>{switch(u){case"narrow":return"狭い";case"wide":return"広い";default:return"標準"}},s=u=>{switch(u){case"narrow":return"text-red-600";case"wide":return"text-green-600";default:return"text-gray-600"}},a=u=>{const h=[...u].sort((v,x)=>v-x),m=[];let p=h[0],_=h[0];for(let v=1;v<h.length;v++)if(h[v]===_+1)_=h[v];else{if(p===_)m.push(p===0?"G":p<0?`B${Math.abs(p)}`:`${p}`);else{const x=p===0?"G":p<0?`B${Math.abs(p)}`:`${p}`,T=_===0?"G":_<0?`B${Math.abs(_)}`:`${_}`;m.push(`${x}-${T}`)}p=h[v],_=h[v]}if(p===_)m.push(p===0?"G":p<0?`B${Math.abs(p)}`:`${p}`);else{const v=p===0?"G":p<0?`B${Math.abs(p)}`:`${p}`,x=_===0?"G":_<0?`B${Math.abs(_)}`:`${_}`;m.push(`${v}-${x}`)}return m.join(", ")+"F"};return c.jsxs("div",{className:"bg-gray-50 rounded p-3 text-xs",children:[c.jsxs("div",{className:"flex items-start justify-between mb-2",children:[c.jsxs("div",{className:"flex-1",children:[c.jsx("div",{className:"font-medium text-gray-900",children:t.location}),c.jsxs("div",{className:"text-gray-600 mt-1",children:["接続階: ",a(t.floors)]})]}),c.jsxs("div",{className:"flex items-center space-x-3",children:[c.jsxs("div",{className:`flex items-center ${r(t.type)}`,children:[e(t.type),c.jsx("span",{className:"ml-1",children:n(t.type)})]}),c.jsxs("div",{className:`${s(t.width)}`,children:["幅: ",i(t.width)]})]})]}),t.type==="emergency"&&c.jsx("div",{className:"mt-2 p-2 bg-red-50 rounded text-red-700",children:c.jsxs("div",{className:"flex items-center text-xs",children:[c.jsx("svg",{className:"h-3 w-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),"緊急時専用"]})}),t.type==="escalator"&&c.jsx("div",{className:"mt-2 p-2 bg-blue-50 rounded text-blue-700",children:c.jsxs("div",{className:"flex items-center text-xs",children:[c.jsx("svg",{className:"h-3 w-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),"ストレッチャー移送時は利用不可"]})})]})},LA=({exit:t})=>{const e=s=>{switch(s){case"main":return c.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})});case"emergency":return c.jsx("svg",{className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})});case"service":return c.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]});default:return c.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 16l4-4m0 0l-4-4m4 4H7"})})}},n=s=>{switch(s){case"main":return"メイン出入口";case"emergency":return"非常口";case"service":return"サービス出入口";default:return"出入口"}},r=s=>{switch(s){case"main":return"text-blue-600 bg-blue-50";case"emergency":return"text-red-600 bg-red-50";case"service":return"text-gray-600 bg-gray-50";default:return"text-gray-600 bg-gray-50"}},i=s=>s===0?"G階":s<0?`B${Math.abs(s)}階`:`${s}階`;return c.jsxs("div",{className:"bg-gray-50 rounded p-3 text-xs",children:[c.jsxs("div",{className:"flex items-start justify-between mb-2",children:[c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[c.jsx("div",{className:"font-medium text-gray-900",children:t.name}),t.isAccessible&&c.jsxs("div",{className:"flex items-center text-blue-600",children:[c.jsx("svg",{className:"h-3 w-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),c.jsx("span",{children:"バリアフリー"})]})]}),c.jsxs("div",{className:"text-gray-600",children:[i(t.floor)," | ",t.direction]})]}),c.jsxs("div",{className:`flex items-center px-2 py-1 rounded text-xs font-medium ${r(t.type)}`,children:[e(t.type),c.jsx("span",{className:"ml-1",children:n(t.type)})]})]}),t.nearbyLandmarks&&t.nearbyLandmarks.length>0&&c.jsx("div",{className:"mt-2 p-2 bg-green-50 rounded",children:c.jsxs("div",{className:"text-green-700",children:[c.jsx("span",{className:"font-medium",children:"近くの目印:"})," ",t.nearbyLandmarks.join(", ")]})}),t.type==="emergency"&&c.jsx("div",{className:"mt-2 p-2 bg-red-50 rounded text-red-700",children:c.jsxs("div",{className:"flex items-center text-xs",children:[c.jsx("svg",{className:"h-3 w-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),"緊急時専用出入口"]})}),t.type==="main"&&c.jsx("div",{className:"mt-2 p-2 bg-blue-50 rounded text-blue-700",children:c.jsxs("div",{className:"flex items-center text-xs",children:[c.jsx("svg",{className:"h-3 w-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),"患者搬送推奨ルート"]})})]})},MA=({accessibility:t,className:e=""})=>{const r=(()=>{let h=0;return t.wheelchairAccessible&&h++,t.elevatorToAllFloors&&h++,t.accessibleParking&&h++,t.accessibleRestrooms&&h++,t.guidanceForVisuallyImpaired&&h++,h})(),i=5,s=()=>{const h=r/i;return h>=.8?"bg-green-100 text-green-800 border-green-200":h>=.6?"bg-yellow-100 text-yellow-800 border-yellow-200":h>=.4?"bg-orange-100 text-orange-800 border-orange-200":"bg-red-100 text-red-800 border-red-200"},a=()=>{const h=r/i;return h>=.8?"バリアフリー対応":h>=.6?"一部バリアフリー":h>=.4?"限定的対応":"要注意"},u=()=>t.wheelchairAccessible?c.jsx("svg",{className:"h-3 w-3",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):c.jsx("svg",{className:"h-3 w-3",fill:"currentColor",viewBox:"0 0 20 20",children:c.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})});return c.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${s()} ${e}`,children:[u(),c.jsx("span",{className:"ml-1",children:a()}),c.jsxs("span",{className:"ml-1 opacity-75",children:["(",r,"/",i,")"]})]})},VA=({location:t,className:e=""})=>{const[n,r]=B.useState(null),[i,s]=B.useState(!1),[a,u]=B.useState(null),[h,m]=B.useState(!1);B.useEffect(()=>{p()},[t]);const p=async()=>{if(t){s(!0),u(null);try{const T=await RA.getBuildingInfoByLocation(t,{radius:200});r(T)}catch(T){console.error("Failed to load building info:",T),u("建物情報の取得に失敗しました")}finally{s(!1)}}},_=T=>T?T<1e3?`${Math.round(T)}m`:`${(T/1e3).toFixed(1)}km`:"",v=T=>T>=.8?"text-green-600":T>=.5?"text-yellow-600":"text-red-600";if(i)return c.jsx("div",{className:`bg-white rounded-lg border p-4 ${e}`,children:c.jsxs("div",{className:"flex items-center justify-center py-4",children:[c.jsx(_r,{size:"sm"}),c.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"建物情報を取得中..."})]})});if(a)return c.jsxs("div",{className:`bg-white rounded-lg border p-4 ${e}`,children:[c.jsx("div",{className:"flex items-center justify-between mb-2",children:c.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"建物情報"})}),c.jsx("div",{className:"text-sm text-red-600",children:a})]});if(!(n!=null&&n.building))return c.jsxs("div",{className:`bg-white rounded-lg border p-4 ${e}`,children:[c.jsx("div",{className:"flex items-center justify-between mb-2",children:c.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"建物情報"})}),c.jsx("div",{className:"text-sm text-gray-500",children:"現場周辺に建物情報が見つかりませんでした"})]});const x=n.building;return c.jsxs("div",{className:`bg-white rounded-lg border p-4 border-red-500 ${e}`,style:{backgroundColor:"#fff2f2"},children:[c.jsxs("div",{className:"flex items-center justify-between mb-4",children:[c.jsxs("div",{className:"flex-1",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("h4",{className:"text-sm font-medium text-gray-900",children:x.name}),c.jsx(MA,{accessibility:x.accessibility})]}),c.jsx("div",{className:"text-xs text-gray-500 mt-1",children:x.address}),n.distance&&c.jsxs("div",{className:"text-xs text-gray-500",children:["現場から",_(n.distance),c.jsxs("span",{className:`ml-1 ${v(n.confidence)}`,children:["(信頼度: ",Math.round(n.confidence*100),"%)"]})]})]}),c.jsx("button",{onClick:()=>m(!h),className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",children:c.jsx("svg",{className:`h-4 w-4 transition-transform ${h?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs mb-4",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-500",children:"建物種別:"}),c.jsxs("div",{className:"font-medium",children:[x.type==="office"&&"オフィスビル",x.type==="hospital"&&"病院",x.type==="station"&&"駅",x.type==="shopping"&&"商業施設",x.type==="residential"&&"住宅",x.type==="school"&&"学校",x.type==="other"&&"その他"]})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-500",children:"階層:"}),c.jsxs("div",{className:"font-medium",children:[x.basement?`B${x.basement}F-`:"",x.floors,"F"]})]})]}),x.emergencyContact&&c.jsxs("div",{className:"mb-4 p-2 bg-red-50 rounded text-xs",children:[c.jsx("span",{className:"text-red-600 font-medium",children:"緊急時連絡先:"}),c.jsx("div",{className:"text-red-800 font-mono",children:x.emergencyContact})]}),h&&c.jsxs("div",{className:"space-y-4 border-t pt-4",children:[x.elevators.length>0&&c.jsxs("div",{children:[c.jsx("h5",{className:"text-sm font-medium text-gray-800 mb-2",children:"エレベーター"}),c.jsx("div",{className:"space-y-2",children:x.elevators.map(T=>c.jsx(jA,{elevator:T},T.id))})]}),x.staircases.length>0&&c.jsxs("div",{children:[c.jsx("h5",{className:"text-sm font-medium text-gray-800 mb-2",children:"階段・エスカレーター"}),c.jsx("div",{className:"space-y-2",children:x.staircases.map(T=>c.jsx(DA,{staircase:T},T.id))})]}),x.exits.length>0&&c.jsxs("div",{children:[c.jsx("h5",{className:"text-sm font-medium text-gray-800 mb-2",children:"出入口"}),c.jsx("div",{className:"space-y-2",children:x.exits.map(T=>c.jsx(LA,{exit:T},T.id))})]}),x.lastUpdated&&c.jsxs("div",{className:"text-xs text-gray-400 pt-2 border-t",children:["最終更新: ",x.lastUpdated.toLocaleDateString("ja-JP")]})]})]})},Rc=[{id:"hospital-001",name:"東京科学大学病院",latitude:35.699374,longitude:139.762881,address:"東京都文京区湯島1-5-45",phone:"03-3813-6111",emergencyLevel:"tertiary",specialties:["救急科","外科","内科","循環器科","脳神経外科","整形外科"],hasER:!0,hasICU:!0,acceptsTrauma:!0},{id:"hospital-002",name:"東京大学医学部附属病院",latitude:35.7016,longitude:139.7658,address:"東京都文京区本郷7-3-1",phone:"03-3815-5411",emergencyLevel:"tertiary",specialties:["救急科","外科","内科","循環器科","脳神経外科"],hasER:!0,hasICU:!0,acceptsTrauma:!0},{id:"hospital-003",name:"順天堂大学医学部附属順天堂医院",latitude:35.7022,longitude:139.7644,address:"東京都文京区本郷3-1-3",phone:"03-3813-3111",emergencyLevel:"tertiary",specialties:["救急科","外科","内科","整形外科","脳神経外科"],hasER:!0,hasICU:!0,acceptsTrauma:!0},{id:"hospital-006",name:"日本医科大学付属病院",latitude:35.7069,longitude:139.7533,address:"東京都文京区千駄木1-1-5",phone:"03-3822-2131",emergencyLevel:"secondary",specialties:["救急科","外科","内科","小児科"],hasER:!0,hasICU:!0,acceptsTrauma:!0},{id:"hospital-007",name:"慈恵会医科大学附属病院",latitude:35.6678,longitude:139.7456,address:"東京都港区西新橋3-25-8",phone:"03-3433-1111",emergencyLevel:"tertiary",specialties:["救急科","外科","内科","循環器科","脳神経外科"],hasER:!0,hasICU:!0,acceptsTrauma:!0},{id:"hospital-008",name:"聖路加国際病院",latitude:35.6724,longitude:139.7745,address:"東京都中央区明石町9-1",phone:"03-3541-5151",emergencyLevel:"secondary",specialties:["救急科","外科","内科","産婦人科"],hasER:!0,hasICU:!0,acceptsTrauma:!0},{id:"hospital-009",name:"東京都立墨東病院",latitude:35.7118,longitude:139.8267,address:"東京都墨田区江東橋4-23-15",phone:"03-3633-6151",emergencyLevel:"tertiary",specialties:["救急科","外科","内科","外傷科","熱傷科"],hasER:!0,hasICU:!0,acceptsTrauma:!0},{id:"hospital-010",name:"国立国際医療研究センター病院",latitude:35.7011,longitude:139.728,address:"東京都新宿区戸山1-21-1",phone:"03-3202-7181",emergencyLevel:"tertiary",specialties:["救急科","外科","内科","感染症科"],hasER:!0,hasICU:!0,acceptsTrauma:!0},{id:"hospital-011",name:"東京医科大学病院",latitude:35.6959,longitude:139.7254,address:"東京都新宿区西新宿6-7-1",phone:"03-3342-6111",emergencyLevel:"secondary",specialties:["救急科","外科","内科","循環器科"],hasER:!0,hasICU:!0,acceptsTrauma:!0},{id:"hospital-012",name:"虎の門病院",latitude:35.6694,longitude:139.7478,address:"東京都港区虎ノ門2-2-2",phone:"03-3588-1111",emergencyLevel:"secondary",specialties:["救急科","外科","内科","循環器科"],hasER:!0,hasICU:!0,acceptsTrauma:!1}],OA=({selectedHospital:t,onHospitalSelect:e,className:n=""})=>{var T;const[r,i]=B.useState([]),[s,a]=B.useState(""),[u,h]=B.useState(!1),[m,p]=B.useState([]);B.useEffect(()=>{console.log("HospitalSelector: Loading all hospitals..."),console.log("HospitalSelector: emergencyHospitals array:",Rc);const E=Rc.map(S=>({...S,distance:0})),R=E.find(S=>S.name==="東京科学大学病院");console.log("東京科学大学病院が見つかりました:",R),console.log("HospitalSelector: All hospitals loaded:",E.length,E.map(S=>S.name)),i(E),p(E)},[]),B.useEffect(()=>{if(!s)p(r);else{const E=r.filter(R=>R.name.toLowerCase().includes(s.toLowerCase())||R.address.toLowerCase().includes(s.toLowerCase())||R.specialties.some(S=>S.toLowerCase().includes(s.toLowerCase())));p(E)}},[s,r]);const _=E=>{e(E),a(E.name),h(!1)},v=E=>{switch(E){case"tertiary":return c.jsx("span",{className:"bg-red-100 text-red-800 text-xs px-2 py-1 rounded-full",children:"三次救急"});case"secondary":return c.jsx("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full",children:"二次救急"});case"primary":return c.jsx("span",{className:"bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full",children:"一次救急"});default:return null}},x=E=>{const R={救急科:"🚑",外科:"🔪",内科:"💊",循環器科:"❤️",脳神経外科:"🧠",整形外科:"🦴",小児科:"👶",産婦人科:"👩",外傷科:"🩹",熱傷科:"🔥",感染症科:"🦠"};return E.slice(0,3).map(S=>R[S]||"🏥").join(" ")};return c.jsxs("div",{className:`relative ${n}`,children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"搬送先病院"}),c.jsxs("div",{className:"relative",children:[c.jsx("input",{type:"text",value:t?t.name:s,onChange:E=>{a(E.target.value),h(!0)},onFocus:()=>h(!0),placeholder:"病院を検索または選択...",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"}),c.jsx("button",{type:"button",onClick:()=>h(!u),className:"absolute right-2 top-2 text-gray-400 hover:text-gray-600",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]}),t&&!u&&c.jsxs("div",{className:"mt-2 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"font-medium text-blue-900",children:t.name}),v(t.emergencyLevel)]}),c.jsxs("span",{className:"text-sm text-gray-600",children:[(T=t.distance)==null?void 0:T.toFixed(1),"km"]})]}),c.jsxs("div",{className:"text-sm text-gray-600",children:[c.jsx("div",{children:t.address}),c.jsxs("div",{className:"mt-1",children:[c.jsx("span",{className:"mr-2",children:x(t.specialties)}),t.specialties.slice(0,3).join(", "),t.specialties.length>3&&` 他${t.specialties.length-3}科`]}),c.jsxs("div",{className:"mt-1 flex space-x-3 text-xs",children:[t.hasER&&c.jsx("span",{className:"text-green-600",children:"✓ ER"}),t.hasICU&&c.jsx("span",{className:"text-green-600",children:"✓ ICU"}),t.acceptsTrauma&&c.jsx("span",{className:"text-green-600",children:"✓ 外傷対応"})]})]})]}),u&&c.jsx("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg max-h-96 overflow-y-auto",children:m.length===0?c.jsx("div",{className:"p-4 text-center text-gray-500",children:"病院が見つかりません"}):c.jsx("div",{className:"py-1",children:m.map(E=>{var R;return c.jsxs("button",{onClick:()=>_(E),className:"w-full px-4 py-3 text-left hover:bg-gray-50 focus:bg-gray-50 focus:outline-none border-b border-gray-100 last:border-b-0",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"font-medium",children:E.name}),v(E.emergencyLevel)]}),c.jsxs("div",{className:"text-sm text-gray-500 flex items-center space-x-2",children:[c.jsxs("span",{children:[(R=E.distance)==null?void 0:R.toFixed(1),"km"]}),c.jsxs("span",{className:"text-xs",children:["📞 ",E.phone]})]})]}),c.jsx("div",{className:"text-sm text-gray-600 mb-1",children:E.address}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"text-sm text-gray-500",children:[c.jsx("span",{className:"mr-2",children:x(E.specialties)}),E.specialties.slice(0,2).join(", "),E.specialties.length>2&&` 他${E.specialties.length-2}科`]}),c.jsxs("div",{className:"flex space-x-2 text-xs",children:[E.hasER&&c.jsx("span",{className:"text-green-600",children:"ER"}),E.hasICU&&c.jsx("span",{className:"text-green-600",children:"ICU"}),E.acceptsTrauma&&c.jsx("span",{className:"text-green-600",children:"外傷"})]})]})]},E.id)})})}),u&&c.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>h(!1)})]})},Ys={TRAFFIC_API:{baseUrl:"https://api.jartic-open-traffic.org/geoserver",username:"traffic",password:"traffic"},DRM_PF_API:{baseUrl:"https://pf.drm.jp",authEndpoint:"/api/0/auth",routeEndpoint:"/api/9/route"}};class FA{constructor(){Pr(this,"drmPfToken",null);Pr(this,"tokenExpiry",null)}async getTrafficData(e,n=30){try{const r=new Date;r.setMinutes(r.getMinutes()-n);const i=new Date(r.getTime()+9*60*60*1e3),s=this.formatTimeCode(i),a=new URLSearchParams({service:"WFS",version:"2.0.0",request:"GetFeature",typeNames:"t_travospublic_measure_5m",srsName:"EPSG:4326",outputFormat:"application/json",exceptions:"application/json",cql_filter:`時間コード=${s} AND 道路種別=3 AND BBOX(ジオメトリ,${e.west},${e.south},${e.east},${e.north},'EPSG:4326')`}),u=await fetch(`${Ys.TRAFFIC_API.baseUrl}?${a}`,{method:"GET",headers:{Authorization:`Basic ${btoa(`${Ys.TRAFFIC_API.username}:${Ys.TRAFFIC_API.password}`)}`}});if(!u.ok)throw new Error(`Traffic API error: ${u.status} ${u.statusText}`);return await u.json()}catch(r){throw console.error("Failed to fetch traffic data:",r),r}}async getTrafficDataAroundPoint(e,n=3){const r=n/111,i=n/(111*Math.abs(Math.cos(e.latitude*Math.PI/180))),s={west:e.longitude-i,south:e.latitude-r,east:e.longitude+i,north:e.latitude+r};return this.getTrafficData(s)}async authenticateDrmPf(){if(this.drmPfToken&&this.tokenExpiry&&new Date<this.tokenExpiry)return this.drmPfToken;try{console.log("Authenticating with DRM-PF API...");const e=await fetch(`${Ys.DRM_PF_API.baseUrl}${Ys.DRM_PF_API.authEndpoint}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({login_id:{}.VITE_DRM_PF_LOGIN_ID||"demo_login",password:{}.VITE_DRM_PF_PASSWORD||"demo_password"})});if(!e.ok)throw new Error(`DRM-PF auth error: ${e.status} ${e.statusText}`);const n=await e.json();if(this.drmPfToken=n.access_token,!this.drmPfToken)throw new Error("No access token received from DRM-PF API");return this.tokenExpiry=new Date,this.tokenExpiry.setMinutes(this.tokenExpiry.getMinutes()+60),console.log("✅ DRM-PF authentication successful"),this.drmPfToken}catch(e){throw console.error("❌ DRM-PF authentication failed:",e),e}}async getRouteOptions(e){try{console.log("🔍 Requesting DRM-PF route from:",e.startLat,e.startLon,"to:",e.endLat,e.endLon);const n=await this.authenticateDrmPf(),r=new URLSearchParams({start_lat:e.startLat.toString(),start_lon:e.startLon.toString(),goal_lat:e.endLat.toString(),goal_lon:e.endLon.toString(),crs:"EPSG:4326",...e.searchType==="time"&&{optimize:"time"},...e.searchType==="distance"&&{optimize:"distance"}}),i=await fetch(`${Ys.DRM_PF_API.baseUrl}${Ys.DRM_PF_API.routeEndpoint}?${r}`,{method:"GET",headers:{Authorization:`Bearer ${n}`}});if(!i.ok){const a=await i.text();throw new Error(`DRM-PF route error: ${i.status} ${i.statusText} - ${a}`)}const s=await i.json();return console.log("✅ DRM-PF route response received"),this.transformDrmPfResponse(s,e)}catch(n){throw console.error("❌ Failed to get DRM-PF route options:",n),n}}transformDrmPfResponse(e,n){try{const r=e.geo_data;if(!r||!r.coordinates)throw new Error("No route geometry in DRM-PF response");const s=(r.type==="LineString"?r.coordinates:r.type==="MultiLineString"?r.coordinates.flat():[]).map(([m,p])=>({lat:p,lon:m})),a=this.calculateRouteDistance(s),u=a/(40*1e3/3600),h={routeId:`drm_pf_${Date.now()}`,totalDistance:a,totalTime:u,points:s,links:[]};return console.log(`📏 DRM-PF route: ${Math.round(a)}m, ${Math.round(u)}s, ${s.length} points`),{routes:[h]}}catch(r){throw console.error("Failed to transform DRM-PF response:",r),r}}calculateRouteDistance(e){let n=0;for(let r=0;r<e.length-1;r++)n+=this.calculateDistance(e[r].lat,e[r].lon,e[r+1].lat,e[r+1].lon);return n}calculateTrafficDensity(e,n,r=1e3){let i=0,s=0;return e.features.forEach(a=>{const[u,h]=a.geometry.coordinates;if(this.calculateDistance(n.latitude,n.longitude,h,u)<=r){const p=a.properties,_=p.上り小型交通量+p.上り大型交通量+p.下り小型交通量+p.下り大型交通量;i+=_,s++}}),s>0?i/s:0}formatTimeCode(e){const n=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),a=String(Math.floor(e.getMinutes()/5)*5).padStart(2,"0");return`${n}${r}${i}${s}${a}`}calculateDistance(e,n,r,i){const a=(r-e)*Math.PI/180,u=(i-n)*Math.PI/180,h=Math.sin(a/2)*Math.sin(a/2)+Math.cos(e*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(u/2)*Math.sin(u/2);return 6371e3*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}createMockTrafficData(e){const n=[];for(let i=e.south;i<=e.north;i+=.01)for(let s=e.west;s<=e.east;s+=.01){const a=Math.random()*100,u=this.getTimeBasedTrafficMultiplier();n.push({type:"Feature",properties:{観測点コード:`MOCK_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,時間コード:this.formatTimeCode(new Date),道路種別:3,上り小型交通量:Math.floor(a*u*.7),上り大型交通量:Math.floor(a*u*.1),下り小型交通量:Math.floor(a*u*.7),下り大型交通量:Math.floor(a*u*.1),ジオメトリ:{type:"Point",coordinates:[s,i]}},geometry:{type:"Point",coordinates:[s,i]}})}return{type:"FeatureCollection",features:n}}getTimeBasedTrafficMultiplier(){const e=new Date().getHours();return e>=7&&e<=9||e>=17&&e<=19?2:e>=6&&e<=10||e>=16&&e<=20?1.5:e>=22||e<=5?.3:1}}const a0=new FA;class zA{constructor(){Pr(this,"networkCache",new Map);Pr(this,"pathfindingCache",new Map)}async getRoadNetwork(e){const n=`${e.south},${e.west},${e.north},${e.east}`;if(this.networkCache.has(n))return console.log("📋 Using cached road network data"),this.networkCache.get(n);try{console.log("🌐 Fetching OSM road network data for area:",e);const r=`
        [out:json][timeout:25];
        (
          way["highway"~"^(primary|secondary|tertiary|unclassified|residential)$"](${e.south},${e.west},${e.north},${e.east});
          way["highway"~"^(trunk|motorway)$"](${e.south},${e.west},${e.north},${e.east});
        );
        (._;>;);
        out geom;
      `;console.log("🔍 Querying Overpass API...");const s=await fetch("https://overpass-api.de/api/interpreter",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`data=${encodeURIComponent(r)}`});if(!s.ok)throw console.warn(`⚠️ Overpass API error: ${s.status} ${s.statusText}`),new Error(`Overpass API error: ${s.status}`);const a=await s.json();console.log("📦 Received OSM data, parsing network...");const u=this.parseOverpassData(a);if(u.nodes.size>0&&u.edges.size>0)return this.networkCache.set(n,u),console.log(`✅ Loaded OSM road network: ${u.nodes.size} nodes, ${u.edges.size} edges`),u;throw console.warn("⚠️ Empty network from Overpass API, using mock network"),new Error("Empty network data received")}catch(r){return console.error("❌ Failed to fetch road network from Overpass API:",r),console.log("🔄 Generating mock road network as fallback..."),this.generateMockNetwork(e)}}parseOverpassData(e){const n=new Map,r=new Map,i=new Map;return e.elements.filter(s=>s.type==="node").forEach(s=>{const a={id:s.id.toString(),latitude:s.lat,longitude:s.lon,type:"waypoint"};n.set(a.id,a)}),e.elements.filter(s=>{var a;return s.type==="way"&&((a=s.tags)==null?void 0:a.highway)}).forEach(s=>{var R;const a=this.classifyRoadType(s.tags.highway),u=this.getMaxSpeed(s.tags.highway,s.tags.maxspeed),h=s.tags.oneway==="yes",m=s.tags.toll==="yes",p=((R=s.geometry)==null?void 0:R.map(S=>({latitude:S.lat,longitude:S.lon})))||[];if(p.length<2)return;let _=0;for(let S=0;S<p.length-1;S++)_+=this.calculateDistance(p[S].latitude,p[S].longitude,p[S+1].latitude,p[S+1].longitude);const v=`way_${s.id}`,x=s.nodes[0].toString(),T=s.nodes[s.nodes.length-1].toString(),E={id:v,fromNodeId:x,toNodeId:T,distance:_,maxSpeed:u,roadType:a,wayType:s.tags.highway,coordinates:p,oneWay:h,tollRoad:m};if(r.set(v,E),[x,T].forEach(S=>{i.has(S)||i.set(S,[]),i.get(S).push(v)}),i.get(x).length>1&&n.has(x)){const S=n.get(x);S.type="intersection"}if(i.get(T).length>1&&n.has(T)){const S=n.get(T);S.type="intersection"}}),{nodes:n,edges:r,nodeEdges:i}}async findPath(e,n,r,i="time"){const s=`${n.latitude},${n.longitude}-${r.latitude},${r.longitude}-${i}`;if(this.pathfindingCache.has(s))return this.pathfindingCache.get(s);try{const a=this.findNearestNode(e,n),u=this.findNearestNode(e,r);if(!a||!u)return console.warn("Could not find nearest nodes for pathfinding"),null;console.log(`Pathfinding from node ${a.id} to ${u.id}`);const h=this.dijkstraPath(e,a,u,i);return h&&this.pathfindingCache.set(s,h),h}catch(a){return console.error("Pathfinding failed:",a),null}}dijkstraPath(e,n,r,i){const s=new Map,a=new Map,u=new Set;for(e.nodes.forEach((h,m)=>{s.set(m,m===n.id?0:1/0),a.set(m,null),u.add(m)});u.size>0;){let h="",m=1/0;for(const _ of u){const v=s.get(_);v<m&&(m=v,h=_)}if(!h||m===1/0)break;if(u.delete(h),h===r.id)return this.reconstructPath(e,a,n,r);const p=e.nodeEdges.get(h)||[];for(const _ of p){const v=e.edges.get(_),x=v.fromNodeId===h?v.toNodeId:v.fromNodeId;if(!u.has(x)||v.oneWay&&v.toNodeId===h)continue;const T=i==="distance"?v.distance:v.distance/(v.maxSpeed*1e3/3600),E=s.get(h)+T;E<s.get(x)&&(s.set(x,E),a.set(x,{nodeId:h,edgeId:_}))}}return null}reconstructPath(e,n,r,i){const s=[],a=[],u=[];let h=i.id;for(;h;){const _=e.nodes.get(h);s.unshift(_);const v=n.get(h);if(v){const x=e.edges.get(v.edgeId);a.unshift(x);const T=x.fromNodeId===v.nodeId?x.coordinates:[...x.coordinates].reverse();u.length===0?u.push(...T):u.push(...T.slice(1))}h=(v==null?void 0:v.nodeId)||null}const m=a.reduce((_,v)=>_+v.distance,0),p=a.reduce((_,v)=>{const x=v.maxSpeed*1e3/3600;return _+v.distance/x},0);return{nodes:s,edges:a,totalDistance:m,estimatedTime:p,coordinates:u}}findNearestNode(e,n){let r=null,i=1/0;return e.nodes.forEach(s=>{const a=this.calculateDistance(n.latitude,n.longitude,s.latitude,s.longitude);a<i&&(i=a,r=s)}),r}classifyRoadType(e){return{motorway:"highway",trunk:"highway",primary:"primary",secondary:"secondary",tertiary:"tertiary",unclassified:"tertiary",residential:"residential"}[e]||"residential"}getMaxSpeed(e,n){if(n){const i=parseInt(n);if(!isNaN(i))return i}return{motorway:100,trunk:80,primary:60,secondary:50,tertiary:40,unclassified:30,residential:30}[e]||30}calculateDistance(e,n,r,i){const a=(r-e)*Math.PI/180,u=(i-n)*Math.PI/180,h=Math.sin(a/2)*Math.sin(a/2)+Math.cos(e*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(u/2)*Math.sin(u/2);return 6371e3*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}generateMockNetwork(e){const n=new Map,r=new Map,i=new Map,s=.005;let a=1,u=1;for(let m=e.south;m<=e.north;m+=s)for(let p=e.west;p<=e.east;p+=s){const _=`node_${a++}`;n.set(_,{id:_,latitude:m,longitude:p,type:"intersection"})}const h=Array.from(n.values());return h.forEach(m=>{h.filter(_=>_.id===m.id?!1:this.calculateDistance(m.latitude,m.longitude,_.latitude,_.longitude)<600).forEach(_=>{const v=`edge_${u++}`,x=this.calculateDistance(m.latitude,m.longitude,_.latitude,_.longitude),T={id:v,fromNodeId:m.id,toNodeId:_.id,distance:x,maxSpeed:40,roadType:"secondary",wayType:"secondary",coordinates:[{latitude:m.latitude,longitude:m.longitude},{latitude:_.latitude,longitude:_.longitude}],oneWay:!1,tollRoad:!1};r.set(v,T),[m.id,_.id].forEach(E=>{i.has(E)||i.set(E,[]),i.get(E).push(v)})})}),console.log(`Generated mock network: ${n.size} nodes, ${r.size} edges`),{nodes:n,edges:r,nodeEdges:i}}}const l0=new zA;class BA{constructor(){Pr(this,"activeRoutes",new Map);Pr(this,"updateIntervals",new Map)}async optimizeRoute(e){const n=`route_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;try{const r=await this.getRouteAreaTrafficData(e.origin,e.destination),i=await this.getRouteOptionsFromAPI(e),s=await this.analyzeRoutesWithTraffic(i,r),a=this.selectRecommendedRoute(s,e.routePreference),u=this.calculateEstimatedArrivalTime(a,e.departureTime||new Date),h={requestId:n,routes:s,recommendedRoute:a,trafficUpdateTime:new Date,estimatedArrivalTime:u,alternativeRoutesCount:s.length-1};return this.activeRoutes.set(n,a),h}catch(r){throw console.error("Route optimization failed:",r),r}}startRouteMonitoring(e,n,r=5){this.stopRouteMonitoring(e);const i=setInterval(async()=>{try{const s=this.activeRoutes.get(e);if(!s){this.stopRouteMonitoring(e);return}const a=await this.checkRouteUpdates(s);a&&n(a)}catch(s){console.error("Route monitoring error:",s)}},r*60*1e3);this.updateIntervals.set(e,i)}stopRouteMonitoring(e){const n=this.updateIntervals.get(e);n&&(clearInterval(n),this.updateIntervals.delete(e)),this.activeRoutes.delete(e)}async getRouteAreaTrafficData(e,n){{const r=this.calculateRouteBounds(e,n,5);return a0.createMockTrafficData(r)}}async getRouteOptionsFromAPI(e){return console.log("🚗 Starting OSMnx-style route search from:",e.origin,"to:",e.destination),await this.generateRoadBasedRoutes(e)}async generateRoadBasedRoutes(e){const n=[],{origin:r,destination:i}=e;console.log("🛣️ Starting OSMnx-style routing from:",r,"to:",i),console.log("🔄 Trying OSRM API for real road-based routing...");const s=await this.tryExternalRoutingAPIs(r,i);if(s.length>0)return console.log(`✅ OSRM API routing successful: ${s.length} routes`),s;try{console.log("🗺️ Attempting OSMnx-style road network routing...");const u=this.calculateRouteBounds(r,i,3),h=await l0.getRoadNetwork(u);if(h.nodes.size>10){console.log(`📊 Loaded OSM road network: ${h.nodes.size} nodes, ${h.edges.size} edges`);const m=[{preference:"time",name:"最速ルート（OSM道路網）",description:"Time-optimized shortest path"},{preference:"distance",name:"最短距離ルート（OSM道路網）",description:"Distance-optimized shortest path"}];for(let p=0;p<m.length;p++){const _=m[p];try{const v=await l0.findPath(h,r,i,_.preference);if(v&&v.coordinates.length>2){console.log(`✅ Found ${_.preference} path: ${v.coordinates.length} points, ${Math.round(v.totalDistance)}m`);const x={id:`osmnx_route_${p}`,name:_.name,points:v.coordinates,distance:v.totalDistance,baseTime:v.estimatedTime,links:v.edges.map(T=>({linkId:T.id,distance:T.distance,roadType:T.roadType,maxSpeed:T.maxSpeed})),routingMethod:"osmnx_style",pathDescription:_.description};n.push(x)}}catch(v){console.warn(`⚠️ OSMnx pathfinding failed for ${_.preference}:`,v)}}if(n.length>0)return console.log(`📍 Generated ${n.length} OSMnx-style network routes`),n}else console.warn("⚠️ Insufficient OSM road network data for area")}catch(u){console.warn("⚠️ OSMnx-style road network routing failed:",u)}console.log("🔄 All network methods failed, creating enhanced road estimates...");const a=this.generateMultipleEstimatedRoutes(r,i);return n.push(...a),console.log(`📍 Generated ${n.length} total routes using fallback methods`),n}async tryExternalRoutingAPIs(e,n){const r=[],i=[{method:"osrm",profile:"driving"},{method:"graphhopper",profile:"car"},{method:"estimated",profile:"urban"}];for(const{method:s,profile:a}of i)try{let u=null;if(s==="osrm"?u=await this.getOSRMRoute(e,n,a):s==="graphhopper"?u=await this.getGraphHopperRoute(e,n,a):s==="estimated"&&(u=this.generateEstimatedRoadRoute(e,n)),u&&u.coordinates.length>2){console.log(`✅ ${s.toUpperCase()} route successful:`,u.coordinates.length,"points"),[{name:`最速ルート（${s==="estimated"?"道路推定":"API"}）`,factor:1},{name:`高速道路優先（${s==="estimated"?"道路推定":"API"}）`,factor:.9},{name:`一般道優先（${s==="estimated"?"道路推定":"API"}）`,factor:1.1}].forEach((m,p)=>{const _={id:`${s}_route_${p}`,name:m.name,points:u.coordinates,distance:u.distance*m.factor,baseTime:u.duration*m.factor,links:[],routingMethod:s};r.push(_)});break}}catch(u){console.warn(`⚠️ ${s.toUpperCase()} routing failed:`,u);continue}return r}async analyzeRoutesWithTraffic(e,n){const r=[];for(let i=0;i<e.length;i++){const s=e[i],a=this.analyzeTrafficImpact(s.points,n),u=this.calculateRouteSegments(s.points,a),h={id:s.id,name:s.name||`Route ${i+1}`,segments:u,totalDistance:s.distance,totalTime:s.baseTime,estimatedTimeWithTraffic:u.reduce((m,p)=>m+p.estimatedTime,0),trafficDelayFactor:a.delayFactor,coordinates:s.points,routeType:this.determineRouteType(a),confidence:a.confidence};r.push(h)}return r}analyzeTrafficImpact(e,n){let r=0,i=0,s=0;return e.forEach(a=>{const u=a0.calculateTrafficDensity(n,a,1e3);if(u>0){const h=1+u/100*.5;r+=h,i+=.8,s++}else r+=1,i+=.3,s++}),{delayFactor:s>0?r/s:1,confidence:s>0?i/s:.5,trafficPoints:s}}calculateRouteSegments(e,n){const r=[];for(let i=0;i<e.length-1;i++){const s=e[i],a=e[i+1],u=this.calculateDistance(s.latitude,s.longitude,a.latitude,a.longitude),m=u/15*n.delayFactor;r.push({startPoint:s,endPoint:a,distance:u,estimatedTime:m,trafficLevel:this.categorizeTrafficLevel(n.delayFactor),roadType:this.determineRoadType(u)})}return r}selectRecommendedRoute(e,n){switch(n){case"fastest":return e.reduce((r,i)=>i.estimatedTimeWithTraffic<r.estimatedTimeWithTraffic?i:r);case"most_stable":return e.reduce((r,i)=>i.confidence>r.confidence?i:r);case"shortest":return e.reduce((r,i)=>i.totalDistance<r.totalDistance?i:r);default:return e.reduce((r,i)=>i.estimatedTimeWithTraffic<r.estimatedTimeWithTraffic?i:r)}}async checkRouteUpdates(e){try{const n=await this.getRouteAreaTrafficData(e.coordinates[0],e.coordinates[e.coordinates.length-1]),r=this.analyzeTrafficImpact(e.coordinates,n),i=e.totalTime*r.delayFactor,a=Math.abs(i-e.estimatedTimeWithTraffic)/e.estimatedTimeWithTraffic;return a>.1?{routeId:e.id,updateTime:new Date,newEstimatedTime:i,trafficIncidents:[],severityLevel:a>.3?"critical":a>.2?"warning":"info"}:null}catch(n){return console.error("Route update check failed:",n),null}}calculateDistance(e,n,r,i){const a=(r-e)*Math.PI/180,u=(i-n)*Math.PI/180,h=Math.sin(a/2)*Math.sin(a/2)+Math.cos(e*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(u/2)*Math.sin(u/2);return 6371e3*(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)))}calculateRouteBounds(e,n,r){const i=r/111,s=r/(111*Math.abs(Math.cos(e.latitude*Math.PI/180)));return{west:Math.min(e.longitude,n.longitude)-s,south:Math.min(e.latitude,n.latitude)-i,east:Math.max(e.longitude,n.longitude)+s,north:Math.max(e.latitude,n.latitude)+i}}async getOSRMRoute(e,n,r="driving"){try{console.log(`🗺️ Attempting OSRM route from [${e.latitude}, ${e.longitude}] to [${n.latitude}, ${n.longitude}]`);const i="https://router.project-osrm.org/route/v1/driving",s=`${e.longitude},${e.latitude};${n.longitude},${n.latitude}`,a=`${i}/${s}?overview=full&geometries=geojson`;console.log("🔍 OSRM request URL:",a);const u=await fetch(a,{method:"GET",headers:{Accept:"application/json"}});if(u.ok){const p=await u.json();if(console.log("✅ OSRM response received:",p),p.routes&&p.routes.length>0){const _=p.routes[0],v=_.geometry;if(v&&v.coordinates&&v.coordinates.length>0){const x=v.coordinates.map(([T,E])=>({latitude:E,longitude:T}));return console.log(`✅ OSRM route successful: ${x.length} points, ${Math.round(_.distance)}m, ${Math.round(_.duration)}s`),{coordinates:x,distance:_.distance,duration:_.duration}}}}else console.warn("⚠️ OSRM API error:",u.status,u.statusText);const h=await this.getGraphHopperRoute(e,n,r);if(h)return console.log("✅ GraphHopper route found with",h.coordinates.length,"points"),h;const m=this.generateEstimatedRoadRoute(e,n);return m?(console.log("📍 Using estimated road route with",m.coordinates.length,"points"),m):(console.warn("⚠️ All routing methods failed"),null)}catch(i){return console.error("❌ Route service error:",i),null}}async getGraphHopperRoute(e,n,r){try{console.log("Trying GraphHopper API...");const i="https://graphhopper.com/api/1/route",s=new URLSearchParams;s.append("point",`${e.latitude},${e.longitude}`),s.append("point",`${n.latitude},${n.longitude}`),s.append("vehicle","car"),s.append("locale","ja"),s.append("instructions","false"),s.append("calc_points","true"),s.append("debug","false"),s.append("elevation","false"),s.append("points_encoded","false"),console.log(`GraphHopper API for ${r} profile`);const a=await fetch(`${i}?${s}`,{method:"GET",headers:{Accept:"application/json"}});if(a.ok){const u=await a.json();if(console.log("GraphHopper response:",u),u.paths&&u.paths.length>0){const h=u.paths[0];return{coordinates:h.points.coordinates.map(p=>({latitude:p[1],longitude:p[0]})),distance:h.distance,duration:h.time/1e3}}}else{const u=await a.text();console.error("GraphHopper API error:",a.status,u)}}catch(i){console.warn("GraphHopper failed:",i)}return null}generateEstimatedRoadRoute(e,n){try{console.log("Generating estimated road route...");const r=this.generateEnhancedRoadPoints(e,n,"balanced");let i=0;for(let a=0;a<r.length-1;a++)i+=this.calculateDistance(r[a].latitude,r[a].longitude,r[a+1].latitude,r[a+1].longitude);const s=i/(25*1e3/3600);return{coordinates:r,distance:i,duration:s}}catch(r){return console.error("Estimated route generation failed:",r),null}}generateMultipleEstimatedRoutes(e,n){const r=[],i=this.calculateDistance(e.latitude,e.longitude,n.latitude,n.longitude);return[{name:"最速推定ルート（幹線道路優先）",distanceFactor:1.3,speedFactor:1.1,pathStyle:"arterial"},{name:"安定推定ルート（バランス重視）",distanceFactor:1.4,speedFactor:1,pathStyle:"balanced"},{name:"迂回推定ルート（渋滞回避）",distanceFactor:1.6,speedFactor:.9,pathStyle:"alternative"}].forEach((a,u)=>{const h=this.generateEnhancedRoadPoints(e,n,a.pathStyle),m=i*a.distanceFactor,_=25*a.speedFactor,v=m/1e3/_*3600;r.push({id:`estimated_route_${u}`,name:a.name,points:h,distance:m,baseTime:v,links:[],routingMethod:"enhanced_estimation"})}),r}generateEnhancedRoadPoints(e,n,r){const i=[e],s=this.calculateDistance(e.latitude,e.longitude,n.latitude,n.longitude),u=Math.max(20,Math.floor(s/200)),h=this.generateRoadWaypoints(e,n,r);for(let m=1;m<u;m++){const p=m/u,_=Math.floor(p*(h.length-1)),v=p*(h.length-1)-_;if(_>=h.length-1)break;const x=h[_],T=h[_+1],E=this.bezierInterpolation(x,T,v);i.push(E)}return i.push(n),i}generateRoadWaypoints(e,n,r){const i=[e],s=n.latitude-e.latitude,a=n.longitude-e.longitude,u=Math.max(3,Math.floor(Math.abs(s)+Math.abs(a))*500);for(let h=1;h<u;h++){const m=h/u;let p=e.latitude+s*m,_=e.longitude+a*m;switch(r){case"arterial":m<.3?(_=e.longitude+a*.1,p=e.latitude+s*m/.3*.7):m<.7?(p=e.latitude+s*.7,_=e.longitude+a*(m-.3)/.4*.8):(p=e.latitude+s*(.7+(m-.7)/.3*.3),_=e.longitude+a*(.8+(m-.7)/.3*.2));break;case"alternative":const v=Math.sin(m*Math.PI)*.003,x=Math.cos(m*Math.PI*1.5)*.002;p+=v,_+=x;break;case"balanced":default:const T=Math.sin(m*Math.PI*.8)*.001,E=Math.cos(m*Math.PI*.6)*8e-4;p+=T,_+=E;break}i.push({latitude:p,longitude:_})}return i.push(n),i}bezierInterpolation(e,n,r){const i=n.latitude-e.latitude,s=n.longitude-e.longitude,a={latitude:e.latitude+i*.3+s*.1,longitude:e.longitude+s*.3-i*.1},u={latitude:e.latitude+i*.7-s*.1,longitude:e.longitude+s*.7+i*.1},h=1-r,m=r*r,p=h*h,_=p*h,v=m*r,x=_*e.latitude+3*p*r*a.latitude+3*h*m*u.latitude+v*n.latitude,T=_*e.longitude+3*p*r*a.longitude+3*h*m*u.longitude+v*n.longitude;return{latitude:x,longitude:T}}categorizeTrafficLevel(e){return e<1.1?"low":e<1.3?"medium":e<1.6?"high":"congested"}determineRoadType(e){return e>5e3?"highway":e>1e3?"arterial":"local"}determineRouteType(e){return e.confidence>.8?"most_stable":e.delayFactor<1.2?"fastest":"shortest"}calculateEstimatedArrivalTime(e,n){const r=new Date(n);return r.setSeconds(r.getSeconds()+e.estimatedTimeWithTraffic),r}async saveRoutePerformance(e){try{if(ui.demoMode){const n=localStorage.getItem("routePerformance")||"[]",r=JSON.parse(n);r.push(e),localStorage.setItem("routePerformance",JSON.stringify(r))}}catch(n){console.error("Failed to save route performance:",n)}}async getRouteAnalytics(){try{if(ui.demoMode){const e=localStorage.getItem("routePerformance")||"[]",n=JSON.parse(e);if(n.length===0)return this.generateMockAnalytics();const r=n.length,i=n.reduce((a,u)=>a+u.accuracy,0)/r,s=n.reduce((a,u)=>a+Math.max(0,u.plannedTime-u.actualTime),0);return{averageAccuracy:i,totalRoutesOptimized:r,timeSaved:s,mostEfficientTimeSlots:this.calculateEfficientTimeSlots(n),problematicAreas:[]}}return this.generateMockAnalytics()}catch(e){return console.error("Failed to get route analytics:",e),this.generateMockAnalytics()}}generateMockAnalytics(){return{averageAccuracy:.85,totalRoutesOptimized:47,timeSaved:1420,mostEfficientTimeSlots:[{hour:6,averageSpeed:45,reliability:.9},{hour:10,averageSpeed:40,reliability:.85},{hour:14,averageSpeed:38,reliability:.8},{hour:22,averageSpeed:50,reliability:.95}],problematicAreas:[{location:{latitude:35.6762,longitude:139.6503},frequency:12,averageDelay:180},{location:{latitude:35.7028,longitude:139.7753},frequency:8,averageDelay:120}]}}calculateEfficientTimeSlots(e){const n=new Map;e.forEach(i=>{const s=new Date(i.completedAt).getHours();n.has(s)||n.set(s,{speeds:[],accuracies:[]});const a=i.plannedTime>0?1e3/i.plannedTime*3.6:30;n.get(s).speeds.push(a),n.get(s).accuracies.push(i.accuracy)});const r=[];for(const[i,s]of n.entries()){const a=s.speeds.reduce((h,m)=>h+m,0)/s.speeds.length,u=s.accuracies.reduce((h,m)=>h+m,0)/s.accuracies.length;r.push({hour:i,averageSpeed:a,reliability:u})}return r.sort((i,s)=>s.reliability-i.reliability).slice(0,4)}}const _c=new BA,UA=(t={})=>{const[e,n]=B.useState(!1),[r,i]=B.useState(null),[s,a]=B.useState(null),[u,h]=B.useState([]),[m,p]=B.useState(null),[_,v]=B.useState(!1),x=B.useRef(null),T=B.useRef(!1),{autoUpdate:E=!0,updateInterval:R=5,onRouteUpdate:S,onError:C}=t,A=B.useCallback(async z=>{n(!0),p(null);try{const j=await _c.optimizeRoute(z);return i(j),a(j.recommendedRoute),x.current=new Date,E&&setTimeout(()=>Z(),1e3),j}catch(j){const me=j instanceof Error?j.message:"Route optimization failed";return p(me),C==null||C(j instanceof Error?j:new Error(me)),null}finally{n(!1)}},[E,C]),U=B.useCallback(z=>{if(!r)return;const j=r.routes.find(me=>me.id===z);j&&(a(j),i(me=>me?{...me,recommendedRoute:j}:null),_&&(V(),setTimeout(()=>Z(),1e3)))},[r,_]),Z=B.useCallback(()=>{!s||!r||T.current||(T.current=!0,v(!0),_c.startRouteMonitoring(r.requestId,z=>{h(j=>[z,...j].slice(0,10)),S==null||S(z),z.alternativeRecommendation&&a(z.alternativeRecommendation)},R))},[s,r,R,S]),V=B.useCallback(()=>{!r||!T.current||(_c.stopRouteMonitoring(r.requestId),T.current=!1,v(!1))},[r]),k=B.useCallback(()=>{p(null)},[]),N=B.useCallback(async(z,j=[])=>{if(!(!s||!r||!x.current))try{const me=s.estimatedTimeWithTraffic,Ve=Math.max(0,1-Math.abs(z-me)/me),Te={routeId:s.id,caseId:r.requestId,plannedTime:me,actualTime:z,accuracy:Ve,trafficConditions:s.segments.some(se=>se.trafficLevel==="congested")?"heavy":s.segments.some(se=>se.trafficLevel==="high")?"moderate":"light",completedAt:new Date,deviations:j};await _c.saveRoutePerformance(Te),V()}catch(me){console.error("Failed to record route performance:",me)}},[s,r,V]),D=B.useCallback(()=>r?r.estimatedArrivalTime:null,[r]),M=B.useCallback(()=>!s||!r?0:r.routes.reduce((j,me)=>me.estimatedTimeWithTraffic>j.estimatedTimeWithTraffic?me:j).estimatedTimeWithTraffic-s.estimatedTimeWithTraffic,[s,r]),F=B.useCallback(()=>{if(!s)return null;const z=s.segments.map(j=>j.trafficLevel);return z.some(j=>j==="congested")?"congested":z.some(j=>j==="high")?"high":z.some(j=>j==="medium")?"medium":"low"},[s]);return B.useEffect(()=>()=>{T.current&&V()},[V]),B.useEffect(()=>{if(m){const z=setTimeout(()=>p(null),1e4);return()=>clearTimeout(z)}},[m]),{isOptimizing:e,optimizationResult:r,currentRoute:s,routeUpdates:u,error:m,optimizeRoute:A,selectRoute:U,startMonitoring:Z,stopMonitoring:V,clearError:k,recordRoutePerformance:N,getETA:D,getTimeSaved:M,getTrafficLevel:F}},xb=()=>{const[t,e]=B.useState(null),[n,r]=B.useState(!1),i=B.useCallback(async()=>{r(!0);try{const s=await _c.getRouteAnalytics();e(s)}catch(s){console.error("Failed to load analytics:",s)}finally{r(!1)}},[]);return B.useEffect(()=>{i()},[i]),{analytics:t,isLoading:n,refreshAnalytics:i}},wb=({currentLocation:t,sceneLocation:e,onRouteSelected:n,onNavigationStart:r,onHospitalSelected:i,className:s=""})=>{var W,fe,X;const[a,u]=B.useState({routePreference:"fastest",vehicleType:"emergency"}),[h,m]=B.useState(null),[p,_]=B.useState(!1),[v,x]=B.useState("current"),{isOptimizing:T,optimizationResult:E,currentRoute:R,routeUpdates:S,error:C,optimizeRoute:A,selectRoute:U,startMonitoring:Z,clearError:V,getETA:k,getTimeSaved:N,getTrafficLevel:D}=UA({autoUpdate:!0,updateInterval:3,onRouteUpdate:Y=>{console.log("Route update received:",Y)}}),{analytics:M}=xb();B.useEffect(()=>{if(console.log("Origin type changed:",v),console.log("Current location:",t),console.log("Scene location:",e),v==="scene"&&!e&&t){console.log("Scene location not available, switching to current location"),x("current");return}(()=>{v==="current"&&t?(console.log("Setting origin to current location"),u(ce=>({...ce,origin:{latitude:t.latitude,longitude:t.longitude,name:"現在地"}}))):v==="scene"&&e?(console.log("Setting origin to scene location"),u(ce=>({...ce,origin:{latitude:e.latitude,longitude:e.longitude,name:"現場（患者位置）"}}))):console.log("Cannot set origin - missing location data for type:",v)})()},[v,t,e]),B.useEffect(()=>{h&&(u(Y=>({...Y,destination:{latitude:h.latitude,longitude:h.longitude,name:h.name}})),i==null||i(h))},[h,i]);const F=async()=>{if(!a.origin||!a.destination){alert("出発地と目的地を設定してください");return}const Y={origin:a.origin,destination:a.destination,routePreference:a.routePreference||"fastest",departureTime:new Date,vehicleType:"emergency"};await A(Y)},z=Y=>{U(Y);const ce=E==null?void 0:E.routes.find(Ie=>Ie.id===Y);ce&&(n==null||n(ce))},j=()=>{R&&(r==null||r(R),Z())},me=Y=>{const ce=Math.floor(Y/60),Ie=Math.floor(ce/60),Oe=ce%60;return Ie>0?`${Ie}時間${Oe}分`:`${ce}分`},Ve=Y=>Y>=1e3?`${(Y/1e3).toFixed(1)}km`:`${Math.round(Y)}m`,Te=Y=>{switch(Y){case"low":return"text-green-600 bg-green-100";case"medium":return"text-yellow-600 bg-yellow-100";case"high":return"text-orange-600 bg-orange-100";case"congested":return"text-red-600 bg-red-100";default:return"text-gray-600 bg-gray-100"}},se=Y=>{switch(Y){case"fastest":return"⚡";case"most_stable":return"🎯";case"shortest":return"📏";default:return"🚗"}};return c.jsxs("div",{className:`bg-white rounded-lg shadow-lg p-6 ${s}`,children:[c.jsxs("div",{className:"flex items-center justify-between mb-6",children:[c.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"ルート最適化"}),c.jsxs("div",{className:"flex space-x-2",children:[c.jsx(Le,{size:"sm",variant:"outline",onClick:()=>_(!p),children:"📊 分析"}),R&&c.jsx(Le,{size:"sm",onClick:j,className:"bg-blue-600 text-white",children:"🧭 ナビ開始"})]})]}),C&&c.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center",children:[c.jsx("span",{className:"text-red-600 mr-2",children:"⚠️"}),c.jsx("span",{className:"text-red-800",children:C})]}),c.jsx(Le,{size:"sm",variant:"outline",onClick:V,children:"✕"})]})}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"出発地"}),c.jsx("div",{className:"mb-2",children:c.jsxs("div",{className:"flex space-x-4",children:[c.jsxs("label",{className:`flex items-center cursor-pointer ${t?"":"opacity-50"}`,children:[c.jsx("input",{type:"radio",name:"originType",value:"current",checked:v==="current",onChange:()=>x("current"),disabled:!t,className:"mr-2 text-blue-600 focus:ring-blue-500"}),c.jsxs("span",{className:"text-sm text-gray-700",children:["現在地 ",!t&&"(取得中...)"]})]}),c.jsxs("label",{className:`flex items-center cursor-pointer ${e?"":"opacity-50"}`,children:[c.jsx("input",{type:"radio",name:"originType",value:"scene",checked:v==="scene",onChange:()=>x("scene"),disabled:!e,className:"mr-2 text-blue-600 focus:ring-blue-500"}),c.jsxs("span",{className:"text-sm text-gray-700",children:["現場（患者位置） ",!e&&"(データなし)"]})]})]})}),c.jsx(ue,{type:"text",value:(W=a.origin)!=null&&W.name?`${a.origin.name} (${a.origin.latitude.toFixed(4)}, ${a.origin.longitude.toFixed(4)})`:v==="current"?"現在地を取得中...":"現場位置を取得中...",placeholder:"位置を設定中...",readOnly:!0,className:"bg-gray-50"}),!1]}),c.jsx("div",{children:c.jsx(OA,{currentLocation:t,selectedHospital:h||void 0,onHospitalSelect:m})}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ルート優先度"}),c.jsxs("select",{value:a.routePreference,onChange:Y=>u(ce=>({...ce,routePreference:Y.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",children:[c.jsx("option",{value:"fastest",children:"最速"}),c.jsx("option",{value:"most_stable",children:"最安定"}),c.jsx("option",{value:"shortest",children:"最短距離"})]})]})]}),c.jsxs("div",{className:"flex justify-center mb-6",children:[c.jsx(Le,{onClick:F,disabled:T||!a.origin||!a.destination||!h,className:"bg-green-600 text-white px-6 py-2",children:T?c.jsx(_r,{size:"sm"}):"🔍 ルート最適化"}),!h&&c.jsx("p",{className:"text-sm text-gray-500 mt-2 text-center",children:"搬送先病院を選択してください"})]}),E&&c.jsxs("div",{className:"space-y-6",children:[R&&c.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsxs("h3",{className:"text-lg font-medium text-blue-900",children:[se(R.routeType)," ",R.name]}),c.jsxs("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${Te(D()||"low")}`,children:[D()==="low"&&"🟢 渋滞少",D()==="medium"&&"🟡 やや混雑",D()==="high"&&"🟠 混雑",D()==="congested"&&"🔴 渋滞"]})]}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-600",children:"距離:"}),c.jsx("div",{className:"font-medium",children:Ve(R.totalDistance)})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-600",children:"所要時間:"}),c.jsx("div",{className:"font-medium",children:me(R.estimatedTimeWithTraffic)})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-600",children:"到着予定:"}),c.jsx("div",{className:"font-medium",children:((fe=k())==null?void 0:fe.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}))||"--:--"})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-gray-600",children:"短縮時間:"}),c.jsx("div",{className:"font-medium text-green-600",children:N()>0?`+${me(N())}`:"基準ルート"})]})]})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"ルート選択肢"}),c.jsx("div",{className:"space-y-3",children:E.routes.map(Y=>c.jsxs("div",{className:`border rounded-lg p-4 cursor-pointer transition-colors ${(R==null?void 0:R.id)===Y.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>z(Y.id),children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"text-lg",children:se(Y.routeType)}),c.jsx("span",{className:"font-medium",children:Y.name}),c.jsxs("span",{className:`px-2 py-1 rounded-full text-xs ${Y.confidence>.8?"bg-green-100 text-green-800":Y.confidence>.6?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:["信頼度 ",Math.round(Y.confidence*100),"%"]})]}),(R==null?void 0:R.id)===Y.id&&c.jsx("span",{className:"text-blue-600 text-sm",children:"✓ 選択中"})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-4 text-sm text-gray-600",children:[c.jsxs("div",{children:["距離: ",Ve(Y.totalDistance)]}),c.jsxs("div",{children:["時間: ",me(Y.estimatedTimeWithTraffic)]}),c.jsxs("div",{children:["遅延率: ×",Y.trafficDelayFactor.toFixed(1)]})]})]},Y.id))})]}),S.length>0&&c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-3",children:"リアルタイム更新"}),c.jsx("div",{className:"space-y-2 max-h-40 overflow-y-auto",children:S.map((Y,ce)=>c.jsx("div",{className:`p-3 rounded-lg text-sm ${Y.severityLevel==="critical"?"bg-red-50 border border-red-200":Y.severityLevel==="warning"?"bg-yellow-50 border border-yellow-200":"bg-blue-50 border border-blue-200"}`,children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("div",{children:c.jsxs("span",{className:"font-medium",children:[Y.severityLevel==="critical"?"🚨":Y.severityLevel==="warning"?"⚠️":"ℹ️"," ","所要時間更新: ",me(Y.newEstimatedTime)]})}),c.jsx("span",{className:"text-gray-500",children:Y.updateTime.toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"})})]})},ce))})]})]}),p&&M&&c.jsxs("div",{className:"mt-6 border-t pt-6",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"📊 ルート分析"}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[c.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[c.jsx("div",{className:"text-sm text-gray-600",children:"予測精度"}),c.jsxs("div",{className:"text-xl font-semibold",children:[Math.round(M.averageAccuracy*100),"%"]})]}),c.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[c.jsx("div",{className:"text-sm text-gray-600",children:"最適化回数"}),c.jsx("div",{className:"text-xl font-semibold",children:M.totalRoutesOptimized})]}),c.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[c.jsx("div",{className:"text-sm text-gray-600",children:"短縮時間"}),c.jsx("div",{className:"text-xl font-semibold text-green-600",children:me(M.timeSaved)})]}),c.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[c.jsx("div",{className:"text-sm text-gray-600",children:"効率的時間帯"}),c.jsxs("div",{className:"text-xl font-semibold",children:[((X=M.mostEfficientTimeSlots[0])==null?void 0:X.hour)||"--","時"]})]})]}),c.jsxs("div",{children:[c.jsx("h4",{className:"text-md font-medium text-gray-800 mb-2",children:"効率的な時間帯"}),c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:M.mostEfficientTimeSlots.map((Y,ce)=>c.jsxs("div",{className:"bg-green-50 rounded p-2 text-sm",children:[c.jsxs("div",{className:"font-medium",children:[Y.hour,":00-",Y.hour+1,":00"]}),c.jsxs("div",{className:"text-gray-600",children:[Y.averageSpeed.toFixed(0),"km/h, 信頼度",Math.round(Y.reliability*100),"%"]})]},ce))})]})]}),T&&c.jsxs("div",{className:"flex justify-center py-8",children:[c.jsx(_r,{size:"lg"}),c.jsx("span",{className:"ml-3 text-gray-600",children:"交通データを取得してルートを最適化中..."})]})]})},$A=()=>{const{caseId:t}=eb(),e=js(),{currentCase:n,loading:r,error:i,loadCurrentCase:s,startObservingCase:a,stopObservingCase:u,updateStatus:h}=vf(),{userInfo:m}=Ds(),p=B.useRef(!0),[_,v]=B.useState("vitals"),[x,T]=B.useState(null),[E,R]=B.useState(null),[S,C]=B.useState(null),A=async V=>{if(t)try{await h(t,V)}catch(k){console.error("Status update failed:",k),alert("ステータス更新に失敗しました")}},U=V=>{switch(V){case fr.DISPATCHED:return{status:fr.ON_SCENE,label:"現場到着"};case fr.ON_SCENE:return{status:fr.TRANSPORTING,label:"搬送開始"};case fr.TRANSPORTING:return{status:fr.COMPLETED,label:"搬送完了"};default:return null}},Z=V=>{T(V)};return B.useEffect(()=>(p.current=!0,t?((async()=>{try{p.current&&(await s(t),p.current&&a(t))}catch(k){console.error("Failed to load case:",k)}})(),()=>{p.current=!1;try{u()}catch(k){console.error("Cleanup error:",k)}}):void 0),[t]),B.useEffect(()=>()=>{p.current=!1},[]),t?r?c.jsx("div",{className:"min-h-screen flex items-center justify-center",children:c.jsx(_r,{size:"lg"})}):i?c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:c.jsxs("div",{className:"text-center",children:[c.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"エラーが発生しました"}),c.jsx("p",{className:"text-gray-600 mb-6",children:i}),c.jsx("button",{onClick:()=>{p.current=!1;try{u()}catch(V){console.error("Stop observing error:",V)}setTimeout(()=>{try{e("/cases")}catch(V){console.error("Navigation error:",V),window.location.href="/cases"}},100)},className:"bg-medical-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"事案一覧に戻る"})]})}):n?c.jsxs("div",{className:"min-h-screen bg-gray-50",children:[c.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:c.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:c.jsxs("div",{className:"flex items-center justify-between h-16",children:[c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("button",{onClick:()=>{p.current=!1;try{u()}catch(V){console.error("Stop observing error:",V)}setTimeout(()=>{try{e("/cases")}catch(V){console.error("Navigation error:",V),window.location.href="/cases"}},100)},className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:c.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:n.caseName}),c.jsxs("p",{className:"text-sm text-gray-500",children:["ステータス: ",n.status," | 担当: ",n.teamId]})]})]}),c.jsxs("div",{className:"flex items-center space-x-4",children:[(()=>{const V=U(n.status);return V?c.jsx(Le,{size:"sm",onClick:()=>A(V.status),children:V.label}):null})(),c.jsx(Le,{size:"sm",variant:"outline",onClick:()=>e(`/cases/${t}/registry`),children:"レジストリ入力"}),c.jsx("div",{className:"text-sm text-gray-700",children:c.jsx("span",{className:"font-medium",children:m==null?void 0:m.name})})]})]})})}),c.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:c.jsxs("div",{className:"px-4 py-6 sm:px-0",children:[c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[c.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"位置情報"}),c.jsx("div",{className:"h-64",children:c.jsx(wA,{sceneLocation:n.sceneLocation,hospitalLocation:n.hospitalLocation,currentLocation:x||void 0,selectedRoute:E,selectedHospital:S,showFullscreenButton:!0})}),c.jsx("div",{className:"mt-3 text-sm text-gray-600",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsxs("div",{className:"flex items-center",children:[c.jsx("div",{className:"w-3 h-3 bg-red-600 rounded-full mr-1"}),c.jsx("span",{children:"現場"})]}),c.jsxs("div",{className:"flex items-center",children:[c.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full mr-1"}),c.jsx("span",{children:"搬送先病院"})]}),x&&c.jsxs("div",{className:"flex items-center",children:[c.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full mr-1"}),c.jsx("span",{children:"現在地"})]}),E&&c.jsxs("div",{className:"flex items-center",children:[c.jsx("div",{className:"w-4 h-1 bg-blue-500 rounded mr-1"}),c.jsx("span",{children:"ルート"})]})]}),c.jsx("div",{className:"text-xs text-gray-500",children:"📱 右上ボタンで全画面表示"})]})}),c.jsx("div",{className:"mt-4",children:c.jsx(AA,{onLocationUpdate:Z})}),n.patientInfo.buildingInfo&&c.jsxs("div",{className:"mt-4 bg-blue-50 rounded-lg p-4 border border-blue-200",children:[c.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"📍 現場情報"}),c.jsxs("div",{className:"text-sm text-blue-800",children:[c.jsxs("div",{className:"mb-1",children:[c.jsx("span",{className:"font-medium",children:"建物:"})," ",n.patientInfo.buildingInfo.buildingName]}),c.jsxs("div",{className:"mb-1",children:[c.jsx("span",{className:"font-medium",children:"階数:"})," ",n.patientInfo.buildingInfo.floor,"階"]}),n.patientInfo.buildingInfo.description&&c.jsxs("div",{className:"mb-1",children:[c.jsx("span",{className:"font-medium",children:"詳細:"})," ",n.patientInfo.buildingInfo.description]}),n.patientInfo.buildingInfo.accessNotes&&c.jsxs("div",{className:"mt-2 p-2 bg-blue-100 rounded",children:[c.jsx("span",{className:"font-medium",children:"アクセス情報:"}),c.jsx("br",{}),n.patientInfo.buildingInfo.accessNotes]})]})]}),c.jsx("div",{className:"mt-4",children:c.jsx(VA,{location:n.sceneLocation})}),c.jsxs("div",{className:"mt-6 border-t pt-4",children:[c.jsx("h4",{className:"text-md font-medium text-gray-900 mb-4",children:"🚗 ルート最適化"}),c.jsx(wb,{currentLocation:x||void 0,sceneLocation:{latitude:n.sceneLocation.latitude,longitude:n.sceneLocation.longitude},onRouteSelected:V=>{var k;console.log("Route selected:",V),console.log("Route coordinates:",V==null?void 0:V.coordinates),console.log("Route coordinates length:",(k=V==null?void 0:V.coordinates)==null?void 0:k.length),R(V)},onNavigationStart:V=>{console.log("Navigation started:",V),alert("ナビゲーションを開始しました")},onHospitalSelected:V=>{console.log("Hospital selected:",V),C(V)}})]})]}),c.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"患者情報"}),n.patientInfo.name&&c.jsxs("div",{className:"mb-3",children:[c.jsx("span",{className:"text-sm font-medium text-gray-500",children:"氏名: "}),c.jsx("span",{className:"text-sm text-gray-900",children:n.patientInfo.name})]}),n.patientInfo.age&&c.jsxs("div",{className:"mb-3",children:[c.jsx("span",{className:"text-sm font-medium text-gray-500",children:"年齢: "}),c.jsxs("span",{className:"text-sm text-gray-900",children:[n.patientInfo.age,"歳"]})]}),n.patientInfo.gender&&c.jsxs("div",{className:"mb-3",children:[c.jsx("span",{className:"text-sm font-medium text-gray-500",children:"性別: "}),c.jsx("span",{className:"text-sm text-gray-900",children:n.patientInfo.gender==="male"?"男性":n.patientInfo.gender==="female"?"女性":"その他"})]}),c.jsx("div",{className:"mt-6 border-b border-gray-200",children:c.jsxs("nav",{className:"-mb-px flex space-x-8",children:[c.jsx("button",{onClick:()=>v("vitals"),className:`py-2 px-1 border-b-2 font-medium text-sm ${_==="vitals"?"border-medical-primary text-medical-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"バイタル"}),c.jsx("button",{onClick:()=>v("treatments"),className:`py-2 px-1 border-b-2 font-medium text-sm ${_==="treatments"?"border-medical-primary text-medical-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"処置記録"})]})}),c.jsx("div",{className:"mt-4",children:_==="vitals"?c.jsx(bA,{caseId:t}):c.jsx(PA,{caseId:t})})]})]}),c.jsxs("div",{className:"mt-6 bg-white rounded-lg shadow p-6",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"コミュニケーション"}),c.jsx("div",{className:"h-64",children:c.jsx(IA,{caseId:t})})]})]})})]}):c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:c.jsxs("div",{className:"text-center",children:[c.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"事案が見つかりません"}),c.jsx("p",{className:"text-gray-600 mb-6",children:"指定された事案は存在しないか、アクセス権限がありません。"}),c.jsx("button",{onClick:()=>{p.current=!1;try{u()}catch(V){console.error("Stop observing error:",V)}setTimeout(()=>{try{e("/cases")}catch(V){console.error("Navigation error:",V),window.location.href="/cases"}},100)},className:"bg-medical-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"事案一覧に戻る"})]})}):c.jsx($a,{to:"/cases",replace:!0})},Am={latitude:35.701835,longitude:139.763417,name:"基地病院"},qA=[{id:"scene-001",name:"東京大学本郷キャンパス",latitude:35.7122,longitude:139.7629,address:"東京都文京区本郷7-3-1",locationType:"public",landmarks:["安田講堂","赤門","正門"],accessNotes:"正門から入構可能"},{id:"scene-002",name:"上野公園",latitude:35.7156,longitude:139.7745,address:"東京都台東区上野公園",locationType:"public",landmarks:["上野動物園","国立博物館","西郷隆盛像"],accessNotes:"複数の入口あり、噴水広場が目印"},{id:"scene-003",name:"秋葉原駅周辺",latitude:35.6984,longitude:139.7732,address:"東京都千代田区外神田1丁目",locationType:"commercial",landmarks:["秋葉原駅","ヨドバシカメラ","電気街"],accessNotes:"駅前ロータリー利用可能"},{id:"scene-004",name:"皇居東御苑",latitude:35.6862,longitude:139.7571,address:"東京都千代田区千代田1-1",locationType:"public",landmarks:["大手門","三の丸尚蔵館","本丸跡"],accessNotes:"大手門から入場、警備員に要連絡"},{id:"scene-005",name:"銀座中央通り",latitude:35.6706,longitude:139.7641,address:"東京都中央区銀座4丁目",locationType:"commercial",landmarks:["銀座四丁目交差点","三越","和光"],accessNotes:"歩行者天国時間に注意"},{id:"scene-006",name:"東京スカイツリー周辺",latitude:35.7101,longitude:139.8107,address:"東京都墨田区押上1丁目",locationType:"commercial",landmarks:["東京スカイツリー","ソラマチ","押上駅"],accessNotes:"観光バス駐車場利用可能"},{id:"scene-007",name:"日本橋地区",latitude:35.6833,longitude:139.7731,address:"東京都中央区日本橋1丁目",locationType:"commercial",landmarks:["日本橋","三越本店","コレド日本橋"],accessNotes:"首都高下、道路状況に注意"},{id:"scene-008",name:"浅草寺境内",latitude:35.7148,longitude:139.7967,address:"東京都台東区浅草2-3-1",locationType:"public",landmarks:["雷門","五重塔","本堂"],accessNotes:"仲見世通りは車両進入不可"},{id:"scene-009",name:"神田駅周辺",latitude:35.6918,longitude:139.7708,address:"東京都千代田区内神田3丁目",locationType:"commercial",landmarks:["神田駅","神田明神","万世橋"],accessNotes:"駅前タクシー乗り場利用可能"},{id:"scene-010",name:"後楽園・東京ドーム",latitude:35.7056,longitude:139.7523,address:"東京都文京区後楽1丁目",locationType:"public",landmarks:["東京ドーム","後楽園遊園地","ラクーア"],accessNotes:"イベント開催時は交通規制あり"},{id:"scene-011",name:"新宿区役所周辺",latitude:35.6938,longitude:139.7035,address:"東京都新宿区歌舞伎町1丁目",locationType:"public",landmarks:["新宿区役所","新宿中央公園","都庁"],accessNotes:"区役所駐車場利用可能"},{id:"scene-012",name:"築地場外市場",latitude:35.6654,longitude:139.7707,address:"東京都中央区築地4丁目",locationType:"commercial",landmarks:["築地本願寺","場外市場","築地川公園"],accessNotes:"早朝は市場関係車両に注意"},{id:"scene-013",name:"錦糸町駅前",latitude:35.6967,longitude:139.8147,address:"東京都墨田区江東橋3丁目",locationType:"transport",landmarks:["錦糸町駅","アルカキット","オリナス"],accessNotes:"南口ロータリー利用推奨"},{id:"scene-014",name:"品川区役所周辺",latitude:35.6092,longitude:139.7301,address:"東京都品川区広町2丁目",locationType:"public",landmarks:["品川区役所","しながわ中央公園"],accessNotes:"区役所正面駐車場利用可能"},{id:"scene-015",name:"亀戸天神社",latitude:35.697,longitude:139.8256,address:"東京都江東区亀戸3-6-1",locationType:"public",landmarks:["亀戸天神社","スカイツリー展望","藤の花"],accessNotes:"参拝者駐車場あり（祭事時除く）"}],GA=(t,e)=>{const r=(t-Am.latitude)*Math.PI/180,i=(e-Am.longitude)*Math.PI/180,s=Math.sin(r/2)*Math.sin(r/2)+Math.cos(Am.latitude*Math.PI/180)*Math.cos(t*Math.PI/180)*Math.sin(i/2)*Math.sin(i/2);return 6371*(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)))},WA=(t=6)=>qA.map(e=>({...e,distance:GA(e.latitude,e.longitude)})).filter(e=>e.distance<=t).sort((e,n)=>e.distance-n.distance),HA=()=>{const t=js(),{createCase:e,loading:n}=vf(),{userInfo:r}=Ds(),[i,s]=B.useState({caseName:"",patientAge:"",patientGender:"male",patientName:"",sceneLatitude:"",sceneLongitude:"",hospitalLatitude:"",hospitalLongitude:"",description:""}),a=(v,x)=>{s({...i,[v]:x})},u=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(v=>{s({...i,sceneLatitude:v.coords.latitude.toString(),sceneLongitude:v.coords.longitude.toString()})},v=>{console.error("位置情報の取得に失敗しました:",v),alert("位置情報の取得に失敗しました。手動で座標を入力してください。")}):alert("このブラウザでは位置情報がサポートされていません。")},h=v=>{s({...i,sceneLatitude:v.latitude.toString(),sceneLongitude:v.longitude.toString()})},m=v=>{const x=Rc.find(T=>T.id===v);x&&s({...i,hospitalLatitude:x.latitude.toString(),hospitalLongitude:x.longitude.toString()})},p=WA(6),_=async v=>{if(v.preventDefault(),!i.caseName.trim()){alert("事案名を入力してください");return}if(!i.sceneLatitude||!i.sceneLongitude){alert("現場の位置情報を入力してください");return}if(!i.hospitalLatitude||!i.hospitalLongitude){alert("搬送先病院の位置情報を入力してください");return}try{const x=(S,C)=>({latitude:S,longitude:C,isEqual:A=>A.latitude===S&&A.longitude===C,toJSON:()=>({latitude:S,longitude:C})}),T=S=>({toDate:()=>S,toMillis:()=>S.getTime(),seconds:Math.floor(S.getTime()/1e3),nanoseconds:S.getTime()%1e3*1e6}),E={caseName:i.caseName.trim(),status:fr.DISPATCHED,teamId:(r==null?void 0:r.uid)||"demo-user",patientInfo:{age:i.patientAge?parseInt(i.patientAge):void 0,gender:i.patientGender,name:i.patientName.trim()||void 0},sceneLocation:x(parseFloat(i.sceneLatitude),parseFloat(i.sceneLongitude)),hospitalLocation:x(parseFloat(i.hospitalLatitude),parseFloat(i.hospitalLongitude)),createdAt:T(new Date),updatedAt:T(new Date)},R=await e(E);alert("新規事案を作成しました"),t(`/cases/${R}`)}catch(x){console.error("事案作成エラー:",x),alert("事案の作成に失敗しました")}};return c.jsxs("div",{className:"min-h-screen bg-gray-50",children:[c.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:c.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:c.jsxs("div",{className:"flex items-center justify-between h-16",children:[c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("button",{onClick:()=>t("/cases"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:c.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),c.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"新規事案作成"})]}),c.jsx("div",{className:"text-sm text-gray-700",children:c.jsx("span",{className:"font-medium",children:r==null?void 0:r.name})})]})})}),c.jsx("main",{className:"max-w-4xl mx-auto py-6 sm:px-6 lg:px-8",children:c.jsx("div",{className:"px-4 py-6 sm:px-0",children:c.jsxs("form",{onSubmit:_,className:"space-y-6",children:[c.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"基本情報"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{className:"md:col-span-2",children:[c.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["事案名 ",c.jsx("span",{className:"text-red-500",children:"*"})]}),c.jsx("input",{type:"text",value:i.caseName,onChange:v=>a("caseName",v.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"例: 2024-06-14 渋谷駅前 交通外傷"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"担当チーム"}),c.jsx("input",{type:"text",value:(r==null?void 0:r.team)||"",className:"w-full px-3 py-2 border rounded-lg bg-gray-50",disabled:!0})]})]})]}),c.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"患者情報"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"患者氏名"}),c.jsx("input",{type:"text",value:i.patientName,onChange:v=>a("patientName",v.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"氏名（任意）"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"年齢"}),c.jsx("input",{type:"number",value:i.patientAge,onChange:v=>a("patientAge",v.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"年齢",min:"0",max:"150"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"性別"}),c.jsxs("select",{value:i.patientGender,onChange:v=>a("patientGender",v.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",children:[c.jsx("option",{value:"male",children:"男性"}),c.jsx("option",{value:"female",children:"女性"}),c.jsx("option",{value:"other",children:"その他"})]})]})]})]}),c.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[c.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["現場位置",c.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"(基地病院から6km以内)"})]}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"事案発生場所を選択"}),c.jsxs("select",{value:"",onChange:v=>{const x=p.find(T=>T.id===v.target.value);x&&h(x)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary mb-2",children:[c.jsx("option",{value:"",children:"-- 場所を選択してください --"}),p.map(v=>{var x;return c.jsxs("option",{value:v.id,children:[v.name," (",(x=v.distance)==null?void 0:x.toFixed(1),"km) - ",v.address]},v.id)})]})]}),c.jsxs("div",{className:"flex space-x-2 flex-wrap gap-2",children:[c.jsx(Le,{type:"button",variant:"outline",size:"sm",onClick:u,children:"📍 現在地を取得"}),p.slice(0,4).map(v=>c.jsx(Le,{type:"button",variant:"outline",size:"sm",onClick:()=>h(v),className:"text-xs",children:v.name},v.id))]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["緯度 ",c.jsx("span",{className:"text-red-500",children:"*"})]}),c.jsx("input",{type:"number",step:"any",value:i.sceneLatitude,onChange:v=>a("sceneLatitude",v.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"35.658584"})]}),c.jsxs("div",{children:[c.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["経度 ",c.jsx("span",{className:"text-red-500",children:"*"})]}),c.jsx("input",{type:"number",step:"any",value:i.sceneLongitude,onChange:v=>a("sceneLongitude",v.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"139.701442"})]})]})]})]}),c.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"搬送先病院"}),c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"救急対応病院を選択"}),c.jsxs("select",{value:"",onChange:v=>{v.target.value&&m(v.target.value)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary mb-2",children:[c.jsx("option",{value:"",children:"-- 病院を選択してください --"}),Rc.map(v=>c.jsxs("option",{value:v.id,children:[v.name," (",v.emergencyLevel==="tertiary"?"三次救急":v.emergencyLevel==="secondary"?"二次救急":"一次救急",") - ",v.address]},v.id))]})]}),c.jsx("div",{className:"flex space-x-2 flex-wrap gap-2",children:Rc.slice(0,3).map(v=>c.jsx(Le,{type:"button",variant:"outline",size:"sm",onClick:()=>m(v.id),className:"text-xs",children:v.name},v.id))}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["緯度 ",c.jsx("span",{className:"text-red-500",children:"*"})]}),c.jsx("input",{type:"number",step:"any",value:i.hospitalLatitude,onChange:v=>a("hospitalLatitude",v.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"35.665498"})]}),c.jsxs("div",{children:[c.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["経度 ",c.jsx("span",{className:"text-red-500",children:"*"})]}),c.jsx("input",{type:"number",step:"any",value:i.hospitalLongitude,onChange:v=>a("hospitalLongitude",v.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"139.686567"})]})]})]})]}),c.jsxs("div",{className:"flex justify-end space-x-4",children:[c.jsx(Le,{type:"button",variant:"outline",onClick:()=>t("/cases"),children:"キャンセル"}),c.jsxs(Le,{type:"submit",disabled:n,className:"flex items-center",children:[n&&c.jsx(_r,{size:"sm",className:"mr-2"}),"事案を作成"]})]})]})})})]})};let jh=null,c0=null,Sa=null;try{ui.demoMode&&(console.log("Demo mode: Using mock Firebase objects"),jh={options:{projectId:"demo-doctorcar"}},c0={currentUser:null,app:jh,onAuthStateChanged:()=>()=>{},signInWithEmailAndPassword:()=>Promise.reject(new Error("Demo mode")),signOut:()=>Promise.resolve()},Sa={collection:()=>({doc:()=>({get:()=>Promise.resolve({exists:!1}),set:()=>Promise.resolve(),update:()=>Promise.resolve()}),get:()=>Promise.resolve({docs:[]})})})}catch(t){console.error("Firebase configuration error:",t),jh={options:{projectId:"fallback-doctorcar"}},c0={currentUser:null,app:jh,onAuthStateChanged:()=>()=>{},signInWithEmailAndPassword:()=>Promise.reject(new Error("Firebase error")),signOut:()=>Promise.resolve()},Sa={collection:()=>({doc:()=>({get:()=>Promise.resolve({exists:!1}),set:()=>Promise.resolve(),update:()=>Promise.resolve()}),get:()=>Promise.resolve({docs:[]})})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bb=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=i&63|128):(i&64512)===55296&&r+1<t.length&&(t.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(t.charCodeAt(++r)&1023),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=i&63|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=i&63|128)}return e},KA=function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((i&31)<<6|s&63)}else if(i>239&&i<365){const s=t[n++],a=t[n++],u=t[n++],h=((i&7)<<18|(s&63)<<12|(a&63)<<6|u&63)-65536;e[r++]=String.fromCharCode(55296+(h>>10)),e[r++]=String.fromCharCode(56320+(h&1023))}else{const s=t[n++],a=t[n++];e[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|a&63)}}return e.join("")},Eb={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<t.length;i+=3){const s=t[i],a=i+1<t.length,u=a?t[i+1]:0,h=i+2<t.length,m=h?t[i+2]:0,p=s>>2,_=(s&3)<<4|u>>4;let v=(u&15)<<2|m>>6,x=m&63;h||(x=64,a||(v=64)),r.push(n[p],n[_],n[v],n[x])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(bb(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):KA(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<t.length;){const s=n[t.charAt(i++)],u=i<t.length?n[t.charAt(i)]:0;++i;const m=i<t.length?n[t.charAt(i)]:64;++i;const _=i<t.length?n[t.charAt(i)]:64;if(++i,s==null||u==null||m==null||_==null)throw new QA;const v=s<<2|u>>4;if(r.push(v),m!==64){const x=u<<4&240|m>>2;if(r.push(x),_!==64){const T=m<<6&192|_;r.push(T)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class QA extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ZA=function(t){const e=bb(t);return Eb.encodeByteArray(e,!0)},Dd=function(t){return ZA(t).replace(/\./g,"")},JA=function(t){try{return Eb.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function YA(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const XA=()=>YA().__FIREBASE_DEFAULTS__,e2=()=>{if(typeof process>"u"||typeof process.env>"u")return;const t={}.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},t2=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&JA(t[1]);return e&&JSON.parse(e)},Ef=()=>{try{return XA()||e2()||t2()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},n2=t=>{var e,n;return(n=(e=Ef())===null||e===void 0?void 0:e.emulatorHosts)===null||n===void 0?void 0:n[t]},r2=t=>{const e=n2(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),r]:[e.substring(0,n),r]},Tb=()=>{var t;return(t=Ef())===null||t===void 0?void 0:t.config},IL=t=>{var e;return(e=Ef())===null||e===void 0?void 0:e[`_${t}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class i2{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,r)=>{n?this.reject(n):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,r))}}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s2(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},r=e||"demo-project",i=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${r}`,aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t),u="";return[Dd(JSON.stringify(n)),Dd(JSON.stringify(a)),u].join(".")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ga(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function SL(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Ga())}function o2(){var t;const e=(t=Ef())===null||t===void 0?void 0:t.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function a2(){return typeof window<"u"||Ib()}function Ib(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function CL(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function PL(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function NL(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function AL(){const t=Ga();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function Sb(){return!o2()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Cb(){try{return typeof indexedDB=="object"}catch{return!1}}function l2(){return new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var s;e(((s=i.error)===null||s===void 0?void 0:s.message)||"")}}catch(n){e(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c2="FirebaseError";class pl extends Error{constructor(e,n,r){super(n),this.code=e,this.customData=r,this.name=c2,Object.setPrototypeOf(this,pl.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Pb.prototype.create)}}class Pb{constructor(e,n,r){this.service=e,this.serviceName=n,this.errors=r}create(e,...n){const r=n[0]||{},i=`${this.service}/${e}`,s=this.errors[e],a=s?u2(s,r):"Error",u=`${this.serviceName}: ${a} (${i}).`;return new pl(i,u,r)}}function u2(t,e){return t.replace(h2,(n,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const h2=/\{\$([^}]+)}/g;function kL(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function bo(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const s=t[i],a=e[i];if(u0(s)&&u0(a)){if(!bo(s,a))return!1}else if(s!==a)return!1}for(const i of r)if(!n.includes(i))return!1;return!0}function u0(t){return t!==null&&typeof t=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function RL(t){const e=[];for(const[n,r]of Object.entries(t))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function jL(t){const e={};return t.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,s]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(s)}}),e}function DL(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function LL(t,e){const n=new d2(t,e);return n.subscribe.bind(n)}class d2{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,r){let i;if(e===void 0&&n===void 0&&r===void 0)throw new Error("Missing Observer.");f2(e,["next","error","complete"])?i=e:i={next:e,error:n,complete:r},i.next===void 0&&(i.next=km),i.error===void 0&&(i.error=km),i.complete===void 0&&(i.complete=km);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function f2(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function km(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wt(t){return t&&t._delegate?t._delegate:t}class iu{constructor(e,n,r){this.name=e,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const no="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class m2{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const r=new i2;if(this.instancesDeferred.set(n,r),this.isInitialized(n)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:n});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){var n;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(n=e==null?void 0:e.optional)!==null&&n!==void 0?n:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(g2(e))try{this.getOrInitializeService({instanceIdentifier:no})}catch{}for(const[n,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(n);try{const s=this.getOrInitializeService({instanceIdentifier:i});r.resolve(s)}catch{}}}}clearInstance(e=no){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=no){return this.instances.has(e)}getOptions(e=no){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:n});for(const[s,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(s);r===u&&a.resolve(i)}return i}onInit(e,n){var r;const i=this.normalizeInstanceIdentifier(n),s=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;s.add(e),this.onInitCallbacks.set(i,s);const a=this.instances.get(i);return a&&e(a,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,n){const r=this.onInitCallbacks.get(n);if(r)for(const i of r)try{i(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:p2(e),options:n}),this.instances.set(e,r),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=no){return this.component?this.component.multipleInstances?e:no:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function p2(t){return t===no?void 0:t}function g2(t){return t.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nb{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new m2(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m_=[];var ze;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(ze||(ze={}));const Ab={debug:ze.DEBUG,verbose:ze.VERBOSE,info:ze.INFO,warn:ze.WARN,error:ze.ERROR,silent:ze.SILENT},_2=ze.INFO,v2={[ze.DEBUG]:"log",[ze.VERBOSE]:"log",[ze.INFO]:"info",[ze.WARN]:"warn",[ze.ERROR]:"error"},y2=(t,e,...n)=>{if(e<t.logLevel)return;const r=new Date().toISOString(),i=v2[e];if(i)console[i](`[${r}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class kb{constructor(e){this.name=e,this._logLevel=_2,this._logHandler=y2,this._userLogHandler=null,m_.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in ze))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Ab[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,ze.DEBUG,...e),this._logHandler(this,ze.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,ze.VERBOSE,...e),this._logHandler(this,ze.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,ze.INFO,...e),this._logHandler(this,ze.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,ze.WARN,...e),this._logHandler(this,ze.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,ze.ERROR,...e),this._logHandler(this,ze.ERROR,...e)}}function x2(t){m_.forEach(e=>{e.setLogLevel(t)})}function w2(t,e){for(const n of m_){let r=null;e&&e.level&&(r=Ab[e.level]),t===null?n.userLogHandler=null:n.userLogHandler=(i,s,...a)=>{const u=a.map(h=>{if(h==null)return null;if(typeof h=="string")return h;if(typeof h=="number"||typeof h=="boolean")return h.toString();if(h instanceof Error)return h.message;try{return JSON.stringify(h)}catch{return null}}).filter(h=>h).join(" ");s>=(r??i.logLevel)&&t({level:ze[s].toLowerCase(),message:u,args:a,type:i.name})}}}const b2=(t,e)=>e.some(n=>t instanceof n);let h0,d0;function E2(){return h0||(h0=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function T2(){return d0||(d0=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Rb=new WeakMap,$p=new WeakMap,jb=new WeakMap,Rm=new WeakMap,p_=new WeakMap;function I2(t){const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("success",s),t.removeEventListener("error",a)},s=()=>{n(vs(t.result)),i()},a=()=>{r(t.error),i()};t.addEventListener("success",s),t.addEventListener("error",a)});return e.then(n=>{n instanceof IDBCursor&&Rb.set(n,t)}).catch(()=>{}),p_.set(e,t),e}function S2(t){if($p.has(t))return;const e=new Promise((n,r)=>{const i=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",a),t.removeEventListener("abort",a)},s=()=>{n(),i()},a=()=>{r(t.error||new DOMException("AbortError","AbortError")),i()};t.addEventListener("complete",s),t.addEventListener("error",a),t.addEventListener("abort",a)});$p.set(t,e)}let qp={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return $p.get(t);if(e==="objectStoreNames")return t.objectStoreNames||jb.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return vs(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function C2(t){qp=t(qp)}function P2(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(jm(this),e,...n);return jb.set(r,e.sort?e.sort():[e]),vs(r)}:T2().includes(t)?function(...e){return t.apply(jm(this),e),vs(Rb.get(this))}:function(...e){return vs(t.apply(jm(this),e))}}function N2(t){return typeof t=="function"?P2(t):(t instanceof IDBTransaction&&S2(t),b2(t,E2())?new Proxy(t,qp):t)}function vs(t){if(t instanceof IDBRequest)return I2(t);if(Rm.has(t))return Rm.get(t);const e=N2(t);return e!==t&&(Rm.set(t,e),p_.set(e,t)),e}const jm=t=>p_.get(t);function A2(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const a=indexedDB.open(t,e),u=vs(a);return r&&a.addEventListener("upgradeneeded",h=>{r(vs(a.result),h.oldVersion,h.newVersion,vs(a.transaction),h)}),n&&a.addEventListener("blocked",h=>n(h.oldVersion,h.newVersion,h)),u.then(h=>{s&&h.addEventListener("close",()=>s()),i&&h.addEventListener("versionchange",m=>i(m.oldVersion,m.newVersion,m))}).catch(()=>{}),u}const k2=["get","getKey","getAll","getAllKeys","count"],R2=["put","add","delete","clear"],Dm=new Map;function f0(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Dm.get(e))return Dm.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=R2.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||k2.includes(n)))return;const s=async function(a,...u){const h=this.transaction(a,i?"readwrite":"readonly");let m=h.store;return r&&(m=m.index(u.shift())),(await Promise.all([m[n](...u),i&&h.done]))[0]};return Dm.set(e,s),s}C2(t=>({...t,get:(e,n,r)=>f0(e,n)||t.get(e,n,r),has:(e,n)=>!!f0(e,n)||t.has(e,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j2{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(D2(n)){const r=n.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(n=>n).join(" ")}}function D2(t){const e=t.getComponent();return(e==null?void 0:e.type)==="VERSION"}const Ld="@firebase/app",Gp="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pi=new kb("@firebase/app"),L2="@firebase/app-compat",M2="@firebase/analytics-compat",V2="@firebase/analytics",O2="@firebase/app-check-compat",F2="@firebase/app-check",z2="@firebase/auth",B2="@firebase/auth-compat",U2="@firebase/database",$2="@firebase/data-connect",q2="@firebase/database-compat",G2="@firebase/functions",W2="@firebase/functions-compat",H2="@firebase/installations",K2="@firebase/installations-compat",Q2="@firebase/messaging",Z2="@firebase/messaging-compat",J2="@firebase/performance",Y2="@firebase/performance-compat",X2="@firebase/remote-config",ek="@firebase/remote-config-compat",tk="@firebase/storage",nk="@firebase/storage-compat",rk="@firebase/firestore",ik="@firebase/vertexai-preview",sk="@firebase/firestore-compat",ok="firebase",ak="10.14.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Md="[DEFAULT]",lk={[Ld]:"fire-core",[L2]:"fire-core-compat",[V2]:"fire-analytics",[M2]:"fire-analytics-compat",[F2]:"fire-app-check",[O2]:"fire-app-check-compat",[z2]:"fire-auth",[B2]:"fire-auth-compat",[U2]:"fire-rtdb",[$2]:"fire-data-connect",[q2]:"fire-rtdb-compat",[G2]:"fire-fn",[W2]:"fire-fn-compat",[H2]:"fire-iid",[K2]:"fire-iid-compat",[Q2]:"fire-fcm",[Z2]:"fire-fcm-compat",[J2]:"fire-perf",[Y2]:"fire-perf-compat",[X2]:"fire-rc",[ek]:"fire-rc-compat",[tk]:"fire-gcs",[nk]:"fire-gcs-compat",[rk]:"fire-fst",[sk]:"fire-fst-compat",[ik]:"fire-vertex","fire-js":"fire-js",[ok]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eo=new Map,su=new Map,ou=new Map;function m0(t,e){try{t.container.addComponent(e)}catch(n){pi.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function ML(t,e){t.container.addOrOverwriteComponent(e)}function Vd(t){const e=t.name;if(ou.has(e))return pi.debug(`There were multiple attempts to register component ${e}.`),!1;ou.set(e,t);for(const n of Eo.values())m0(n,t);for(const n of su.values())m0(n,t);return!0}function g_(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function ck(t,e,n=Md){g_(t,e).clearInstance(n)}function uk(t){return t.options!==void 0}function VL(t){return t.settings!==void 0}function OL(){ou.clear()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hk={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Kn=new Pb("app","Firebase",hk);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Db{constructor(e,n,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new iu("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Kn.create("app-deleted",{appName:this._name})}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dk extends Db{constructor(e,n,r,i){const s=n.automaticDataCollectionEnabled!==void 0?n.automaticDataCollectionEnabled:!1,a={name:r,automaticDataCollectionEnabled:s};if(e.apiKey!==void 0)super(e,a,i);else{const u=e;super(u.options,a,i)}this._serverConfig=Object.assign({automaticDataCollectionEnabled:s},n),this._finalizationRegistry=null,typeof FinalizationRegistry<"u"&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,n.releaseOnDeref=void 0,ja(Ld,Gp,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,e!==void 0&&this._finalizationRegistry!==null&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){gk(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw Kn.create("server-app-deleted")}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fk=ak;function mk(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Md,automaticDataCollectionEnabled:!1},e),i=r.name;if(typeof i!="string"||!i)throw Kn.create("bad-app-name",{appName:String(i)});if(n||(n=Tb()),!n)throw Kn.create("no-options");const s=Eo.get(i);if(s){if(bo(n,s.options)&&bo(r,s.config))return s;throw Kn.create("duplicate-app",{appName:i})}const a=new Nb(i);for(const h of ou.values())a.addComponent(h);const u=new Db(n,r,a);return Eo.set(i,u),u}function FL(t,e){if(a2()&&!Ib())throw Kn.create("invalid-server-app-environment");e.automaticDataCollectionEnabled===void 0&&(e.automaticDataCollectionEnabled=!1);let n;uk(t)?n=t.options:n=t;const r=Object.assign(Object.assign({},e),n);r.releaseOnDeref!==void 0&&delete r.releaseOnDeref;const i=m=>[...m].reduce((p,_)=>Math.imul(31,p)+_.charCodeAt(0)|0,0);if(e.releaseOnDeref!==void 0&&typeof FinalizationRegistry>"u")throw Kn.create("finalization-registry-not-supported",{});const s=""+i(JSON.stringify(r)),a=su.get(s);if(a)return a.incRefCount(e.releaseOnDeref),a;const u=new Nb(s);for(const m of ou.values())u.addComponent(m);const h=new dk(n,e,s,u);return su.set(s,h),h}function pk(t=Md){const e=Eo.get(t);if(!e&&t===Md&&Tb())return mk();if(!e)throw Kn.create("no-app",{appName:t});return e}function zL(){return Array.from(Eo.values())}async function gk(t){let e=!1;const n=t.name;Eo.has(n)?(e=!0,Eo.delete(n)):su.has(n)&&t.decRefCount()<=0&&(su.delete(n),e=!0),e&&(await Promise.all(t.container.getProviders().map(r=>r.delete())),t.isDeleted=!0)}function ja(t,e,n){var r;let i=(r=lk[t])!==null&&r!==void 0?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),a=e.match(/\s|\//);if(s||a){const u=[`Unable to register library "${i}" with version "${e}":`];s&&u.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&a&&u.push("and"),a&&u.push(`version name "${e}" contains illegal characters (whitespace or "/")`),pi.warn(u.join(" "));return}Vd(new iu(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}function BL(t,e){if(t!==null&&typeof t!="function")throw Kn.create("invalid-log-argument");w2(t,e)}function UL(t){x2(t)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _k="firebase-heartbeat-database",vk=1,au="firebase-heartbeat-store";let Lm=null;function Lb(){return Lm||(Lm=A2(_k,vk,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(au)}catch(n){console.warn(n)}}}}).catch(t=>{throw Kn.create("idb-open",{originalErrorMessage:t.message})})),Lm}async function yk(t){try{const n=(await Lb()).transaction(au),r=await n.objectStore(au).get(Mb(t));return await n.done,r}catch(e){if(e instanceof pl)pi.warn(e.message);else{const n=Kn.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});pi.warn(n.message)}}}async function p0(t,e){try{const r=(await Lb()).transaction(au,"readwrite");await r.objectStore(au).put(e,Mb(t)),await r.done}catch(n){if(n instanceof pl)pi.warn(n.message);else{const r=Kn.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});pi.warn(r.message)}}}function Mb(t){return`${t.name}!${t.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xk=1024,wk=30*24*60*60*1e3;class bk{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new Tk(n),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,n;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=g0();return((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(a=>a.date===s)?void 0:(this._heartbeatsCache.heartbeats.push({date:s,agent:i}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(a=>{const u=new Date(a.date).valueOf();return Date.now()-u<=wk}),this._storage.overwrite(this._heartbeatsCache))}catch(r){pi.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=g0(),{heartbeatsToSend:r,unsentEntries:i}=Ek(this._heartbeatsCache.heartbeats),s=Dd(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=n,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(n){return pi.warn(n),""}}}function g0(){return new Date().toISOString().substring(0,10)}function Ek(t,e=xk){const n=[];let r=t.slice();for(const i of t){const s=n.find(a=>a.agent===i.agent);if(s){if(s.dates.push(i.date),_0(n)>e){s.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),_0(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}class Tk{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Cb()?l2().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await yk(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return p0(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var n;if(await this._canUseIndexedDBPromise){const i=await this.read();return p0(this.app,{lastSentHeartbeatDate:(n=e.lastSentHeartbeatDate)!==null&&n!==void 0?n:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function _0(t){return Dd(JSON.stringify({version:2,heartbeats:t})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ik(t){Vd(new iu("platform-logger",e=>new j2(e),"PRIVATE")),Vd(new iu("heartbeat",e=>new bk(e),"PRIVATE")),ja(Ld,Gp,t),ja(Ld,Gp,"esm2017"),ja("fire-js","")}Ik("");var v0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var po,Vb;(function(){var t;/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/function e(k,N){function D(){}D.prototype=N.prototype,k.D=N.prototype,k.prototype=new D,k.prototype.constructor=k,k.C=function(M,F,z){for(var j=Array(arguments.length-2),me=2;me<arguments.length;me++)j[me-2]=arguments[me];return N.prototype[F].apply(M,j)}}function n(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}e(r,n),r.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function i(k,N,D){D||(D=0);var M=Array(16);if(typeof N=="string")for(var F=0;16>F;++F)M[F]=N.charCodeAt(D++)|N.charCodeAt(D++)<<8|N.charCodeAt(D++)<<16|N.charCodeAt(D++)<<24;else for(F=0;16>F;++F)M[F]=N[D++]|N[D++]<<8|N[D++]<<16|N[D++]<<24;N=k.g[0],D=k.g[1],F=k.g[2];var z=k.g[3],j=N+(z^D&(F^z))+M[0]+3614090360&4294967295;N=D+(j<<7&4294967295|j>>>25),j=z+(F^N&(D^F))+M[1]+3905402710&4294967295,z=N+(j<<12&4294967295|j>>>20),j=F+(D^z&(N^D))+M[2]+606105819&4294967295,F=z+(j<<17&4294967295|j>>>15),j=D+(N^F&(z^N))+M[3]+3250441966&4294967295,D=F+(j<<22&4294967295|j>>>10),j=N+(z^D&(F^z))+M[4]+4118548399&4294967295,N=D+(j<<7&4294967295|j>>>25),j=z+(F^N&(D^F))+M[5]+1200080426&4294967295,z=N+(j<<12&4294967295|j>>>20),j=F+(D^z&(N^D))+M[6]+2821735955&4294967295,F=z+(j<<17&4294967295|j>>>15),j=D+(N^F&(z^N))+M[7]+4249261313&4294967295,D=F+(j<<22&4294967295|j>>>10),j=N+(z^D&(F^z))+M[8]+1770035416&4294967295,N=D+(j<<7&4294967295|j>>>25),j=z+(F^N&(D^F))+M[9]+2336552879&4294967295,z=N+(j<<12&4294967295|j>>>20),j=F+(D^z&(N^D))+M[10]+4294925233&4294967295,F=z+(j<<17&4294967295|j>>>15),j=D+(N^F&(z^N))+M[11]+2304563134&4294967295,D=F+(j<<22&4294967295|j>>>10),j=N+(z^D&(F^z))+M[12]+1804603682&4294967295,N=D+(j<<7&4294967295|j>>>25),j=z+(F^N&(D^F))+M[13]+4254626195&4294967295,z=N+(j<<12&4294967295|j>>>20),j=F+(D^z&(N^D))+M[14]+2792965006&4294967295,F=z+(j<<17&4294967295|j>>>15),j=D+(N^F&(z^N))+M[15]+1236535329&4294967295,D=F+(j<<22&4294967295|j>>>10),j=N+(F^z&(D^F))+M[1]+4129170786&4294967295,N=D+(j<<5&4294967295|j>>>27),j=z+(D^F&(N^D))+M[6]+3225465664&4294967295,z=N+(j<<9&4294967295|j>>>23),j=F+(N^D&(z^N))+M[11]+643717713&4294967295,F=z+(j<<14&4294967295|j>>>18),j=D+(z^N&(F^z))+M[0]+3921069994&4294967295,D=F+(j<<20&4294967295|j>>>12),j=N+(F^z&(D^F))+M[5]+3593408605&4294967295,N=D+(j<<5&4294967295|j>>>27),j=z+(D^F&(N^D))+M[10]+38016083&4294967295,z=N+(j<<9&4294967295|j>>>23),j=F+(N^D&(z^N))+M[15]+3634488961&4294967295,F=z+(j<<14&4294967295|j>>>18),j=D+(z^N&(F^z))+M[4]+3889429448&4294967295,D=F+(j<<20&4294967295|j>>>12),j=N+(F^z&(D^F))+M[9]+568446438&4294967295,N=D+(j<<5&4294967295|j>>>27),j=z+(D^F&(N^D))+M[14]+3275163606&4294967295,z=N+(j<<9&4294967295|j>>>23),j=F+(N^D&(z^N))+M[3]+4107603335&4294967295,F=z+(j<<14&4294967295|j>>>18),j=D+(z^N&(F^z))+M[8]+1163531501&4294967295,D=F+(j<<20&4294967295|j>>>12),j=N+(F^z&(D^F))+M[13]+2850285829&4294967295,N=D+(j<<5&4294967295|j>>>27),j=z+(D^F&(N^D))+M[2]+4243563512&4294967295,z=N+(j<<9&4294967295|j>>>23),j=F+(N^D&(z^N))+M[7]+1735328473&4294967295,F=z+(j<<14&4294967295|j>>>18),j=D+(z^N&(F^z))+M[12]+2368359562&4294967295,D=F+(j<<20&4294967295|j>>>12),j=N+(D^F^z)+M[5]+4294588738&4294967295,N=D+(j<<4&4294967295|j>>>28),j=z+(N^D^F)+M[8]+2272392833&4294967295,z=N+(j<<11&4294967295|j>>>21),j=F+(z^N^D)+M[11]+1839030562&4294967295,F=z+(j<<16&4294967295|j>>>16),j=D+(F^z^N)+M[14]+4259657740&4294967295,D=F+(j<<23&4294967295|j>>>9),j=N+(D^F^z)+M[1]+2763975236&4294967295,N=D+(j<<4&4294967295|j>>>28),j=z+(N^D^F)+M[4]+1272893353&4294967295,z=N+(j<<11&4294967295|j>>>21),j=F+(z^N^D)+M[7]+4139469664&4294967295,F=z+(j<<16&4294967295|j>>>16),j=D+(F^z^N)+M[10]+3200236656&4294967295,D=F+(j<<23&4294967295|j>>>9),j=N+(D^F^z)+M[13]+681279174&4294967295,N=D+(j<<4&4294967295|j>>>28),j=z+(N^D^F)+M[0]+3936430074&4294967295,z=N+(j<<11&4294967295|j>>>21),j=F+(z^N^D)+M[3]+3572445317&4294967295,F=z+(j<<16&4294967295|j>>>16),j=D+(F^z^N)+M[6]+76029189&4294967295,D=F+(j<<23&4294967295|j>>>9),j=N+(D^F^z)+M[9]+3654602809&4294967295,N=D+(j<<4&4294967295|j>>>28),j=z+(N^D^F)+M[12]+3873151461&4294967295,z=N+(j<<11&4294967295|j>>>21),j=F+(z^N^D)+M[15]+530742520&4294967295,F=z+(j<<16&4294967295|j>>>16),j=D+(F^z^N)+M[2]+3299628645&4294967295,D=F+(j<<23&4294967295|j>>>9),j=N+(F^(D|~z))+M[0]+4096336452&4294967295,N=D+(j<<6&4294967295|j>>>26),j=z+(D^(N|~F))+M[7]+1126891415&4294967295,z=N+(j<<10&4294967295|j>>>22),j=F+(N^(z|~D))+M[14]+2878612391&4294967295,F=z+(j<<15&4294967295|j>>>17),j=D+(z^(F|~N))+M[5]+4237533241&4294967295,D=F+(j<<21&4294967295|j>>>11),j=N+(F^(D|~z))+M[12]+1700485571&4294967295,N=D+(j<<6&4294967295|j>>>26),j=z+(D^(N|~F))+M[3]+2399980690&4294967295,z=N+(j<<10&4294967295|j>>>22),j=F+(N^(z|~D))+M[10]+4293915773&4294967295,F=z+(j<<15&4294967295|j>>>17),j=D+(z^(F|~N))+M[1]+2240044497&4294967295,D=F+(j<<21&4294967295|j>>>11),j=N+(F^(D|~z))+M[8]+1873313359&4294967295,N=D+(j<<6&4294967295|j>>>26),j=z+(D^(N|~F))+M[15]+4264355552&4294967295,z=N+(j<<10&4294967295|j>>>22),j=F+(N^(z|~D))+M[6]+2734768916&4294967295,F=z+(j<<15&4294967295|j>>>17),j=D+(z^(F|~N))+M[13]+1309151649&4294967295,D=F+(j<<21&4294967295|j>>>11),j=N+(F^(D|~z))+M[4]+4149444226&4294967295,N=D+(j<<6&4294967295|j>>>26),j=z+(D^(N|~F))+M[11]+3174756917&4294967295,z=N+(j<<10&4294967295|j>>>22),j=F+(N^(z|~D))+M[2]+718787259&4294967295,F=z+(j<<15&4294967295|j>>>17),j=D+(z^(F|~N))+M[9]+3951481745&4294967295,k.g[0]=k.g[0]+N&4294967295,k.g[1]=k.g[1]+(F+(j<<21&4294967295|j>>>11))&4294967295,k.g[2]=k.g[2]+F&4294967295,k.g[3]=k.g[3]+z&4294967295}r.prototype.u=function(k,N){N===void 0&&(N=k.length);for(var D=N-this.blockSize,M=this.B,F=this.h,z=0;z<N;){if(F==0)for(;z<=D;)i(this,k,z),z+=this.blockSize;if(typeof k=="string"){for(;z<N;)if(M[F++]=k.charCodeAt(z++),F==this.blockSize){i(this,M),F=0;break}}else for(;z<N;)if(M[F++]=k[z++],F==this.blockSize){i(this,M),F=0;break}}this.h=F,this.o+=N},r.prototype.v=function(){var k=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);k[0]=128;for(var N=1;N<k.length-8;++N)k[N]=0;var D=8*this.o;for(N=k.length-8;N<k.length;++N)k[N]=D&255,D/=256;for(this.u(k),k=Array(16),N=D=0;4>N;++N)for(var M=0;32>M;M+=8)k[D++]=this.g[N]>>>M&255;return k};function s(k,N){var D=u;return Object.prototype.hasOwnProperty.call(D,k)?D[k]:D[k]=N(k)}function a(k,N){this.h=N;for(var D=[],M=!0,F=k.length-1;0<=F;F--){var z=k[F]|0;M&&z==N||(D[F]=z,M=!1)}this.g=D}var u={};function h(k){return-128<=k&&128>k?s(k,function(N){return new a([N|0],0>N?-1:0)}):new a([k|0],0>k?-1:0)}function m(k){if(isNaN(k)||!isFinite(k))return _;if(0>k)return R(m(-k));for(var N=[],D=1,M=0;k>=D;M++)N[M]=k/D|0,D*=4294967296;return new a(N,0)}function p(k,N){if(k.length==0)throw Error("number format error: empty string");if(N=N||10,2>N||36<N)throw Error("radix out of range: "+N);if(k.charAt(0)=="-")return R(p(k.substring(1),N));if(0<=k.indexOf("-"))throw Error('number format error: interior "-" character');for(var D=m(Math.pow(N,8)),M=_,F=0;F<k.length;F+=8){var z=Math.min(8,k.length-F),j=parseInt(k.substring(F,F+z),N);8>z?(z=m(Math.pow(N,z)),M=M.j(z).add(m(j))):(M=M.j(D),M=M.add(m(j)))}return M}var _=h(0),v=h(1),x=h(16777216);t=a.prototype,t.m=function(){if(E(this))return-R(this).m();for(var k=0,N=1,D=0;D<this.g.length;D++){var M=this.i(D);k+=(0<=M?M:4294967296+M)*N,N*=4294967296}return k},t.toString=function(k){if(k=k||10,2>k||36<k)throw Error("radix out of range: "+k);if(T(this))return"0";if(E(this))return"-"+R(this).toString(k);for(var N=m(Math.pow(k,6)),D=this,M="";;){var F=U(D,N).g;D=S(D,F.j(N));var z=((0<D.g.length?D.g[0]:D.h)>>>0).toString(k);if(D=F,T(D))return z+M;for(;6>z.length;)z="0"+z;M=z+M}},t.i=function(k){return 0>k?0:k<this.g.length?this.g[k]:this.h};function T(k){if(k.h!=0)return!1;for(var N=0;N<k.g.length;N++)if(k.g[N]!=0)return!1;return!0}function E(k){return k.h==-1}t.l=function(k){return k=S(this,k),E(k)?-1:T(k)?0:1};function R(k){for(var N=k.g.length,D=[],M=0;M<N;M++)D[M]=~k.g[M];return new a(D,~k.h).add(v)}t.abs=function(){return E(this)?R(this):this},t.add=function(k){for(var N=Math.max(this.g.length,k.g.length),D=[],M=0,F=0;F<=N;F++){var z=M+(this.i(F)&65535)+(k.i(F)&65535),j=(z>>>16)+(this.i(F)>>>16)+(k.i(F)>>>16);M=j>>>16,z&=65535,j&=65535,D[F]=j<<16|z}return new a(D,D[D.length-1]&-2147483648?-1:0)};function S(k,N){return k.add(R(N))}t.j=function(k){if(T(this)||T(k))return _;if(E(this))return E(k)?R(this).j(R(k)):R(R(this).j(k));if(E(k))return R(this.j(R(k)));if(0>this.l(x)&&0>k.l(x))return m(this.m()*k.m());for(var N=this.g.length+k.g.length,D=[],M=0;M<2*N;M++)D[M]=0;for(M=0;M<this.g.length;M++)for(var F=0;F<k.g.length;F++){var z=this.i(M)>>>16,j=this.i(M)&65535,me=k.i(F)>>>16,Ve=k.i(F)&65535;D[2*M+2*F]+=j*Ve,C(D,2*M+2*F),D[2*M+2*F+1]+=z*Ve,C(D,2*M+2*F+1),D[2*M+2*F+1]+=j*me,C(D,2*M+2*F+1),D[2*M+2*F+2]+=z*me,C(D,2*M+2*F+2)}for(M=0;M<N;M++)D[M]=D[2*M+1]<<16|D[2*M];for(M=N;M<2*N;M++)D[M]=0;return new a(D,0)};function C(k,N){for(;(k[N]&65535)!=k[N];)k[N+1]+=k[N]>>>16,k[N]&=65535,N++}function A(k,N){this.g=k,this.h=N}function U(k,N){if(T(N))throw Error("division by zero");if(T(k))return new A(_,_);if(E(k))return N=U(R(k),N),new A(R(N.g),R(N.h));if(E(N))return N=U(k,R(N)),new A(R(N.g),N.h);if(30<k.g.length){if(E(k)||E(N))throw Error("slowDivide_ only works with positive integers.");for(var D=v,M=N;0>=M.l(k);)D=Z(D),M=Z(M);var F=V(D,1),z=V(M,1);for(M=V(M,2),D=V(D,2);!T(M);){var j=z.add(M);0>=j.l(k)&&(F=F.add(D),z=j),M=V(M,1),D=V(D,1)}return N=S(k,F.j(N)),new A(F,N)}for(F=_;0<=k.l(N);){for(D=Math.max(1,Math.floor(k.m()/N.m())),M=Math.ceil(Math.log(D)/Math.LN2),M=48>=M?1:Math.pow(2,M-48),z=m(D),j=z.j(N);E(j)||0<j.l(k);)D-=M,z=m(D),j=z.j(N);T(z)&&(z=v),F=F.add(z),k=S(k,j)}return new A(F,k)}t.A=function(k){return U(this,k).h},t.and=function(k){for(var N=Math.max(this.g.length,k.g.length),D=[],M=0;M<N;M++)D[M]=this.i(M)&k.i(M);return new a(D,this.h&k.h)},t.or=function(k){for(var N=Math.max(this.g.length,k.g.length),D=[],M=0;M<N;M++)D[M]=this.i(M)|k.i(M);return new a(D,this.h|k.h)},t.xor=function(k){for(var N=Math.max(this.g.length,k.g.length),D=[],M=0;M<N;M++)D[M]=this.i(M)^k.i(M);return new a(D,this.h^k.h)};function Z(k){for(var N=k.g.length+1,D=[],M=0;M<N;M++)D[M]=k.i(M)<<1|k.i(M-1)>>>31;return new a(D,k.h)}function V(k,N){var D=N>>5;N%=32;for(var M=k.g.length-D,F=[],z=0;z<M;z++)F[z]=0<N?k.i(z+D)>>>N|k.i(z+D+1)<<32-N:k.i(z+D);return new a(F,k.h)}r.prototype.digest=r.prototype.v,r.prototype.reset=r.prototype.s,r.prototype.update=r.prototype.u,Vb=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.A,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=m,a.fromString=p,po=a}).apply(typeof v0<"u"?v0:typeof self<"u"?self:typeof window<"u"?window:{});var Dh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};/** @license
Copyright The Closure Library Authors.
SPDX-License-Identifier: Apache-2.0
*/var Ob,vc,Fb,Xh,Wp,zb,Bb,Ub;(function(){var t,e=typeof Object.defineProperties=="function"?Object.defineProperty:function(d,y,b){return d==Array.prototype||d==Object.prototype||(d[y]=b.value),d};function n(d){d=[typeof globalThis=="object"&&globalThis,d,typeof window=="object"&&window,typeof self=="object"&&self,typeof Dh=="object"&&Dh];for(var y=0;y<d.length;++y){var b=d[y];if(b&&b.Math==Math)return b}throw Error("Cannot find global object")}var r=n(this);function i(d,y){if(y)e:{var b=r;d=d.split(".");for(var P=0;P<d.length-1;P++){var $=d[P];if(!($ in b))break e;b=b[$]}d=d[d.length-1],P=b[d],y=y(P),y!=P&&y!=null&&e(b,d,{configurable:!0,writable:!0,value:y})}}function s(d,y){d instanceof String&&(d+="");var b=0,P=!1,$={next:function(){if(!P&&b<d.length){var Q=b++;return{value:y(Q,d[Q]),done:!1}}return P=!0,{done:!0,value:void 0}}};return $[Symbol.iterator]=function(){return $},$}i("Array.prototype.values",function(d){return d||function(){return s(this,function(y,b){return b})}});/** @license

 Copyright The Closure Library Authors.
 SPDX-License-Identifier: Apache-2.0
*/var a=a||{},u=this||self;function h(d){var y=typeof d;return y=y!="object"?y:d?Array.isArray(d)?"array":y:"null",y=="array"||y=="object"&&typeof d.length=="number"}function m(d){var y=typeof d;return y=="object"&&d!=null||y=="function"}function p(d,y,b){return d.call.apply(d.bind,arguments)}function _(d,y,b){if(!d)throw Error();if(2<arguments.length){var P=Array.prototype.slice.call(arguments,2);return function(){var $=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply($,P),d.apply(y,$)}}return function(){return d.apply(y,arguments)}}function v(d,y,b){return v=Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?p:_,v.apply(null,arguments)}function x(d,y){var b=Array.prototype.slice.call(arguments,1);return function(){var P=b.slice();return P.push.apply(P,arguments),d.apply(this,P)}}function T(d,y){function b(){}b.prototype=y.prototype,d.aa=y.prototype,d.prototype=new b,d.prototype.constructor=d,d.Qb=function(P,$,Q){for(var ie=Array(arguments.length-2),Ge=2;Ge<arguments.length;Ge++)ie[Ge-2]=arguments[Ge];return y.prototype[$].apply(P,ie)}}function E(d){const y=d.length;if(0<y){const b=Array(y);for(let P=0;P<y;P++)b[P]=d[P];return b}return[]}function R(d,y){for(let b=1;b<arguments.length;b++){const P=arguments[b];if(h(P)){const $=d.length||0,Q=P.length||0;d.length=$+Q;for(let ie=0;ie<Q;ie++)d[$+ie]=P[ie]}else d.push(P)}}class S{constructor(y,b){this.i=y,this.j=b,this.h=0,this.g=null}get(){let y;return 0<this.h?(this.h--,y=this.g,this.g=y.next,y.next=null):y=this.i(),y}}function C(d){return/^[\s\xa0]*$/.test(d)}function A(){var d=u.navigator;return d&&(d=d.userAgent)?d:""}function U(d){return U[" "](d),d}U[" "]=function(){};var Z=A().indexOf("Gecko")!=-1&&!(A().toLowerCase().indexOf("webkit")!=-1&&A().indexOf("Edge")==-1)&&!(A().indexOf("Trident")!=-1||A().indexOf("MSIE")!=-1)&&A().indexOf("Edge")==-1;function V(d,y,b){for(const P in d)y.call(b,d[P],P,d)}function k(d,y){for(const b in d)y.call(void 0,d[b],b,d)}function N(d){const y={};for(const b in d)y[b]=d[b];return y}const D="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function M(d,y){let b,P;for(let $=1;$<arguments.length;$++){P=arguments[$];for(b in P)d[b]=P[b];for(let Q=0;Q<D.length;Q++)b=D[Q],Object.prototype.hasOwnProperty.call(P,b)&&(d[b]=P[b])}}function F(d){var y=1;d=d.split(":");const b=[];for(;0<y&&d.length;)b.push(d.shift()),y--;return d.length&&b.push(d.join(":")),b}function z(d){u.setTimeout(()=>{throw d},0)}function j(){var d=fe;let y=null;return d.g&&(y=d.g,d.g=d.g.next,d.g||(d.h=null),y.next=null),y}class me{constructor(){this.h=this.g=null}add(y,b){const P=Ve.get();P.set(y,b),this.h?this.h.next=P:this.g=P,this.h=P}}var Ve=new S(()=>new Te,d=>d.reset());class Te{constructor(){this.next=this.g=this.h=null}set(y,b){this.h=y,this.g=b,this.next=null}reset(){this.next=this.g=this.h=null}}let se,W=!1,fe=new me,X=()=>{const d=u.Promise.resolve(void 0);se=()=>{d.then(Y)}};var Y=()=>{for(var d;d=j();){try{d.h.call(d.g)}catch(b){z(b)}var y=Ve;y.j(d),100>y.h&&(y.h++,d.next=y.g,y.g=d)}W=!1};function ce(){this.s=this.s,this.C=this.C}ce.prototype.s=!1,ce.prototype.ma=function(){this.s||(this.s=!0,this.N())},ce.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function Ie(d,y){this.type=d,this.g=this.target=y,this.defaultPrevented=!1}Ie.prototype.h=function(){this.defaultPrevented=!0};var Oe=function(){if(!u.addEventListener||!Object.defineProperty)return!1;var d=!1,y=Object.defineProperty({},"passive",{get:function(){d=!0}});try{const b=()=>{};u.addEventListener("test",b,y),u.removeEventListener("test",b,y)}catch{}return d}();function Ne(d,y){if(Ie.call(this,d?d.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,d){var b=this.type=d.type,P=d.changedTouches&&d.changedTouches.length?d.changedTouches[0]:null;if(this.target=d.target||d.srcElement,this.g=y,y=d.relatedTarget){if(Z){e:{try{U(y.nodeName);var $=!0;break e}catch{}$=!1}$||(y=null)}}else b=="mouseover"?y=d.fromElement:b=="mouseout"&&(y=d.toElement);this.relatedTarget=y,P?(this.clientX=P.clientX!==void 0?P.clientX:P.pageX,this.clientY=P.clientY!==void 0?P.clientY:P.pageY,this.screenX=P.screenX||0,this.screenY=P.screenY||0):(this.clientX=d.clientX!==void 0?d.clientX:d.pageX,this.clientY=d.clientY!==void 0?d.clientY:d.pageY,this.screenX=d.screenX||0,this.screenY=d.screenY||0),this.button=d.button,this.key=d.key||"",this.ctrlKey=d.ctrlKey,this.altKey=d.altKey,this.shiftKey=d.shiftKey,this.metaKey=d.metaKey,this.pointerId=d.pointerId||0,this.pointerType=typeof d.pointerType=="string"?d.pointerType:xe[d.pointerType]||"",this.state=d.state,this.i=d,d.defaultPrevented&&Ne.aa.h.call(this)}}T(Ne,Ie);var xe={2:"touch",3:"pen",4:"mouse"};Ne.prototype.h=function(){Ne.aa.h.call(this);var d=this.i;d.preventDefault?d.preventDefault():d.returnValue=!1};var ut="closure_listenable_"+(1e6*Math.random()|0),Cn=0;function zs(d,y,b,P,$){this.listener=d,this.proxy=null,this.src=y,this.type=b,this.capture=!!P,this.ha=$,this.key=++Cn,this.da=this.fa=!1}function Yn(d){d.da=!0,d.listener=null,d.proxy=null,d.src=null,d.ha=null}function Xn(d){this.src=d,this.g={},this.h=0}Xn.prototype.add=function(d,y,b,P,$){var Q=d.toString();d=this.g[Q],d||(d=this.g[Q]=[],this.h++);var ie=vr(d,y,P,$);return-1<ie?(y=d[ie],b||(y.fa=!1)):(y=new zs(y,this.src,Q,!!P,$),y.fa=b,d.push(y)),y};function Vn(d,y){var b=y.type;if(b in d.g){var P=d.g[b],$=Array.prototype.indexOf.call(P,y,void 0),Q;(Q=0<=$)&&Array.prototype.splice.call(P,$,1),Q&&(Yn(y),d.g[b].length==0&&(delete d.g[b],d.h--))}}function vr(d,y,b,P){for(var $=0;$<d.length;++$){var Q=d[$];if(!Q.da&&Q.listener==y&&Q.capture==!!b&&Q.ha==P)return $}return-1}var Ti="closure_lm_"+(1e6*Math.random()|0),zr={};function Ii(d,y,b,P,$){if(P&&P.once)return Bs(d,y,b,P,$);if(Array.isArray(y)){for(var Q=0;Q<y.length;Q++)Ii(d,y[Q],b,P,$);return null}return b=xr(b),d&&d[ut]?d.K(y,b,m(P)?!!P.capture:!!P,$):Br(d,y,b,!1,P,$)}function Br(d,y,b,P,$,Q){if(!y)throw Error("Invalid event type");var ie=m($)?!!$.capture:!!$,Ge=Pi(d);if(Ge||(d[Ti]=Ge=new Xn(d)),b=Ge.add(y,b,P,ie,Q),b.proxy)return b;if(P=Ur(),b.proxy=P,P.src=d,P.listener=b,d.addEventListener)Oe||($=ie),$===void 0&&($=!1),d.addEventListener(y.toString(),P,$);else if(d.attachEvent)d.attachEvent(Ci(y.toString()),P);else if(d.addListener&&d.removeListener)d.addListener(P);else throw Error("addEventListener and attachEvent are unavailable.");return b}function Ur(){function d(b){return y.call(d.src,d.listener,b)}const y=Us;return d}function Bs(d,y,b,P,$){if(Array.isArray(y)){for(var Q=0;Q<y.length;Q++)Bs(d,y[Q],b,P,$);return null}return b=xr(b),d&&d[ut]?d.L(y,b,m(P)?!!P.capture:!!P,$):Br(d,y,b,!0,P,$)}function Si(d,y,b,P,$){if(Array.isArray(y))for(var Q=0;Q<y.length;Q++)Si(d,y[Q],b,P,$);else P=m(P)?!!P.capture:!!P,b=xr(b),d&&d[ut]?(d=d.i,y=String(y).toString(),y in d.g&&(Q=d.g[y],b=vr(Q,b,P,$),-1<b&&(Yn(Q[b]),Array.prototype.splice.call(Q,b,1),Q.length==0&&(delete d.g[y],d.h--)))):d&&(d=Pi(d))&&(y=d.g[y.toString()],d=-1,y&&(d=vr(y,b,P,$)),(b=-1<d?y[d]:null)&&yr(b))}function yr(d){if(typeof d!="number"&&d&&!d.da){var y=d.src;if(y&&y[ut])Vn(y.i,d);else{var b=d.type,P=d.proxy;y.removeEventListener?y.removeEventListener(b,P,d.capture):y.detachEvent?y.detachEvent(Ci(b),P):y.addListener&&y.removeListener&&y.removeListener(P),(b=Pi(y))?(Vn(b,d),b.h==0&&(b.src=null,y[Ti]=null)):Yn(d)}}}function Ci(d){return d in zr?zr[d]:zr[d]="on"+d}function Us(d,y){if(d.da)d=!0;else{y=new Ne(y,this);var b=d.listener,P=d.ha||d.src;d.fa&&yr(d),d=b.call(P,y)}return d}function Pi(d){return d=d[Ti],d instanceof Xn?d:null}var Ni="__closure_events_fn_"+(1e9*Math.random()>>>0);function xr(d){return typeof d=="function"?d:(d[Ni]||(d[Ni]=function(y){return d.handleEvent(y)}),d[Ni])}function _t(){ce.call(this),this.i=new Xn(this),this.M=this,this.F=null}T(_t,ce),_t.prototype[ut]=!0,_t.prototype.removeEventListener=function(d,y,b,P){Si(this,d,y,b,P)};function xt(d,y){var b,P=d.F;if(P)for(b=[];P;P=P.F)b.push(P);if(d=d.M,P=y.type||y,typeof y=="string")y=new Ie(y,d);else if(y instanceof Ie)y.target=y.target||d;else{var $=y;y=new Ie(P,d),M(y,$)}if($=!0,b)for(var Q=b.length-1;0<=Q;Q--){var ie=y.g=b[Q];$=$r(ie,P,!0,y)&&$}if(ie=y.g=d,$=$r(ie,P,!0,y)&&$,$=$r(ie,P,!1,y)&&$,b)for(Q=0;Q<b.length;Q++)ie=y.g=b[Q],$=$r(ie,P,!1,y)&&$}_t.prototype.N=function(){if(_t.aa.N.call(this),this.i){var d=this.i,y;for(y in d.g){for(var b=d.g[y],P=0;P<b.length;P++)Yn(b[P]);delete d.g[y],d.h--}}this.F=null},_t.prototype.K=function(d,y,b,P){return this.i.add(String(d),y,!1,b,P)},_t.prototype.L=function(d,y,b,P){return this.i.add(String(d),y,!0,b,P)};function $r(d,y,b,P){if(y=d.i.g[String(y)],!y)return!0;y=y.concat();for(var $=!0,Q=0;Q<y.length;++Q){var ie=y[Q];if(ie&&!ie.da&&ie.capture==b){var Ge=ie.listener,Lt=ie.ha||ie.src;ie.fa&&Vn(d.i,ie),$=Ge.call(Lt,P)!==!1&&$}}return $&&!P.defaultPrevented}function Ai(d,y,b){if(typeof d=="function")b&&(d=v(d,b));else if(d&&typeof d.handleEvent=="function")d=v(d.handleEvent,d);else throw Error("Invalid listener argument");return 2147483647<Number(y)?-1:u.setTimeout(d,y||0)}function ki(d){d.g=Ai(()=>{d.g=null,d.i&&(d.i=!1,ki(d))},d.l);const y=d.h;d.h=null,d.m.apply(null,y)}class Fo extends ce{constructor(y,b){super(),this.m=y,this.l=b,this.h=null,this.i=!1,this.g=null}j(y){this.h=arguments,this.g?this.i=!0:ki(this)}N(){super.N(),this.g&&(u.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function er(d){ce.call(this),this.h=d,this.g={}}T(er,ce);var qr=[];function Ri(d){V(d.g,function(y,b){this.g.hasOwnProperty(b)&&yr(y)},d),d.g={}}er.prototype.N=function(){er.aa.N.call(this),Ri(this)},er.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var ji=u.JSON.stringify,wr=u.JSON.parse,zo=class{stringify(d){return u.JSON.stringify(d,void 0)}parse(d){return u.JSON.parse(d,void 0)}};function Di(){}Di.prototype.h=null;function Li(d){return d.h||(d.h=d.i())}function Mi(){}var tr={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Vi(){Ie.call(this,"d")}T(Vi,Ie);function Oi(){Ie.call(this,"c")}T(Oi,Ie);var On={},$s=null;function Gr(){return $s=$s||new _t}On.La="serverreachability";function ae(d){Ie.call(this,On.La,d)}T(ae,Ie);function J(d){const y=Gr();xt(y,new ae(y))}On.STAT_EVENT="statevent";function Be(d,y){Ie.call(this,On.STAT_EVENT,d),this.stat=y}T(Be,Ie);function we(d){const y=Gr();xt(y,new Be(y,d))}On.Ma="timingevent";function zu(d,y){Ie.call(this,On.Ma,d),this.size=y}T(zu,Ie);function qs(d,y){if(typeof d!="function")throw Error("Fn must not be null and must be a function");return u.setTimeout(function(){d()},y)}function en(){this.g=!0}en.prototype.xa=function(){this.g=!1};function ve(d,y,b,P,$,Q){d.info(function(){if(d.g)if(Q)for(var ie="",Ge=Q.split("&"),Lt=0;Lt<Ge.length;Lt++){var Se=Ge[Lt].split("=");if(1<Se.length){var dt=Se[0];Se=Se[1];var Ft=dt.split("_");ie=2<=Ft.length&&Ft[1]=="type"?ie+(dt+"="+Se+"&"):ie+(dt+"=redacted&")}}else ie=null;else ie=Q;return"XMLHTTP REQ ("+P+") [attempt "+$+"]: "+y+`
`+b+`
`+ie})}function Bu(d,y,b,P,$,Q,ie){d.info(function(){return"XMLHTTP RESP ("+P+") [ attempt "+$+"]: "+y+`
`+b+`
`+Q+" "+ie})}function Wr(d,y,b,P){d.info(function(){return"XMLHTTP TEXT ("+y+"): "+$u(d,b)+(P?" "+P:"")})}function Uu(d,y){d.info(function(){return"TIMEOUT: "+y})}en.prototype.info=function(){};function $u(d,y){if(!d.g)return y;if(!y)return null;try{var b=JSON.parse(y);if(b){for(d=0;d<b.length;d++)if(Array.isArray(b[d])){var P=b[d];if(!(2>P.length)){var $=P[1];if(Array.isArray($)&&!(1>$.length)){var Q=$[0];if(Q!="noop"&&Q!="stop"&&Q!="close")for(var ie=1;ie<$.length;ie++)$[ie]=""}}}}return ji(b)}catch{return y}}var Fi={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Sl={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"},br;function Gs(){}T(Gs,Di),Gs.prototype.g=function(){return new XMLHttpRequest},Gs.prototype.i=function(){return{}},br=new Gs;function Er(d,y,b,P){this.j=d,this.i=y,this.l=b,this.R=P||1,this.U=new er(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new qu}function qu(){this.i=null,this.g="",this.h=!1}var Gu={},Cl={};function Bo(d,y,b){d.L=1,d.v=Tr(rr(y)),d.m=b,d.P=!0,Wu(d,null)}function Wu(d,y){d.F=Date.now(),Uo(d),d.A=rr(d.v);var b=d.A,P=d.R;Array.isArray(P)||(P=[String(P)]),Ee(b.i,"t",P),d.C=0,b=d.j.J,d.h=new qu,d.g=Gl(d.j,b?y:null,!d.m),0<d.O&&(d.M=new Fo(v(d.Y,d,d.g),d.O)),y=d.U,b=d.g,P=d.ca;var $="readystatechange";Array.isArray($)||($&&(qr[0]=$.toString()),$=qr);for(var Q=0;Q<$.length;Q++){var ie=Ii(b,$[Q],P||y.handleEvent,!1,y.h||y);if(!ie)break;y.g[ie.key]=ie}y=d.H?N(d.H):{},d.m?(d.u||(d.u="POST"),y["Content-Type"]="application/x-www-form-urlencoded",d.g.ea(d.A,d.u,d.m,y)):(d.u="GET",d.g.ea(d.A,d.u,null,y)),J(),ve(d.i,d.u,d.A,d.l,d.R,d.m)}Er.prototype.ca=function(d){d=d.target;const y=this.M;y&&Bn(d)==3?y.j():this.Y(d)},Er.prototype.Y=function(d){try{if(d==this.g)e:{const Ft=Bn(this.g);var y=this.g.Ba();const nn=this.g.Z();if(!(3>Ft)&&(Ft!=3||this.g&&(this.h.h||this.g.oa()||Yu(this.g)))){this.J||Ft!=4||y==7||(y==8||0>=nn?J(3):J(2)),Pl(this);var b=this.g.Z();this.X=b;t:if(Ws(this)){var P=Yu(this.g);d="";var $=P.length,Q=Bn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){nr(this),Hs(this);var ie="";break t}this.h.i=new u.TextDecoder}for(y=0;y<$;y++)this.h.h=!0,d+=this.h.i.decode(P[y],{stream:!(Q&&y==$-1)});P.length=0,this.h.g+=d,this.C=0,ie=this.h.g}else ie=this.g.oa();if(this.o=b==200,Bu(this.i,this.u,this.A,this.l,this.R,Ft,b),this.o){if(this.T&&!this.K){t:{if(this.g){var Ge,Lt=this.g;if((Ge=Lt.g?Lt.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(Ge)){var Se=Ge;break t}}Se=null}if(b=Se)Wr(this.i,this.l,b,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Hr(this,b);else{this.o=!1,this.s=3,we(12),nr(this),Hs(this);break e}}if(this.P){b=!0;let Nn;for(;!this.J&&this.C<ie.length;)if(Nn=Kf(this,ie),Nn==Cl){Ft==4&&(this.s=4,we(14),b=!1),Wr(this.i,this.l,null,"[Incomplete Response]");break}else if(Nn==Gu){this.s=4,we(15),Wr(this.i,this.l,ie,"[Invalid Chunk]"),b=!1;break}else Wr(this.i,this.l,Nn,null),Hr(this,Nn);if(Ws(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Ft!=4||ie.length!=0||this.h.h||(this.s=1,we(16),b=!1),this.o=this.o&&b,!b)Wr(this.i,this.l,ie,"[Invalid Chunked Response]"),nr(this),Hs(this);else if(0<ie.length&&!this.W){this.W=!0;var dt=this.j;dt.g==this&&dt.ba&&!dt.M&&(dt.j.info("Great, no buffering proxy detected. Bytes received: "+ie.length),Zs(dt),dt.M=!0,we(11))}}else Wr(this.i,this.l,ie,null),Hr(this,ie);Ft==4&&nr(this),this.o&&!this.J&&(Ft==4?ql(this.j,this):(this.o=!1,Uo(this)))}else zl(this.g),b==400&&0<ie.indexOf("Unknown SID")?(this.s=3,we(12)):(this.s=0,we(13)),nr(this),Hs(this)}}}catch{}finally{}};function Ws(d){return d.g?d.u=="GET"&&d.L!=2&&d.j.Ca:!1}function Kf(d,y){var b=d.C,P=y.indexOf(`
`,b);return P==-1?Cl:(b=Number(y.substring(b,P)),isNaN(b)?Gu:(P+=1,P+b>y.length?Cl:(y=y.slice(P,P+b),d.C=P+b,y)))}Er.prototype.cancel=function(){this.J=!0,nr(this)};function Uo(d){d.S=Date.now()+d.I,Hu(d,d.I)}function Hu(d,y){if(d.B!=null)throw Error("WatchDog timer not null");d.B=qs(v(d.ba,d),y)}function Pl(d){d.B&&(u.clearTimeout(d.B),d.B=null)}Er.prototype.ba=function(){this.B=null;const d=Date.now();0<=d-this.S?(Uu(this.i,this.A),this.L!=2&&(J(),we(17)),nr(this),this.s=2,Hs(this)):Hu(this,this.S-d)};function Hs(d){d.j.G==0||d.J||ql(d.j,d)}function nr(d){Pl(d);var y=d.M;y&&typeof y.ma=="function"&&y.ma(),d.M=null,Ri(d.U),d.g&&(y=d.g,d.g=null,y.abort(),y.ma())}function Hr(d,y){try{var b=d.j;if(b.G!=0&&(b.g==d||Ze(b.h,d))){if(!d.K&&Ze(b.h,d)&&b.G==3){try{var P=b.Da.g.parse(y)}catch{P=null}if(Array.isArray(P)&&P.length==3){var $=P;if($[0]==0){e:if(!b.u){if(b.g)if(b.g.F+3e3<d.F)Js(b),Ko(b);else break e;Jo(b),we(18)}}else b.za=$[1],0<b.za-b.T&&37500>$[2]&&b.F&&b.v==0&&!b.C&&(b.C=qs(v(b.Za,b),6e3));if(1>=Fe(b.h)&&b.ca){try{b.ca()}catch{}b.ca=void 0}}else Xr(b,11)}else if((d.K||b.g==d)&&Js(b),!C(y))for($=b.Da.g.parse(y),y=0;y<$.length;y++){let Se=$[y];if(b.T=Se[0],Se=Se[1],b.G==2)if(Se[0]=="c"){b.K=Se[1],b.ia=Se[2];const dt=Se[3];dt!=null&&(b.la=dt,b.j.info("VER="+b.la));const Ft=Se[4];Ft!=null&&(b.Aa=Ft,b.j.info("SVER="+b.Aa));const nn=Se[5];nn!=null&&typeof nn=="number"&&0<nn&&(P=1.5*nn,b.L=P,b.j.info("backChannelRequestTimeoutMs_="+P)),P=b;const Nn=d.g;if(Nn){const ar=Nn.g?Nn.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(ar){var Q=P.h;Q.g||ar.indexOf("spdy")==-1&&ar.indexOf("quic")==-1&&ar.indexOf("h2")==-1||(Q.j=Q.l,Q.g=new Set,Q.h&&(Bi(Q,Q.h),Q.h=null))}if(P.D){const Hl=Nn.g?Nn.g.getResponseHeader("X-HTTP-Session-Id"):null;Hl&&(P.ya=Hl,$e(P.I,P.D,Hl))}}b.G=3,b.l&&b.l.ua(),b.ba&&(b.R=Date.now()-d.F,b.j.info("Handshake RTT: "+b.R+"ms")),P=b;var ie=d;if(P.qa=nh(P,P.J?P.ia:null,P.W),ie.K){Kr(P.h,ie);var Ge=ie,Lt=P.L;Lt&&(Ge.I=Lt),Ge.B&&(Pl(Ge),Uo(Ge)),P.g=ie}else $l(P);0<b.i.length&&Zo(b)}else Se[0]!="stop"&&Se[0]!="close"||Xr(b,7);else b.G==3&&(Se[0]=="stop"||Se[0]=="close"?Se[0]=="stop"?Xr(b,7):Ul(b):Se[0]!="noop"&&b.l&&b.l.ta(Se),b.v=0)}}J(4)}catch{}}var Ku=class{constructor(d,y){this.g=d,this.map=y}};function Nl(d){this.l=d||10,u.PerformanceNavigationTiming?(d=u.performance.getEntriesByType("navigation"),d=0<d.length&&(d[0].nextHopProtocol=="hq"||d[0].nextHopProtocol=="h2")):d=!!(u.chrome&&u.chrome.loadTimes&&u.chrome.loadTimes()&&u.chrome.loadTimes().wasFetchedViaSpdy),this.j=d?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function zi(d){return d.h?!0:d.g?d.g.size>=d.j:!1}function Fe(d){return d.h?1:d.g?d.g.size:0}function Ze(d,y){return d.h?d.h==y:d.g?d.g.has(y):!1}function Bi(d,y){d.g?d.g.add(y):d.h=y}function Kr(d,y){d.h&&d.h==y?d.h=null:d.g&&d.g.has(y)&&d.g.delete(y)}Nl.prototype.cancel=function(){if(this.i=Qr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const d of this.g.values())d.cancel();this.g.clear()}};function Qr(d){if(d.h!=null)return d.i.concat(d.h.D);if(d.g!=null&&d.g.size!==0){let y=d.i;for(const b of d.g.values())y=y.concat(b.D);return y}return E(d.i)}function Al(d){if(d.V&&typeof d.V=="function")return d.V();if(typeof Map<"u"&&d instanceof Map||typeof Set<"u"&&d instanceof Set)return Array.from(d.values());if(typeof d=="string")return d.split("");if(h(d)){for(var y=[],b=d.length,P=0;P<b;P++)y.push(d[P]);return y}y=[],b=0;for(P in d)y[b++]=d[P];return y}function Ce(d){if(d.na&&typeof d.na=="function")return d.na();if(!d.V||typeof d.V!="function"){if(typeof Map<"u"&&d instanceof Map)return Array.from(d.keys());if(!(typeof Set<"u"&&d instanceof Set)){if(h(d)||typeof d=="string"){var y=[];d=d.length;for(var b=0;b<d;b++)y.push(b);return y}y=[],b=0;for(const P in d)y[b++]=P;return y}}}function it(d,y){if(d.forEach&&typeof d.forEach=="function")d.forEach(y,void 0);else if(h(d)||typeof d=="string")Array.prototype.forEach.call(d,y,void 0);else for(var b=Ce(d),P=Al(d),$=P.length,Q=0;Q<$;Q++)y.call(void 0,P[Q],b&&b[Q],d)}var $o=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function qo(d,y){if(d){d=d.split("&");for(var b=0;b<d.length;b++){var P=d[b].indexOf("="),$=null;if(0<=P){var Q=d[b].substring(0,P);$=d[b].substring(P+1)}else Q=d[b];y(Q,$?decodeURIComponent($.replace(/\+/g," ")):"")}}}function Pt(d){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,d instanceof Pt){this.h=d.h,Zr(this,d.j),this.o=d.o,this.g=d.g,Fn(this,d.s),this.l=d.l;var y=d.i,b=new Ir;b.i=y.i,y.g&&(b.g=new Map(y.g),b.h=y.h),ht(this,b),this.m=d.m}else d&&(y=String(d).match($o))?(this.h=!1,Zr(this,y[1]||"",!0),this.o=ir(y[2]||""),this.g=ir(y[3]||"",!0),Fn(this,y[4]),this.l=ir(y[5]||"",!0),ht(this,y[6]||"",!0),this.m=ir(y[7]||"")):(this.h=!1,this.i=new Ir(null,this.h))}Pt.prototype.toString=function(){var d=[],y=this.j;y&&d.push(Jr(y,Go,!0),":");var b=this.g;return(b||y=="file")&&(d.push("//"),(y=this.o)&&d.push(Jr(y,Go,!0),"@"),d.push(encodeURIComponent(String(b)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),b=this.s,b!=null&&d.push(":",String(b))),(b=this.l)&&(this.g&&b.charAt(0)!="/"&&d.push("/"),d.push(Jr(b,b.charAt(0)=="/"?Wo:kl,!0))),(b=this.i.toString())&&d.push("?",b),(b=this.m)&&d.push("#",Jr(b,jl)),d.join("")};function rr(d){return new Pt(d)}function Zr(d,y,b){d.j=b?ir(y,!0):y,d.j&&(d.j=d.j.replace(/:$/,""))}function Fn(d,y){if(y){if(y=Number(y),isNaN(y)||0>y)throw Error("Bad port number "+y);d.s=y}else d.s=null}function ht(d,y,b){y instanceof Ir?(d.i=y,Ke(d.i,d.h)):(b||(y=Jr(y,Rl)),d.i=new Ir(y,d.h))}function $e(d,y,b){d.i.set(y,b)}function Tr(d){return $e(d,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),d}function ir(d,y){return d?y?decodeURI(d.replace(/%25/g,"%2525")):decodeURIComponent(d):""}function Jr(d,y,b){return typeof d=="string"?(d=encodeURI(d).replace(y,Ks),b&&(d=d.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),d):null}function Ks(d){return d=d.charCodeAt(0),"%"+(d>>4&15).toString(16)+(d&15).toString(16)}var Go=/[#\/\?@]/g,kl=/[#\?:]/g,Wo=/[#\?]/g,Rl=/[#\?@]/g,jl=/#/g;function Ir(d,y){this.h=this.g=null,this.i=d||null,this.j=!!y}function sr(d){d.g||(d.g=new Map,d.h=0,d.i&&qo(d.i,function(y,b){d.add(decodeURIComponent(y.replace(/\+/g," ")),b)}))}t=Ir.prototype,t.add=function(d,y){sr(this),this.i=null,d=Ht(this,d);var b=this.g.get(d);return b||this.g.set(d,b=[]),b.push(y),this.h+=1,this};function Ho(d,y){sr(d),y=Ht(d,y),d.g.has(y)&&(d.i=null,d.h-=d.g.get(y).length,d.g.delete(y))}function Qu(d,y){return sr(d),y=Ht(d,y),d.g.has(y)}t.forEach=function(d,y){sr(this),this.g.forEach(function(b,P){b.forEach(function($){d.call(y,$,P,this)},this)},this)},t.na=function(){sr(this);const d=Array.from(this.g.values()),y=Array.from(this.g.keys()),b=[];for(let P=0;P<y.length;P++){const $=d[P];for(let Q=0;Q<$.length;Q++)b.push(y[P])}return b},t.V=function(d){sr(this);let y=[];if(typeof d=="string")Qu(this,d)&&(y=y.concat(this.g.get(Ht(this,d))));else{d=Array.from(this.g.values());for(let b=0;b<d.length;b++)y=y.concat(d[b])}return y},t.set=function(d,y){return sr(this),this.i=null,d=Ht(this,d),Qu(this,d)&&(this.h-=this.g.get(d).length),this.g.set(d,[y]),this.h+=1,this},t.get=function(d,y){return d?(d=this.V(d),0<d.length?String(d[0]):y):y};function Ee(d,y,b){Ho(d,y),0<b.length&&(d.i=null,d.g.set(Ht(d,y),E(b)),d.h+=b.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const d=[],y=Array.from(this.g.keys());for(var b=0;b<y.length;b++){var P=y[b];const Q=encodeURIComponent(String(P)),ie=this.V(P);for(P=0;P<ie.length;P++){var $=Q;ie[P]!==""&&($+="="+encodeURIComponent(String(ie[P]))),d.push($)}}return this.i=d.join("&")};function Ht(d,y){return y=String(y),d.j&&(y=y.toLowerCase()),y}function Ke(d,y){y&&!d.j&&(sr(d),d.i=null,d.g.forEach(function(b,P){var $=P.toLowerCase();P!=$&&(Ho(this,P),Ee(this,$,b))},d)),d.j=y}function Zu(d,y){const b=new en;if(u.Image){const P=new Image;P.onload=x(zn,b,"TestLoadImage: loaded",!0,y,P),P.onerror=x(zn,b,"TestLoadImage: error",!1,y,P),P.onabort=x(zn,b,"TestLoadImage: abort",!1,y,P),P.ontimeout=x(zn,b,"TestLoadImage: timeout",!1,y,P),u.setTimeout(function(){P.ontimeout&&P.ontimeout()},1e4),P.src=d}else y(!1)}function Dl(d,y){const b=new en,P=new AbortController,$=setTimeout(()=>{P.abort(),zn(b,"TestPingServer: timeout",!1,y)},1e4);fetch(d,{signal:P.signal}).then(Q=>{clearTimeout($),Q.ok?zn(b,"TestPingServer: ok",!0,y):zn(b,"TestPingServer: server error",!1,y)}).catch(()=>{clearTimeout($),zn(b,"TestPingServer: error",!1,y)})}function zn(d,y,b,P,$){try{$&&($.onload=null,$.onerror=null,$.onabort=null,$.ontimeout=null),P(b)}catch{}}function Ll(){this.g=new zo}function Yr(d,y,b){const P=b||"";try{it(d,function($,Q){let ie=$;m($)&&(ie=ji($)),y.push(P+Q+"="+encodeURIComponent(ie))})}catch($){throw y.push(P+"type="+encodeURIComponent("_badmap")),$}}function Ui(d){this.l=d.Ub||null,this.j=d.eb||!1}T(Ui,Di),Ui.prototype.g=function(){return new Sr(this.l,this.j)},Ui.prototype.i=function(d){return function(){return d}}({});function Sr(d,y){_t.call(this),this.D=d,this.o=y,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}T(Sr,_t),t=Sr.prototype,t.open=function(d,y){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.B=d,this.A=y,this.readyState=1,$i(this)},t.send=function(d){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;const y={headers:this.u,method:this.B,credentials:this.m,cache:void 0};d&&(y.body=d),(this.D||u).fetch(new Request(this.A,y)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,Pn(this)),this.readyState=0},t.Sa=function(d){if(this.g&&(this.l=d,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=d.headers,this.readyState=2,$i(this)),this.g&&(this.readyState=3,$i(this),this.g)))if(this.responseType==="arraybuffer")d.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(typeof u.ReadableStream<"u"&&"body"in d){if(this.j=d.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;Nt(this)}else d.text().then(this.Ra.bind(this),this.ga.bind(this))};function Nt(d){d.j.read().then(d.Pa.bind(d)).catch(d.ga.bind(d))}t.Pa=function(d){if(this.g){if(this.o&&d.value)this.response.push(d.value);else if(!this.o){var y=d.value?d.value:new Uint8Array(0);(y=this.v.decode(y,{stream:!d.done}))&&(this.response=this.responseText+=y)}d.done?Pn(this):$i(this),this.readyState==3&&Nt(this)}},t.Ra=function(d){this.g&&(this.response=this.responseText=d,Pn(this))},t.Qa=function(d){this.g&&(this.response=d,Pn(this))},t.ga=function(){this.g&&Pn(this)};function Pn(d){d.readyState=4,d.l=null,d.j=null,d.v=null,$i(d)}t.setRequestHeader=function(d,y){this.u.append(d,y)},t.getResponseHeader=function(d){return this.h&&this.h.get(d.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const d=[],y=this.h.entries();for(var b=y.next();!b.done;)b=b.value,d.push(b[0]+": "+b[1]),b=y.next();return d.join(`\r
`)};function $i(d){d.onreadystatechange&&d.onreadystatechange.call(d)}Object.defineProperty(Sr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(d){this.m=d?"include":"same-origin"}});function Ml(d){let y="";return V(d,function(b,P){y+=P,y+=":",y+=b,y+=`\r
`}),y}function Vl(d,y,b){e:{for(P in b){var P=!1;break e}P=!0}P||(b=Ml(b),typeof d=="string"?b!=null&&encodeURIComponent(String(b)):$e(d,y,b))}function et(d){_t.call(this),this.headers=new Map,this.o=d||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}T(et,_t);var Ol=/^https?$/i,Qf=["POST","PUT"];t=et.prototype,t.Ha=function(d){this.J=d},t.ea=function(d,y,b,P){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+d);y=y?y.toUpperCase():"GET",this.D=d,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():br.g(),this.v=this.o?Li(this.o):Li(br),this.g.onreadystatechange=v(this.Ea,this);try{this.B=!0,this.g.open(y,String(d),!0),this.B=!1}catch(Q){Fl(this,Q);return}if(d=b||"",b=new Map(this.headers),P)if(Object.getPrototypeOf(P)===Object.prototype)for(var $ in P)b.set($,P[$]);else if(typeof P.keys=="function"&&typeof P.get=="function")for(const Q of P.keys())b.set(Q,P.get(Q));else throw Error("Unknown input type for opt_headers: "+String(P));P=Array.from(b.keys()).find(Q=>Q.toLowerCase()=="content-type"),$=u.FormData&&d instanceof u.FormData,!(0<=Array.prototype.indexOf.call(Qf,y,void 0))||P||$||b.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[Q,ie]of b)this.g.setRequestHeader(Q,ie);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{qi(this),this.u=!0,this.g.send(d),this.u=!1}catch(Q){Fl(this,Q)}};function Fl(d,y){d.h=!1,d.g&&(d.j=!0,d.g.abort(),d.j=!1),d.l=y,d.m=5,ke(d),tn(d)}function ke(d){d.A||(d.A=!0,xt(d,"complete"),xt(d,"error"))}t.abort=function(d){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=d||7,xt(this,"complete"),xt(this,"abort"),tn(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tn(this,!0)),et.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Ju(this):this.bb())},t.bb=function(){Ju(this)};function Ju(d){if(d.h&&typeof a<"u"&&(!d.v[1]||Bn(d)!=4||d.Z()!=2)){if(d.u&&Bn(d)==4)Ai(d.Ea,0,d);else if(xt(d,"readystatechange"),Bn(d)==4){d.h=!1;try{const ie=d.Z();e:switch(ie){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var y=!0;break e;default:y=!1}var b;if(!(b=y)){var P;if(P=ie===0){var $=String(d.D).match($o)[1]||null;!$&&u.self&&u.self.location&&($=u.self.location.protocol.slice(0,-1)),P=!Ol.test($?$.toLowerCase():"")}b=P}if(b)xt(d,"complete"),xt(d,"success");else{d.m=6;try{var Q=2<Bn(d)?d.g.statusText:""}catch{Q=""}d.l=Q+" ["+d.Z()+"]",ke(d)}}finally{tn(d)}}}}function tn(d,y){if(d.g){qi(d);const b=d.g,P=d.v[0]?()=>{}:null;d.g=null,d.v=null,y||xt(d,"ready");try{b.onreadystatechange=P}catch{}}}function qi(d){d.I&&(u.clearTimeout(d.I),d.I=null)}t.isActive=function(){return!!this.g};function Bn(d){return d.g?d.g.readyState:0}t.Z=function(){try{return 2<Bn(this)?this.g.status:-1}catch{return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.Oa=function(d){if(this.g){var y=this.g.responseText;return d&&y.indexOf(d)==0&&(y=y.substring(d.length)),wr(y)}};function Yu(d){try{if(!d.g)return null;if("response"in d.g)return d.g.response;switch(d.H){case"":case"text":return d.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in d.g)return d.g.mozResponseArrayBuffer}return null}catch{return null}}function zl(d){const y={};d=(d.g&&2<=Bn(d)&&d.g.getAllResponseHeaders()||"").split(`\r
`);for(let P=0;P<d.length;P++){if(C(d[P]))continue;var b=F(d[P]);const $=b[0];if(b=b[1],typeof b!="string")continue;b=b.trim();const Q=y[$]||[];y[$]=Q,Q.push(b)}k(y,function(P){return P.join(", ")})}t.Ba=function(){return this.m},t.Ka=function(){return typeof this.l=="string"?this.l:String(this.l)};function Qs(d,y,b){return b&&b.internalChannelParams&&b.internalChannelParams[d]||y}function Bl(d){this.Aa=0,this.i=[],this.j=new en,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=Qs("failFast",!1,d),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=Qs("baseRetryDelayMs",5e3,d),this.cb=Qs("retryDelaySeedMs",1e4,d),this.Wa=Qs("forwardChannelMaxRetries",2,d),this.wa=Qs("forwardChannelRequestTimeoutMs",2e4,d),this.pa=d&&d.xmlHttpFactory||void 0,this.Xa=d&&d.Tb||void 0,this.Ca=d&&d.useFetchStreams||!1,this.L=void 0,this.J=d&&d.supportsCrossDomainXhr||!1,this.K="",this.h=new Nl(d&&d.concurrentRequestLimit),this.Da=new Ll,this.P=d&&d.fastHandshake||!1,this.O=d&&d.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=d&&d.Rb||!1,d&&d.xa&&this.j.xa(),d&&d.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&d&&d.detectBufferingProxy||!1,this.ja=void 0,d&&d.longPollingTimeout&&0<d.longPollingTimeout&&(this.ja=d.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}t=Bl.prototype,t.la=8,t.G=1,t.connect=function(d,y,b,P){we(0),this.W=d,this.H=y||{},b&&P!==void 0&&(this.H.OSID=b,this.H.OAID=P),this.F=this.X,this.I=nh(this,null,this.W),Zo(this)};function Ul(d){if(Qo(d),d.G==3){var y=d.U++,b=rr(d.I);if($e(b,"SID",d.K),$e(b,"RID",y),$e(b,"TYPE","terminate"),Gi(d,b),y=new Er(d,d.j,y),y.L=2,y.v=Tr(rr(b)),b=!1,u.navigator&&u.navigator.sendBeacon)try{b=u.navigator.sendBeacon(y.v.toString(),"")}catch{}!b&&u.Image&&(new Image().src=y.v,b=!0),b||(y.g=Gl(y.j,null),y.g.ea(y.v)),y.F=Date.now(),Uo(y)}Yo(d)}function Ko(d){d.g&&(Zs(d),d.g.cancel(),d.g=null)}function Qo(d){Ko(d),d.u&&(u.clearTimeout(d.u),d.u=null),Js(d),d.h.cancel(),d.s&&(typeof d.s=="number"&&u.clearTimeout(d.s),d.s=null)}function Zo(d){if(!zi(d.h)&&!d.s){d.s=!0;var y=d.Ga;se||X(),W||(se(),W=!0),fe.add(y,d),d.B=0}}function Un(d,y){return Fe(d.h)>=d.h.j-(d.s?1:0)?!1:d.s?(d.i=y.D.concat(d.i),!0):d.G==1||d.G==2||d.B>=(d.Va?0:d.Wa)?!1:(d.s=qs(v(d.Ga,d,y),th(d,d.B)),d.B++,!0)}t.Ga=function(d){if(this.s)if(this.s=null,this.G==1){if(!d){this.U=Math.floor(1e5*Math.random()),d=this.U++;const $=new Er(this,this.j,d);let Q=this.o;if(this.S&&(Q?(Q=N(Q),M(Q,this.S)):Q=this.S),this.m!==null||this.O||($.H=Q,Q=null),this.P)e:{for(var y=0,b=0;b<this.i.length;b++){t:{var P=this.i[b];if("__data__"in P.map&&(P=P.map.__data__,typeof P=="string")){P=P.length;break t}P=void 0}if(P===void 0)break;if(y+=P,4096<y){y=b;break e}if(y===4096||b===this.i.length-1){y=b+1;break e}}y=1e3}else y=1e3;y=or(this,$,y),b=rr(this.I),$e(b,"RID",d),$e(b,"CVER",22),this.D&&$e(b,"X-HTTP-Session-Id",this.D),Gi(this,b),Q&&(this.O?y="headers="+encodeURIComponent(String(Ml(Q)))+"&"+y:this.m&&Vl(b,this.m,Q)),Bi(this.h,$),this.Ua&&$e(b,"TYPE","init"),this.P?($e(b,"$req",y),$e(b,"SID","null"),$.T=!0,Bo($,b,null)):Bo($,b,y),this.G=2}}else this.G==3&&(d?Xu(this,d):this.i.length==0||zi(this.h)||Xu(this))};function Xu(d,y){var b;y?b=y.l:b=d.U++;const P=rr(d.I);$e(P,"SID",d.K),$e(P,"RID",b),$e(P,"AID",d.T),Gi(d,P),d.m&&d.o&&Vl(P,d.m,d.o),b=new Er(d,d.j,b,d.B+1),d.m===null&&(b.H=d.o),y&&(d.i=y.D.concat(d.i)),y=or(d,b,1e3),b.I=Math.round(.5*d.wa)+Math.round(.5*d.wa*Math.random()),Bi(d.h,b),Bo(b,P,y)}function Gi(d,y){d.H&&V(d.H,function(b,P){$e(y,P,b)}),d.l&&it({},function(b,P){$e(y,P,b)})}function or(d,y,b){b=Math.min(d.i.length,b);var P=d.l?v(d.l.Na,d.l,d):null;e:{var $=d.i;let Q=-1;for(;;){const ie=["count="+b];Q==-1?0<b?(Q=$[0].g,ie.push("ofs="+Q)):Q=0:ie.push("ofs="+Q);let Ge=!0;for(let Lt=0;Lt<b;Lt++){let Se=$[Lt].g;const dt=$[Lt].map;if(Se-=Q,0>Se)Q=Math.max(0,$[Lt].g-100),Ge=!1;else try{Yr(dt,ie,"req"+Se+"_")}catch{P&&P(dt)}}if(Ge){P=ie.join("&");break e}}}return d=d.i.splice(0,b),y.D=d,P}function $l(d){if(!d.g&&!d.u){d.Y=1;var y=d.Fa;se||X(),W||(se(),W=!0),fe.add(y,d),d.v=0}}function Jo(d){return d.g||d.u||3<=d.v?!1:(d.Y++,d.u=qs(v(d.Fa,d),th(d,d.v)),d.v++,!0)}t.Fa=function(){if(this.u=null,eh(this),this.ba&&!(this.M||this.g==null||0>=this.R)){var d=2*this.R;this.j.info("BP detection timer enabled: "+d),this.A=qs(v(this.ab,this),d)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,we(10),Ko(this),eh(this))};function Zs(d){d.A!=null&&(u.clearTimeout(d.A),d.A=null)}function eh(d){d.g=new Er(d,d.j,"rpc",d.Y),d.m===null&&(d.g.H=d.o),d.g.O=0;var y=rr(d.qa);$e(y,"RID","rpc"),$e(y,"SID",d.K),$e(y,"AID",d.T),$e(y,"CI",d.F?"0":"1"),!d.F&&d.ja&&$e(y,"TO",d.ja),$e(y,"TYPE","xmlhttp"),Gi(d,y),d.m&&d.o&&Vl(y,d.m,d.o),d.L&&(d.g.I=d.L);var b=d.g;d=d.ia,b.L=1,b.v=Tr(rr(y)),b.m=null,b.P=!0,Wu(b,d)}t.Za=function(){this.C!=null&&(this.C=null,Ko(this),Jo(this),we(19))};function Js(d){d.C!=null&&(u.clearTimeout(d.C),d.C=null)}function ql(d,y){var b=null;if(d.g==y){Js(d),Zs(d),d.g=null;var P=2}else if(Ze(d.h,y))b=y.D,Kr(d.h,y),P=1;else return;if(d.G!=0){if(y.o)if(P==1){b=y.m?y.m.length:0,y=Date.now()-y.F;var $=d.B;P=Gr(),xt(P,new zu(P,b)),Zo(d)}else $l(d);else if($=y.s,$==3||$==0&&0<y.X||!(P==1&&Un(d,y)||P==2&&Jo(d)))switch(b&&0<b.length&&(y=d.h,y.i=y.i.concat(b)),$){case 1:Xr(d,5);break;case 4:Xr(d,10);break;case 3:Xr(d,6);break;default:Xr(d,2)}}}function th(d,y){let b=d.Ta+Math.floor(Math.random()*d.cb);return d.isActive()||(b*=2),b*y}function Xr(d,y){if(d.j.info("Error code "+y),y==2){var b=v(d.fb,d),P=d.Xa;const $=!P;P=new Pt(P||"//www.google.com/images/cleardot.gif"),u.location&&u.location.protocol=="http"||Zr(P,"https"),Tr(P),$?Zu(P.toString(),b):Dl(P.toString(),b)}else we(2);d.G=0,d.l&&d.l.sa(y),Yo(d),Qo(d)}t.fb=function(d){d?(this.j.info("Successfully pinged google.com"),we(2)):(this.j.info("Failed to ping google.com"),we(1))};function Yo(d){if(d.G=0,d.ka=[],d.l){const y=Qr(d.h);(y.length!=0||d.i.length!=0)&&(R(d.ka,y),R(d.ka,d.i),d.h.i.length=0,E(d.i),d.i.length=0),d.l.ra()}}function nh(d,y,b){var P=b instanceof Pt?rr(b):new Pt(b);if(P.g!="")y&&(P.g=y+"."+P.g),Fn(P,P.s);else{var $=u.location;P=$.protocol,y=y?y+"."+$.hostname:$.hostname,$=+$.port;var Q=new Pt(null);P&&Zr(Q,P),y&&(Q.g=y),$&&Fn(Q,$),b&&(Q.l=b),P=Q}return b=d.D,y=d.ya,b&&y&&$e(P,b,y),$e(P,"VER",d.la),Gi(d,P),P}function Gl(d,y,b){if(y&&!d.J)throw Error("Can't create secondary domain capable XhrIo object.");return y=d.Ca&&!d.pa?new et(new Ui({eb:b})):new et(d.pa),y.Ha(d.J),y}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function Wl(){}t=Wl.prototype,t.ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){};function ei(){}ei.prototype.g=function(d,y){return new wt(d,y)};function wt(d,y){_t.call(this),this.g=new Bl(y),this.l=d,this.h=y&&y.messageUrlParams||null,d=y&&y.messageHeaders||null,y&&y.clientProtocolHeaderRequired&&(d?d["X-Client-Protocol"]="webchannel":d={"X-Client-Protocol":"webchannel"}),this.g.o=d,d=y&&y.initMessageHeaders||null,y&&y.messageContentType&&(d?d["X-WebChannel-Content-Type"]=y.messageContentType:d={"X-WebChannel-Content-Type":y.messageContentType}),y&&y.va&&(d?d["X-WebChannel-Client-Profile"]=y.va:d={"X-WebChannel-Client-Profile":y.va}),this.g.S=d,(d=y&&y.Sb)&&!C(d)&&(this.g.m=d),this.v=y&&y.supportsCrossDomainXhr||!1,this.u=y&&y.sendRawJson||!1,(y=y&&y.httpSessionIdParam)&&!C(y)&&(this.g.D=y,d=this.h,d!==null&&y in d&&(d=this.h,y in d&&delete d[y])),this.j=new Dt(this)}T(wt,_t),wt.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},wt.prototype.close=function(){Ul(this.g)},wt.prototype.o=function(d){var y=this.g;if(typeof d=="string"){var b={};b.__data__=d,d=b}else this.u&&(b={},b.__data__=ji(d),d=b);y.i.push(new Ku(y.Ya++,d)),y.G==3&&Zo(y)},wt.prototype.N=function(){this.g.l=null,delete this.j,Ul(this.g),delete this.g,wt.aa.N.call(this)};function rh(d){Vi.call(this),d.__headers__&&(this.headers=d.__headers__,this.statusCode=d.__status__,delete d.__headers__,delete d.__status__);var y=d.__sm__;if(y){e:{for(const b in y){d=b;break e}d=void 0}(this.i=d)&&(d=this.i,y=y!==null&&d in y?y[d]:void 0),this.data=y}else this.data=d}T(rh,Vi);function Wi(){Oi.call(this),this.status=1}T(Wi,Oi);function Dt(d){this.g=d}T(Dt,Wl),Dt.prototype.ua=function(){xt(this.g,"a")},Dt.prototype.ta=function(d){xt(this.g,new rh(d))},Dt.prototype.sa=function(d){xt(this.g,new Wi)},Dt.prototype.ra=function(){xt(this.g,"b")},ei.prototype.createWebChannel=ei.prototype.g,wt.prototype.send=wt.prototype.o,wt.prototype.open=wt.prototype.m,wt.prototype.close=wt.prototype.close,Ub=function(){return new ei},Bb=function(){return Gr()},zb=On,Wp={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Fi.NO_ERROR=0,Fi.TIMEOUT=8,Fi.HTTP_ERROR=6,Xh=Fi,Sl.COMPLETE="complete",Fb=Sl,Mi.EventType=tr,tr.OPEN="a",tr.CLOSE="b",tr.ERROR="c",tr.MESSAGE="d",_t.prototype.listen=_t.prototype.K,vc=Mi,et.prototype.listenOnce=et.prototype.L,et.prototype.getLastError=et.prototype.Ka,et.prototype.getLastErrorCode=et.prototype.Ba,et.prototype.getStatus=et.prototype.Z,et.prototype.getResponseJson=et.prototype.Oa,et.prototype.getResponseText=et.prototype.oa,et.prototype.send=et.prototype.ea,et.prototype.setWithCredentials=et.prototype.Ha,Ob=et}).apply(typeof Dh<"u"?Dh:typeof self<"u"?self:typeof window<"u"?window:{});const y0="@firebase/firestore";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $t{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}$t.UNAUTHENTICATED=new $t(null),$t.GOOGLE_CREDENTIALS=new $t("google-credentials-uid"),$t.FIRST_PARTY=new $t("first-party-uid"),$t.MOCK_USER=new $t("mock-user");/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let gl="10.14.0";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bs=new kb("@firebase/firestore");function ua(){return bs.logLevel}function $L(t){bs.setLogLevel(t)}function ee(t,...e){if(bs.logLevel<=ze.DEBUG){const n=e.map(__);bs.debug(`Firestore (${gl}): ${t}`,...n)}}function Tt(t,...e){if(bs.logLevel<=ze.ERROR){const n=e.map(__);bs.error(`Firestore (${gl}): ${t}`,...n)}}function Jn(t,...e){if(bs.logLevel<=ze.WARN){const n=e.map(__);bs.warn(`Firestore (${gl}): ${t}`,...n)}}function __(t){if(typeof t=="string")return t;try{/**
* @license
* Copyright 2020 Google LLC
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
*   http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*/return function(n){return JSON.stringify(n)}(t)}catch{return t}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function de(t="Unexpected state"){const e=`FIRESTORE (${gl}) INTERNAL ASSERTION FAILED: `+t;throw Tt(e),new Error(e)}function ge(t,e){t||de()}function qL(t,e){t||de()}function oe(t,e){return t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class te extends pl{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gt{constructor(){this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $b{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Sk{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable(()=>n($t.UNAUTHENTICATED))}shutdown(){}}class Ck{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable(()=>n(this.token.user))}shutdown(){this.changeListener=null}}class Pk{constructor(e){this.t=e,this.currentUser=$t.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){ge(this.o===void 0);let r=this.i;const i=h=>this.i!==r?(r=this.i,n(h)):Promise.resolve();let s=new Gt;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Gt,e.enqueueRetryable(()=>i(this.currentUser))};const a=()=>{const h=s;e.enqueueRetryable(async()=>{await h.promise,await i(this.currentUser)})},u=h=>{ee("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit(h=>u(h)),setTimeout(()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(ee("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Gt)}},0),a()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(r=>this.i!==e?(ee("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(ge(typeof r.accessToken=="string"),new $b(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ge(e===null||typeof e=="string"),new $t(e)}}class Nk{constructor(e,n,r){this.l=e,this.h=n,this.P=r,this.type="FirstParty",this.user=$t.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class Ak{constructor(e,n,r){this.l=e,this.h=n,this.P=r}getToken(){return Promise.resolve(new Nk(this.l,this.h,this.P))}start(e,n){e.enqueueRetryable(()=>n($t.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class qb{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class kk{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,n){ge(this.o===void 0);const r=s=>{s.error!=null&&ee("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const a=s.token!==this.R;return this.R=s.token,ee("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?n(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{ee("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.o&&this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.A.getImmediate({optional:!0});s?i(s):ee("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(n=>n?(ge(typeof n.token=="string"),this.R=n.token,new qb(n.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class GL{getToken(){return Promise.resolve(new qb(""))}invalidateToken(){}start(e,n){}shutdown(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rk(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gb{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=Rk(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<n&&(r+=e.charAt(i[s]%e.length))}return r}}function be(t,e){return t<e?-1:t>e?1:0}function Wa(t,e,n){return t.length===e.length&&t.every((r,i)=>n(r,e[i]))}function Wb(t){return t+"\0"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ct{constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new te(H.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new te(H.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<-62135596800)throw new te(H.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new te(H.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ct.fromMillis(Date.now())}static fromDate(e){return ct.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*n));return new ct(n,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?be(this.nanoseconds,e.nanoseconds):be(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _e{constructor(e){this.timestamp=e}static fromTimestamp(e){return new _e(e)}static min(){return new _e(new ct(0,0))}static max(){return new _e(new ct(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lu{constructor(e,n,r){n===void 0?n=0:n>e.length&&de(),r===void 0?r=e.length-n:r>e.length-n&&de(),this.segments=e,this.offset=n,this.len=r}get length(){return this.len}isEqual(e){return lu.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof lu?e.forEach(r=>{n.push(r)}):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,r=this.limit();n<r;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const r=Math.min(e.length,n.length);for(let i=0;i<r;i++){const s=e.get(i),a=n.get(i);if(s<a)return-1;if(s>a)return 1}return e.length<n.length?-1:e.length>n.length?1:0}}class De extends lu{construct(e,n,r){return new De(e,n,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const r of e){if(r.indexOf("//")>=0)throw new te(H.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);n.push(...r.split("/").filter(i=>i.length>0))}return new De(n)}static emptyPath(){return new De([])}}const jk=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class at extends lu{construct(e,n,r){return new at(e,n,r)}static isValidIdentifier(e){return jk.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),at.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new at(["__name__"])}static fromServerFormat(e){const n=[];let r="",i=0;const s=()=>{if(r.length===0)throw new te(H.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(r),r=""};let a=!1;for(;i<e.length;){const u=e[i];if(u==="\\"){if(i+1===e.length)throw new te(H.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const h=e[i+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new te(H.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=h,i+=2}else u==="`"?(a=!a,i++):u!=="."||a?(r+=u,i++):(s(),i++)}if(s(),a)throw new te(H.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new at(n)}static emptyPath(){return new at([])}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class le{constructor(e){this.path=e}static fromPath(e){return new le(De.fromString(e))}static fromName(e){return new le(De.fromString(e).popFirst(5))}static empty(){return new le(De.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&De.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return De.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new le(new De(e.slice()))}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ha{constructor(e,n,r,i){this.indexId=e,this.collectionGroup=n,this.fields=r,this.indexState=i}}function Hp(t){return t.fields.find(e=>e.kind===2)}function ro(t){return t.fields.filter(e=>e.kind!==2)}function Dk(t,e){let n=be(t.collectionGroup,e.collectionGroup);if(n!==0)return n;for(let r=0;r<Math.min(t.fields.length,e.fields.length);++r)if(n=Lk(t.fields[r],e.fields[r]),n!==0)return n;return be(t.fields.length,e.fields.length)}Ha.UNKNOWN_ID=-1;class go{constructor(e,n){this.fieldPath=e,this.kind=n}}function Lk(t,e){const n=at.comparator(t.fieldPath,e.fieldPath);return n!==0?n:be(t.kind,e.kind)}class Ka{constructor(e,n){this.sequenceNumber=e,this.offset=n}static empty(){return new Ka(0,Dn.min())}}function Hb(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=_e.fromTimestamp(r===1e9?new ct(n+1,0):new ct(n,r));return new Dn(i,le.empty(),e)}function Kb(t){return new Dn(t.readTime,t.key,-1)}class Dn{constructor(e,n,r){this.readTime=e,this.documentKey=n,this.largestBatchId=r}static min(){return new Dn(_e.min(),le.empty(),-1)}static max(){return new Dn(_e.max(),le.empty(),-1)}}function v_(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=le.comparator(t.documentKey,e.documentKey),n!==0?n:be(t.largestBatchId,e.largestBatchId))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qb="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Zb{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ls(t){if(t.code!==H.FAILED_PRECONDITION||t.message!==Qb)throw t;ee("LocalStore","Unexpectedly lost primary lease")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)},n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)})}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&de(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new q((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(n,s).next(r,i)}})}toPromise(){return new Promise((e,n)=>{this.next(e,n)})}wrapUserFunction(e){try{const n=e();return n instanceof q?n:q.resolve(n)}catch(n){return q.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction(()=>e(n)):q.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction(()=>e(n)):q.reject(n)}static resolve(e){return new q((n,r)=>{n(e)})}static reject(e){return new q((n,r)=>{r(e)})}static waitFor(e){return new q((n,r)=>{let i=0,s=0,a=!1;e.forEach(u=>{++i,u.next(()=>{++s,a&&s===i&&n()},h=>r(h))}),a=!0,s===i&&n()})}static or(e){let n=q.resolve(!1);for(const r of e)n=n.next(i=>i?q.resolve(i):r());return n}static forEach(e,n){const r=[];return e.forEach((i,s)=>{r.push(n.call(this,i,s))}),this.waitFor(r)}static mapArray(e,n){return new q((r,i)=>{const s=e.length,a=new Array(s);let u=0;for(let h=0;h<s;h++){const m=h;n(e[m]).next(p=>{a[m]=p,++u,u===s&&r(a)},p=>i(p))}})}static doWhile(e,n){return new q((r,i)=>{const s=()=>{e()===!0?n().next(()=>{s()},i):r()};s()})}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tf{constructor(e,n){this.action=e,this.transaction=n,this.aborted=!1,this.V=new Gt,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{n.error?this.V.reject(new jc(e,n.error)):this.V.resolve()},this.transaction.onerror=r=>{const i=y_(r.target.error);this.V.reject(new jc(e,i))}}static open(e,n,r,i){try{return new Tf(n,e.transaction(i,r))}catch(s){throw new jc(n,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(ee("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){const n=this.transaction.objectStore(e);return new Vk(n)}}class Mr{constructor(e,n,r){this.name=e,this.version=n,this.p=r,Mr.S(Ga())===12.2&&Tt("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return ee("SimpleDb","Removing database:",e),io(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!Cb())return!1;if(Mr.v())return!0;const e=Ga(),n=Mr.S(e),r=0<n&&n<10,i=Jb(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static v(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.C)==="YES"}static F(e,n){return e.store(n)}static S(e){const n=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=n?n[1].split("_").slice(0,2).join("."):"-1";return Number(r)}async M(e){return this.db||(ee("SimpleDb","Opening database:",this.name),this.db=await new Promise((n,r)=>{const i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{const a=s.target.result;n(a)},i.onblocked=()=>{r(new jc(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{const a=s.target.error;a.name==="VersionError"?r(new te(H.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):a.name==="InvalidStateError"?r(new te(H.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+a)):r(new jc(e,a))},i.onupgradeneeded=s=>{ee("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);const a=s.target.result;this.p.O(a,i.transaction,s.oldVersion,this.version).next(()=>{ee("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.N&&(this.db.onversionchange=n=>this.N(n)),this.db}L(e){this.N=e,this.db&&(this.db.onversionchange=n=>e(n))}async runTransaction(e,n,r,i){const s=n==="readonly";let a=0;for(;;){++a;try{this.db=await this.M(e);const u=Tf.open(this.db,e,s?"readonly":"readwrite",r),h=i(u).next(m=>(u.g(),m)).catch(m=>(u.abort(m),q.reject(m))).toPromise();return h.catch(()=>{}),await u.m,h}catch(u){const h=u,m=h.name!=="FirebaseError"&&a<3;if(ee("SimpleDb","Transaction failed with error:",h.message,"Retrying:",m),this.close(),!m)return Promise.reject(h)}}}close(){this.db&&this.db.close(),this.db=void 0}}function Jb(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}class Mk{constructor(e){this.B=e,this.k=!1,this.q=null}get isDone(){return this.k}get K(){return this.q}set cursor(e){this.B=e}done(){this.k=!0}$(e){this.q=e}delete(){return io(this.B.delete())}}class jc extends te{constructor(e,n){super(H.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${n}`),this.name="IndexedDbTransactionError"}}function Ms(t){return t.name==="IndexedDbTransactionError"}class Vk{constructor(e){this.store=e}put(e,n){let r;return n!==void 0?(ee("SimpleDb","PUT",this.store.name,e,n),r=this.store.put(n,e)):(ee("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),io(r)}add(e){return ee("SimpleDb","ADD",this.store.name,e,e),io(this.store.add(e))}get(e){return io(this.store.get(e)).next(n=>(n===void 0&&(n=null),ee("SimpleDb","GET",this.store.name,e,n),n))}delete(e){return ee("SimpleDb","DELETE",this.store.name,e),io(this.store.delete(e))}count(){return ee("SimpleDb","COUNT",this.store.name),io(this.store.count())}U(e,n){const r=this.options(e,n),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){const s=i.getAll(r.range);return new q((a,u)=>{s.onerror=h=>{u(h.target.error)},s.onsuccess=h=>{a(h.target.result)}})}{const s=this.cursor(r),a=[];return this.W(s,(u,h)=>{a.push(h)}).next(()=>a)}}G(e,n){const r=this.store.getAll(e,n===null?void 0:n);return new q((i,s)=>{r.onerror=a=>{s(a.target.error)},r.onsuccess=a=>{i(a.target.result)}})}j(e,n){ee("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,n);r.H=!1;const i=this.cursor(r);return this.W(i,(s,a,u)=>u.delete())}J(e,n){let r;n?r=e:(r={},n=e);const i=this.cursor(r);return this.W(i,n)}Y(e){const n=this.cursor({});return new q((r,i)=>{n.onerror=s=>{const a=y_(s.target.error);i(a)},n.onsuccess=s=>{const a=s.target.result;a?e(a.primaryKey,a.value).next(u=>{u?a.continue():r()}):r()}})}W(e,n){const r=[];return new q((i,s)=>{e.onerror=a=>{s(a.target.error)},e.onsuccess=a=>{const u=a.target.result;if(!u)return void i();const h=new Mk(u),m=n(u.primaryKey,u.value,h);if(m instanceof q){const p=m.catch(_=>(h.done(),q.reject(_)));r.push(p)}h.isDone?i():h.K===null?u.continue():u.continue(h.K)}}).next(()=>q.waitFor(r))}options(e,n){let r;return e!==void 0&&(typeof e=="string"?r=e:n=e),{index:r,range:n}}cursor(e){let n="next";if(e.reverse&&(n="prev"),e.index){const r=this.store.index(e.index);return e.H?r.openKeyCursor(e.range,n):r.openCursor(e.range,n)}return this.store.openCursor(e.range,n)}}function io(t){return new q((e,n)=>{t.onsuccess=r=>{const i=r.target.result;e(i)},t.onerror=r=>{const i=y_(r.target.error);n(i)}})}let x0=!1;function y_(t){const e=Mr.S(Ga());if(e>=12.2&&e<13){const n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){const r=new te("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${n}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return x0||(x0=!0,setTimeout(()=>{throw r},0)),r}}return t}class Ok{constructor(e,n){this.asyncQueue=e,this.Z=n,this.task=null}start(){this.X(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}X(e){ee("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,async()=>{this.task=null;try{ee("IndexBackfiller",`Documents written: ${await this.Z.ee()}`)}catch(n){Ms(n)?ee("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",n):await Ls(n)}await this.X(6e4)})}}class Fk{constructor(e,n){this.localStore=e,this.persistence=n}async ee(e=50){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",n=>this.te(n,e))}te(e,n){const r=new Set;let i=n,s=!0;return q.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(a=>{if(a!==null&&!r.has(a))return ee("IndexBackfiller",`Processing collection: ${a}`),this.ne(e,a,i).next(u=>{i-=u,r.add(a)});s=!1})).next(()=>n-i)}ne(e,n,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,n).next(i=>this.localStore.localDocuments.getNextDocuments(e,n,i,r).next(s=>{const a=s.changes;return this.localStore.indexManager.updateIndexEntries(e,a).next(()=>this.re(i,s)).next(u=>(ee("IndexBackfiller",`Updating offset: ${u}`),this.localStore.indexManager.updateCollectionGroup(e,n,u))).next(()=>a.size)}))}re(e,n){let r=e;return n.changes.forEach((i,s)=>{const a=Kb(s);v_(a,r)>0&&(r=a)}),new Dn(r.readTime,r.documentKey,Math.max(n.batchId,e.largestBatchId))}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wn{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=r=>this.ie(r),this.se=r=>n.writeSequenceNumber(r))}ie(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.se&&this.se(e),e}}wn.oe=-1;function Su(t){return t==null}function cu(t){return t===0&&1/t==-1/0}function Yb(t){return typeof t=="number"&&Number.isInteger(t)&&!cu(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cn(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=w0(e)),e=zk(t.get(n),e);return w0(e)}function zk(t,e){let n=e;const r=t.length;for(let i=0;i<r;i++){const s=t.charAt(i);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function w0(t){return t+""}function Rr(t){const e=t.length;if(ge(e>=2),e===2)return ge(t.charAt(0)===""&&t.charAt(1)===""),De.emptyPath();const n=e-2,r=[];let i="";for(let s=0;s<e;){const a=t.indexOf("",s);switch((a<0||a>n)&&de(),t.charAt(a+1)){case"":const u=t.substring(s,a);let h;i.length===0?h=u:(i+=u,h=i,i=""),r.push(h);break;case"":i+=t.substring(s,a),i+="\0";break;case"":i+=t.substring(s,a+1);break;default:de()}s=a+2}return new De(r)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const b0=["userId","batchId"];/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ed(t,e){return[t,cn(e)]}function Xb(t,e,n){return[t,cn(e),n]}const Bk={},Uk=["prefixPath","collectionGroup","readTime","documentId"],$k=["prefixPath","collectionGroup","documentId"],qk=["collectionGroup","readTime","prefixPath","documentId"],Gk=["canonicalId","targetId"],Wk=["targetId","path"],Hk=["path","targetId"],Kk=["collectionId","parent"],Qk=["indexId","uid"],Zk=["uid","sequenceNumber"],Jk=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Yk=["indexId","uid","orderedDocumentKey"],Xk=["userId","collectionPath","documentId"],eR=["userId","collectionPath","largestBatchId"],tR=["userId","collectionGroup","largestBatchId"],eE=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],nR=[...eE,"documentOverlays"],tE=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],nE=tE,x_=[...nE,"indexConfiguration","indexState","indexEntries"],rR=x_,iR=[...x_,"globals"];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Kp extends Zb{constructor(e,n){super(),this._e=e,this.currentSequenceNumber=n}}function Ot(t,e){const n=oe(t);return Mr.F(n._e,e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function E0(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Vs(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function rE(t,e){const n=[];for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.push(e(t[r],r,t));return n}function iE(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xe{constructor(e,n){this.comparator=e,this.root=n||Qt.EMPTY}insert(e,n){return new Xe(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Qt.BLACK,null,null))}remove(e){return new Xe(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Qt.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const r=this.comparator(e,n.key);if(r===0)return n.value;r<0?n=n.left:r>0&&(n=n.right)}return null}indexOf(e){let n=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(i===0)return n+r.left.size;i<0?r=r.left:(n+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((n,r)=>(e(n,r),!1))}toString(){const e=[];return this.inorderTraversal((n,r)=>(e.push(`${n}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new Lh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new Lh(this.root,e,this.comparator,!1)}getReverseIterator(){return new Lh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new Lh(this.root,e,this.comparator,!0)}}class Lh{constructor(e,n,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=n?r(e.key,n):1,n&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Qt{constructor(e,n,r,i,s){this.key=e,this.value=n,this.color=r??Qt.RED,this.left=i??Qt.EMPTY,this.right=s??Qt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,r,i,s){return new Qt(e??this.key,n??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,n,r),null):s===0?i.copy(null,n,null,null,null):i.copy(null,null,null,null,i.right.insert(e,n,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Qt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),n(e,i.key)===0){if(i.right.isEmpty())return Qt.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Qt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Qt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw de();const e=this.left.check();if(e!==this.right.check())throw de();return e+(this.isRed()?0:1)}}Qt.EMPTY=null,Qt.RED=!0,Qt.BLACK=!1;Qt.EMPTY=new class{constructor(){this.size=0}get key(){throw de()}get value(){throw de()}get color(){throw de()}get left(){throw de()}get right(){throw de()}copy(e,n,r,i,s){return this}insert(e,n,r){return new Qt(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qe{constructor(e){this.comparator=e,this.data=new Xe(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((n,r)=>(e(n),!1))}forEachInRange(e,n){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;n(i.key)}}forEachWhile(e,n){let r;for(r=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new T0(this.data.getIterator())}getIteratorFrom(e){return new T0(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach(r=>{n=n.add(r)}),n}isEqual(e){if(!(e instanceof Qe)||this.size!==e.size)return!1;const n=this.data.getIterator(),r=e.data.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){const e=[];return this.forEach(n=>{e.push(n)}),e}toString(){const e=[];return this.forEach(n=>e.push(n)),"SortedSet("+e.toString()+")"}copy(e){const n=new Qe(this.comparator);return n.data=e,n}}class T0{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function sa(t){return t.hasNext()?t.getNext():void 0}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bn{constructor(e){this.fields=e,e.sort(at.comparator)}static empty(){return new bn([])}unionWith(e){let n=new Qe(at.comparator);for(const r of this.fields)n=n.add(r);for(const r of e)n=n.add(r);return new bn(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return Wa(this.fields,e.fields,(n,r)=>n.isEqual(r))}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sE extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function HL(){return typeof atob<"u"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yt{constructor(e){this.binaryString=e}static fromBase64String(e){const n=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new sE("Invalid base64 string: "+s):s}}(e);return new yt(n)}static fromUint8Array(e){const n=function(i){let s="";for(let a=0;a<i.length;++a)s+=String.fromCharCode(i[a]);return s}(e);return new yt(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(n){return btoa(n)}(this.binaryString)}toUint8Array(){return function(n){const r=new Uint8Array(n.length);for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return be(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}yt.EMPTY_BYTE_STRING=new yt("");const sR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function gi(t){if(ge(!!t),typeof t=="string"){let e=0;const n=sR.exec(t);if(ge(!!n),n[1]){let i=n[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:st(t.seconds),nanos:st(t.nanos)}}function st(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function _i(t){return typeof t=="string"?yt.fromBase64String(t):yt.fromUint8Array(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function If(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="server_timestamp"}function Sf(t){const e=t.mapValue.fields.__previous_value__;return If(e)?Sf(e):e}function uu(t){const e=gi(t.mapValue.fields.__local_write_time__.timestampValue);return new ct(e.seconds,e.nanos)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oR{constructor(e,n,r,i,s,a,u,h,m){this.databaseId=e,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=m}}class To{constructor(e,n){this.projectId=e,this.database=n||"(default)"}static empty(){return new To("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof To&&e.projectId===this.projectId&&e.database===this.database}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ls={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},td={nullValue:"NULL_VALUE"};function Es(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?If(t)?4:oE(t)?9007199254740991:Cf(t)?10:11:de()}function Fr(t,e){if(t===e)return!0;const n=Es(t);if(n!==Es(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return uu(t).isEqual(uu(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;const a=gi(i.timestampValue),u=gi(s.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(i,s){return _i(i.bytesValue).isEqual(_i(s.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(i,s){return st(i.geoPointValue.latitude)===st(s.geoPointValue.latitude)&&st(i.geoPointValue.longitude)===st(s.geoPointValue.longitude)}(t,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return st(i.integerValue)===st(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){const a=st(i.doubleValue),u=st(s.doubleValue);return a===u?cu(a)===cu(u):isNaN(a)&&isNaN(u)}return!1}(t,e);case 9:return Wa(t.arrayValue.values||[],e.arrayValue.values||[],Fr);case 10:case 11:return function(i,s){const a=i.mapValue.fields||{},u=s.mapValue.fields||{};if(E0(a)!==E0(u))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!Fr(a[h],u[h])))return!1;return!0}(t,e);default:return de()}}function hu(t,e){return(t.values||[]).find(n=>Fr(n,e))!==void 0}function Ts(t,e){if(t===e)return 0;const n=Es(t),r=Es(e);if(n!==r)return be(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return be(t.booleanValue,e.booleanValue);case 2:return function(s,a){const u=st(s.integerValue||s.doubleValue),h=st(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1}(t,e);case 3:return I0(t.timestampValue,e.timestampValue);case 4:return I0(uu(t),uu(e));case 5:return be(t.stringValue,e.stringValue);case 6:return function(s,a){const u=_i(s),h=_i(a);return u.compareTo(h)}(t.bytesValue,e.bytesValue);case 7:return function(s,a){const u=s.split("/"),h=a.split("/");for(let m=0;m<u.length&&m<h.length;m++){const p=be(u[m],h[m]);if(p!==0)return p}return be(u.length,h.length)}(t.referenceValue,e.referenceValue);case 8:return function(s,a){const u=be(st(s.latitude),st(a.latitude));return u!==0?u:be(st(s.longitude),st(a.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return S0(t.arrayValue,e.arrayValue);case 10:return function(s,a){var u,h,m,p;const _=s.fields||{},v=a.fields||{},x=(u=_.value)===null||u===void 0?void 0:u.arrayValue,T=(h=v.value)===null||h===void 0?void 0:h.arrayValue,E=be(((m=x==null?void 0:x.values)===null||m===void 0?void 0:m.length)||0,((p=T==null?void 0:T.values)===null||p===void 0?void 0:p.length)||0);return E!==0?E:S0(x,T)}(t.mapValue,e.mapValue);case 11:return function(s,a){if(s===ls.mapValue&&a===ls.mapValue)return 0;if(s===ls.mapValue)return 1;if(a===ls.mapValue)return-1;const u=s.fields||{},h=Object.keys(u),m=a.fields||{},p=Object.keys(m);h.sort(),p.sort();for(let _=0;_<h.length&&_<p.length;++_){const v=be(h[_],p[_]);if(v!==0)return v;const x=Ts(u[h[_]],m[p[_]]);if(x!==0)return x}return be(h.length,p.length)}(t.mapValue,e.mapValue);default:throw de()}}function I0(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return be(t,e);const n=gi(t),r=gi(e),i=be(n.seconds,r.seconds);return i!==0?i:be(n.nanos,r.nanos)}function S0(t,e){const n=t.values||[],r=e.values||[];for(let i=0;i<n.length&&i<r.length;++i){const s=Ts(n[i],r[i]);if(s)return s}return be(n.length,r.length)}function Qa(t){return Qp(t)}function Qp(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(n){const r=gi(n);return`time(${r.seconds},${r.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(n){return _i(n).toBase64()}(t.bytesValue):"referenceValue"in t?function(n){return le.fromName(n).toString()}(t.referenceValue):"geoPointValue"in t?function(n){return`geo(${n.latitude},${n.longitude})`}(t.geoPointValue):"arrayValue"in t?function(n){let r="[",i=!0;for(const s of n.values||[])i?i=!1:r+=",",r+=Qp(s);return r+"]"}(t.arrayValue):"mapValue"in t?function(n){const r=Object.keys(n.fields||{}).sort();let i="{",s=!0;for(const a of r)s?s=!1:i+=",",i+=`${a}:${Qp(n.fields[a])}`;return i+"}"}(t.mapValue):de()}function nd(t){switch(Es(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Sf(t);return e?16+nd(e):16;case 5:return 2*t.stringValue.length;case 6:return _i(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(r){return(r.values||[]).reduce((i,s)=>i+nd(s),0)}(t.arrayValue);case 10:case 11:return function(r){let i=0;return Vs(r.fields,(s,a)=>{i+=s.length+nd(a)}),i}(t.mapValue);default:throw de()}}function Io(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Zp(t){return!!t&&"integerValue"in t}function du(t){return!!t&&"arrayValue"in t}function C0(t){return!!t&&"nullValue"in t}function P0(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function rd(t){return!!t&&"mapValue"in t}function Cf(t){var e,n;return((n=(((e=t==null?void 0:t.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||n===void 0?void 0:n.stringValue)==="__vector__"}function Dc(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Vs(t.mapValue.fields,(n,r)=>e.mapValue.fields[n]=Dc(r)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Dc(t.arrayValue.values[n]);return e}return Object.assign({},t)}function oE(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}const aE={mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{}}}}};function aR(t){return"nullValue"in t?td:"booleanValue"in t?{booleanValue:!1}:"integerValue"in t||"doubleValue"in t?{doubleValue:NaN}:"timestampValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in t?{stringValue:""}:"bytesValue"in t?{bytesValue:""}:"referenceValue"in t?Io(To.empty(),le.empty()):"geoPointValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in t?{arrayValue:{}}:"mapValue"in t?Cf(t)?aE:{mapValue:{}}:de()}function lR(t){return"nullValue"in t?{booleanValue:!1}:"booleanValue"in t?{doubleValue:NaN}:"integerValue"in t||"doubleValue"in t?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in t?{stringValue:""}:"stringValue"in t?{bytesValue:""}:"bytesValue"in t?Io(To.empty(),le.empty()):"referenceValue"in t?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in t?{arrayValue:{}}:"arrayValue"in t?aE:"mapValue"in t?Cf(t)?{mapValue:{}}:ls:de()}function N0(t,e){const n=Ts(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?-1:!t.inclusive&&e.inclusive?1:0}function A0(t,e){const n=Ts(t.value,e.value);return n!==0?n:t.inclusive&&!e.inclusive?1:!t.inclusive&&e.inclusive?-1:0}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zt{constructor(e){this.value=e}static empty(){return new Zt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let r=0;r<e.length-1;++r)if(n=(n.mapValue.fields||{})[e.get(r)],!rd(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Dc(n)}setAll(e){let n=at.emptyPath(),r={},i=[];e.forEach((a,u)=>{if(!n.isImmediateParentOf(u)){const h=this.getFieldsMap(n);this.applyChanges(h,r,i),r={},i=[],n=u.popLast()}a?r[u.lastSegment()]=Dc(a):i.push(u.lastSegment())});const s=this.getFieldsMap(n);this.applyChanges(s,r,i)}delete(e){const n=this.field(e.popLast());rd(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Fr(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=n.mapValue.fields[e.get(r)];rd(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},n.mapValue.fields[e.get(r)]=i),n=i}return n.mapValue.fields}applyChanges(e,n,r){Vs(n,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new Zt(Dc(this.value))}}function lE(t){const e=[];return Vs(t.fields,(n,r)=>{const i=new at([n]);if(rd(r)){const s=lE(r.mapValue).fields;if(s.length===0)e.push(i);else for(const a of s)e.push(i.child(a))}else e.push(i)}),new bn(e)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nt{constructor(e,n,r,i,s,a,u){this.key=e,this.documentType=n,this.version=r,this.readTime=i,this.createTime=s,this.data=a,this.documentState=u}static newInvalidDocument(e){return new nt(e,0,_e.min(),_e.min(),_e.min(),Zt.empty(),0)}static newFoundDocument(e,n,r,i){return new nt(e,1,n,_e.min(),r,i,0)}static newNoDocument(e,n){return new nt(e,2,n,_e.min(),_e.min(),Zt.empty(),0)}static newUnknownDocument(e,n){return new nt(e,3,n,_e.min(),_e.min(),Zt.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(_e.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Zt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Zt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=_e.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof nt&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new nt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Is{constructor(e,n){this.position=e,this.inclusive=n}}function k0(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],a=t.position[i];if(s.field.isKeyField()?r=le.comparator(le.fromName(a.referenceValue),n.key):r=Ts(a,n.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function R0(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Fr(t.position[n],e.position[n]))return!1;return!0}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fu{constructor(e,n="asc"){this.field=e,this.dir=n}}function cR(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cE{}class Me extends cE{constructor(e,n,r){super(),this.field=e,this.op=n,this.value=r}static create(e,n,r){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,r):new uR(e,n,r):n==="array-contains"?new fR(e,r):n==="in"?new pE(e,r):n==="not-in"?new mR(e,r):n==="array-contains-any"?new pR(e,r):new Me(e,n,r)}static createKeyFieldInFilter(e,n,r){return n==="in"?new hR(e,r):new dR(e,r)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&this.matchesComparison(Ts(n,this.value)):n!==null&&Es(this.value)===Es(n)&&this.matchesComparison(Ts(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return de()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class We extends cE{constructor(e,n){super(),this.filters=e,this.op=n,this.ae=null}static create(e,n){return new We(e,n)}matches(e){return Za(this)?this.filters.find(n=>!n.matches(e))===void 0:this.filters.find(n=>n.matches(e))!==void 0}getFlattenedFilters(){return this.ae!==null||(this.ae=this.filters.reduce((e,n)=>e.concat(n.getFlattenedFilters()),[])),this.ae}getFilters(){return Object.assign([],this.filters)}}function Za(t){return t.op==="and"}function Jp(t){return t.op==="or"}function w_(t){return uE(t)&&Za(t)}function uE(t){for(const e of t.filters)if(e instanceof We)return!1;return!0}function Yp(t){if(t instanceof Me)return t.field.canonicalString()+t.op.toString()+Qa(t.value);if(w_(t))return t.filters.map(e=>Yp(e)).join(",");{const e=t.filters.map(n=>Yp(n)).join(",");return`${t.op}(${e})`}}function hE(t,e){return t instanceof Me?function(r,i){return i instanceof Me&&r.op===i.op&&r.field.isEqual(i.field)&&Fr(r.value,i.value)}(t,e):t instanceof We?function(r,i){return i instanceof We&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,a,u)=>s&&hE(a,i.filters[u]),!0):!1}(t,e):void de()}function dE(t,e){const n=t.filters.concat(e);return We.create(n,t.op)}function fE(t){return t instanceof Me?function(n){return`${n.field.canonicalString()} ${n.op} ${Qa(n.value)}`}(t):t instanceof We?function(n){return n.op.toString()+" {"+n.getFilters().map(fE).join(" ,")+"}"}(t):"Filter"}class uR extends Me{constructor(e,n,r){super(e,n,r),this.key=le.fromName(r.referenceValue)}matches(e){const n=le.comparator(e.key,this.key);return this.matchesComparison(n)}}class hR extends Me{constructor(e,n){super(e,"in",n),this.keys=mE("in",n)}matches(e){return this.keys.some(n=>n.isEqual(e.key))}}class dR extends Me{constructor(e,n){super(e,"not-in",n),this.keys=mE("not-in",n)}matches(e){return!this.keys.some(n=>n.isEqual(e.key))}}function mE(t,e){var n;return(((n=e.arrayValue)===null||n===void 0?void 0:n.values)||[]).map(r=>le.fromName(r.referenceValue))}class fR extends Me{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return du(n)&&hu(n.arrayValue,this.value)}}class pE extends Me{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&hu(this.value.arrayValue,n)}}class mR extends Me{constructor(e,n){super(e,"not-in",n)}matches(e){if(hu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&!hu(this.value.arrayValue,n)}}class pR extends Me{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!du(n)||!n.arrayValue.values)&&n.arrayValue.values.some(r=>hu(this.value.arrayValue,r))}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gR{constructor(e,n=null,r=[],i=[],s=null,a=null,u=null){this.path=e,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=a,this.endAt=u,this.ue=null}}function Xp(t,e=null,n=[],r=[],i=null,s=null,a=null){return new gR(t,e,n,r,i,s,a)}function So(t){const e=oe(t);if(e.ue===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(r=>Yp(r)).join(","),n+="|ob:",n+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Su(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map(r=>Qa(r)).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map(r=>Qa(r)).join(",")),e.ue=n}return e.ue}function Cu(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!cR(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!hE(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!R0(t.startAt,e.startAt)&&R0(t.endAt,e.endAt)}function Od(t){return le.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}function Fd(t,e){return t.filters.filter(n=>n instanceof Me&&n.field.isEqual(e))}function j0(t,e,n){let r=td,i=!0;for(const s of Fd(t,e)){let a=td,u=!0;switch(s.op){case"<":case"<=":a=aR(s.value);break;case"==":case"in":case">=":a=s.value;break;case">":a=s.value,u=!1;break;case"!=":case"not-in":a=td}N0({value:r,inclusive:i},{value:a,inclusive:u})<0&&(r=a,i=u)}if(n!==null){for(let s=0;s<t.orderBy.length;++s)if(t.orderBy[s].field.isEqual(e)){const a=n.position[s];N0({value:r,inclusive:i},{value:a,inclusive:n.inclusive})<0&&(r=a,i=n.inclusive);break}}return{value:r,inclusive:i}}function D0(t,e,n){let r=ls,i=!0;for(const s of Fd(t,e)){let a=ls,u=!0;switch(s.op){case">=":case">":a=lR(s.value),u=!1;break;case"==":case"in":case"<=":a=s.value;break;case"<":a=s.value,u=!1;break;case"!=":case"not-in":a=ls}A0({value:r,inclusive:i},{value:a,inclusive:u})>0&&(r=a,i=u)}if(n!==null){for(let s=0;s<t.orderBy.length;++s)if(t.orderBy[s].field.isEqual(e)){const a=n.position[s];A0({value:r,inclusive:i},{value:a,inclusive:n.inclusive})>0&&(r=a,i=n.inclusive);break}}return{value:r,inclusive:i}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xi{constructor(e,n=null,r=[],i=[],s=null,a="F",u=null,h=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=a,this.startAt=u,this.endAt=h,this.ce=null,this.le=null,this.he=null,this.startAt,this.endAt}}function gE(t,e,n,r,i,s,a,u){return new xi(t,e,n,r,i,s,a,u)}function _l(t){return new xi(t)}function L0(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function b_(t){return t.collectionGroup!==null}function Da(t){const e=oe(t);if(e.ce===null){e.ce=[];const n=new Set;for(const s of e.explicitOrderBy)e.ce.push(s),n.add(s.field.canonicalString());const r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new Qe(at.comparator);return a.filters.forEach(h=>{h.getFlattenedFilters().forEach(m=>{m.isInequality()&&(u=u.add(m.field))})}),u})(e).forEach(s=>{n.has(s.canonicalString())||s.isKeyField()||e.ce.push(new fu(s,r))}),n.has(at.keyField().canonicalString())||e.ce.push(new fu(at.keyField(),r))}return e.ce}function un(t){const e=oe(t);return e.le||(e.le=vE(e,Da(t))),e.le}function _E(t){const e=oe(t);return e.he||(e.he=vE(e,t.explicitOrderBy)),e.he}function vE(t,e){if(t.limitType==="F")return Xp(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(i=>{const s=i.dir==="desc"?"asc":"desc";return new fu(i.field,s)});const n=t.endAt?new Is(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new Is(t.startAt.position,t.startAt.inclusive):null;return Xp(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}function eg(t,e){const n=t.filters.concat([e]);return new xi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function zd(t,e,n){return new xi(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Pu(t,e){return Cu(un(t),un(e))&&t.limitType===e.limitType}function yE(t){return`${So(un(t))}|lt:${t.limitType}`}function ha(t){return`Query(target=${function(n){let r=n.path.canonicalString();return n.collectionGroup!==null&&(r+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(r+=`, filters: [${n.filters.map(i=>fE(i)).join(", ")}]`),Su(n.limit)||(r+=", limit: "+n.limit),n.orderBy.length>0&&(r+=`, orderBy: [${n.orderBy.map(i=>function(a){return`${a.field.canonicalString()} (${a.dir})`}(i)).join(", ")}]`),n.startAt&&(r+=", startAt: ",r+=n.startAt.inclusive?"b:":"a:",r+=n.startAt.position.map(i=>Qa(i)).join(",")),n.endAt&&(r+=", endAt: ",r+=n.endAt.inclusive?"a:":"b:",r+=n.endAt.position.map(i=>Qa(i)).join(",")),`Target(${r})`}(un(t))}; limitType=${t.limitType})`}function Nu(t,e){return e.isFoundDocument()&&function(r,i){const s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):le.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(t,e)&&function(r,i){for(const s of Da(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(t,e)&&function(r,i){for(const s of r.filters)if(!s.matches(i))return!1;return!0}(t,e)&&function(r,i){return!(r.startAt&&!function(a,u,h){const m=k0(a,u,h);return a.inclusive?m<=0:m<0}(r.startAt,Da(r),i)||r.endAt&&!function(a,u,h){const m=k0(a,u,h);return a.inclusive?m>=0:m>0}(r.endAt,Da(r),i))}(t,e)}function xE(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function wE(t){return(e,n)=>{let r=!1;for(const i of Da(t)){const s=_R(i,e,n);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function _R(t,e,n){const r=t.field.isKeyField()?le.comparator(e.key,n.key):function(s,a,u){const h=a.data.field(s),m=u.data.field(s);return h!==null&&m!==null?Ts(h,m):de()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return de()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wi{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r!==void 0){for(const[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,n){const r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,n]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,n]);i.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),r=this.inner[n];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[n]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Vs(this.inner,(n,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return iE(this.inner)}size(){return this.innerSize}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vR=new Xe(le.comparator);function En(){return vR}const bE=new Xe(le.comparator);function yc(...t){let e=bE;for(const n of t)e=e.insert(n.key,n);return e}function EE(t){let e=bE;return t.forEach((n,r)=>e=e.insert(n,r.overlayedDocument)),e}function jr(){return Lc()}function TE(){return Lc()}function Lc(){return new wi(t=>t.toString(),(t,e)=>t.isEqual(e))}const yR=new Xe(le.comparator),xR=new Qe(le.comparator);function Pe(...t){let e=xR;for(const n of t)e=e.add(n);return e}const wR=new Qe(be);function E_(){return wR}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T_(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:cu(e)?"-0":e}}function IE(t){return{integerValue:""+t}}function SE(t,e){return Yb(e)?IE(e):T_(t,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pf{constructor(){this._=void 0}}function bR(t,e,n){return t instanceof Ja?function(i,s){const a={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&If(s)&&(s=Sf(s)),s&&(a.fields.__previous_value__=s),{mapValue:a}}(n,e):t instanceof Co?PE(t,e):t instanceof Po?NE(t,e):function(i,s){const a=CE(i,s),u=M0(a)+M0(i.Pe);return Zp(a)&&Zp(i.Pe)?IE(u):T_(i.serializer,u)}(t,e)}function ER(t,e,n){return t instanceof Co?PE(t,e):t instanceof Po?NE(t,e):n}function CE(t,e){return t instanceof Ya?function(r){return Zp(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}class Ja extends Pf{}class Co extends Pf{constructor(e){super(),this.elements=e}}function PE(t,e){const n=AE(e);for(const r of t.elements)n.some(i=>Fr(i,r))||n.push(r);return{arrayValue:{values:n}}}class Po extends Pf{constructor(e){super(),this.elements=e}}function NE(t,e){let n=AE(e);for(const r of t.elements)n=n.filter(i=>!Fr(i,r));return{arrayValue:{values:n}}}class Ya extends Pf{constructor(e,n){super(),this.serializer=e,this.Pe=n}}function M0(t){return st(t.integerValue||t.doubleValue)}function AE(t){return du(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Au{constructor(e,n){this.field=e,this.transform=n}}function TR(t,e){return t.field.isEqual(e.field)&&function(r,i){return r instanceof Co&&i instanceof Co||r instanceof Po&&i instanceof Po?Wa(r.elements,i.elements,Fr):r instanceof Ya&&i instanceof Ya?Fr(r.Pe,i.Pe):r instanceof Ja&&i instanceof Ja}(t.transform,e.transform)}class IR{constructor(e,n){this.version=e,this.transformResults=n}}class lt{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new lt}static exists(e){return new lt(void 0,e)}static updateTime(e){return new lt(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function id(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class Nf{}function kE(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new yl(t.key,lt.none()):new vl(t.key,t.data,lt.none());{const n=t.data,r=Zt.empty();let i=new Qe(at.comparator);for(let s of e.fields)if(!i.has(s)){let a=n.field(s);a===null&&s.length>1&&(s=s.popLast(),a=n.field(s)),a===null?r.delete(s):r.set(s,a),i=i.add(s)}return new bi(t.key,r,new bn(i.toArray()),lt.none())}}function SR(t,e,n){t instanceof vl?function(i,s,a){const u=i.value.clone(),h=O0(i.fieldTransforms,s,a.transformResults);u.setAll(h),s.convertToFoundDocument(a.version,u).setHasCommittedMutations()}(t,e,n):t instanceof bi?function(i,s,a){if(!id(i.precondition,s))return void s.convertToUnknownDocument(a.version);const u=O0(i.fieldTransforms,s,a.transformResults),h=s.data;h.setAll(RE(i)),h.setAll(u),s.convertToFoundDocument(a.version,h).setHasCommittedMutations()}(t,e,n):function(i,s,a){s.convertToNoDocument(a.version).setHasCommittedMutations()}(0,e,n)}function Mc(t,e,n,r){return t instanceof vl?function(s,a,u,h){if(!id(s.precondition,a))return u;const m=s.value.clone(),p=F0(s.fieldTransforms,h,a);return m.setAll(p),a.convertToFoundDocument(a.version,m).setHasLocalMutations(),null}(t,e,n,r):t instanceof bi?function(s,a,u,h){if(!id(s.precondition,a))return u;const m=F0(s.fieldTransforms,h,a),p=a.data;return p.setAll(RE(s)),p.setAll(m),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),u===null?null:u.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(_=>_.field))}(t,e,n,r):function(s,a,u){return id(s.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u}(t,e,n)}function CR(t,e){let n=null;for(const r of t.fieldTransforms){const i=e.data.field(r.field),s=CE(r.transform,i||null);s!=null&&(n===null&&(n=Zt.empty()),n.set(r.field,s))}return n||null}function V0(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&Wa(r,i,(s,a)=>TR(s,a))}(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class vl extends Nf{constructor(e,n,r,i=[]){super(),this.key=e,this.value=n,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class bi extends Nf{constructor(e,n,r,i,s=[]){super(),this.key=e,this.data=n,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function RE(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function O0(t,e,n){const r=new Map;ge(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],a=s.transform,u=e.data.field(s.field);r.set(s.field,ER(a,u,n[i]))}return r}function F0(t,e,n){const r=new Map;for(const i of t){const s=i.transform,a=n.data.field(i.field);r.set(i.field,bR(s,a,e))}return r}class yl extends Nf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class I_ extends Nf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class S_{constructor(e,n,r,i){this.batchId=e,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,n){const r=n.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&SR(s,e,r[i])}}applyToLocalView(e,n){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(n=Mc(r,e,n,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(n=Mc(r,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const r=TE();return this.mutations.forEach(i=>{const s=e.get(i.key),a=s.overlayedDocument;let u=this.applyToLocalView(a,s.mutatedFields);u=n.has(i.key)?null:u;const h=kE(a,u);h!==null&&r.set(i.key,h),a.isValidDocument()||a.convertToNoDocument(_e.min())}),r}keys(){return this.mutations.reduce((e,n)=>e.add(n.key),Pe())}isEqual(e){return this.batchId===e.batchId&&Wa(this.mutations,e.mutations,(n,r)=>V0(n,r))&&Wa(this.baseMutations,e.baseMutations,(n,r)=>V0(n,r))}}class C_{constructor(e,n,r,i){this.batch=e,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}static from(e,n,r){ge(e.mutations.length===r.length);let i=function(){return yR}();const s=e.mutations;for(let a=0;a<s.length;a++)i=i.insert(s[a].key,r[a].version);return new C_(e,n,r,i)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class P_{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jE{constructor(e,n,r){this.alias=e,this.aggregateType=n,this.fieldPath=r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class PR{constructor(e,n){this.count=e,this.unchangedNames=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var Rt,Ue;function DE(t){switch(t){default:return de();case H.CANCELLED:case H.UNKNOWN:case H.DEADLINE_EXCEEDED:case H.RESOURCE_EXHAUSTED:case H.INTERNAL:case H.UNAVAILABLE:case H.UNAUTHENTICATED:return!1;case H.INVALID_ARGUMENT:case H.NOT_FOUND:case H.ALREADY_EXISTS:case H.PERMISSION_DENIED:case H.FAILED_PRECONDITION:case H.ABORTED:case H.OUT_OF_RANGE:case H.UNIMPLEMENTED:case H.DATA_LOSS:return!0}}function LE(t){if(t===void 0)return Tt("GRPC error has no .code"),H.UNKNOWN;switch(t){case Rt.OK:return H.OK;case Rt.CANCELLED:return H.CANCELLED;case Rt.UNKNOWN:return H.UNKNOWN;case Rt.DEADLINE_EXCEEDED:return H.DEADLINE_EXCEEDED;case Rt.RESOURCE_EXHAUSTED:return H.RESOURCE_EXHAUSTED;case Rt.INTERNAL:return H.INTERNAL;case Rt.UNAVAILABLE:return H.UNAVAILABLE;case Rt.UNAUTHENTICATED:return H.UNAUTHENTICATED;case Rt.INVALID_ARGUMENT:return H.INVALID_ARGUMENT;case Rt.NOT_FOUND:return H.NOT_FOUND;case Rt.ALREADY_EXISTS:return H.ALREADY_EXISTS;case Rt.PERMISSION_DENIED:return H.PERMISSION_DENIED;case Rt.FAILED_PRECONDITION:return H.FAILED_PRECONDITION;case Rt.ABORTED:return H.ABORTED;case Rt.OUT_OF_RANGE:return H.OUT_OF_RANGE;case Rt.UNIMPLEMENTED:return H.UNIMPLEMENTED;case Rt.DATA_LOSS:return H.DATA_LOSS;default:return de()}}(Ue=Rt||(Rt={}))[Ue.OK=0]="OK",Ue[Ue.CANCELLED=1]="CANCELLED",Ue[Ue.UNKNOWN=2]="UNKNOWN",Ue[Ue.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ue[Ue.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ue[Ue.NOT_FOUND=5]="NOT_FOUND",Ue[Ue.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ue[Ue.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ue[Ue.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ue[Ue.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ue[Ue.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ue[Ue.ABORTED=10]="ABORTED",Ue[Ue.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ue[Ue.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ue[Ue.INTERNAL=13]="INTERNAL",Ue[Ue.UNAVAILABLE=14]="UNAVAILABLE",Ue[Ue.DATA_LOSS=15]="DATA_LOSS";/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Bd=null;/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ME(){return new TextEncoder}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const NR=new po([4294967295,4294967295],0);function z0(t){const e=ME().encode(t),n=new Vb;return n.update(e),new Uint8Array(n.digest())}function B0(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new po([n,r],0),new po([i,s],0)]}class N_{constructor(e,n,r){if(this.bitmap=e,this.padding=n,this.hashCount=r,n<0||n>=8)throw new xc(`Invalid padding: ${n}`);if(r<0)throw new xc(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new xc(`Invalid hash count: ${r}`);if(e.length===0&&n!==0)throw new xc(`Invalid padding when bitmap length is 0: ${n}`);this.Ie=8*e.length-n,this.Te=po.fromNumber(this.Ie)}Ee(e,n,r){let i=e.add(n.multiply(po.fromNumber(r)));return i.compare(NR)===1&&(i=new po([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Te).toNumber()}de(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Ie===0)return!1;const n=z0(e),[r,i]=B0(n);for(let s=0;s<this.hashCount;s++){const a=this.Ee(r,i,s);if(!this.de(a))return!1}return!0}static create(e,n,r){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),a=new N_(s,i,n);return r.forEach(u=>a.insert(u)),a}insert(e){if(this.Ie===0)return;const n=z0(e),[r,i]=B0(n);for(let s=0;s<this.hashCount;s++){const a=this.Ee(r,i,s);this.Ae(a)}}Ae(e){const n=Math.floor(e/8),r=e%8;this.bitmap[n]|=1<<r}}class xc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ku{constructor(e,n,r,i,s){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,n,r){const i=new Map;return i.set(e,Ru.createSynthesizedTargetChangeForCurrentChange(e,n,r)),new ku(_e.min(),i,new Xe(be),En(),Pe())}}class Ru{constructor(e,n,r,i,s){this.resumeToken=e,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,n,r){return new Ru(r,n,Pe(),Pe(),Pe())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sd{constructor(e,n,r,i){this.Re=e,this.removedTargetIds=n,this.key=r,this.Ve=i}}class VE{constructor(e,n){this.targetId=e,this.me=n}}class OE{constructor(e,n,r=yt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=n,this.resumeToken=r,this.cause=i}}class U0{constructor(){this.fe=0,this.ge=q0(),this.pe=yt.EMPTY_BYTE_STRING,this.ye=!1,this.we=!0}get current(){return this.ye}get resumeToken(){return this.pe}get Se(){return this.fe!==0}get be(){return this.we}De(e){e.approximateByteSize()>0&&(this.we=!0,this.pe=e)}ve(){let e=Pe(),n=Pe(),r=Pe();return this.ge.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:n=n.add(i);break;case 1:r=r.add(i);break;default:de()}}),new Ru(this.pe,this.ye,e,n,r)}Ce(){this.we=!1,this.ge=q0()}Fe(e,n){this.we=!0,this.ge=this.ge.insert(e,n)}Me(e){this.we=!0,this.ge=this.ge.remove(e)}xe(){this.fe+=1}Oe(){this.fe-=1,ge(this.fe>=0)}Ne(){this.we=!0,this.ye=!0}}class AR{constructor(e){this.Le=e,this.Be=new Map,this.ke=En(),this.qe=$0(),this.Qe=new Xe(be)}Ke(e){for(const n of e.Re)e.Ve&&e.Ve.isFoundDocument()?this.$e(n,e.Ve):this.Ue(n,e.key,e.Ve);for(const n of e.removedTargetIds)this.Ue(n,e.key,e.Ve)}We(e){this.forEachTarget(e,n=>{const r=this.Ge(n);switch(e.state){case 0:this.ze(n)&&r.De(e.resumeToken);break;case 1:r.Oe(),r.Se||r.Ce(),r.De(e.resumeToken);break;case 2:r.Oe(),r.Se||this.removeTarget(n);break;case 3:this.ze(n)&&(r.Ne(),r.De(e.resumeToken));break;case 4:this.ze(n)&&(this.je(n),r.De(e.resumeToken));break;default:de()}})}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.Be.forEach((r,i)=>{this.ze(i)&&n(i)})}He(e){const n=e.targetId,r=e.me.count,i=this.Je(n);if(i){const s=i.target;if(Od(s))if(r===0){const a=new le(s.path);this.Ue(n,a,nt.newNoDocument(a,_e.min()))}else ge(r===1);else{const a=this.Ye(n);if(a!==r){const u=this.Ze(e),h=u?this.Xe(u,e,a):1;if(h!==0){this.je(n);const m=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Qe=this.Qe.insert(n,m)}Bd==null||Bd.et(function(p,_,v,x,T){var E,R,S,C,A,U;const Z={localCacheCount:p,existenceFilterCount:_.count,databaseId:v.database,projectId:v.projectId},V=_.unchangedNames;return V&&(Z.bloomFilter={applied:T===0,hashCount:(E=V==null?void 0:V.hashCount)!==null&&E!==void 0?E:0,bitmapLength:(C=(S=(R=V==null?void 0:V.bits)===null||R===void 0?void 0:R.bitmap)===null||S===void 0?void 0:S.length)!==null&&C!==void 0?C:0,padding:(U=(A=V==null?void 0:V.bits)===null||A===void 0?void 0:A.padding)!==null&&U!==void 0?U:0,mightContain:k=>{var N;return(N=x==null?void 0:x.mightContain(k))!==null&&N!==void 0&&N}}),Z}(a,e.me,this.Le.tt(),u,h))}}}}Ze(e){const n=e.me.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=n;let a,u;try{a=_i(r).toUint8Array()}catch(h){if(h instanceof sE)return Jn("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new N_(a,i,s)}catch(h){return Jn(h instanceof xc?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.Ie===0?null:u}Xe(e,n,r){return n.me.count===r-this.nt(e,n.targetId)?0:2}nt(e,n){const r=this.Le.getRemoteKeysForTarget(n);let i=0;return r.forEach(s=>{const a=this.Le.tt(),u=`projects/${a.projectId}/databases/${a.database}/documents/${s.path.canonicalString()}`;e.mightContain(u)||(this.Ue(n,s,null),i++)}),i}rt(e){const n=new Map;this.Be.forEach((s,a)=>{const u=this.Je(a);if(u){if(s.current&&Od(u.target)){const h=new le(u.target.path);this.ke.get(h)!==null||this.it(a,h)||this.Ue(a,h,nt.newNoDocument(h,e))}s.be&&(n.set(a,s.ve()),s.Ce())}});let r=Pe();this.qe.forEach((s,a)=>{let u=!0;a.forEachWhile(h=>{const m=this.Je(h);return!m||m.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)}),u&&(r=r.add(s))}),this.ke.forEach((s,a)=>a.setReadTime(e));const i=new ku(e,n,this.Qe,this.ke,r);return this.ke=En(),this.qe=$0(),this.Qe=new Xe(be),i}$e(e,n){if(!this.ze(e))return;const r=this.it(e,n.key)?2:0;this.Ge(e).Fe(n.key,r),this.ke=this.ke.insert(n.key,n),this.qe=this.qe.insert(n.key,this.st(n.key).add(e))}Ue(e,n,r){if(!this.ze(e))return;const i=this.Ge(e);this.it(e,n)?i.Fe(n,1):i.Me(n),this.qe=this.qe.insert(n,this.st(n).delete(e)),r&&(this.ke=this.ke.insert(n,r))}removeTarget(e){this.Be.delete(e)}Ye(e){const n=this.Ge(e).ve();return this.Le.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}xe(e){this.Ge(e).xe()}Ge(e){let n=this.Be.get(e);return n||(n=new U0,this.Be.set(e,n)),n}st(e){let n=this.qe.get(e);return n||(n=new Qe(be),this.qe=this.qe.insert(e,n)),n}ze(e){const n=this.Je(e)!==null;return n||ee("WatchChangeAggregator","Detected inactive target",e),n}Je(e){const n=this.Be.get(e);return n&&n.Se?null:this.Le.ot(e)}je(e){this.Be.set(e,new U0),this.Le.getRemoteKeysForTarget(e).forEach(n=>{this.Ue(e,n,null)})}it(e,n){return this.Le.getRemoteKeysForTarget(e).has(n)}}function $0(){return new Xe(le.comparator)}function q0(){return new Xe(le.comparator)}const kR=(()=>({asc:"ASCENDING",desc:"DESCENDING"}))(),RR=(()=>({"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"}))(),jR=(()=>({and:"AND",or:"OR"}))();class DR{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function tg(t,e){return t.useProto3Json||Su(e)?e:{value:e}}function Xa(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function FE(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function LR(t,e){return Xa(t,e.toTimestamp())}function St(t){return ge(!!t),_e.fromTimestamp(function(n){const r=gi(n);return new ct(r.seconds,r.nanos)}(t))}function A_(t,e){return ng(t,e).canonicalString()}function ng(t,e){const n=function(i){return new De(["projects",i.projectId,"databases",i.database])}(t).child("documents");return e===void 0?n:n.child(e)}function zE(t){const e=De.fromString(t);return ge(ZE(e)),e}function mu(t,e){return A_(t.databaseId,e.path)}function Vr(t,e){const n=zE(e);if(n.get(1)!==t.databaseId.projectId)throw new te(H.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new te(H.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new le($E(n))}function BE(t,e){return A_(t.databaseId,e)}function UE(t){const e=zE(t);return e.length===4?De.emptyPath():$E(e)}function rg(t){return new De(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function $E(t){return ge(t.length>4&&t.get(4)==="documents"),t.popFirst(5)}function G0(t,e,n){return{name:mu(t,e),fields:n.value.mapValue.fields}}function qE(t,e,n){const r=Vr(t,e.name),i=St(e.updateTime),s=e.createTime?St(e.createTime):_e.min(),a=new Zt({mapValue:{fields:e.fields}}),u=nt.newFoundDocument(r,i,s,a);return n&&u.setHasCommittedMutations(),n?u.setHasCommittedMutations():u}function MR(t,e){return"found"in e?function(r,i){ge(!!i.found),i.found.name,i.found.updateTime;const s=Vr(r,i.found.name),a=St(i.found.updateTime),u=i.found.createTime?St(i.found.createTime):_e.min(),h=new Zt({mapValue:{fields:i.found.fields}});return nt.newFoundDocument(s,a,u,h)}(t,e):"missing"in e?function(r,i){ge(!!i.missing),ge(!!i.readTime);const s=Vr(r,i.missing),a=St(i.readTime);return nt.newNoDocument(s,a)}(t,e):de()}function VR(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(m){return m==="NO_CHANGE"?0:m==="ADD"?1:m==="REMOVE"?2:m==="CURRENT"?3:m==="RESET"?4:de()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(m,p){return m.useProto3Json?(ge(p===void 0||typeof p=="string"),yt.fromBase64String(p||"")):(ge(p===void 0||p instanceof Buffer||p instanceof Uint8Array),yt.fromUint8Array(p||new Uint8Array))}(t,e.targetChange.resumeToken),a=e.targetChange.cause,u=a&&function(m){const p=m.code===void 0?H.UNKNOWN:LE(m.code);return new te(p,m.message||"")}(a);n=new OE(r,i,s,u||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Vr(t,r.document.name),s=St(r.document.updateTime),a=r.document.createTime?St(r.document.createTime):_e.min(),u=new Zt({mapValue:{fields:r.document.fields}}),h=nt.newFoundDocument(i,s,a,u),m=r.targetIds||[],p=r.removedTargetIds||[];n=new sd(m,p,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Vr(t,r.document),s=r.readTime?St(r.readTime):_e.min(),a=nt.newNoDocument(i,s),u=r.removedTargetIds||[];n=new sd([],u,a.key,a)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Vr(t,r.document),s=r.removedTargetIds||[];n=new sd([],s,i,null)}else{if(!("filter"in e))return de();{e.filter;const r=e.filter;r.targetId;const{count:i=0,unchangedNames:s}=r,a=new PR(i,s),u=r.targetId;n=new VE(u,a)}}return n}function pu(t,e){let n;if(e instanceof vl)n={update:G0(t,e.key,e.value)};else if(e instanceof yl)n={delete:mu(t,e.key)};else if(e instanceof bi)n={update:G0(t,e.key,e.data),updateMask:$R(e.fieldMask)};else{if(!(e instanceof I_))return de();n={verify:mu(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(r=>function(s,a){const u=a.transform;if(u instanceof Ja)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Co)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Po)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Ya)return{fieldPath:a.field.canonicalString(),increment:u.Pe};throw de()}(0,r))),e.precondition.isNone||(n.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:LR(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:de()}(t,e.precondition)),n}function ig(t,e){const n=e.currentDocument?function(s){return s.updateTime!==void 0?lt.updateTime(St(s.updateTime)):s.exists!==void 0?lt.exists(s.exists):lt.none()}(e.currentDocument):lt.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(a,u){let h=null;if("setToServerValue"in u)ge(u.setToServerValue==="REQUEST_TIME"),h=new Ja;else if("appendMissingElements"in u){const p=u.appendMissingElements.values||[];h=new Co(p)}else if("removeAllFromArray"in u){const p=u.removeAllFromArray.values||[];h=new Po(p)}else"increment"in u?h=new Ya(a,u.increment):de();const m=at.fromServerFormat(u.fieldPath);return new Au(m,h)}(t,i)):[];if(e.update){e.update.name;const i=Vr(t,e.update.name),s=new Zt({mapValue:{fields:e.update.fields}});if(e.updateMask){const a=function(h){const m=h.fieldPaths||[];return new bn(m.map(p=>at.fromServerFormat(p)))}(e.updateMask);return new bi(i,s,a,n,r)}return new vl(i,s,n,r)}if(e.delete){const i=Vr(t,e.delete);return new yl(i,n)}if(e.verify){const i=Vr(t,e.verify);return new I_(i,n)}return de()}function OR(t,e){return t&&t.length>0?(ge(e!==void 0),t.map(n=>function(i,s){let a=i.updateTime?St(i.updateTime):St(s);return a.isEqual(_e.min())&&(a=St(s)),new IR(a,i.transformResults||[])}(n,e))):[]}function GE(t,e){return{documents:[BE(t,e.path)]}}function Af(t,e){const n={structuredQuery:{}},r=e.path;let i;e.collectionGroup!==null?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=BE(t,i);const s=function(m){if(m.length!==0)return QE(We.create(m,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const a=function(m){if(m.length!==0)return m.map(p=>function(v){return{field:ns(v.field),direction:zR(v.dir)}}(p))}(e.orderBy);a&&(n.structuredQuery.orderBy=a);const u=tg(t,e.limit);return u!==null&&(n.structuredQuery.limit=u),e.startAt&&(n.structuredQuery.startAt=function(m){return{before:m.inclusive,values:m.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(m){return{before:!m.inclusive,values:m.position}}(e.endAt)),{_t:n,parent:i}}function WE(t,e,n,r){const{_t:i,parent:s}=Af(t,e),a={},u=[];let h=0;return n.forEach(m=>{const p=r?m.alias:"aggregate_"+h++;a[p]=m.alias,m.aggregateType==="count"?u.push({alias:p,count:{}}):m.aggregateType==="avg"?u.push({alias:p,avg:{field:ns(m.fieldPath)}}):m.aggregateType==="sum"&&u.push({alias:p,sum:{field:ns(m.fieldPath)}})}),{request:{structuredAggregationQuery:{aggregations:u,structuredQuery:i.structuredQuery},parent:i.parent},ut:a,parent:s}}function HE(t){let e=UE(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){ge(r===1);const p=n.from[0];p.allDescendants?i=p.collectionId:e=e.child(p.collectionId)}let s=[];n.where&&(s=function(_){const v=KE(_);return v instanceof We&&w_(v)?v.getFilters():[v]}(n.where));let a=[];n.orderBy&&(a=function(_){return _.map(v=>function(T){return new fu(da(T.field),function(R){switch(R){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(T.direction))}(v))}(n.orderBy));let u=null;n.limit&&(u=function(_){let v;return v=typeof _=="object"?_.value:_,Su(v)?null:v}(n.limit));let h=null;n.startAt&&(h=function(_){const v=!!_.before,x=_.values||[];return new Is(x,v)}(n.startAt));let m=null;return n.endAt&&(m=function(_){const v=!_.before,x=_.values||[];return new Is(x,v)}(n.endAt)),gE(e,i,a,s,u,"F",h,m)}function FR(t,e){const n=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return de()}}(e.purpose);return n==null?null:{"goog-listen-tags":n}}function KE(t){return t.unaryFilter!==void 0?function(n){switch(n.unaryFilter.op){case"IS_NAN":const r=da(n.unaryFilter.field);return Me.create(r,"==",{doubleValue:NaN});case"IS_NULL":const i=da(n.unaryFilter.field);return Me.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=da(n.unaryFilter.field);return Me.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=da(n.unaryFilter.field);return Me.create(a,"!=",{nullValue:"NULL_VALUE"});default:return de()}}(t):t.fieldFilter!==void 0?function(n){return Me.create(da(n.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return de()}}(n.fieldFilter.op),n.fieldFilter.value)}(t):t.compositeFilter!==void 0?function(n){return We.create(n.compositeFilter.filters.map(r=>KE(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return de()}}(n.compositeFilter.op))}(t):de()}function zR(t){return kR[t]}function BR(t){return RR[t]}function UR(t){return jR[t]}function ns(t){return{fieldPath:t.canonicalString()}}function da(t){return at.fromServerFormat(t.fieldPath)}function QE(t){return t instanceof Me?function(n){if(n.op==="=="){if(P0(n.value))return{unaryFilter:{field:ns(n.field),op:"IS_NAN"}};if(C0(n.value))return{unaryFilter:{field:ns(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(P0(n.value))return{unaryFilter:{field:ns(n.field),op:"IS_NOT_NAN"}};if(C0(n.value))return{unaryFilter:{field:ns(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ns(n.field),op:BR(n.op),value:n.value}}}(t):t instanceof We?function(n){const r=n.getFilters().map(i=>QE(i));return r.length===1?r[0]:{compositeFilter:{op:UR(n.op),filters:r}}}(t):de()}function $R(t){const e=[];return t.fields.forEach(n=>e.push(n.canonicalString())),{fieldPaths:e}}function ZE(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class li{constructor(e,n,r,i,s=_e.min(),a=_e.min(),u=yt.EMPTY_BYTE_STRING,h=null){this.target=e,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(e){return new li(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new li(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new li(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new li(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class JE{constructor(e){this.ct=e}}function qR(t,e){let n;if(e.document)n=qE(t.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=le.fromSegments(e.noDocument.path),i=Ao(e.noDocument.readTime);n=nt.newNoDocument(r,i),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return de();{const r=le.fromSegments(e.unknownDocument.path),i=Ao(e.unknownDocument.version);n=nt.newUnknownDocument(r,i)}}return e.readTime&&n.setReadTime(function(i){const s=new ct(i[0],i[1]);return _e.fromTimestamp(s)}(e.readTime)),n}function W0(t,e){const n=e.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:Ud(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,a){return{name:mu(s,a.key),fields:a.data.value.mapValue.fields,updateTime:Xa(s,a.version.toTimestamp()),createTime:Xa(s,a.createTime.toTimestamp())}}(t.ct,e);else if(e.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:No(e.version)};else{if(!e.isUnknownDocument())return de();r.unknownDocument={path:n.path.toArray(),version:No(e.version)}}return r}function Ud(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function No(t){const e=t.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ao(t){const e=new ct(t.seconds,t.nanoseconds);return _e.fromTimestamp(e)}function so(t,e){const n=(e.baseMutations||[]).map(s=>ig(t.ct,s));for(let s=0;s<e.mutations.length-1;++s){const a=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){const u=e.mutations[s+1];a.updateTransforms=u.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}const r=e.mutations.map(s=>ig(t.ct,s)),i=ct.fromMillis(e.localWriteTimeMs);return new S_(e.batchId,i,n,r)}function wc(t){const e=Ao(t.readTime),n=t.lastLimboFreeSnapshotVersion!==void 0?Ao(t.lastLimboFreeSnapshotVersion):_e.min();let r;return r=function(s){return s.documents!==void 0}(t.query)?function(s){return ge(s.documents.length===1),un(_l(UE(s.documents[0])))}(t.query):function(s){return un(HE(s))}(t.query),new li(r,t.targetId,"TargetPurposeListen",t.lastListenSequenceNumber,e,n,yt.fromBase64String(t.resumeToken))}function YE(t,e){const n=No(e.snapshotVersion),r=No(e.lastLimboFreeSnapshotVersion);let i;i=Od(e.target)?GE(t.ct,e.target):Af(t.ct,e.target)._t;const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:So(e.target),readTime:n,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function k_(t){const e=HE({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?zd(e,e.limit,"L"):e}function Mm(t,e){return new P_(e.largestBatchId,ig(t.ct,e.overlayMutation))}function H0(t,e){const n=e.path.lastSegment();return[t,cn(e.path.popLast()),n]}function K0(t,e,n,r){return{indexId:t,uid:e,sequenceNumber:n,readTime:No(r.readTime),documentKey:cn(r.documentKey.path),largestBatchId:r.largestBatchId}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class GR{getBundleMetadata(e,n){return Q0(e).get(n).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:Ao(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,n){return Q0(e).put(function(i){return{bundleId:i.id,createTime:No(St(i.createTime)),version:i.version}}(n))}getNamedQuery(e,n){return Z0(e).get(n).next(r=>{if(r)return function(s){return{name:s.name,query:k_(s.bundledQuery),readTime:Ao(s.readTime)}}(r)})}saveNamedQuery(e,n){return Z0(e).put(function(i){return{name:i.name,readTime:No(St(i.readTime)),bundledQuery:i.bundledQuery}}(n))}}function Q0(t){return Ot(t,"bundles")}function Z0(t){return Ot(t,"namedQueries")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kf{constructor(e,n){this.serializer=e,this.userId=n}static lt(e,n){const r=n.uid||"";return new kf(e,r)}getOverlay(e,n){return lc(e).get(H0(this.userId,n)).next(r=>r?Mm(this.serializer,r):null)}getOverlays(e,n){const r=jr();return q.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){const i=[];return r.forEach((s,a)=>{const u=new P_(n,a);i.push(this.ht(e,u))}),q.waitFor(i)}removeOverlaysForBatchId(e,n,r){const i=new Set;n.forEach(a=>i.add(cn(a.getCollectionPath())));const s=[];return i.forEach(a=>{const u=IDBKeyRange.bound([this.userId,a,r],[this.userId,a,r+1],!1,!0);s.push(lc(e).j("collectionPathOverlayIndex",u))}),q.waitFor(s)}getOverlaysForCollection(e,n,r){const i=jr(),s=cn(n),a=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return lc(e).U("collectionPathOverlayIndex",a).next(u=>{for(const h of u){const m=Mm(this.serializer,h);i.set(m.getKey(),m)}return i})}getOverlaysForCollectionGroup(e,n,r,i){const s=jr();let a;const u=IDBKeyRange.bound([this.userId,n,r],[this.userId,n,Number.POSITIVE_INFINITY],!0);return lc(e).J({index:"collectionGroupOverlayIndex",range:u},(h,m,p)=>{const _=Mm(this.serializer,m);s.size()<i||_.largestBatchId===a?(s.set(_.getKey(),_),a=_.largestBatchId):p.done()}).next(()=>s)}ht(e,n){return lc(e).put(function(i,s,a){const[u,h,m]=H0(s,a.mutation.key);return{userId:s,collectionPath:h,documentId:m,collectionGroup:a.mutation.key.getCollectionGroup(),largestBatchId:a.largestBatchId,overlayMutation:pu(i.ct,a.mutation)}}(this.serializer,this.userId,n))}}function lc(t){return Ot(t,"documentOverlays")}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class WR{Pt(e){return Ot(e,"globals")}getSessionToken(e){return this.Pt(e).get("sessionToken").next(n=>{const r=n==null?void 0:n.value;return r?yt.fromUint8Array(r):yt.EMPTY_BYTE_STRING})}setSessionToken(e,n){return this.Pt(e).put({name:"sessionToken",value:n.toUint8Array()})}}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oo{constructor(){}It(e,n){this.Tt(e,n),n.Et()}Tt(e,n){if("nullValue"in e)this.dt(n,5);else if("booleanValue"in e)this.dt(n,10),n.At(e.booleanValue?1:0);else if("integerValue"in e)this.dt(n,15),n.At(st(e.integerValue));else if("doubleValue"in e){const r=st(e.doubleValue);isNaN(r)?this.dt(n,13):(this.dt(n,15),cu(r)?n.At(0):n.At(r))}else if("timestampValue"in e){let r=e.timestampValue;this.dt(n,20),typeof r=="string"&&(r=gi(r)),n.Rt(`${r.seconds||""}`),n.At(r.nanos||0)}else if("stringValue"in e)this.Vt(e.stringValue,n),this.ft(n);else if("bytesValue"in e)this.dt(n,30),n.gt(_i(e.bytesValue)),this.ft(n);else if("referenceValue"in e)this.yt(e.referenceValue,n);else if("geoPointValue"in e){const r=e.geoPointValue;this.dt(n,45),n.At(r.latitude||0),n.At(r.longitude||0)}else"mapValue"in e?oE(e)?this.dt(n,Number.MAX_SAFE_INTEGER):Cf(e)?this.wt(e.mapValue,n):(this.St(e.mapValue,n),this.ft(n)):"arrayValue"in e?(this.bt(e.arrayValue,n),this.ft(n)):de()}Vt(e,n){this.dt(n,25),this.Dt(e,n)}Dt(e,n){n.Rt(e)}St(e,n){const r=e.fields||{};this.dt(n,55);for(const i of Object.keys(r))this.Vt(i,n),this.Tt(r[i],n)}wt(e,n){var r,i;const s=e.fields||{};this.dt(n,53);const a="value",u=((i=(r=s[a].arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.length)||0;this.dt(n,15),n.At(st(u)),this.Vt(a,n),this.Tt(s[a],n)}bt(e,n){const r=e.values||[];this.dt(n,50);for(const i of r)this.Tt(i,n)}yt(e,n){this.dt(n,37),le.fromName(e).path.forEach(r=>{this.dt(n,60),this.Dt(r,n)})}dt(e,n){e.At(n)}ft(e){e.At(2)}}oo.vt=new oo;function HR(t){if(t===0)return 8;let e=0;return!(t>>4)&&(e+=4,t<<=4),!(t>>6)&&(e+=2,t<<=2),!(t>>7)&&(e+=1),e}function J0(t){const e=64-function(r){let i=0;for(let s=0;s<8;++s){const a=HR(255&r[s]);if(i+=a,a!==8)break}return i}(t);return Math.ceil(e/8)}class KR{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Ct(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Ft(r.value),r=n.next();this.Mt()}xt(e){const n=e[Symbol.iterator]();let r=n.next();for(;!r.done;)this.Ot(r.value),r=n.next();this.Nt()}Lt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Ft(r);else if(r<2048)this.Ft(960|r>>>6),this.Ft(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Ft(480|r>>>12),this.Ft(128|63&r>>>6),this.Ft(128|63&r);else{const i=n.codePointAt(0);this.Ft(240|i>>>18),this.Ft(128|63&i>>>12),this.Ft(128|63&i>>>6),this.Ft(128|63&i)}}this.Mt()}Bt(e){for(const n of e){const r=n.charCodeAt(0);if(r<128)this.Ot(r);else if(r<2048)this.Ot(960|r>>>6),this.Ot(128|63&r);else if(n<"\uD800"||"\uDBFF"<n)this.Ot(480|r>>>12),this.Ot(128|63&r>>>6),this.Ot(128|63&r);else{const i=n.codePointAt(0);this.Ot(240|i>>>18),this.Ot(128|63&i>>>12),this.Ot(128|63&i>>>6),this.Ot(128|63&i)}}this.Nt()}kt(e){const n=this.qt(e),r=J0(n);this.Qt(1+r),this.buffer[this.position++]=255&r;for(let i=n.length-r;i<n.length;++i)this.buffer[this.position++]=255&n[i]}Kt(e){const n=this.qt(e),r=J0(n);this.Qt(1+r),this.buffer[this.position++]=~(255&r);for(let i=n.length-r;i<n.length;++i)this.buffer[this.position++]=~(255&n[i])}$t(){this.Ut(255),this.Ut(255)}Wt(){this.Gt(255),this.Gt(255)}reset(){this.position=0}seed(e){this.Qt(e.length),this.buffer.set(e,this.position),this.position+=e.length}zt(){return this.buffer.slice(0,this.position)}qt(e){const n=function(s){const a=new DataView(new ArrayBuffer(8));return a.setFloat64(0,s,!1),new Uint8Array(a.buffer)}(e),r=(128&n[0])!=0;n[0]^=r?255:128;for(let i=1;i<n.length;++i)n[i]^=r?255:0;return n}Ft(e){const n=255&e;n===0?(this.Ut(0),this.Ut(255)):n===255?(this.Ut(255),this.Ut(0)):this.Ut(n)}Ot(e){const n=255&e;n===0?(this.Gt(0),this.Gt(255)):n===255?(this.Gt(255),this.Gt(0)):this.Gt(e)}Mt(){this.Ut(0),this.Ut(1)}Nt(){this.Gt(0),this.Gt(1)}Ut(e){this.Qt(1),this.buffer[this.position++]=e}Gt(e){this.Qt(1),this.buffer[this.position++]=~e}Qt(e){const n=e+this.position;if(n<=this.buffer.length)return;let r=2*this.buffer.length;r<n&&(r=n);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class QR{constructor(e){this.jt=e}gt(e){this.jt.Ct(e)}Rt(e){this.jt.Lt(e)}At(e){this.jt.kt(e)}Et(){this.jt.$t()}}class ZR{constructor(e){this.jt=e}gt(e){this.jt.xt(e)}Rt(e){this.jt.Bt(e)}At(e){this.jt.Kt(e)}Et(){this.jt.Wt()}}class cc{constructor(){this.jt=new KR,this.Ht=new QR(this.jt),this.Jt=new ZR(this.jt)}seed(e){this.jt.seed(e)}Yt(e){return e===0?this.Ht:this.Jt}zt(){return this.jt.zt()}reset(){this.jt.reset()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ao{constructor(e,n,r,i){this.indexId=e,this.documentKey=n,this.arrayValue=r,this.directionalValue=i}Zt(){const e=this.directionalValue.length,n=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(n);return r.set(this.directionalValue,0),n!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new ao(this.indexId,this.documentKey,this.arrayValue,r)}}function Qi(t,e){let n=t.indexId-e.indexId;return n!==0?n:(n=Y0(t.arrayValue,e.arrayValue),n!==0?n:(n=Y0(t.directionalValue,e.directionalValue),n!==0?n:le.comparator(t.documentKey,e.documentKey)))}function Y0(t,e){for(let n=0;n<t.length&&n<e.length;++n){const r=t[n]-e[n];if(r!==0)return r}return t.length-e.length}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class X0{constructor(e){this.Xt=new Qe((n,r)=>at.comparator(n.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.en=e.orderBy,this.tn=[];for(const n of e.filters){const r=n;r.isInequality()?this.Xt=this.Xt.add(r):this.tn.push(r)}}get nn(){return this.Xt.size>1}rn(e){if(ge(e.collectionGroup===this.collectionId),this.nn)return!1;const n=Hp(e);if(n!==void 0&&!this.sn(n))return!1;const r=ro(e);let i=new Set,s=0,a=0;for(;s<r.length&&this.sn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Xt.size>0){const u=this.Xt.getIterator().getNext();if(!i.has(u.field.canonicalString())){const h=r[s];if(!this.on(u,h)||!this._n(this.en[a++],h))return!1}++s}for(;s<r.length;++s){const u=r[s];if(a>=this.en.length||!this._n(this.en[a++],u))return!1}return!0}an(){if(this.nn)return null;let e=new Qe(at.comparator);const n=[];for(const r of this.tn)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")n.push(new go(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),n.push(new go(r.field,0))}for(const r of this.en)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),n.push(new go(r.field,r.dir==="asc"?0:1)));return new Ha(Ha.UNKNOWN_ID,this.collectionId,n,Ka.empty())}sn(e){for(const n of this.tn)if(this.on(n,e))return!0;return!1}on(e,n){if(e===void 0||!e.field.isEqual(n.fieldPath))return!1;const r=e.op==="array-contains"||e.op==="array-contains-any";return n.kind===2===r}_n(e,n){return!!e.field.isEqual(n.fieldPath)&&(n.kind===0&&e.dir==="asc"||n.kind===1&&e.dir==="desc")}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XE(t){var e,n;if(ge(t instanceof Me||t instanceof We),t instanceof Me){if(t instanceof pE){const i=((n=(e=t.value.arrayValue)===null||e===void 0?void 0:e.values)===null||n===void 0?void 0:n.map(s=>Me.create(t.field,"==",s)))||[];return We.create(i,"or")}return t}const r=t.filters.map(i=>XE(i));return We.create(r,t.op)}function JR(t){if(t.getFilters().length===0)return[];const e=ag(XE(t));return ge(eT(e)),sg(e)||og(e)?[e]:e.getFilters()}function sg(t){return t instanceof Me}function og(t){return t instanceof We&&w_(t)}function eT(t){return sg(t)||og(t)||function(n){if(n instanceof We&&Jp(n)){for(const r of n.getFilters())if(!sg(r)&&!og(r))return!1;return!0}return!1}(t)}function ag(t){if(ge(t instanceof Me||t instanceof We),t instanceof Me)return t;if(t.filters.length===1)return ag(t.filters[0]);const e=t.filters.map(r=>ag(r));let n=We.create(e,t.op);return n=$d(n),eT(n)?n:(ge(n instanceof We),ge(Za(n)),ge(n.filters.length>1),n.filters.reduce((r,i)=>R_(r,i)))}function R_(t,e){let n;return ge(t instanceof Me||t instanceof We),ge(e instanceof Me||e instanceof We),n=t instanceof Me?e instanceof Me?function(i,s){return We.create([i,s],"and")}(t,e):ex(t,e):e instanceof Me?ex(e,t):function(i,s){if(ge(i.filters.length>0&&s.filters.length>0),Za(i)&&Za(s))return dE(i,s.getFilters());const a=Jp(i)?i:s,u=Jp(i)?s:i,h=a.filters.map(m=>R_(m,u));return We.create(h,"or")}(t,e),$d(n)}function ex(t,e){if(Za(e))return dE(e,t.getFilters());{const n=e.filters.map(r=>R_(t,r));return We.create(n,"or")}}function $d(t){if(ge(t instanceof Me||t instanceof We),t instanceof Me)return t;const e=t.getFilters();if(e.length===1)return $d(e[0]);if(uE(t))return t;const n=e.map(i=>$d(i)),r=[];return n.forEach(i=>{i instanceof Me?r.push(i):i instanceof We&&(i.op===t.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:We.create(r,t.op)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class YR{constructor(){this.un=new j_}addToCollectionParentIndex(e,n){return this.un.add(n),q.resolve()}getCollectionParents(e,n){return q.resolve(this.un.getEntries(n))}addFieldIndex(e,n){return q.resolve()}deleteFieldIndex(e,n){return q.resolve()}deleteAllFieldIndexes(e){return q.resolve()}createTargetIndexes(e,n){return q.resolve()}getDocumentsMatchingTarget(e,n){return q.resolve(null)}getIndexType(e,n){return q.resolve(0)}getFieldIndexes(e,n){return q.resolve([])}getNextCollectionGroupToUpdate(e){return q.resolve(null)}getMinOffset(e,n){return q.resolve(Dn.min())}getMinOffsetFromCollectionGroup(e,n){return q.resolve(Dn.min())}updateCollectionGroup(e,n,r){return q.resolve()}updateIndexEntries(e,n){return q.resolve()}}class j_{constructor(){this.index={}}add(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n]||new Qe(De.comparator),s=!i.has(r);return this.index[n]=i.add(r),s}has(e){const n=e.lastSegment(),r=e.popLast(),i=this.index[n];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Qe(De.comparator)).toArray()}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mh=new Uint8Array(0);class XR{constructor(e,n){this.databaseId=n,this.cn=new j_,this.ln=new wi(r=>So(r),(r,i)=>Cu(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,n){if(!this.cn.has(n)){const r=n.lastSegment(),i=n.popLast();e.addOnCommittedListener(()=>{this.cn.add(n)});const s={collectionId:r,parent:cn(i)};return tx(e).put(s)}return q.resolve()}getCollectionParents(e,n){const r=[],i=IDBKeyRange.bound([n,""],[Wb(n),""],!1,!0);return tx(e).U(i).next(s=>{for(const a of s){if(a.collectionId!==n)break;r.push(Rr(a.parent))}return r})}addFieldIndex(e,n){const r=uc(e),i=function(u){return{indexId:u.indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(h=>[h.fieldPath.canonicalString(),h.kind])}}(n);delete i.indexId;const s=r.add(i);if(n.indexState){const a=aa(e);return s.next(u=>{a.put(K0(u,this.uid,n.indexState.sequenceNumber,n.indexState.offset))})}return s.next()}deleteFieldIndex(e,n){const r=uc(e),i=aa(e),s=oa(e);return r.delete(n.indexId).next(()=>i.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([n.indexId],[n.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){const n=uc(e),r=oa(e),i=aa(e);return n.j().next(()=>r.j()).next(()=>i.j())}createTargetIndexes(e,n){return q.forEach(this.hn(n),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){const s=new X0(r).an();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,n){const r=oa(e);let i=!0;const s=new Map;return q.forEach(this.hn(n),a=>this.Pn(e,a).next(u=>{i&&(i=!!u),s.set(a,u)})).next(()=>{if(i){let a=Pe();const u=[];return q.forEach(s,(h,m)=>{ee("IndexedDbIndexManager",`Using index ${function(A){return`id=${A.indexId}|cg=${A.collectionGroup}|f=${A.fields.map(U=>`${U.fieldPath}:${U.kind}`).join(",")}`}(h)} to execute ${So(n)}`);const p=function(A,U){const Z=Hp(U);if(Z===void 0)return null;for(const V of Fd(A,Z.fieldPath))switch(V.op){case"array-contains-any":return V.value.arrayValue.values||[];case"array-contains":return[V.value]}return null}(m,h),_=function(A,U){const Z=new Map;for(const V of ro(U))for(const k of Fd(A,V.fieldPath))switch(k.op){case"==":case"in":Z.set(V.fieldPath.canonicalString(),k.value);break;case"not-in":case"!=":return Z.set(V.fieldPath.canonicalString(),k.value),Array.from(Z.values())}return null}(m,h),v=function(A,U){const Z=[];let V=!0;for(const k of ro(U)){const N=k.kind===0?j0(A,k.fieldPath,A.startAt):D0(A,k.fieldPath,A.startAt);Z.push(N.value),V&&(V=N.inclusive)}return new Is(Z,V)}(m,h),x=function(A,U){const Z=[];let V=!0;for(const k of ro(U)){const N=k.kind===0?D0(A,k.fieldPath,A.endAt):j0(A,k.fieldPath,A.endAt);Z.push(N.value),V&&(V=N.inclusive)}return new Is(Z,V)}(m,h),T=this.In(h,m,v),E=this.In(h,m,x),R=this.Tn(h,m,_),S=this.En(h.indexId,p,T,v.inclusive,E,x.inclusive,R);return q.forEach(S,C=>r.G(C,n.limit).next(A=>{A.forEach(U=>{const Z=le.fromSegments(U.documentKey);a.has(Z)||(a=a.add(Z),u.push(Z))})}))}).next(()=>u)}return q.resolve(null)})}hn(e){let n=this.ln.get(e);return n||(e.filters.length===0?n=[e]:n=JR(We.create(e.filters,"and")).map(r=>Xp(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.ln.set(e,n),n)}En(e,n,r,i,s,a,u){const h=(n!=null?n.length:1)*Math.max(r.length,s.length),m=h/(n!=null?n.length:1),p=[];for(let _=0;_<h;++_){const v=n?this.dn(n[_/m]):Mh,x=this.An(e,v,r[_%m],i),T=this.Rn(e,v,s[_%m],a),E=u.map(R=>this.An(e,v,R,!0));p.push(...this.createRange(x,T,E))}return p}An(e,n,r,i){const s=new ao(e,le.empty(),n,r);return i?s:s.Zt()}Rn(e,n,r,i){const s=new ao(e,le.empty(),n,r);return i?s.Zt():s}Pn(e,n){const r=new X0(n),i=n.collectionGroup!=null?n.collectionGroup:n.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let a=null;for(const u of s)r.rn(u)&&(!a||u.fields.length>a.fields.length)&&(a=u);return a})}getIndexType(e,n){let r=2;const i=this.hn(n);return q.forEach(i,s=>this.Pn(e,s).next(a=>{a?r!==0&&a.fields.length<function(h){let m=new Qe(at.comparator),p=!1;for(const _ of h.filters)for(const v of _.getFlattenedFilters())v.field.isKeyField()||(v.op==="array-contains"||v.op==="array-contains-any"?p=!0:m=m.add(v.field));for(const _ of h.orderBy)_.field.isKeyField()||(m=m.add(_.field));return m.size+(p?1:0)}(s)&&(r=1):r=0})).next(()=>function(a){return a.limit!==null}(n)&&i.length>1&&r===2?1:r)}Vn(e,n){const r=new cc;for(const i of ro(e)){const s=n.data.field(i.fieldPath);if(s==null)return null;const a=r.Yt(i.kind);oo.vt.It(s,a)}return r.zt()}dn(e){const n=new cc;return oo.vt.It(e,n.Yt(0)),n.zt()}mn(e,n){const r=new cc;return oo.vt.It(Io(this.databaseId,n),r.Yt(function(s){const a=ro(s);return a.length===0?0:a[a.length-1].kind}(e))),r.zt()}Tn(e,n,r){if(r===null)return[];let i=[];i.push(new cc);let s=0;for(const a of ro(e)){const u=r[s++];for(const h of i)if(this.fn(n,a.fieldPath)&&du(u))i=this.gn(i,a,u);else{const m=h.Yt(a.kind);oo.vt.It(u,m)}}return this.pn(i)}In(e,n,r){return this.Tn(e,n,r.position)}pn(e){const n=[];for(let r=0;r<e.length;++r)n[r]=e[r].zt();return n}gn(e,n,r){const i=[...e],s=[];for(const a of r.arrayValue.values||[])for(const u of i){const h=new cc;h.seed(u.zt()),oo.vt.It(a,h.Yt(n.kind)),s.push(h)}return s}fn(e,n){return!!e.filters.find(r=>r instanceof Me&&r.field.isEqual(n)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,n){const r=uc(e),i=aa(e);return(n?r.U("collectionGroupIndex",IDBKeyRange.bound(n,n)):r.U()).next(s=>{const a=[];return q.forEach(s,u=>i.get([u.indexId,this.uid]).next(h=>{a.push(function(p,_){const v=_?new Ka(_.sequenceNumber,new Dn(Ao(_.readTime),new le(Rr(_.documentKey)),_.largestBatchId)):Ka.empty(),x=p.fields.map(([T,E])=>new go(at.fromServerFormat(T),E));return new Ha(p.indexId,p.collectionGroup,x,v)}(u,h))})).next(()=>a)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(n=>n.length===0?null:(n.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:be(r.collectionGroup,i.collectionGroup)}),n[0].collectionGroup))}updateCollectionGroup(e,n,r){const i=uc(e),s=aa(e);return this.yn(e).next(a=>i.U("collectionGroupIndex",IDBKeyRange.bound(n,n)).next(u=>q.forEach(u,h=>s.put(K0(h.indexId,this.uid,a,r)))))}updateIndexEntries(e,n){const r=new Map;return q.forEach(n,(i,s)=>{const a=r.get(i.collectionGroup);return(a?q.resolve(a):this.getFieldIndexes(e,i.collectionGroup)).next(u=>(r.set(i.collectionGroup,u),q.forEach(u,h=>this.wn(e,i,h).next(m=>{const p=this.Sn(s,h);return m.isEqual(p)?q.resolve():this.bn(e,s,h,m,p)}))))})}Dn(e,n,r,i){return oa(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.mn(r,n.key),documentKey:n.key.path.toArray()})}vn(e,n,r,i){return oa(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.mn(r,n.key),n.key.path.toArray()])}wn(e,n,r){const i=oa(e);let s=new Qe(Qi);return i.J({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.mn(r,n)])},(a,u)=>{s=s.add(new ao(r.indexId,n,u.arrayValue,u.directionalValue))}).next(()=>s)}Sn(e,n){let r=new Qe(Qi);const i=this.Vn(n,e);if(i==null)return r;const s=Hp(n);if(s!=null){const a=e.data.field(s.fieldPath);if(du(a))for(const u of a.arrayValue.values||[])r=r.add(new ao(n.indexId,e.key,this.dn(u),i))}else r=r.add(new ao(n.indexId,e.key,Mh,i));return r}bn(e,n,r,i,s){ee("IndexedDbIndexManager","Updating index entries for document '%s'",n.key);const a=[];return function(h,m,p,_,v){const x=h.getIterator(),T=m.getIterator();let E=sa(x),R=sa(T);for(;E||R;){let S=!1,C=!1;if(E&&R){const A=p(E,R);A<0?C=!0:A>0&&(S=!0)}else E!=null?C=!0:S=!0;S?(_(R),R=sa(T)):C?(v(E),E=sa(x)):(E=sa(x),R=sa(T))}}(i,s,Qi,u=>{a.push(this.Dn(e,n,r,u))},u=>{a.push(this.vn(e,n,r,u))}),q.waitFor(a)}yn(e){let n=1;return aa(e).J({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),n=i.sequenceNumber+1}).next(()=>n)}createRange(e,n,r){r=r.sort((a,u)=>Qi(a,u)).filter((a,u,h)=>!u||Qi(a,h[u-1])!==0);const i=[];i.push(e);for(const a of r){const u=Qi(a,e),h=Qi(a,n);if(u===0)i[0]=e.Zt();else if(u>0&&h<0)i.push(a),i.push(a.Zt());else if(h>0)break}i.push(n);const s=[];for(let a=0;a<i.length;a+=2){if(this.Cn(i[a],i[a+1]))return[];const u=[i[a].indexId,this.uid,i[a].arrayValue,i[a].directionalValue,Mh,[]],h=[i[a+1].indexId,this.uid,i[a+1].arrayValue,i[a+1].directionalValue,Mh,[]];s.push(IDBKeyRange.bound(u,h))}return s}Cn(e,n){return Qi(e,n)>0}getMinOffsetFromCollectionGroup(e,n){return this.getFieldIndexes(e,n).next(nx)}getMinOffset(e,n){return q.mapArray(this.hn(n),r=>this.Pn(e,r).next(i=>i||de())).next(nx)}}function tx(t){return Ot(t,"collectionParents")}function oa(t){return Ot(t,"indexEntries")}function uc(t){return Ot(t,"indexConfiguration")}function aa(t){return Ot(t,"indexState")}function nx(t){ge(t.length!==0);let e=t[0].indexState.offset,n=e.largestBatchId;for(let r=1;r<t.length;r++){const i=t[r].indexState.offset;v_(i,e)<0&&(e=i),n<i.largestBatchId&&(n=i.largestBatchId)}return new Dn(e.readTime,e.documentKey,n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rx={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class an{constructor(e,n,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new an(e,an.DEFAULT_COLLECTION_PERCENTILE,an.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tT(t,e,n){const r=t.store("mutations"),i=t.store("documentMutations"),s=[],a=IDBKeyRange.only(n.batchId);let u=0;const h=r.J({range:a},(p,_,v)=>(u++,v.delete()));s.push(h.next(()=>{ge(u===1)}));const m=[];for(const p of n.mutations){const _=Xb(e,p.key.path,n.batchId);s.push(i.delete(_)),m.push(p.key)}return q.waitFor(s).next(()=>m)}function qd(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw de();e=t.noDocument}return JSON.stringify(e).length}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */an.DEFAULT_COLLECTION_PERCENTILE=10,an.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,an.DEFAULT=new an(41943040,an.DEFAULT_COLLECTION_PERCENTILE,an.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),an.DISABLED=new an(-1,0,0);class Rf{constructor(e,n,r,i){this.userId=e,this.serializer=n,this.indexManager=r,this.referenceDelegate=i,this.Fn={}}static lt(e,n,r,i){ge(e.uid!=="");const s=e.isAuthenticated()?e.uid:"";return new Rf(s,n,r,i)}checkEmpty(e){let n=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Zi(e).J({index:"userMutationsIndex",range:r},(i,s,a)=>{n=!1,a.done()}).next(()=>n)}addMutationBatch(e,n,r,i){const s=fa(e),a=Zi(e);return a.add({}).next(u=>{ge(typeof u=="number");const h=new S_(u,n,r,i),m=function(x,T,E){const R=E.baseMutations.map(C=>pu(x.ct,C)),S=E.mutations.map(C=>pu(x.ct,C));return{userId:T,batchId:E.batchId,localWriteTimeMs:E.localWriteTime.toMillis(),baseMutations:R,mutations:S}}(this.serializer,this.userId,h),p=[];let _=new Qe((v,x)=>be(v.canonicalString(),x.canonicalString()));for(const v of i){const x=Xb(this.userId,v.key.path,u);_=_.add(v.key.path.popLast()),p.push(a.put(m)),p.push(s.put(x,Bk))}return _.forEach(v=>{p.push(this.indexManager.addToCollectionParentIndex(e,v))}),e.addOnCommittedListener(()=>{this.Fn[u]=h.keys()}),q.waitFor(p).next(()=>h)})}lookupMutationBatch(e,n){return Zi(e).get(n).next(r=>r?(ge(r.userId===this.userId),so(this.serializer,r)):null)}Mn(e,n){return this.Fn[n]?q.resolve(this.Fn[n]):this.lookupMutationBatch(e,n).next(r=>{if(r){const i=r.keys();return this.Fn[n]=i,i}return null})}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Zi(e).J({index:"userMutationsIndex",range:i},(a,u,h)=>{u.userId===this.userId&&(ge(u.batchId>=r),s=so(this.serializer,u)),h.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const n=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Zi(e).J({index:"userMutationsIndex",range:n,reverse:!0},(i,s,a)=>{r=s.batchId,a.done()}).next(()=>r)}getAllMutationBatches(e){const n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Zi(e).U("userMutationsIndex",n).next(r=>r.map(i=>so(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,n){const r=ed(this.userId,n.path),i=IDBKeyRange.lowerBound(r),s=[];return fa(e).J({range:i},(a,u,h)=>{const[m,p,_]=a,v=Rr(p);if(m===this.userId&&n.path.isEqual(v))return Zi(e).get(_).next(x=>{if(!x)throw de();ge(x.userId===this.userId),s.push(so(this.serializer,x))});h.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Qe(be);const i=[];return n.forEach(s=>{const a=ed(this.userId,s.path),u=IDBKeyRange.lowerBound(a),h=fa(e).J({range:u},(m,p,_)=>{const[v,x,T]=m,E=Rr(x);v===this.userId&&s.path.isEqual(E)?r=r.add(T):_.done()});i.push(h)}),q.waitFor(i).next(()=>this.xn(e,r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1,s=ed(this.userId,r),a=IDBKeyRange.lowerBound(s);let u=new Qe(be);return fa(e).J({range:a},(h,m,p)=>{const[_,v,x]=h,T=Rr(v);_===this.userId&&r.isPrefixOf(T)?T.length===i&&(u=u.add(x)):p.done()}).next(()=>this.xn(e,u))}xn(e,n){const r=[],i=[];return n.forEach(s=>{i.push(Zi(e).get(s).next(a=>{if(a===null)throw de();ge(a.userId===this.userId),r.push(so(this.serializer,a))}))}),q.waitFor(i).next(()=>r)}removeMutationBatch(e,n){return tT(e._e,this.userId,n).next(r=>(e.addOnCommittedListener(()=>{this.On(n.batchId)}),q.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}On(e){delete this.Fn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(n=>{if(!n)return q.resolve();const r=IDBKeyRange.lowerBound(function(a){return[a]}(this.userId)),i=[];return fa(e).J({range:r},(s,a,u)=>{if(s[0]===this.userId){const h=Rr(s[1]);i.push(h)}else u.done()}).next(()=>{ge(i.length===0)})})}containsKey(e,n){return nT(e,this.userId,n)}Nn(e){return rT(e).get(this.userId).next(n=>n||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function nT(t,e,n){const r=ed(e,n.path),i=r[1],s=IDBKeyRange.lowerBound(r);let a=!1;return fa(t).J({range:s,H:!0},(u,h,m)=>{const[p,_,v]=u;p===e&&_===i&&(a=!0),m.done()}).next(()=>a)}function Zi(t){return Ot(t,"mutations")}function fa(t){return Ot(t,"documentMutations")}function rT(t){return Ot(t,"mutationQueues")}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ko{constructor(e){this.Ln=e}next(){return this.Ln+=2,this.Ln}static Bn(){return new ko(0)}static kn(){return new ko(-1)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ej{constructor(e,n){this.referenceDelegate=e,this.serializer=n}allocateTargetId(e){return this.qn(e).next(n=>{const r=new ko(n.highestTargetId);return n.highestTargetId=r.next(),this.Qn(e,n).next(()=>n.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.qn(e).next(n=>_e.fromTimestamp(new ct(n.lastRemoteSnapshotVersion.seconds,n.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.qn(e).next(n=>n.highestListenSequenceNumber)}setTargetsMetadata(e,n,r){return this.qn(e).next(i=>(i.highestListenSequenceNumber=n,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),n>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=n),this.Qn(e,i)))}addTargetData(e,n){return this.Kn(e,n).next(()=>this.qn(e).next(r=>(r.targetCount+=1,this.$n(n,r),this.Qn(e,r))))}updateTargetData(e,n){return this.Kn(e,n)}removeTargetData(e,n){return this.removeMatchingKeysForTargetId(e,n.targetId).next(()=>la(e).delete(n.targetId)).next(()=>this.qn(e)).next(r=>(ge(r.targetCount>0),r.targetCount-=1,this.Qn(e,r)))}removeTargets(e,n,r){let i=0;const s=[];return la(e).J((a,u)=>{const h=wc(u);h.sequenceNumber<=n&&r.get(h.targetId)===null&&(i++,s.push(this.removeTargetData(e,h)))}).next(()=>q.waitFor(s)).next(()=>i)}forEachTarget(e,n){return la(e).J((r,i)=>{const s=wc(i);n(s)})}qn(e){return ix(e).get("targetGlobalKey").next(n=>(ge(n!==null),n))}Qn(e,n){return ix(e).put("targetGlobalKey",n)}Kn(e,n){return la(e).put(YE(this.serializer,n))}$n(e,n){let r=!1;return e.targetId>n.highestTargetId&&(n.highestTargetId=e.targetId,r=!0),e.sequenceNumber>n.highestListenSequenceNumber&&(n.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.qn(e).next(n=>n.targetCount)}getTargetData(e,n){const r=So(n),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return la(e).J({range:i,index:"queryTargetsIndex"},(a,u,h)=>{const m=wc(u);Cu(n,m.target)&&(s=m,h.done())}).next(()=>s)}addMatchingKeys(e,n,r){const i=[],s=rs(e);return n.forEach(a=>{const u=cn(a.path);i.push(s.put({targetId:r,path:u})),i.push(this.referenceDelegate.addReference(e,r,a))}),q.waitFor(i)}removeMatchingKeys(e,n,r){const i=rs(e);return q.forEach(n,s=>{const a=cn(s.path);return q.waitFor([i.delete([r,a]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,n){const r=rs(e),i=IDBKeyRange.bound([n],[n+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,n){const r=IDBKeyRange.bound([n],[n+1],!1,!0),i=rs(e);let s=Pe();return i.J({range:r,H:!0},(a,u,h)=>{const m=Rr(a[1]),p=new le(m);s=s.add(p)}).next(()=>s)}containsKey(e,n){const r=cn(n.path),i=IDBKeyRange.bound([r],[Wb(r)],!1,!0);let s=0;return rs(e).J({index:"documentTargetsIndex",H:!0,range:i},([a,u],h,m)=>{a!==0&&(s++,m.done())}).next(()=>s>0)}ot(e,n){return la(e).get(n).next(r=>r?wc(r):null)}}function la(t){return Ot(t,"targets")}function ix(t){return Ot(t,"targetGlobal")}function rs(t){return Ot(t,"targetDocuments")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sx([t,e],[n,r]){const i=be(t,n);return i===0?be(e,r):i}class tj{constructor(e){this.Un=e,this.buffer=new Qe(sx),this.Wn=0}Gn(){return++this.Wn}zn(e){const n=[e,this.Gn()];if(this.buffer.size<this.Un)this.buffer=this.buffer.add(n);else{const r=this.buffer.last();sx(n,r)<0&&(this.buffer=this.buffer.delete(r).add(n))}}get maxValue(){return this.buffer.last()[0]}}class iT{constructor(e,n,r){this.garbageCollector=e,this.asyncQueue=n,this.localStore=r,this.jn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Hn(6e4)}stop(){this.jn&&(this.jn.cancel(),this.jn=null)}get started(){return this.jn!==null}Hn(e){ee("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.jn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.jn=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){Ms(n)?ee("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n):await Ls(n)}await this.Hn(3e5)})}}class nj{constructor(e,n){this.Jn=e,this.params=n}calculateTargetCount(e,n){return this.Jn.Yn(e).next(r=>Math.floor(n/100*r))}nthSequenceNumber(e,n){if(n===0)return q.resolve(wn.oe);const r=new tj(n);return this.Jn.forEachTarget(e,i=>r.zn(i.sequenceNumber)).next(()=>this.Jn.Zn(e,i=>r.zn(i))).next(()=>r.maxValue)}removeTargets(e,n,r){return this.Jn.removeTargets(e,n,r)}removeOrphanedDocuments(e,n){return this.Jn.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(ee("LruGarbageCollector","Garbage collection skipped; disabled"),q.resolve(rx)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(ee("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),rx):this.Xn(e,n))}getCacheSize(e){return this.Jn.getCacheSize(e)}Xn(e,n){let r,i,s,a,u,h,m;const p=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(_=>(_>this.params.maximumSequenceNumbersToCollect?(ee("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),i=this.params.maximumSequenceNumbersToCollect):i=_,a=Date.now(),this.nthSequenceNumber(e,i))).next(_=>(r=_,u=Date.now(),this.removeTargets(e,r,n))).next(_=>(s=_,h=Date.now(),this.removeOrphanedDocuments(e,r))).next(_=>(m=Date.now(),ua()<=ze.DEBUG&&ee("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${i} in `+(u-a)+`ms
	Removed ${s} targets in `+(h-u)+`ms
	Removed ${_} documents in `+(m-h)+`ms
Total Duration: ${m-p}ms`),q.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:_})))}}function sT(t,e){return new nj(t,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rj{constructor(e,n){this.db=e,this.garbageCollector=sT(this,n)}Yn(e){const n=this.er(e);return this.db.getTargetCache().getTargetCount(e).next(r=>n.next(i=>r+i))}er(e){let n=0;return this.Zn(e,r=>{n++}).next(()=>n)}forEachTarget(e,n){return this.db.getTargetCache().forEachTarget(e,n)}Zn(e,n){return this.tr(e,(r,i)=>n(i))}addReference(e,n,r){return Vh(e,r)}removeReference(e,n,r){return Vh(e,r)}removeTargets(e,n,r){return this.db.getTargetCache().removeTargets(e,n,r)}markPotentiallyOrphaned(e,n){return Vh(e,n)}nr(e,n){return function(i,s){let a=!1;return rT(i).Y(u=>nT(i,u,s).next(h=>(h&&(a=!0),q.resolve(!h)))).next(()=>a)}(e,n)}removeOrphanedDocuments(e,n){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.tr(e,(a,u)=>{if(u<=n){const h=this.nr(e,a).next(m=>{if(!m)return s++,r.getEntry(e,a).next(()=>(r.removeEntry(a,_e.min()),rs(e).delete(function(_){return[0,cn(_.path)]}(a))))});i.push(h)}}).next(()=>q.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,n){return Vh(e,n)}tr(e,n){const r=rs(e);let i,s=wn.oe;return r.J({index:"documentTargetsIndex"},([a,u],{path:h,sequenceNumber:m})=>{a===0?(s!==wn.oe&&n(new le(Rr(i)),s),s=m,i=h):s=wn.oe}).next(()=>{s!==wn.oe&&n(new le(Rr(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function Vh(t,e){return rs(t).put(function(r,i){return{targetId:0,path:cn(r.path),sequenceNumber:i}}(e,t.currentSequenceNumber))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oT{constructor(){this.changes=new wi(e=>e.toString(),(e,n)=>e.isEqual(n)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,nt.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const r=this.changes.get(n);return r!==void 0?q.resolve(r):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ij{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,n,r){return Xs(e).put(r)}removeEntry(e,n,r){return Xs(e).delete(function(s,a){const u=s.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Ud(a),u[u.length-1]]}(n,r))}updateMetadata(e,n){return this.getMetadata(e).next(r=>(r.byteSize+=n,this.rr(e,r)))}getEntry(e,n){let r=nt.newInvalidDocument(n);return Xs(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(hc(n))},(i,s)=>{r=this.ir(n,s)}).next(()=>r)}sr(e,n){let r={size:0,document:nt.newInvalidDocument(n)};return Xs(e).J({index:"documentKeyIndex",range:IDBKeyRange.only(hc(n))},(i,s)=>{r={document:this.ir(n,s),size:qd(s)}}).next(()=>r)}getEntries(e,n){let r=En();return this._r(e,n,(i,s)=>{const a=this.ir(i,s);r=r.insert(i,a)}).next(()=>r)}ar(e,n){let r=En(),i=new Xe(le.comparator);return this._r(e,n,(s,a)=>{const u=this.ir(s,a);r=r.insert(s,u),i=i.insert(s,qd(a))}).next(()=>({documents:r,ur:i}))}_r(e,n,r){if(n.isEmpty())return q.resolve();let i=new Qe(lx);n.forEach(h=>i=i.add(h));const s=IDBKeyRange.bound(hc(i.first()),hc(i.last())),a=i.getIterator();let u=a.getNext();return Xs(e).J({index:"documentKeyIndex",range:s},(h,m,p)=>{const _=le.fromSegments([...m.prefixPath,m.collectionGroup,m.documentId]);for(;u&&lx(u,_)<0;)r(u,null),u=a.getNext();u&&u.isEqual(_)&&(r(u,m),u=a.hasNext()?a.getNext():null),u?p.$(hc(u)):p.done()}).next(()=>{for(;u;)r(u,null),u=a.hasNext()?a.getNext():null})}getDocumentsMatchingQuery(e,n,r,i,s){const a=n.path,u=[a.popLast().toArray(),a.lastSegment(),Ud(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],h=[a.popLast().toArray(),a.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Xs(e).U(IDBKeyRange.bound(u,h,!0)).next(m=>{s==null||s.incrementDocumentReadCount(m.length);let p=En();for(const _ of m){const v=this.ir(le.fromSegments(_.prefixPath.concat(_.collectionGroup,_.documentId)),_);v.isFoundDocument()&&(Nu(n,v)||i.has(v.key))&&(p=p.insert(v.key,v))}return p})}getAllFromCollectionGroup(e,n,r,i){let s=En();const a=ax(n,r),u=ax(n,Dn.max());return Xs(e).J({index:"collectionGroupIndex",range:IDBKeyRange.bound(a,u,!0)},(h,m,p)=>{const _=this.ir(le.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);s=s.insert(_.key,_),s.size===i&&p.done()}).next(()=>s)}newChangeBuffer(e){return new sj(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(n=>n.byteSize)}getMetadata(e){return ox(e).get("remoteDocumentGlobalKey").next(n=>(ge(!!n),n))}rr(e,n){return ox(e).put("remoteDocumentGlobalKey",n)}ir(e,n){if(n){const r=qR(this.serializer,n);if(!(r.isNoDocument()&&r.version.isEqual(_e.min())))return r}return nt.newInvalidDocument(e)}}function aT(t){return new ij(t)}class sj extends oT{constructor(e,n){super(),this.cr=e,this.trackRemovals=n,this.lr=new wi(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const n=[];let r=0,i=new Qe((s,a)=>be(s.canonicalString(),a.canonicalString()));return this.changes.forEach((s,a)=>{const u=this.lr.get(s);if(n.push(this.cr.removeEntry(e,s,u.readTime)),a.isValidDocument()){const h=W0(this.cr.serializer,a);i=i.add(s.path.popLast());const m=qd(h);r+=m-u.size,n.push(this.cr.addEntry(e,s,h))}else if(r-=u.size,this.trackRemovals){const h=W0(this.cr.serializer,a.convertToNoDocument(_e.min()));n.push(this.cr.addEntry(e,s,h))}}),i.forEach(s=>{n.push(this.cr.indexManager.addToCollectionParentIndex(e,s))}),n.push(this.cr.updateMetadata(e,r)),q.waitFor(n)}getFromCache(e,n){return this.cr.sr(e,n).next(r=>(this.lr.set(n,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,n){return this.cr.ar(e,n).next(({documents:r,ur:i})=>(i.forEach((s,a)=>{this.lr.set(s,{size:a,readTime:r.get(s).readTime})}),r))}}function ox(t){return Ot(t,"remoteDocumentGlobal")}function Xs(t){return Ot(t,"remoteDocumentsV14")}function hc(t){const e=t.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function ax(t,e){const n=e.documentKey.path.toArray();return[t,Ud(e.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function lx(t,e){const n=t.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<n.length-2&&s<r.length-2;++s)if(i=be(n[s],r[s]),i)return i;return i=be(n.length,r.length),i||(i=be(n[n.length-2],r[r.length-2]),i||be(n[n.length-1],r[r.length-1]))}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oj{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lT{constructor(e,n,r,i){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,n){let r=null;return this.documentOverlayCache.getOverlay(e,n).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,n))).next(i=>(r!==null&&Mc(r.mutation,i,bn.empty(),ct.now()),i))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.getLocalViewOfDocuments(e,r,Pe()).next(()=>r))}getLocalViewOfDocuments(e,n,r=Pe()){const i=jr();return this.populateOverlays(e,i,n).next(()=>this.computeViews(e,n,i,r).next(s=>{let a=yc();return s.forEach((u,h)=>{a=a.insert(u,h.overlayedDocument)}),a}))}getOverlayedDocuments(e,n){const r=jr();return this.populateOverlays(e,r,n).next(()=>this.computeViews(e,n,r,Pe()))}populateOverlays(e,n,r){const i=[];return r.forEach(s=>{n.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((a,u)=>{n.set(a,u)})})}computeViews(e,n,r,i){let s=En();const a=Lc(),u=function(){return Lc()}();return n.forEach((h,m)=>{const p=r.get(m.key);i.has(m.key)&&(p===void 0||p.mutation instanceof bi)?s=s.insert(m.key,m):p!==void 0?(a.set(m.key,p.mutation.getFieldMask()),Mc(p.mutation,m,p.mutation.getFieldMask(),ct.now())):a.set(m.key,bn.empty())}),this.recalculateAndSaveOverlays(e,s).next(h=>(h.forEach((m,p)=>a.set(m,p)),n.forEach((m,p)=>{var _;return u.set(m,new oj(p,(_=a.get(m))!==null&&_!==void 0?_:null))}),u))}recalculateAndSaveOverlays(e,n){const r=Lc();let i=new Xe((a,u)=>a-u),s=Pe();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next(a=>{for(const u of a)u.keys().forEach(h=>{const m=n.get(h);if(m===null)return;let p=r.get(h)||bn.empty();p=u.applyToLocalView(m,p),r.set(h,p);const _=(i.get(u.batchId)||Pe()).add(h);i=i.insert(u.batchId,_)})}).next(()=>{const a=[],u=i.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),m=h.key,p=h.value,_=TE();p.forEach(v=>{if(!s.has(v)){const x=kE(n.get(v),r.get(v));x!==null&&_.set(v,x),s=s.add(v)}}),a.push(this.documentOverlayCache.saveOverlays(e,m,_))}return q.waitFor(a)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,n,r,i){return function(a){return le.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0}(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):b_(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,r,i):this.getDocumentsMatchingCollectionQuery(e,n,r,i)}getNextDocuments(e,n,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,r,i).next(s=>{const a=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,r.largestBatchId,i-s.size):q.resolve(jr());let u=-1,h=s;return a.next(m=>q.forEach(m,(p,_)=>(u<_.largestBatchId&&(u=_.largestBatchId),s.get(p)?q.resolve():this.remoteDocumentCache.getEntry(e,p).next(v=>{h=h.insert(p,v)}))).next(()=>this.populateOverlays(e,m,s)).next(()=>this.computeViews(e,h,m,Pe())).next(p=>({batchId:u,changes:EE(p)})))})}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new le(n)).next(r=>{let i=yc();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,n,r,i){const s=n.collectionGroup;let a=yc();return this.indexManager.getCollectionParents(e,s).next(u=>q.forEach(u,h=>{const m=function(_,v){return new xi(v,null,_.explicitOrderBy.slice(),_.filters.slice(),_.limit,_.limitType,_.startAt,_.endAt)}(n,h.child(s));return this.getDocumentsMatchingCollectionQuery(e,m,r,i).next(p=>{p.forEach((_,v)=>{a=a.insert(_,v)})})}).next(()=>a))}getDocumentsMatchingCollectionQuery(e,n,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,r.largestBatchId).next(a=>(s=a,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,r,s,i))).next(a=>{s.forEach((h,m)=>{const p=m.getKey();a.get(p)===null&&(a=a.insert(p,nt.newInvalidDocument(p)))});let u=yc();return a.forEach((h,m)=>{const p=s.get(h);p!==void 0&&Mc(p.mutation,m,bn.empty(),ct.now()),Nu(n,m)&&(u=u.insert(h,m))}),u})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class aj{constructor(e){this.serializer=e,this.hr=new Map,this.Pr=new Map}getBundleMetadata(e,n){return q.resolve(this.hr.get(n))}saveBundleMetadata(e,n){return this.hr.set(n.id,function(i){return{id:i.id,version:i.version,createTime:St(i.createTime)}}(n)),q.resolve()}getNamedQuery(e,n){return q.resolve(this.Pr.get(n))}saveNamedQuery(e,n){return this.Pr.set(n.name,function(i){return{name:i.name,query:k_(i.bundledQuery),readTime:St(i.readTime)}}(n)),q.resolve()}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lj{constructor(){this.overlays=new Xe(le.comparator),this.Ir=new Map}getOverlay(e,n){return q.resolve(this.overlays.get(n))}getOverlays(e,n){const r=jr();return q.forEach(n,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,n,r){return r.forEach((i,s)=>{this.ht(e,n,s)}),q.resolve()}removeOverlaysForBatchId(e,n,r){const i=this.Ir.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.Ir.delete(r)),q.resolve()}getOverlaysForCollection(e,n,r){const i=jr(),s=n.length+1,a=new le(n.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const h=u.getNext().value,m=h.getKey();if(!n.isPrefixOf(m.path))break;m.path.length===s&&h.largestBatchId>r&&i.set(h.getKey(),h)}return q.resolve(i)}getOverlaysForCollectionGroup(e,n,r,i){let s=new Xe((m,p)=>m-p);const a=this.overlays.getIterator();for(;a.hasNext();){const m=a.getNext().value;if(m.getKey().getCollectionGroup()===n&&m.largestBatchId>r){let p=s.get(m.largestBatchId);p===null&&(p=jr(),s=s.insert(m.largestBatchId,p)),p.set(m.getKey(),m)}}const u=jr(),h=s.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach((m,p)=>u.set(m,p)),!(u.size()>=i)););return q.resolve(u)}ht(e,n,r){const i=this.overlays.get(r.key);if(i!==null){const a=this.Ir.get(i.largestBatchId).delete(r.key);this.Ir.set(i.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new P_(n,r));let s=this.Ir.get(n);s===void 0&&(s=Pe(),this.Ir.set(n,s)),this.Ir.set(n,s.add(r.key))}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cj{constructor(){this.sessionToken=yt.EMPTY_BYTE_STRING}getSessionToken(e){return q.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,q.resolve()}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class D_{constructor(){this.Tr=new Qe(Bt.Er),this.dr=new Qe(Bt.Ar)}isEmpty(){return this.Tr.isEmpty()}addReference(e,n){const r=new Bt(e,n);this.Tr=this.Tr.add(r),this.dr=this.dr.add(r)}Rr(e,n){e.forEach(r=>this.addReference(r,n))}removeReference(e,n){this.Vr(new Bt(e,n))}mr(e,n){e.forEach(r=>this.removeReference(r,n))}gr(e){const n=new le(new De([])),r=new Bt(n,e),i=new Bt(n,e+1),s=[];return this.dr.forEachInRange([r,i],a=>{this.Vr(a),s.push(a.key)}),s}pr(){this.Tr.forEach(e=>this.Vr(e))}Vr(e){this.Tr=this.Tr.delete(e),this.dr=this.dr.delete(e)}yr(e){const n=new le(new De([])),r=new Bt(n,e),i=new Bt(n,e+1);let s=Pe();return this.dr.forEachInRange([r,i],a=>{s=s.add(a.key)}),s}containsKey(e){const n=new Bt(e,0),r=this.Tr.firstAfterOrEqual(n);return r!==null&&e.isEqual(r.key)}}class Bt{constructor(e,n){this.key=e,this.wr=n}static Er(e,n){return le.comparator(e.key,n.key)||be(e.wr,n.wr)}static Ar(e,n){return be(e.wr,n.wr)||le.comparator(e.key,n.key)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uj{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.Sr=1,this.br=new Qe(Bt.Er)}checkEmpty(e){return q.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,r,i){const s=this.Sr;this.Sr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new S_(s,n,r,i);this.mutationQueue.push(a);for(const u of i)this.br=this.br.add(new Bt(u.key,s)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast());return q.resolve(a)}lookupMutationBatch(e,n){return q.resolve(this.Dr(n))}getNextMutationBatchAfterBatchId(e,n){const r=n+1,i=this.vr(r),s=i<0?0:i;return q.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return q.resolve(this.mutationQueue.length===0?-1:this.Sr-1)}getAllMutationBatches(e){return q.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const r=new Bt(n,0),i=new Bt(n,Number.POSITIVE_INFINITY),s=[];return this.br.forEachInRange([r,i],a=>{const u=this.Dr(a.wr);s.push(u)}),q.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,n){let r=new Qe(be);return n.forEach(i=>{const s=new Bt(i,0),a=new Bt(i,Number.POSITIVE_INFINITY);this.br.forEachInRange([s,a],u=>{r=r.add(u.wr)})}),q.resolve(this.Cr(r))}getAllMutationBatchesAffectingQuery(e,n){const r=n.path,i=r.length+1;let s=r;le.isDocumentKey(s)||(s=s.child(""));const a=new Bt(new le(s),0);let u=new Qe(be);return this.br.forEachWhile(h=>{const m=h.key.path;return!!r.isPrefixOf(m)&&(m.length===i&&(u=u.add(h.wr)),!0)},a),q.resolve(this.Cr(u))}Cr(e){const n=[];return e.forEach(r=>{const i=this.Dr(r);i!==null&&n.push(i)}),n}removeMutationBatch(e,n){ge(this.Fr(n.batchId,"removed")===0),this.mutationQueue.shift();let r=this.br;return q.forEach(n.mutations,i=>{const s=new Bt(i.key,n.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.br=r})}On(e){}containsKey(e,n){const r=new Bt(n,0),i=this.br.firstAfterOrEqual(r);return q.resolve(n.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,q.resolve()}Fr(e,n){return this.vr(e)}vr(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Dr(e){const n=this.vr(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hj{constructor(e){this.Mr=e,this.docs=function(){return new Xe(le.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const r=n.key,i=this.docs.get(r),s=i?i.size:0,a=this.Mr(n);return this.docs=this.docs.insert(r,{document:n.mutableCopy(),size:a}),this.size+=a-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const r=this.docs.get(n);return q.resolve(r?r.document.mutableCopy():nt.newInvalidDocument(n))}getEntries(e,n){let r=En();return n.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():nt.newInvalidDocument(i))}),q.resolve(r)}getDocumentsMatchingQuery(e,n,r,i){let s=En();const a=n.path,u=new le(a.child("")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:m,value:{document:p}}=h.getNext();if(!a.isPrefixOf(m.path))break;m.path.length>a.length+1||v_(Kb(p),r)<=0||(i.has(p.key)||Nu(n,p))&&(s=s.insert(p.key,p.mutableCopy()))}return q.resolve(s)}getAllFromCollectionGroup(e,n,r,i){de()}Or(e,n){return q.forEach(this.docs,r=>n(r))}newChangeBuffer(e){return new dj(this)}getSize(e){return q.resolve(this.size)}}class dj extends oT{constructor(e){super(),this.cr=e}applyChanges(e){const n=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?n.push(this.cr.addEntry(e,i)):this.cr.removeEntry(r)}),q.waitFor(n)}getFromCache(e,n){return this.cr.getEntry(e,n)}getAllFromCache(e,n){return this.cr.getEntries(e,n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fj{constructor(e){this.persistence=e,this.Nr=new wi(n=>So(n),Cu),this.lastRemoteSnapshotVersion=_e.min(),this.highestTargetId=0,this.Lr=0,this.Br=new D_,this.targetCount=0,this.kr=ko.Bn()}forEachTarget(e,n){return this.Nr.forEach((r,i)=>n(i)),q.resolve()}getLastRemoteSnapshotVersion(e){return q.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return q.resolve(this.Lr)}allocateTargetId(e){return this.highestTargetId=this.kr.next(),q.resolve(this.highestTargetId)}setTargetsMetadata(e,n,r){return r&&(this.lastRemoteSnapshotVersion=r),n>this.Lr&&(this.Lr=n),q.resolve()}Kn(e){this.Nr.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.kr=new ko(n),this.highestTargetId=n),e.sequenceNumber>this.Lr&&(this.Lr=e.sequenceNumber)}addTargetData(e,n){return this.Kn(n),this.targetCount+=1,q.resolve()}updateTargetData(e,n){return this.Kn(n),q.resolve()}removeTargetData(e,n){return this.Nr.delete(n.target),this.Br.gr(n.targetId),this.targetCount-=1,q.resolve()}removeTargets(e,n,r){let i=0;const s=[];return this.Nr.forEach((a,u)=>{u.sequenceNumber<=n&&r.get(u.targetId)===null&&(this.Nr.delete(a),s.push(this.removeMatchingKeysForTargetId(e,u.targetId)),i++)}),q.waitFor(s).next(()=>i)}getTargetCount(e){return q.resolve(this.targetCount)}getTargetData(e,n){const r=this.Nr.get(n)||null;return q.resolve(r)}addMatchingKeys(e,n,r){return this.Br.Rr(n,r),q.resolve()}removeMatchingKeys(e,n,r){this.Br.mr(n,r);const i=this.persistence.referenceDelegate,s=[];return i&&n.forEach(a=>{s.push(i.markPotentiallyOrphaned(e,a))}),q.waitFor(s)}removeMatchingKeysForTargetId(e,n){return this.Br.gr(n),q.resolve()}getMatchingKeysForTargetId(e,n){const r=this.Br.yr(n);return q.resolve(r)}containsKey(e,n){return q.resolve(this.Br.containsKey(n))}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class L_{constructor(e,n){this.qr={},this.overlays={},this.Qr=new wn(0),this.Kr=!1,this.Kr=!0,this.$r=new cj,this.referenceDelegate=e(this),this.Ur=new fj(this),this.indexManager=new YR,this.remoteDocumentCache=function(i){return new hj(i)}(r=>this.referenceDelegate.Wr(r)),this.serializer=new JE(n),this.Gr=new aj(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.Kr=!1,Promise.resolve()}get started(){return this.Kr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new lj,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let r=this.qr[e.toKey()];return r||(r=new uj(n,this.referenceDelegate),this.qr[e.toKey()]=r),r}getGlobalsCache(){return this.$r}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Gr}runTransaction(e,n,r){ee("MemoryPersistence","Starting transaction:",e);const i=new mj(this.Qr.next());return this.referenceDelegate.zr(),r(i).next(s=>this.referenceDelegate.jr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Hr(e,n){return q.or(Object.values(this.qr).map(r=>()=>r.containsKey(e,n)))}}class mj extends Zb{constructor(e){super(),this.currentSequenceNumber=e}}class jf{constructor(e){this.persistence=e,this.Jr=new D_,this.Yr=null}static Zr(e){return new jf(e)}get Xr(){if(this.Yr)return this.Yr;throw de()}addReference(e,n,r){return this.Jr.addReference(r,n),this.Xr.delete(r.toString()),q.resolve()}removeReference(e,n,r){return this.Jr.removeReference(r,n),this.Xr.add(r.toString()),q.resolve()}markPotentiallyOrphaned(e,n){return this.Xr.add(n.toString()),q.resolve()}removeTarget(e,n){this.Jr.gr(n.targetId).forEach(i=>this.Xr.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,n.targetId).next(i=>{i.forEach(s=>this.Xr.add(s.toString()))}).next(()=>r.removeTargetData(e,n))}zr(){this.Yr=new Set}jr(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return q.forEach(this.Xr,r=>{const i=le.fromPath(r);return this.ei(e,i).next(s=>{s||n.removeEntry(i,_e.min())})}).next(()=>(this.Yr=null,n.apply(e)))}updateLimboDocument(e,n){return this.ei(e,n).next(r=>{r?this.Xr.delete(n.toString()):this.Xr.add(n.toString())})}Wr(e){return 0}ei(e,n){return q.or([()=>q.resolve(this.Jr.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Hr(e,n)])}}class Gd{constructor(e,n){this.persistence=e,this.ti=new wi(r=>cn(r.path),(r,i)=>r.isEqual(i)),this.garbageCollector=sT(this,n)}static Zr(e,n){return new Gd(e,n)}zr(){}jr(e){return q.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}Yn(e){const n=this.er(e);return this.persistence.getTargetCache().getTargetCount(e).next(r=>n.next(i=>r+i))}er(e){let n=0;return this.Zn(e,r=>{n++}).next(()=>n)}Zn(e,n){return q.forEach(this.ti,(r,i)=>this.nr(e,r,i).next(s=>s?q.resolve():n(i)))}removeTargets(e,n,r){return this.persistence.getTargetCache().removeTargets(e,n,r)}removeOrphanedDocuments(e,n){let r=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.Or(e,a=>this.nr(e,a,n).next(u=>{u||(r++,s.removeEntry(a,_e.min()))})).next(()=>s.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,n){return this.ti.set(n,e.currentSequenceNumber),q.resolve()}removeTarget(e,n){const r=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,n,r){return this.ti.set(r,e.currentSequenceNumber),q.resolve()}removeReference(e,n,r){return this.ti.set(r,e.currentSequenceNumber),q.resolve()}updateLimboDocument(e,n){return this.ti.set(n,e.currentSequenceNumber),q.resolve()}Wr(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=nd(e.data.value)),n}nr(e,n,r){return q.or([()=>this.persistence.Hr(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const i=this.ti.get(n);return q.resolve(i!==void 0&&i>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pj{constructor(e){this.serializer=e}O(e,n,r,i){const s=new Tf("createOrUpgrade",n);r<1&&i>=1&&(function(h){h.createObjectStore("owner")}(e),function(h){h.createObjectStore("mutationQueues",{keyPath:"userId"}),h.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",b0,{unique:!0}),h.createObjectStore("documentMutations")}(e),cx(e),function(h){h.createObjectStore("remoteDocuments")}(e));let a=q.resolve();return r<3&&i>=3&&(r!==0&&(function(h){h.deleteObjectStore("targetDocuments"),h.deleteObjectStore("targets"),h.deleteObjectStore("targetGlobal")}(e),cx(e)),a=a.next(()=>function(h){const m=h.store("targetGlobal"),p={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:_e.min().toTimestamp(),targetCount:0};return m.put("targetGlobalKey",p)}(s))),r<4&&i>=4&&(r!==0&&(a=a.next(()=>function(h,m){return m.store("mutations").U().next(p=>{h.deleteObjectStore("mutations"),h.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",b0,{unique:!0});const _=m.store("mutations"),v=p.map(x=>_.put(x));return q.waitFor(v)})}(e,s))),a=a.next(()=>{(function(h){h.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(a=a.next(()=>this.ni(s))),r<6&&i>=6&&(a=a.next(()=>(function(h){h.createObjectStore("remoteDocumentGlobal")}(e),this.ri(s)))),r<7&&i>=7&&(a=a.next(()=>this.ii(s))),r<8&&i>=8&&(a=a.next(()=>this.si(e,s))),r<9&&i>=9&&(a=a.next(()=>{(function(h){h.objectStoreNames.contains("remoteDocumentChanges")&&h.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(a=a.next(()=>this.oi(s))),r<11&&i>=11&&(a=a.next(()=>{(function(h){h.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(h){h.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(a=a.next(()=>{(function(h){const m=h.createObjectStore("documentOverlays",{keyPath:Xk});m.createIndex("collectionPathOverlayIndex",eR,{unique:!1}),m.createIndex("collectionGroupOverlayIndex",tR,{unique:!1})})(e)})),r<13&&i>=13&&(a=a.next(()=>function(h){const m=h.createObjectStore("remoteDocumentsV14",{keyPath:Uk});m.createIndex("documentKeyIndex",$k),m.createIndex("collectionGroupIndex",qk)}(e)).next(()=>this._i(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(a=a.next(()=>this.ai(e,s))),r<15&&i>=15&&(a=a.next(()=>function(h){h.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),h.createObjectStore("indexState",{keyPath:Qk}).createIndex("sequenceNumberIndex",Zk,{unique:!1}),h.createObjectStore("indexEntries",{keyPath:Jk}).createIndex("documentKeyIndex",Yk,{unique:!1})}(e))),r<16&&i>=16&&(a=a.next(()=>{n.objectStore("indexState").clear()}).next(()=>{n.objectStore("indexEntries").clear()})),r<17&&i>=17&&(a=a.next(()=>{(function(h){h.createObjectStore("globals",{keyPath:"name"})})(e)})),a}ri(e){let n=0;return e.store("remoteDocuments").J((r,i)=>{n+=qd(i)}).next(()=>{const r={byteSize:n};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}ni(e){const n=e.store("mutationQueues"),r=e.store("mutations");return n.U().next(i=>q.forEach(i,s=>{const a=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.U("userMutationsIndex",a).next(u=>q.forEach(u,h=>{ge(h.userId===s.userId);const m=so(this.serializer,h);return tT(e,s.userId,m).next(()=>{})}))}))}ii(e){const n=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.J((a,u)=>{const h=new De(a),m=function(_){return[0,cn(_)]}(h);s.push(n.get(m).next(p=>p?q.resolve():(_=>n.put({targetId:0,path:cn(_),sequenceNumber:i.highestListenSequenceNumber}))(h)))}).next(()=>q.waitFor(s))})}si(e,n){e.createObjectStore("collectionParents",{keyPath:Kk});const r=n.store("collectionParents"),i=new j_,s=a=>{if(i.add(a)){const u=a.lastSegment(),h=a.popLast();return r.put({collectionId:u,parent:cn(h)})}};return n.store("remoteDocuments").J({H:!0},(a,u)=>{const h=new De(a);return s(h.popLast())}).next(()=>n.store("documentMutations").J({H:!0},([a,u,h],m)=>{const p=Rr(u);return s(p.popLast())}))}oi(e){const n=e.store("targets");return n.J((r,i)=>{const s=wc(i),a=YE(this.serializer,s);return n.put(a)})}_i(e,n){const r=n.store("remoteDocuments"),i=[];return r.J((s,a)=>{const u=n.store("remoteDocumentsV14"),h=function(_){return _.document?new le(De.fromString(_.document.name).popFirst(5)):_.noDocument?le.fromSegments(_.noDocument.path):_.unknownDocument?le.fromSegments(_.unknownDocument.path):de()}(a).path.toArray(),m={prefixPath:h.slice(0,h.length-2),collectionGroup:h[h.length-2],documentId:h[h.length-1],readTime:a.readTime||[0,0],unknownDocument:a.unknownDocument,noDocument:a.noDocument,document:a.document,hasCommittedMutations:!!a.hasCommittedMutations};i.push(u.put(m))}).next(()=>q.waitFor(i))}ai(e,n){const r=n.store("mutations"),i=aT(this.serializer),s=new L_(jf.Zr,this.serializer.ct);return r.U().next(a=>{const u=new Map;return a.forEach(h=>{var m;let p=(m=u.get(h.userId))!==null&&m!==void 0?m:Pe();so(this.serializer,h).keys().forEach(_=>p=p.add(_)),u.set(h.userId,p)}),q.forEach(u,(h,m)=>{const p=new $t(m),_=kf.lt(this.serializer,p),v=s.getIndexManager(p),x=Rf.lt(p,this.serializer,v,s.referenceDelegate);return new lT(i,x,_,v).recalculateAndSaveOverlaysForDocumentKeys(new Kp(n,wn.oe),h).next()})})}}function cx(t){t.createObjectStore("targetDocuments",{keyPath:Wk}).createIndex("documentTargetsIndex",Hk,{unique:!0}),t.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Gk,{unique:!0}),t.createObjectStore("targetGlobal")}const Vm="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class M_{constructor(e,n,r,i,s,a,u,h,m,p,_=17){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.ui=s,this.window=a,this.document=u,this.ci=m,this.li=p,this.hi=_,this.Qr=null,this.Kr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Pi=null,this.inForeground=!1,this.Ii=null,this.Ti=null,this.Ei=Number.NEGATIVE_INFINITY,this.di=v=>Promise.resolve(),!M_.D())throw new te(H.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new rj(this,i),this.Ai=n+"main",this.serializer=new JE(h),this.Ri=new Mr(this.Ai,this.hi,new pj(this.serializer)),this.$r=new WR,this.Ur=new ej(this.referenceDelegate,this.serializer),this.remoteDocumentCache=aT(this.serializer),this.Gr=new GR,this.window&&this.window.localStorage?this.Vi=this.window.localStorage:(this.Vi=null,p===!1&&Tt("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.mi().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new te(H.FAILED_PRECONDITION,Vm);return this.fi(),this.gi(),this.pi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Ur.getHighestSequenceNumber(e))}).then(e=>{this.Qr=new wn(e,this.ci)}).then(()=>{this.Kr=!0}).catch(e=>(this.Ri&&this.Ri.close(),Promise.reject(e)))}yi(e){return this.di=async n=>{if(this.started)return e(n)},e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ri.L(async n=>{n.newVersion===null&&await e()})}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.ui.enqueueAndForget(async()=>{this.started&&await this.mi()}))}mi(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Oh(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.wi(e).next(n=>{n||(this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)))})}).next(()=>this.Si(e)).next(n=>this.isPrimary&&!n?this.bi(e).next(()=>!1):!!n&&this.Di(e).next(()=>!0))).catch(e=>{if(Ms(e))return ee("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return ee("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.ui.enqueueRetryable(()=>this.di(e)),this.isPrimary=e})}wi(e){return dc(e).get("owner").next(n=>q.resolve(this.vi(n)))}Ci(e){return Oh(e).delete(this.clientId)}async Fi(){if(this.isPrimary&&!this.Mi(this.Ei,18e5)){this.Ei=Date.now();const e=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",n=>{const r=Ot(n,"clientMetadata");return r.U().next(i=>{const s=this.xi(i,18e5),a=i.filter(u=>s.indexOf(u)===-1);return q.forEach(a,u=>r.delete(u.clientId)).next(()=>a)})}).catch(()=>[]);if(this.Vi)for(const n of e)this.Vi.removeItem(this.Oi(n.clientId))}}pi(){this.Ti=this.ui.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.mi().then(()=>this.Fi()).then(()=>this.pi()))}vi(e){return!!e&&e.ownerId===this.clientId}Si(e){return this.li?q.resolve(!0):dc(e).get("owner").next(n=>{if(n!==null&&this.Mi(n.leaseTimestampMs,5e3)&&!this.Ni(n.ownerId)){if(this.vi(n)&&this.networkEnabled)return!0;if(!this.vi(n)){if(!n.allowTabSynchronization)throw new te(H.FAILED_PRECONDITION,Vm);return!1}}return!(!this.networkEnabled||!this.inForeground)||Oh(e).U().next(r=>this.xi(r,5e3).find(i=>{if(this.clientId!==i.clientId){const s=!this.networkEnabled&&i.networkEnabled,a=!this.inForeground&&i.inForeground,u=this.networkEnabled===i.networkEnabled;if(s||a&&u)return!0}return!1})===void 0)}).next(n=>(this.isPrimary!==n&&ee("IndexedDbPersistence",`Client ${n?"is":"is not"} eligible for a primary lease.`),n))}async shutdown(){this.Kr=!1,this.Li(),this.Ti&&(this.Ti.cancel(),this.Ti=null),this.Bi(),this.ki(),await this.Ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{const n=new Kp(e,wn.oe);return this.bi(n).next(()=>this.Ci(n))}),this.Ri.close(),this.qi()}xi(e,n){return e.filter(r=>this.Mi(r.updateTimeMs,n)&&!this.Ni(r.clientId))}Qi(){return this.runTransaction("getActiveClients","readonly",e=>Oh(e).U().next(n=>this.xi(n,18e5).map(r=>r.clientId)))}get started(){return this.Kr}getGlobalsCache(){return this.$r}getMutationQueue(e,n){return Rf.lt(e,this.serializer,n,this.referenceDelegate)}getTargetCache(){return this.Ur}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new XR(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return kf.lt(this.serializer,e)}getBundleCache(){return this.Gr}runTransaction(e,n,r){ee("IndexedDbPersistence","Starting transaction:",e);const i=n==="readonly"?"readonly":"readwrite",s=function(h){return h===17?iR:h===16?rR:h===15?x_:h===14?nE:h===13?tE:h===12?nR:h===11?eE:void de()}(this.hi);let a;return this.Ri.runTransaction(e,i,s,u=>(a=new Kp(u,this.Qr?this.Qr.next():wn.oe),n==="readwrite-primary"?this.wi(a).next(h=>!!h||this.Si(a)).next(h=>{if(!h)throw Tt(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.ui.enqueueRetryable(()=>this.di(!1)),new te(H.FAILED_PRECONDITION,Qb);return r(a)}).next(h=>this.Di(a).next(()=>h)):this.Ki(a).next(()=>r(a)))).then(u=>(a.raiseOnCommittedEvent(),u))}Ki(e){return dc(e).get("owner").next(n=>{if(n!==null&&this.Mi(n.leaseTimestampMs,5e3)&&!this.Ni(n.ownerId)&&!this.vi(n)&&!(this.li||this.allowTabSynchronization&&n.allowTabSynchronization))throw new te(H.FAILED_PRECONDITION,Vm)})}Di(e){const n={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return dc(e).put("owner",n)}static D(){return Mr.D()}bi(e){const n=dc(e);return n.get("owner").next(r=>this.vi(r)?(ee("IndexedDbPersistence","Releasing primary lease."),n.delete("owner")):q.resolve())}Mi(e,n){const r=Date.now();return!(e<r-n)&&(!(e>r)||(Tt(`Detected an update time that is in the future: ${e} > ${r}`),!1))}fi(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.Ii=()=>{this.ui.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.mi()))},this.document.addEventListener("visibilitychange",this.Ii),this.inForeground=this.document.visibilityState==="visible")}Bi(){this.Ii&&(this.document.removeEventListener("visibilitychange",this.Ii),this.Ii=null)}gi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.Pi=()=>{this.Li();const n=/(?:Version|Mobile)\/1[456]/;Sb()&&(navigator.appVersion.match(n)||navigator.userAgent.match(n))&&this.ui.enterRestrictedMode(!0),this.ui.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Pi))}ki(){this.Pi&&(this.window.removeEventListener("pagehide",this.Pi),this.Pi=null)}Ni(e){var n;try{const r=((n=this.Vi)===null||n===void 0?void 0:n.getItem(this.Oi(e)))!==null;return ee("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Tt("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Li(){if(this.Vi)try{this.Vi.setItem(this.Oi(this.clientId),String(Date.now()))}catch(e){Tt("Failed to set zombie client id.",e)}}qi(){if(this.Vi)try{this.Vi.removeItem(this.Oi(this.clientId))}catch{}}Oi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function dc(t){return Ot(t,"owner")}function Oh(t){return Ot(t,"clientMetadata")}function V_(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class O_{constructor(e,n,r,i){this.targetId=e,this.fromCache=n,this.$i=r,this.Ui=i}static Wi(e,n){let r=Pe(),i=Pe();for(const s of n.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new O_(e,n.fromCache,r,i)}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gj{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cT{constructor(){this.Gi=!1,this.zi=!1,this.ji=100,this.Hi=function(){return Sb()?8:Jb(Ga())>0?6:4}()}initialize(e,n){this.Ji=e,this.indexManager=n,this.Gi=!0}getDocumentsMatchingQuery(e,n,r,i){const s={result:null};return this.Yi(e,n).next(a=>{s.result=a}).next(()=>{if(!s.result)return this.Zi(e,n,i,r).next(a=>{s.result=a})}).next(()=>{if(s.result)return;const a=new gj;return this.Xi(e,n,a).next(u=>{if(s.result=u,this.zi)return this.es(e,n,a,u.size)})}).next(()=>s.result)}es(e,n,r,i){return r.documentReadCount<this.ji?(ua()<=ze.DEBUG&&ee("QueryEngine","SDK will not create cache indexes for query:",ha(n),"since it only creates cache indexes for collection contains","more than or equal to",this.ji,"documents"),q.resolve()):(ua()<=ze.DEBUG&&ee("QueryEngine","Query:",ha(n),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Hi*i?(ua()<=ze.DEBUG&&ee("QueryEngine","The SDK decides to create cache indexes for query:",ha(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,un(n))):q.resolve())}Yi(e,n){if(L0(n))return q.resolve(null);let r=un(n);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(n.limit!==null&&i===1&&(n=zd(n,null,"F"),r=un(n)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const a=Pe(...s);return this.Ji.getDocuments(e,a).next(u=>this.indexManager.getMinOffset(e,r).next(h=>{const m=this.ts(n,u);return this.ns(n,m,a,h.readTime)?this.Yi(e,zd(n,null,"F")):this.rs(e,m,n,h)}))})))}Zi(e,n,r,i){return L0(n)||i.isEqual(_e.min())?q.resolve(null):this.Ji.getDocuments(e,r).next(s=>{const a=this.ts(n,s);return this.ns(n,a,r,i)?q.resolve(null):(ua()<=ze.DEBUG&&ee("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ha(n)),this.rs(e,a,n,Hb(i,-1)).next(u=>u))})}ts(e,n){let r=new Qe(wE(e));return n.forEach((i,s)=>{Nu(e,s)&&(r=r.add(s))}),r}ns(e,n,r,i){if(e.limit===null)return!1;if(r.size!==n.size)return!0;const s=e.limitType==="F"?n.last():n.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Xi(e,n,r){return ua()<=ze.DEBUG&&ee("QueryEngine","Using full collection scan to execute query:",ha(n)),this.Ji.getDocumentsMatchingQuery(e,n,Dn.min(),r)}rs(e,n,r,i){return this.Ji.getDocumentsMatchingQuery(e,r,i).next(s=>(n.forEach(a=>{s=s.insert(a.key,a)}),s))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _j{constructor(e,n,r,i){this.persistence=e,this.ss=n,this.serializer=i,this.os=new Xe(be),this._s=new wi(s=>So(s),Cu),this.us=new Map,this.cs=e.getRemoteDocumentCache(),this.Ur=e.getTargetCache(),this.Gr=e.getBundleCache(),this.ls(r)}ls(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new lT(this.cs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.cs.setIndexManager(this.indexManager),this.ss.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",n=>e.collect(n,this.os))}}function uT(t,e,n,r){return new _j(t,e,n,r)}async function hT(t,e){const n=oe(t);return await n.persistence.runTransaction("Handle user change","readonly",r=>{let i;return n.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,n.ls(e),n.mutationQueue.getAllMutationBatches(r))).next(s=>{const a=[],u=[];let h=Pe();for(const m of i){a.push(m.batchId);for(const p of m.mutations)h=h.add(p.key)}for(const m of s){u.push(m.batchId);for(const p of m.mutations)h=h.add(p.key)}return n.localDocuments.getDocuments(r,h).next(m=>({hs:m,removedBatchIds:a,addedBatchIds:u}))})})}function vj(t,e){const n=oe(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=n.cs.newChangeBuffer({trackRemovals:!0});return function(u,h,m,p){const _=m.batch,v=_.keys();let x=q.resolve();return v.forEach(T=>{x=x.next(()=>p.getEntry(h,T)).next(E=>{const R=m.docVersions.get(T);ge(R!==null),E.version.compareTo(R)<0&&(_.applyToRemoteDocument(E,m),E.isValidDocument()&&(E.setReadTime(m.commitVersion),p.addEntry(E)))})}),x.next(()=>u.mutationQueue.removeMutationBatch(h,_))}(n,r,e,s).next(()=>s.apply(r)).next(()=>n.mutationQueue.performConsistencyCheck(r)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(u){let h=Pe();for(let m=0;m<u.mutationResults.length;++m)u.mutationResults[m].transformResults.length>0&&(h=h.add(u.batch.mutations[m].key));return h}(e))).next(()=>n.localDocuments.getDocuments(r,i))})}function dT(t){const e=oe(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",n=>e.Ur.getLastRemoteSnapshotVersion(n))}function yj(t,e){const n=oe(t),r=e.snapshotVersion;let i=n.os;return n.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const a=n.cs.newChangeBuffer({trackRemovals:!0});i=n.os;const u=[];e.targetChanges.forEach((p,_)=>{const v=i.get(_);if(!v)return;u.push(n.Ur.removeMatchingKeys(s,p.removedDocuments,_).next(()=>n.Ur.addMatchingKeys(s,p.addedDocuments,_)));let x=v.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(_)!==null?x=x.withResumeToken(yt.EMPTY_BYTE_STRING,_e.min()).withLastLimboFreeSnapshotVersion(_e.min()):p.resumeToken.approximateByteSize()>0&&(x=x.withResumeToken(p.resumeToken,r)),i=i.insert(_,x),function(E,R,S){return E.resumeToken.approximateByteSize()===0||R.snapshotVersion.toMicroseconds()-E.snapshotVersion.toMicroseconds()>=3e8?!0:S.addedDocuments.size+S.modifiedDocuments.size+S.removedDocuments.size>0}(v,x,p)&&u.push(n.Ur.updateTargetData(s,x))});let h=En(),m=Pe();if(e.documentUpdates.forEach(p=>{e.resolvedLimboDocuments.has(p)&&u.push(n.persistence.referenceDelegate.updateLimboDocument(s,p))}),u.push(fT(s,a,e.documentUpdates).next(p=>{h=p.Ps,m=p.Is})),!r.isEqual(_e.min())){const p=n.Ur.getLastRemoteSnapshotVersion(s).next(_=>n.Ur.setTargetsMetadata(s,s.currentSequenceNumber,r));u.push(p)}return q.waitFor(u).next(()=>a.apply(s)).next(()=>n.localDocuments.getLocalViewOfDocuments(s,h,m)).next(()=>h)}).then(s=>(n.os=i,s))}function fT(t,e,n){let r=Pe(),i=Pe();return n.forEach(s=>r=r.add(s)),e.getEntries(t,r).next(s=>{let a=En();return n.forEach((u,h)=>{const m=s.get(u);h.isFoundDocument()!==m.isFoundDocument()&&(i=i.add(u)),h.isNoDocument()&&h.version.isEqual(_e.min())?(e.removeEntry(u,h.readTime),a=a.insert(u,h)):!m.isValidDocument()||h.version.compareTo(m.version)>0||h.version.compareTo(m.version)===0&&m.hasPendingWrites?(e.addEntry(h),a=a.insert(u,h)):ee("LocalStore","Ignoring outdated watch update for ",u,". Current version:",m.version," Watch version:",h.version)}),{Ps:a,Is:i}})}function xj(t,e){const n=oe(t);return n.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function el(t,e){const n=oe(t);return n.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return n.Ur.getTargetData(r,e).next(s=>s?(i=s,q.resolve(i)):n.Ur.allocateTargetId(r).next(a=>(i=new li(e,a,"TargetPurposeListen",r.currentSequenceNumber),n.Ur.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=n.os.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.os=n.os.insert(r.targetId,r),n._s.set(e,r.targetId)),r})}async function tl(t,e,n){const r=oe(t),i=r.os.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,a=>r.persistence.referenceDelegate.removeTarget(a,i))}catch(a){if(!Ms(a))throw a;ee("LocalStore",`Failed to update sequence numbers for target ${e}: ${a}`)}r.os=r.os.remove(e),r._s.delete(i.target)}function Wd(t,e,n){const r=oe(t);let i=_e.min(),s=Pe();return r.persistence.runTransaction("Execute query","readwrite",a=>function(h,m,p){const _=oe(h),v=_._s.get(p);return v!==void 0?q.resolve(_.os.get(v)):_.Ur.getTargetData(m,p)}(r,a,un(e)).next(u=>{if(u)return i=u.lastLimboFreeSnapshotVersion,r.Ur.getMatchingKeysForTargetId(a,u.targetId).next(h=>{s=h})}).next(()=>r.ss.getDocumentsMatchingQuery(a,e,n?i:_e.min(),n?s:Pe())).next(u=>(gT(r,xE(e),u),{documents:u,Ts:s})))}function mT(t,e){const n=oe(t),r=oe(n.Ur),i=n.os.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",s=>r.ot(s,e).next(a=>a?a.target:null))}function pT(t,e){const n=oe(t),r=n.us.get(e)||_e.min();return n.persistence.runTransaction("Get new document changes","readonly",i=>n.cs.getAllFromCollectionGroup(i,e,Hb(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(gT(n,e,i),i))}function gT(t,e,n){let r=t.us.get(e)||_e.min();n.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),t.us.set(e,r)}async function wj(t,e,n,r){const i=oe(t);let s=Pe(),a=En();for(const m of n){const p=e.Es(m.metadata.name);m.document&&(s=s.add(p));const _=e.ds(m);_.setReadTime(e.As(m.metadata.readTime)),a=a.insert(p,_)}const u=i.cs.newChangeBuffer({trackRemovals:!0}),h=await el(i,function(p){return un(_l(De.fromString(`__bundle__/docs/${p}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",m=>fT(m,u,a).next(p=>(u.apply(m),p)).next(p=>i.Ur.removeMatchingKeysForTargetId(m,h.targetId).next(()=>i.Ur.addMatchingKeys(m,s,h.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(m,p.Ps,p.Is)).next(()=>p.Ps)))}async function bj(t,e,n=Pe()){const r=await el(t,un(k_(e.bundledQuery))),i=oe(t);return i.persistence.runTransaction("Save named query","readwrite",s=>{const a=St(e.readTime);if(r.snapshotVersion.compareTo(a)>=0)return i.Gr.saveNamedQuery(s,e);const u=r.withResumeToken(yt.EMPTY_BYTE_STRING,a);return i.os=i.os.insert(u.targetId,u),i.Ur.updateTargetData(s,u).next(()=>i.Ur.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.Ur.addMatchingKeys(s,n,r.targetId)).next(()=>i.Gr.saveNamedQuery(s,e))})}function ux(t,e){return`firestore_clients_${t}_${e}`}function hx(t,e,n){let r=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function Om(t,e){return`firestore_targets_${t}_${e}`}class Hd{constructor(e,n,r,i){this.user=e,this.batchId=n,this.state=r,this.error=i}static Rs(e,n,r){const i=JSON.parse(r);let s,a=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return a&&i.error&&(a=typeof i.error.message=="string"&&typeof i.error.code=="string",a&&(s=new te(i.error.code,i.error.message))),a?new Hd(e,n,i.state,s):(Tt("SharedClientState",`Failed to parse mutation state for ID '${n}': ${r}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Vc{constructor(e,n,r){this.targetId=e,this.state=n,this.error=r}static Rs(e,n){const r=JSON.parse(n);let i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new te(r.error.code,r.error.message))),s?new Vc(e,r.state,i):(Tt("SharedClientState",`Failed to parse target state for ID '${e}': ${n}`),null)}Vs(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Kd{constructor(e,n){this.clientId=e,this.activeTargetIds=n}static Rs(e,n){const r=JSON.parse(n);let i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=E_();for(let a=0;i&&a<r.activeTargetIds.length;++a)i=Yb(r.activeTargetIds[a]),s=s.add(r.activeTargetIds[a]);return i?new Kd(e,s):(Tt("SharedClientState",`Failed to parse client data for instance '${e}': ${n}`),null)}}class F_{constructor(e,n){this.clientId=e,this.onlineState=n}static Rs(e){const n=JSON.parse(e);return typeof n=="object"&&["Unknown","Online","Offline"].indexOf(n.onlineState)!==-1&&typeof n.clientId=="string"?new F_(n.clientId,n.onlineState):(Tt("SharedClientState",`Failed to parse online state: ${e}`),null)}}class lg{constructor(){this.activeTargetIds=E_()}fs(e){this.activeTargetIds=this.activeTargetIds.add(e)}gs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Vs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Fm{constructor(e,n,r,i,s){this.window=e,this.ui=n,this.persistenceKey=r,this.ps=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ys=this.ws.bind(this),this.Ss=new Xe(be),this.started=!1,this.bs=[];const a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.Ds=ux(this.persistenceKey,this.ps),this.vs=function(h){return`firestore_sequence_number_${h}`}(this.persistenceKey),this.Ss=this.Ss.insert(this.ps,new lg),this.Cs=new RegExp(`^firestore_clients_${a}_([^_]*)$`),this.Fs=new RegExp(`^firestore_mutations_${a}_(\\d+)(?:_(.*))?$`),this.Ms=new RegExp(`^firestore_targets_${a}_(\\d+)$`),this.xs=function(h){return`firestore_online_state_${h}`}(this.persistenceKey),this.Os=function(h){return`firestore_bundle_loaded_v2_${h}`}(this.persistenceKey),this.window.addEventListener("storage",this.ys)}static D(e){return!(!e||!e.localStorage)}async start(){const e=await this.syncEngine.Qi();for(const r of e){if(r===this.ps)continue;const i=this.getItem(ux(this.persistenceKey,r));if(i){const s=Kd.Rs(r,i);s&&(this.Ss=this.Ss.insert(s.clientId,s))}}this.Ns();const n=this.storage.getItem(this.xs);if(n){const r=this.Ls(n);r&&this.Bs(r)}for(const r of this.bs)this.ws(r);this.bs=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0}writeSequenceNumber(e){this.setItem(this.vs,JSON.stringify(e))}getAllActiveQueryTargets(){return this.ks(this.Ss)}isActiveQueryTarget(e){let n=!1;return this.Ss.forEach((r,i)=>{i.activeTargetIds.has(e)&&(n=!0)}),n}addPendingMutation(e){this.qs(e,"pending")}updateMutationState(e,n,r){this.qs(e,n,r),this.Qs(e)}addLocalQueryTarget(e,n=!0){let r="not-current";if(this.isActiveQueryTarget(e)){const i=this.storage.getItem(Om(this.persistenceKey,e));if(i){const s=Vc.Rs(e,i);s&&(r=s.state)}}return n&&this.Ks.fs(e),this.Ns(),r}removeLocalQueryTarget(e){this.Ks.gs(e),this.Ns()}isLocalQueryTarget(e){return this.Ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Om(this.persistenceKey,e))}updateQueryState(e,n,r){this.$s(e,n,r)}handleUserChange(e,n,r){n.forEach(i=>{this.Qs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Us(e)}notifyBundleLoaded(e){this.Ws(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ys),this.removeItem(this.Ds),this.started=!1)}getItem(e){const n=this.storage.getItem(e);return ee("SharedClientState","READ",e,n),n}setItem(e,n){ee("SharedClientState","SET",e,n),this.storage.setItem(e,n)}removeItem(e){ee("SharedClientState","REMOVE",e),this.storage.removeItem(e)}ws(e){const n=e;if(n.storageArea===this.storage){if(ee("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Ds)return void Tt("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.ui.enqueueRetryable(async()=>{if(this.started){if(n.key!==null){if(this.Cs.test(n.key)){if(n.newValue==null){const r=this.Gs(n.key);return this.zs(r,null)}{const r=this.js(n.key,n.newValue);if(r)return this.zs(r.clientId,r)}}else if(this.Fs.test(n.key)){if(n.newValue!==null){const r=this.Hs(n.key,n.newValue);if(r)return this.Js(r)}}else if(this.Ms.test(n.key)){if(n.newValue!==null){const r=this.Ys(n.key,n.newValue);if(r)return this.Zs(r)}}else if(n.key===this.xs){if(n.newValue!==null){const r=this.Ls(n.newValue);if(r)return this.Bs(r)}}else if(n.key===this.vs){const r=function(s){let a=wn.oe;if(s!=null)try{const u=JSON.parse(s);ge(typeof u=="number"),a=u}catch(u){Tt("SharedClientState","Failed to read sequence number from WebStorage",u)}return a}(n.newValue);r!==wn.oe&&this.sequenceNumberHandler(r)}else if(n.key===this.Os){const r=this.Xs(n.newValue);await Promise.all(r.map(i=>this.syncEngine.eo(i)))}}}else this.bs.push(n)})}}get Ks(){return this.Ss.get(this.ps)}Ns(){this.setItem(this.Ds,this.Ks.Vs())}qs(e,n,r){const i=new Hd(this.currentUser,e,n,r),s=hx(this.persistenceKey,this.currentUser,e);this.setItem(s,i.Vs())}Qs(e){const n=hx(this.persistenceKey,this.currentUser,e);this.removeItem(n)}Us(e){const n={clientId:this.ps,onlineState:e};this.storage.setItem(this.xs,JSON.stringify(n))}$s(e,n,r){const i=Om(this.persistenceKey,e),s=new Vc(e,n,r);this.setItem(i,s.Vs())}Ws(e){const n=JSON.stringify(Array.from(e));this.setItem(this.Os,n)}Gs(e){const n=this.Cs.exec(e);return n?n[1]:null}js(e,n){const r=this.Gs(e);return Kd.Rs(r,n)}Hs(e,n){const r=this.Fs.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Hd.Rs(new $t(s),i,n)}Ys(e,n){const r=this.Ms.exec(e),i=Number(r[1]);return Vc.Rs(i,n)}Ls(e){return F_.Rs(e)}Xs(e){return JSON.parse(e)}async Js(e){if(e.user.uid===this.currentUser.uid)return this.syncEngine.no(e.batchId,e.state,e.error);ee("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)}Zs(e){return this.syncEngine.ro(e.targetId,e.state,e.error)}zs(e,n){const r=n?this.Ss.insert(e,n):this.Ss.remove(e),i=this.ks(this.Ss),s=this.ks(r),a=[],u=[];return s.forEach(h=>{i.has(h)||a.push(h)}),i.forEach(h=>{s.has(h)||u.push(h)}),this.syncEngine.io(a,u).then(()=>{this.Ss=r})}Bs(e){this.Ss.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}ks(e){let n=E_();return e.forEach((r,i)=>{n=n.unionWith(i.activeTargetIds)}),n}}class _T{constructor(){this.so=new lg,this.oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,r){}addLocalQueryTarget(e,n=!0){return n&&this.so.fs(e),this.oo[e]||"not-current"}updateQueryState(e,n,r){this.oo[e]=n}removeLocalQueryTarget(e){this.so.gs(e)}isLocalQueryTarget(e){return this.so.activeTargetIds.has(e)}clearQueryState(e){delete this.oo[e]}getAllActiveQueryTargets(){return this.so.activeTargetIds}isActiveQueryTarget(e){return this.so.activeTargetIds.has(e)}start(){return this.so=new lg,Promise.resolve()}handleUserChange(e,n,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ej{_o(e){}shutdown(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dx{constructor(){this.ao=()=>this.uo(),this.co=()=>this.lo(),this.ho=[],this.Po()}_o(e){this.ho.push(e)}shutdown(){window.removeEventListener("online",this.ao),window.removeEventListener("offline",this.co)}Po(){window.addEventListener("online",this.ao),window.addEventListener("offline",this.co)}uo(){ee("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.ho)e(0)}lo(){ee("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.ho)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Fh=null;function zm(){return Fh===null?Fh=function(){return 268435456+Math.round(2147483648*Math.random())}():Fh++,"0x"+Fh.toString(16)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tj={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ij{constructor(e){this.Io=e.Io,this.To=e.To}Eo(e){this.Ao=e}Ro(e){this.Vo=e}mo(e){this.fo=e}onMessage(e){this.po=e}close(){this.To()}send(e){this.Io(e)}yo(){this.Ao()}wo(){this.Vo()}So(e){this.fo(e)}bo(e){this.po(e)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const on="WebChannelConnection";class Sj extends class{constructor(n){this.databaseInfo=n,this.databaseId=n.databaseId;const r=n.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Do=r+"://"+n.host,this.vo=`projects/${i}/databases/${s}`,this.Co=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get Fo(){return!1}Mo(n,r,i,s,a){const u=zm(),h=this.xo(n,r.toUriEncodedString());ee("RestConnection",`Sending RPC '${n}' ${u}:`,h,i);const m={"google-cloud-resource-prefix":this.vo,"x-goog-request-params":this.Co};return this.Oo(m,s,a),this.No(n,h,m,i).then(p=>(ee("RestConnection",`Received RPC '${n}' ${u}: `,p),p),p=>{throw Jn("RestConnection",`RPC '${n}' ${u} failed with error: `,p,"url: ",h,"request:",i),p})}Lo(n,r,i,s,a,u){return this.Mo(n,r,i,s,a)}Oo(n,r,i){n["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+gl}(),n["Content-Type"]="text/plain",this.databaseInfo.appId&&(n["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,a)=>n[a]=s),i&&i.headers.forEach((s,a)=>n[a]=s)}xo(n,r){const i=Tj[n];return`${this.Do}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}No(e,n,r,i){const s=zm();return new Promise((a,u)=>{const h=new Ob;h.setWithCredentials(!0),h.listenOnce(Fb.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Xh.NO_ERROR:const p=h.getResponseJson();ee(on,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(p)),a(p);break;case Xh.TIMEOUT:ee(on,`RPC '${e}' ${s} timed out`),u(new te(H.DEADLINE_EXCEEDED,"Request time out"));break;case Xh.HTTP_ERROR:const _=h.getStatus();if(ee(on,`RPC '${e}' ${s} failed with status:`,_,"response text:",h.getResponseText()),_>0){let v=h.getResponseJson();Array.isArray(v)&&(v=v[0]);const x=v==null?void 0:v.error;if(x&&x.status&&x.message){const T=function(R){const S=R.toLowerCase().replace(/_/g,"-");return Object.values(H).indexOf(S)>=0?S:H.UNKNOWN}(x.status);u(new te(T,x.message))}else u(new te(H.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new te(H.UNAVAILABLE,"Connection failed."));break;default:de()}}finally{ee(on,`RPC '${e}' ${s} completed.`)}});const m=JSON.stringify(i);ee(on,`RPC '${e}' ${s} sending request:`,i),h.send(n,"POST",m,r,15)})}Bo(e,n,r){const i=zm(),s=[this.Do,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=Ub(),u=Bb(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},m=this.longPollingOptions.timeoutSeconds;m!==void 0&&(h.longPollingTimeout=Math.round(1e3*m)),this.useFetchStreams&&(h.useFetchStreams=!0),this.Oo(h.initMessageHeaders,n,r),h.encodeInitMessageHeaders=!0;const p=s.join("");ee(on,`Creating RPC '${e}' stream ${i}: ${p}`,h);const _=a.createWebChannel(p,h);let v=!1,x=!1;const T=new Ij({Io:R=>{x?ee(on,`Not sending because RPC '${e}' stream ${i} is closed:`,R):(v||(ee(on,`Opening RPC '${e}' stream ${i} transport.`),_.open(),v=!0),ee(on,`RPC '${e}' stream ${i} sending:`,R),_.send(R))},To:()=>_.close()}),E=(R,S,C)=>{R.listen(S,A=>{try{C(A)}catch(U){setTimeout(()=>{throw U},0)}})};return E(_,vc.EventType.OPEN,()=>{x||(ee(on,`RPC '${e}' stream ${i} transport opened.`),T.yo())}),E(_,vc.EventType.CLOSE,()=>{x||(x=!0,ee(on,`RPC '${e}' stream ${i} transport closed`),T.So())}),E(_,vc.EventType.ERROR,R=>{x||(x=!0,Jn(on,`RPC '${e}' stream ${i} transport errored:`,R),T.So(new te(H.UNAVAILABLE,"The operation could not be completed")))}),E(_,vc.EventType.MESSAGE,R=>{var S;if(!x){const C=R.data[0];ge(!!C);const A=C,U=A.error||((S=A[0])===null||S===void 0?void 0:S.error);if(U){ee(on,`RPC '${e}' stream ${i} received error:`,U);const Z=U.status;let V=function(D){const M=Rt[D];if(M!==void 0)return LE(M)}(Z),k=U.message;V===void 0&&(V=H.INTERNAL,k="Unknown error status: "+Z+" with message "+U.message),x=!0,T.So(new te(V,k)),_.close()}else ee(on,`RPC '${e}' stream ${i} received:`,C),T.bo(C)}}),E(u,zb.STAT_EVENT,R=>{R.stat===Wp.PROXY?ee(on,`RPC '${e}' stream ${i} detected buffering proxy`):R.stat===Wp.NOPROXY&&ee(on,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{T.wo()},0),T}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vT(){return typeof window<"u"?window:null}function od(){return typeof document<"u"?document:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ju(t){return new DR(t,!0)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class z_{constructor(e,n,r=1e3,i=1.5,s=6e4){this.ui=e,this.timerId=n,this.ko=r,this.qo=i,this.Qo=s,this.Ko=0,this.$o=null,this.Uo=Date.now(),this.reset()}reset(){this.Ko=0}Wo(){this.Ko=this.Qo}Go(e){this.cancel();const n=Math.floor(this.Ko+this.zo()),r=Math.max(0,Date.now()-this.Uo),i=Math.max(0,n-r);i>0&&ee("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Ko} ms, delay with jitter: ${n} ms, last attempt: ${r} ms ago)`),this.$o=this.ui.enqueueAfterDelay(this.timerId,i,()=>(this.Uo=Date.now(),e())),this.Ko*=this.qo,this.Ko<this.ko&&(this.Ko=this.ko),this.Ko>this.Qo&&(this.Ko=this.Qo)}jo(){this.$o!==null&&(this.$o.skipDelay(),this.$o=null)}cancel(){this.$o!==null&&(this.$o.cancel(),this.$o=null)}zo(){return(Math.random()-.5)*this.Ko}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yT{constructor(e,n,r,i,s,a,u,h){this.ui=e,this.Ho=r,this.Jo=i,this.connection=s,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.Yo=0,this.Zo=null,this.Xo=null,this.stream=null,this.e_=0,this.t_=new z_(e,n)}n_(){return this.state===1||this.state===5||this.r_()}r_(){return this.state===2||this.state===3}start(){this.e_=0,this.state!==4?this.auth():this.i_()}async stop(){this.n_()&&await this.close(0)}s_(){this.state=0,this.t_.reset()}o_(){this.r_()&&this.Zo===null&&(this.Zo=this.ui.enqueueAfterDelay(this.Ho,6e4,()=>this.__()))}a_(e){this.u_(),this.stream.send(e)}async __(){if(this.r_())return this.close(0)}u_(){this.Zo&&(this.Zo.cancel(),this.Zo=null)}c_(){this.Xo&&(this.Xo.cancel(),this.Xo=null)}async close(e,n){this.u_(),this.c_(),this.t_.cancel(),this.Yo++,e!==4?this.t_.reset():n&&n.code===H.RESOURCE_EXHAUSTED?(Tt(n.toString()),Tt("Using maximum backoff delay to prevent overloading the backend."),this.t_.Wo()):n&&n.code===H.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.l_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.mo(n)}l_(){}auth(){this.state=1;const e=this.h_(this.Yo),n=this.Yo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Yo===n&&this.P_(r,i)},r=>{e(()=>{const i=new te(H.UNKNOWN,"Fetching auth token failed: "+r.message);return this.I_(i)})})}P_(e,n){const r=this.h_(this.Yo);this.stream=this.T_(e,n),this.stream.Eo(()=>{r(()=>this.listener.Eo())}),this.stream.Ro(()=>{r(()=>(this.state=2,this.Xo=this.ui.enqueueAfterDelay(this.Jo,1e4,()=>(this.r_()&&(this.state=3),Promise.resolve())),this.listener.Ro()))}),this.stream.mo(i=>{r(()=>this.I_(i))}),this.stream.onMessage(i=>{r(()=>++this.e_==1?this.E_(i):this.onNext(i))})}i_(){this.state=5,this.t_.Go(async()=>{this.state=0,this.start()})}I_(e){return ee("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}h_(e){return n=>{this.ui.enqueueAndForget(()=>this.Yo===e?n():(ee("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Cj extends yT{constructor(e,n,r,i,s,a){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,r,i,a),this.serializer=s}T_(e,n){return this.connection.Bo("Listen",e,n)}E_(e){return this.onNext(e)}onNext(e){this.t_.reset();const n=VR(this.serializer,e),r=function(s){if(!("targetChange"in s))return _e.min();const a=s.targetChange;return a.targetIds&&a.targetIds.length?_e.min():a.readTime?St(a.readTime):_e.min()}(e);return this.listener.d_(n,r)}A_(e){const n={};n.database=rg(this.serializer),n.addTarget=function(s,a){let u;const h=a.target;if(u=Od(h)?{documents:GE(s,h)}:{query:Af(s,h)._t},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=FE(s,a.resumeToken);const m=tg(s,a.expectedCount);m!==null&&(u.expectedCount=m)}else if(a.snapshotVersion.compareTo(_e.min())>0){u.readTime=Xa(s,a.snapshotVersion.toTimestamp());const m=tg(s,a.expectedCount);m!==null&&(u.expectedCount=m)}return u}(this.serializer,e);const r=FR(this.serializer,e);r&&(n.labels=r),this.a_(n)}R_(e){const n={};n.database=rg(this.serializer),n.removeTarget=e,this.a_(n)}}class Pj extends yT{constructor(e,n,r,i,s,a){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,r,i,a),this.serializer=s}get V_(){return this.e_>0}start(){this.lastStreamToken=void 0,super.start()}l_(){this.V_&&this.m_([])}T_(e,n){return this.connection.Bo("Write",e,n)}E_(e){return ge(!!e.streamToken),this.lastStreamToken=e.streamToken,ge(!e.writeResults||e.writeResults.length===0),this.listener.f_()}onNext(e){ge(!!e.streamToken),this.lastStreamToken=e.streamToken,this.t_.reset();const n=OR(e.writeResults,e.commitTime),r=St(e.commitTime);return this.listener.g_(r,n)}p_(){const e={};e.database=rg(this.serializer),this.a_(e)}m_(e){const n={streamToken:this.lastStreamToken,writes:e.map(r=>pu(this.serializer,r))};this.a_(n)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Nj extends class{}{constructor(e,n,r,i){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=r,this.serializer=i,this.y_=!1}w_(){if(this.y_)throw new te(H.FAILED_PRECONDITION,"The client has already been terminated.")}Mo(e,n,r,i){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,a])=>this.connection.Mo(e,ng(n,r),i,s,a)).catch(s=>{throw s.name==="FirebaseError"?(s.code===H.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new te(H.UNKNOWN,s.toString())})}Lo(e,n,r,i,s){return this.w_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([a,u])=>this.connection.Lo(e,ng(n,r),i,a,u,s)).catch(a=>{throw a.name==="FirebaseError"?(a.code===H.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new te(H.UNKNOWN,a.toString())})}terminate(){this.y_=!0,this.connection.terminate()}}class Aj{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.S_=0,this.b_=null,this.D_=!0}v_(){this.S_===0&&(this.C_("Unknown"),this.b_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.b_=null,this.F_("Backend didn't respond within 10 seconds."),this.C_("Offline"),Promise.resolve())))}M_(e){this.state==="Online"?this.C_("Unknown"):(this.S_++,this.S_>=1&&(this.x_(),this.F_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.C_("Offline")))}set(e){this.x_(),this.S_=0,e==="Online"&&(this.D_=!1),this.C_(e)}C_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}F_(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.D_?(Tt(n),this.D_=!1):ee("OnlineStateTracker",n)}x_(){this.b_!==null&&(this.b_.cancel(),this.b_=null)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kj{constructor(e,n,r,i,s){this.localStore=e,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.O_=[],this.N_=new Map,this.L_=new Set,this.B_=[],this.k_=s,this.k_._o(a=>{r.enqueueAndForget(async()=>{Os(this)&&(ee("RemoteStore","Restarting streams for network reachability change."),await async function(h){const m=oe(h);m.L_.add(4),await xl(m),m.q_.set("Unknown"),m.L_.delete(4),await Du(m)}(this))})}),this.q_=new Aj(r,i)}}async function Du(t){if(Os(t))for(const e of t.B_)await e(!0)}async function xl(t){for(const e of t.B_)await e(!1)}function Df(t,e){const n=oe(t);n.N_.has(e.targetId)||(n.N_.set(e.targetId,e),$_(n)?U_(n):bl(n).r_()&&B_(n,e))}function nl(t,e){const n=oe(t),r=bl(n);n.N_.delete(e),r.r_()&&xT(n,e),n.N_.size===0&&(r.r_()?r.o_():Os(n)&&n.q_.set("Unknown"))}function B_(t,e){if(t.Q_.xe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(_e.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}bl(t).A_(e)}function xT(t,e){t.Q_.xe(e),bl(t).R_(e)}function U_(t){t.Q_=new AR({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),ot:e=>t.N_.get(e)||null,tt:()=>t.datastore.serializer.databaseId}),bl(t).start(),t.q_.v_()}function $_(t){return Os(t)&&!bl(t).n_()&&t.N_.size>0}function Os(t){return oe(t).L_.size===0}function wT(t){t.Q_=void 0}async function Rj(t){t.q_.set("Online")}async function jj(t){t.N_.forEach((e,n)=>{B_(t,e)})}async function Dj(t,e){wT(t),$_(t)?(t.q_.M_(e),U_(t)):t.q_.set("Unknown")}async function Lj(t,e,n){if(t.q_.set("Online"),e instanceof OE&&e.state===2&&e.cause)try{await async function(i,s){const a=s.cause;for(const u of s.targetIds)i.N_.has(u)&&(await i.remoteSyncer.rejectListen(u,a),i.N_.delete(u),i.Q_.removeTarget(u))}(t,e)}catch(r){ee("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),await Qd(t,r)}else if(e instanceof sd?t.Q_.Ke(e):e instanceof VE?t.Q_.He(e):t.Q_.We(e),!n.isEqual(_e.min()))try{const r=await dT(t.localStore);n.compareTo(r)>=0&&await function(s,a){const u=s.Q_.rt(a);return u.targetChanges.forEach((h,m)=>{if(h.resumeToken.approximateByteSize()>0){const p=s.N_.get(m);p&&s.N_.set(m,p.withResumeToken(h.resumeToken,a))}}),u.targetMismatches.forEach((h,m)=>{const p=s.N_.get(h);if(!p)return;s.N_.set(h,p.withResumeToken(yt.EMPTY_BYTE_STRING,p.snapshotVersion)),xT(s,h);const _=new li(p.target,h,m,p.sequenceNumber);B_(s,_)}),s.remoteSyncer.applyRemoteEvent(u)}(t,n)}catch(r){ee("RemoteStore","Failed to raise snapshot:",r),await Qd(t,r)}}async function Qd(t,e,n){if(!Ms(e))throw e;t.L_.add(1),await xl(t),t.q_.set("Offline"),n||(n=()=>dT(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{ee("RemoteStore","Retrying IndexedDB access"),await n(),t.L_.delete(1),await Du(t)})}function bT(t,e){return e().catch(n=>Qd(t,n,e))}async function wl(t){const e=oe(t),n=Ss(e);let r=e.O_.length>0?e.O_[e.O_.length-1].batchId:-1;for(;Mj(e);)try{const i=await xj(e.localStore,r);if(i===null){e.O_.length===0&&n.o_();break}r=i.batchId,Vj(e,i)}catch(i){await Qd(e,i)}ET(e)&&TT(e)}function Mj(t){return Os(t)&&t.O_.length<10}function Vj(t,e){t.O_.push(e);const n=Ss(t);n.r_()&&n.V_&&n.m_(e.mutations)}function ET(t){return Os(t)&&!Ss(t).n_()&&t.O_.length>0}function TT(t){Ss(t).start()}async function Oj(t){Ss(t).p_()}async function Fj(t){const e=Ss(t);for(const n of t.O_)e.m_(n.mutations)}async function zj(t,e,n){const r=t.O_.shift(),i=C_.from(r,e,n);await bT(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await wl(t)}async function Bj(t,e){e&&Ss(t).V_&&await async function(r,i){if(function(a){return DE(a)&&a!==H.ABORTED}(i.code)){const s=r.O_.shift();Ss(r).s_(),await bT(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),await wl(r)}}(t,e),ET(t)&&TT(t)}async function fx(t,e){const n=oe(t);n.asyncQueue.verifyOperationInProgress(),ee("RemoteStore","RemoteStore received new credentials");const r=Os(n);n.L_.add(3),await xl(n),r&&n.q_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.L_.delete(3),await Du(n)}async function cg(t,e){const n=oe(t);e?(n.L_.delete(2),await Du(n)):e||(n.L_.add(2),await xl(n),n.q_.set("Unknown"))}function bl(t){return t.K_||(t.K_=function(n,r,i){const s=oe(n);return s.w_(),new Cj(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{Eo:Rj.bind(null,t),Ro:jj.bind(null,t),mo:Dj.bind(null,t),d_:Lj.bind(null,t)}),t.B_.push(async e=>{e?(t.K_.s_(),$_(t)?U_(t):t.q_.set("Unknown")):(await t.K_.stop(),wT(t))})),t.K_}function Ss(t){return t.U_||(t.U_=function(n,r,i){const s=oe(n);return s.w_(),new Pj(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(t.datastore,t.asyncQueue,{Eo:()=>Promise.resolve(),Ro:Oj.bind(null,t),mo:Bj.bind(null,t),f_:Fj.bind(null,t),g_:zj.bind(null,t)}),t.B_.push(async e=>{e?(t.U_.s_(),await wl(t)):(await t.U_.stop(),t.O_.length>0&&(ee("RemoteStore",`Stopping write stream with ${t.O_.length} pending writes`),t.O_=[]))})),t.U_}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q_{constructor(e,n,r,i,s){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Gt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(a=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,n,r,i,s){const a=Date.now()+r,u=new q_(e,n,a,i,s);return u.start(r),u}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new te(H.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function El(t,e){if(Tt("AsyncQueue",`${e}: ${t}`),Ms(t))return new te(H.UNAVAILABLE,`${e}: ${t}`);throw t}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class La{constructor(e){this.comparator=e?(n,r)=>e(n,r)||le.comparator(n.key,r.key):(n,r)=>le.comparator(n.key,r.key),this.keyedMap=yc(),this.sortedSet=new Xe(this.comparator)}static emptySet(e){return new La(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((n,r)=>(e(n),!1))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof La)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;n.hasNext();){const i=n.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(n=>{e.push(n.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const r=new La;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mx{constructor(){this.W_=new Xe(le.comparator)}track(e){const n=e.doc.key,r=this.W_.get(n);r?e.type!==0&&r.type===3?this.W_=this.W_.insert(n,e):e.type===3&&r.type!==1?this.W_=this.W_.insert(n,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.W_=this.W_.insert(n,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.W_=this.W_.remove(n):e.type===1&&r.type===2?this.W_=this.W_.insert(n,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.W_=this.W_.insert(n,{type:2,doc:e.doc}):de():this.W_=this.W_.insert(n,e)}G_(){const e=[];return this.W_.inorderTraversal((n,r)=>{e.push(r)}),e}}class rl{constructor(e,n,r,i,s,a,u,h,m){this.query=e,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=m}static fromInitialDocuments(e,n,r,i,s){const a=[];return n.forEach(u=>{a.push({type:0,doc:u})}),new rl(e,n,La.emptySet(n),a,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Pu(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,r=e.docChanges;if(n.length!==r.length)return!1;for(let i=0;i<n.length;i++)if(n[i].type!==r[i].type||!n[i].doc.isEqual(r[i].doc))return!1;return!0}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uj{constructor(){this.z_=void 0,this.j_=[]}H_(){return this.j_.some(e=>e.J_())}}class $j{constructor(){this.queries=px(),this.onlineState="Unknown",this.Y_=new Set}terminate(){(function(n,r){const i=oe(n),s=i.queries;i.queries=px(),s.forEach((a,u)=>{for(const h of u.j_)h.onError(r)})})(this,new te(H.ABORTED,"Firestore shutting down"))}}function px(){return new wi(t=>yE(t),Pu)}async function G_(t,e){const n=oe(t);let r=3;const i=e.query;let s=n.queries.get(i);s?!s.H_()&&e.J_()&&(r=2):(s=new Uj,r=e.J_()?0:1);try{switch(r){case 0:s.z_=await n.onListen(i,!0);break;case 1:s.z_=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(a){const u=El(a,`Initialization of query '${ha(e.query)}' failed`);return void e.onError(u)}n.queries.set(i,s),s.j_.push(e),e.Z_(n.onlineState),s.z_&&e.X_(s.z_)&&H_(n)}async function W_(t,e){const n=oe(t),r=e.query;let i=3;const s=n.queries.get(r);if(s){const a=s.j_.indexOf(e);a>=0&&(s.j_.splice(a,1),s.j_.length===0?i=e.J_()?0:1:!s.H_()&&e.J_()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}function qj(t,e){const n=oe(t);let r=!1;for(const i of e){const s=i.query,a=n.queries.get(s);if(a){for(const u of a.j_)u.X_(i)&&(r=!0);a.z_=i}}r&&H_(n)}function Gj(t,e,n){const r=oe(t),i=r.queries.get(e);if(i)for(const s of i.j_)s.onError(n);r.queries.delete(e)}function H_(t){t.Y_.forEach(e=>{e.next()})}var ug,gx;(gx=ug||(ug={})).ea="default",gx.Cache="cache";class K_{constructor(e,n,r){this.query=e,this.ta=n,this.na=!1,this.ra=null,this.onlineState="Unknown",this.options=r||{}}X_(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)i.type!==3&&r.push(i);e=new rl(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.na?this.ia(e)&&(this.ta.next(e),n=!0):this.sa(e,this.onlineState)&&(this.oa(e),n=!0),this.ra=e,n}onError(e){this.ta.error(e)}Z_(e){this.onlineState=e;let n=!1;return this.ra&&!this.na&&this.sa(this.ra,e)&&(this.oa(this.ra),n=!0),n}sa(e,n){if(!e.fromCache||!this.J_())return!0;const r=n!=="Offline";return(!this.options._a||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}ia(e){if(e.docChanges.length>0)return!0;const n=this.ra&&this.ra.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}oa(e){e=rl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.na=!0,this.ta.next(e)}J_(){return this.options.source!==ug.Cache}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wj{constructor(e,n){this.aa=e,this.byteLength=n}ua(){return"metadata"in this.aa}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _x{constructor(e){this.serializer=e}Es(e){return Vr(this.serializer,e)}ds(e){return e.metadata.exists?qE(this.serializer,e.document,!1):nt.newNoDocument(this.Es(e.metadata.name),this.As(e.metadata.readTime))}As(e){return St(e)}}class Hj{constructor(e,n,r){this.ca=e,this.localStore=n,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=IT(e)}la(e){this.progress.bytesLoaded+=e.byteLength;let n=this.progress.documentsLoaded;if(e.aa.namedQuery)this.queries.push(e.aa.namedQuery);else if(e.aa.documentMetadata){this.documents.push({metadata:e.aa.documentMetadata}),e.aa.documentMetadata.exists||++n;const r=De.fromString(e.aa.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.aa.document&&(this.documents[this.documents.length-1].document=e.aa.document,++n);return n!==this.progress.documentsLoaded?(this.progress.documentsLoaded=n,Object.assign({},this.progress)):null}ha(e){const n=new Map,r=new _x(this.serializer);for(const i of e)if(i.metadata.queries){const s=r.Es(i.metadata.name);for(const a of i.metadata.queries){const u=(n.get(a)||Pe()).add(s);n.set(a,u)}}return n}async complete(){const e=await wj(this.localStore,new _x(this.serializer),this.documents,this.ca.id),n=this.ha(this.documents);for(const r of this.queries)await bj(this.localStore,r,n.get(r.name));return this.progress.taskState="Success",{progress:this.progress,Pa:this.collectionGroups,Ia:e}}}function IT(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ST{constructor(e){this.key=e}}class CT{constructor(e){this.key=e}}class PT{constructor(e,n){this.query=e,this.Ta=n,this.Ea=null,this.hasCachedResults=!1,this.current=!1,this.da=Pe(),this.mutatedKeys=Pe(),this.Aa=wE(e),this.Ra=new La(this.Aa)}get Va(){return this.Ta}ma(e,n){const r=n?n.fa:new mx,i=n?n.Ra:this.Ra;let s=n?n.mutatedKeys:this.mutatedKeys,a=i,u=!1;const h=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,m=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((p,_)=>{const v=i.get(p),x=Nu(this.query,_)?_:null,T=!!v&&this.mutatedKeys.has(v.key),E=!!x&&(x.hasLocalMutations||this.mutatedKeys.has(x.key)&&x.hasCommittedMutations);let R=!1;v&&x?v.data.isEqual(x.data)?T!==E&&(r.track({type:3,doc:x}),R=!0):this.ga(v,x)||(r.track({type:2,doc:x}),R=!0,(h&&this.Aa(x,h)>0||m&&this.Aa(x,m)<0)&&(u=!0)):!v&&x?(r.track({type:0,doc:x}),R=!0):v&&!x&&(r.track({type:1,doc:v}),R=!0,(h||m)&&(u=!0)),R&&(x?(a=a.add(x),s=E?s.add(p):s.delete(p)):(a=a.delete(p),s=s.delete(p)))}),this.query.limit!==null)for(;a.size>this.query.limit;){const p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),s=s.delete(p.key),r.track({type:1,doc:p})}return{Ra:a,fa:r,ns:u,mutatedKeys:s}}ga(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,r,i){const s=this.Ra;this.Ra=e.Ra,this.mutatedKeys=e.mutatedKeys;const a=e.fa.G_();a.sort((p,_)=>function(x,T){const E=R=>{switch(R){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return de()}};return E(x)-E(T)}(p.type,_.type)||this.Aa(p.doc,_.doc)),this.pa(r),i=i!=null&&i;const u=n&&!i?this.ya():[],h=this.da.size===0&&this.current&&!i?1:0,m=h!==this.Ea;return this.Ea=h,a.length!==0||m?{snapshot:new rl(this.query,e.Ra,s,a,e.mutatedKeys,h===0,m,!1,!!r&&r.resumeToken.approximateByteSize()>0),wa:u}:{wa:u}}Z_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Ra:this.Ra,fa:new mx,mutatedKeys:this.mutatedKeys,ns:!1},!1)):{wa:[]}}Sa(e){return!this.Ta.has(e)&&!!this.Ra.has(e)&&!this.Ra.get(e).hasLocalMutations}pa(e){e&&(e.addedDocuments.forEach(n=>this.Ta=this.Ta.add(n)),e.modifiedDocuments.forEach(n=>{}),e.removedDocuments.forEach(n=>this.Ta=this.Ta.delete(n)),this.current=e.current)}ya(){if(!this.current)return[];const e=this.da;this.da=Pe(),this.Ra.forEach(r=>{this.Sa(r.key)&&(this.da=this.da.add(r.key))});const n=[];return e.forEach(r=>{this.da.has(r)||n.push(new CT(r))}),this.da.forEach(r=>{e.has(r)||n.push(new ST(r))}),n}ba(e){this.Ta=e.Ts,this.da=Pe();const n=this.ma(e.documents);return this.applyChanges(n,!0)}Da(){return rl.fromInitialDocuments(this.query,this.Ra,this.mutatedKeys,this.Ea===0,this.hasCachedResults)}}class Kj{constructor(e,n,r){this.query=e,this.targetId=n,this.view=r}}class Qj{constructor(e){this.key=e,this.va=!1}}class Zj{constructor(e,n,r,i,s,a){this.localStore=e,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=a,this.Ca={},this.Fa=new wi(u=>yE(u),Pu),this.Ma=new Map,this.xa=new Set,this.Oa=new Xe(le.comparator),this.Na=new Map,this.La=new D_,this.Ba={},this.ka=new Map,this.qa=ko.kn(),this.onlineState="Unknown",this.Qa=void 0}get isPrimaryClient(){return this.Qa===!0}}async function Jj(t,e,n=!0){const r=Lf(t);let i;const s=r.Fa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.Da()):i=await NT(r,e,n,!0),i}async function Yj(t,e){const n=Lf(t);await NT(n,e,!0,!1)}async function NT(t,e,n,r){const i=await el(t.localStore,un(e)),s=i.targetId,a=t.sharedClientState.addLocalQueryTarget(s,n);let u;return r&&(u=await Q_(t,e,s,a==="current",i.resumeToken)),t.isPrimaryClient&&n&&Df(t.remoteStore,i),u}async function Q_(t,e,n,r,i){t.Ka=(_,v,x)=>async function(E,R,S,C){let A=R.view.ma(S);A.ns&&(A=await Wd(E.localStore,R.query,!1).then(({documents:k})=>R.view.ma(k,A)));const U=C&&C.targetChanges.get(R.targetId),Z=C&&C.targetMismatches.get(R.targetId)!=null,V=R.view.applyChanges(A,E.isPrimaryClient,U,Z);return hg(E,R.targetId,V.wa),V.snapshot}(t,_,v,x);const s=await Wd(t.localStore,e,!0),a=new PT(e,s.Ts),u=a.ma(s.documents),h=Ru.createSynthesizedTargetChangeForCurrentChange(n,r&&t.onlineState!=="Offline",i),m=a.applyChanges(u,t.isPrimaryClient,h);hg(t,n,m.wa);const p=new Kj(e,n,a);return t.Fa.set(e,p),t.Ma.has(n)?t.Ma.get(n).push(e):t.Ma.set(n,[e]),m.snapshot}async function Xj(t,e,n){const r=oe(t),i=r.Fa.get(e),s=r.Ma.get(i.targetId);if(s.length>1)return r.Ma.set(i.targetId,s.filter(a=>!Pu(a,e))),void r.Fa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await tl(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&nl(r.remoteStore,i.targetId),il(r,i.targetId)}).catch(Ls)):(il(r,i.targetId),await tl(r.localStore,i.targetId,!0))}async function eD(t,e){const n=oe(t),r=n.Fa.get(e),i=n.Ma.get(r.targetId);n.isPrimaryClient&&i.length===1&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),nl(n.remoteStore,r.targetId))}async function tD(t,e,n){const r=X_(t);try{const i=await function(a,u){const h=oe(a),m=ct.now(),p=u.reduce((x,T)=>x.add(T.key),Pe());let _,v;return h.persistence.runTransaction("Locally write mutations","readwrite",x=>{let T=En(),E=Pe();return h.cs.getEntries(x,p).next(R=>{T=R,T.forEach((S,C)=>{C.isValidDocument()||(E=E.add(S))})}).next(()=>h.localDocuments.getOverlayedDocuments(x,T)).next(R=>{_=R;const S=[];for(const C of u){const A=CR(C,_.get(C.key).overlayedDocument);A!=null&&S.push(new bi(C.key,A,lE(A.value.mapValue),lt.exists(!0)))}return h.mutationQueue.addMutationBatch(x,m,S,u)}).next(R=>{v=R;const S=R.applyToLocalDocumentSet(_,E);return h.documentOverlayCache.saveOverlays(x,R.batchId,S)})}).then(()=>({batchId:v.batchId,changes:EE(_)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(a,u,h){let m=a.Ba[a.currentUser.toKey()];m||(m=new Xe(be)),m=m.insert(u,h),a.Ba[a.currentUser.toKey()]=m}(r,i.batchId,n),await Ei(r,i.changes),await wl(r.remoteStore)}catch(i){const s=El(i,"Failed to persist write");n.reject(s)}}async function AT(t,e){const n=oe(t);try{const r=await yj(n.localStore,e);e.targetChanges.forEach((i,s)=>{const a=n.Na.get(s);a&&(ge(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?a.va=!0:i.modifiedDocuments.size>0?ge(a.va):i.removedDocuments.size>0&&(ge(a.va),a.va=!1))}),await Ei(n,r,e)}catch(r){await Ls(r)}}function vx(t,e,n){const r=oe(t);if(r.isPrimaryClient&&n===0||!r.isPrimaryClient&&n===1){const i=[];r.Fa.forEach((s,a)=>{const u=a.view.Z_(e);u.snapshot&&i.push(u.snapshot)}),function(a,u){const h=oe(a);h.onlineState=u;let m=!1;h.queries.forEach((p,_)=>{for(const v of _.j_)v.Z_(u)&&(m=!0)}),m&&H_(h)}(r.eventManager,e),i.length&&r.Ca.d_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function nD(t,e,n){const r=oe(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Na.get(e),s=i&&i.key;if(s){let a=new Xe(le.comparator);a=a.insert(s,nt.newNoDocument(s,_e.min()));const u=Pe().add(s),h=new ku(_e.min(),new Map,new Xe(be),a,u);await AT(r,h),r.Oa=r.Oa.remove(s),r.Na.delete(e),Y_(r)}else await tl(r.localStore,e,!1).then(()=>il(r,e,n)).catch(Ls)}async function rD(t,e){const n=oe(t),r=e.batch.batchId;try{const i=await vj(n.localStore,e);J_(n,r,null),Z_(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Ei(n,i)}catch(i){await Ls(i)}}async function iD(t,e,n){const r=oe(t);try{const i=await function(a,u){const h=oe(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",m=>{let p;return h.mutationQueue.lookupMutationBatch(m,u).next(_=>(ge(_!==null),p=_.keys(),h.mutationQueue.removeMutationBatch(m,_))).next(()=>h.mutationQueue.performConsistencyCheck(m)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(m,p,u)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(m,p)).next(()=>h.localDocuments.getDocuments(m,p))})}(r.localStore,e);J_(r,e,n),Z_(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Ei(r,i)}catch(i){await Ls(i)}}async function sD(t,e){const n=oe(t);Os(n.remoteStore)||ee("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=await function(a){const u=oe(a);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",h=>u.mutationQueue.getHighestUnacknowledgedBatchId(h))}(n.localStore);if(r===-1)return void e.resolve();const i=n.ka.get(r)||[];i.push(e),n.ka.set(r,i)}catch(r){const i=El(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}function Z_(t,e){(t.ka.get(e)||[]).forEach(n=>{n.resolve()}),t.ka.delete(e)}function J_(t,e,n){const r=oe(t);let i=r.Ba[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(n?s.reject(n):s.resolve(),i=i.remove(e)),r.Ba[r.currentUser.toKey()]=i}}function il(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Ma.get(e))t.Fa.delete(r),n&&t.Ca.$a(r,n);t.Ma.delete(e),t.isPrimaryClient&&t.La.gr(e).forEach(r=>{t.La.containsKey(r)||kT(t,r)})}function kT(t,e){t.xa.delete(e.path.canonicalString());const n=t.Oa.get(e);n!==null&&(nl(t.remoteStore,n),t.Oa=t.Oa.remove(e),t.Na.delete(n),Y_(t))}function hg(t,e,n){for(const r of n)r instanceof ST?(t.La.addReference(r.key,e),oD(t,r)):r instanceof CT?(ee("SyncEngine","Document no longer in limbo: "+r.key),t.La.removeReference(r.key,e),t.La.containsKey(r.key)||kT(t,r.key)):de()}function oD(t,e){const n=e.key,r=n.path.canonicalString();t.Oa.get(n)||t.xa.has(r)||(ee("SyncEngine","New document in limbo: "+n),t.xa.add(r),Y_(t))}function Y_(t){for(;t.xa.size>0&&t.Oa.size<t.maxConcurrentLimboResolutions;){const e=t.xa.values().next().value;t.xa.delete(e);const n=new le(De.fromString(e)),r=t.qa.next();t.Na.set(r,new Qj(n)),t.Oa=t.Oa.insert(n,r),Df(t.remoteStore,new li(un(_l(n.path)),r,"TargetPurposeLimboResolution",wn.oe))}}async function Ei(t,e,n){const r=oe(t),i=[],s=[],a=[];r.Fa.isEmpty()||(r.Fa.forEach((u,h)=>{a.push(r.Ka(h,e,n).then(m=>{var p;if((m||n)&&r.isPrimaryClient){const _=m?!m.fromCache:(p=n==null?void 0:n.targetChanges.get(h.targetId))===null||p===void 0?void 0:p.current;r.sharedClientState.updateQueryState(h.targetId,_?"current":"not-current")}if(m){i.push(m);const _=O_.Wi(h.targetId,m);s.push(_)}}))}),await Promise.all(a),r.Ca.d_(i),await async function(h,m){const p=oe(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",_=>q.forEach(m,v=>q.forEach(v.$i,x=>p.persistence.referenceDelegate.addReference(_,v.targetId,x)).next(()=>q.forEach(v.Ui,x=>p.persistence.referenceDelegate.removeReference(_,v.targetId,x)))))}catch(_){if(!Ms(_))throw _;ee("LocalStore","Failed to update sequence numbers: "+_)}for(const _ of m){const v=_.targetId;if(!_.fromCache){const x=p.os.get(v),T=x.snapshotVersion,E=x.withLastLimboFreeSnapshotVersion(T);p.os=p.os.insert(v,E)}}}(r.localStore,s))}async function aD(t,e){const n=oe(t);if(!n.currentUser.isEqual(e)){ee("SyncEngine","User change. New user:",e.toKey());const r=await hT(n.localStore,e);n.currentUser=e,function(s,a){s.ka.forEach(u=>{u.forEach(h=>{h.reject(new te(H.CANCELLED,a))})}),s.ka.clear()}(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),await Ei(n,r.hs)}}function lD(t,e){const n=oe(t),r=n.Na.get(e);if(r&&r.va)return Pe().add(r.key);{let i=Pe();const s=n.Ma.get(e);if(!s)return i;for(const a of s){const u=n.Fa.get(a);i=i.unionWith(u.view.Va)}return i}}async function cD(t,e){const n=oe(t),r=await Wd(n.localStore,e.query,!0),i=e.view.ba(r);return n.isPrimaryClient&&hg(n,e.targetId,i.wa),i}async function uD(t,e){const n=oe(t);return pT(n.localStore,e).then(r=>Ei(n,r))}async function hD(t,e,n,r){const i=oe(t),s=await function(u,h){const m=oe(u),p=oe(m.mutationQueue);return m.persistence.runTransaction("Lookup mutation documents","readonly",_=>p.Mn(_,h).next(v=>v?m.localDocuments.getDocuments(_,v):q.resolve(null)))}(i.localStore,e);s!==null?(n==="pending"?await wl(i.remoteStore):n==="acknowledged"||n==="rejected"?(J_(i,e,r||null),Z_(i,e),function(u,h){oe(oe(u).mutationQueue).On(h)}(i.localStore,e)):de(),await Ei(i,s)):ee("SyncEngine","Cannot apply mutation batch with id: "+e)}async function dD(t,e){const n=oe(t);if(Lf(n),X_(n),e===!0&&n.Qa!==!0){const r=n.sharedClientState.getAllActiveQueryTargets(),i=await yx(n,r.toArray());n.Qa=!0,await cg(n.remoteStore,!0);for(const s of i)Df(n.remoteStore,s)}else if(e===!1&&n.Qa!==!1){const r=[];let i=Promise.resolve();n.Ma.forEach((s,a)=>{n.sharedClientState.isLocalQueryTarget(a)?r.push(a):i=i.then(()=>(il(n,a),tl(n.localStore,a,!0))),nl(n.remoteStore,a)}),await i,await yx(n,r),function(a){const u=oe(a);u.Na.forEach((h,m)=>{nl(u.remoteStore,m)}),u.La.pr(),u.Na=new Map,u.Oa=new Xe(le.comparator)}(n),n.Qa=!1,await cg(n.remoteStore,!1)}}async function yx(t,e,n){const r=oe(t),i=[],s=[];for(const a of e){let u;const h=r.Ma.get(a);if(h&&h.length!==0){u=await el(r.localStore,un(h[0]));for(const m of h){const p=r.Fa.get(m),_=await cD(r,p);_.snapshot&&s.push(_.snapshot)}}else{const m=await mT(r.localStore,a);u=await el(r.localStore,m),await Q_(r,RT(m),a,!1,u.resumeToken)}i.push(u)}return r.Ca.d_(s),i}function RT(t){return gE(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function fD(t){return function(n){return oe(oe(n).persistence).Qi()}(oe(t).localStore)}async function mD(t,e,n,r){const i=oe(t);if(i.Qa)return void ee("SyncEngine","Ignoring unexpected query state notification.");const s=i.Ma.get(e);if(s&&s.length>0)switch(n){case"current":case"not-current":{const a=await pT(i.localStore,xE(s[0])),u=ku.createSynthesizedRemoteEventForCurrentChange(e,n==="current",yt.EMPTY_BYTE_STRING);await Ei(i,a,u);break}case"rejected":await tl(i.localStore,e,!0),il(i,e,r);break;default:de()}}async function pD(t,e,n){const r=Lf(t);if(r.Qa){for(const i of e){if(r.Ma.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){ee("SyncEngine","Adding an already active target "+i);continue}const s=await mT(r.localStore,i),a=await el(r.localStore,s);await Q_(r,RT(s),a.targetId,!1,a.resumeToken),Df(r.remoteStore,a)}for(const i of n)r.Ma.has(i)&&await tl(r.localStore,i,!1).then(()=>{nl(r.remoteStore,i),il(r,i)}).catch(Ls)}}function Lf(t){const e=oe(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=AT.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=lD.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=nD.bind(null,e),e.Ca.d_=qj.bind(null,e.eventManager),e.Ca.$a=Gj.bind(null,e.eventManager),e}function X_(t){const e=oe(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=rD.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=iD.bind(null,e),e}function gD(t,e,n){const r=oe(t);(async function(s,a,u){try{const h=await a.getMetadata();if(await function(x,T){const E=oe(x),R=St(T.createTime);return E.persistence.runTransaction("hasNewerBundle","readonly",S=>E.Gr.getBundleMetadata(S,T.id)).then(S=>!!S&&S.createTime.compareTo(R)>=0)}(s.localStore,h))return await a.close(),u._completeWith(function(x){return{taskState:"Success",documentsLoaded:x.totalDocuments,bytesLoaded:x.totalBytes,totalDocuments:x.totalDocuments,totalBytes:x.totalBytes}}(h)),Promise.resolve(new Set);u._updateProgress(IT(h));const m=new Hj(h,s.localStore,a.serializer);let p=await a.Ua();for(;p;){const v=await m.la(p);v&&u._updateProgress(v),p=await a.Ua()}const _=await m.complete();return await Ei(s,_.Ia,void 0),await function(x,T){const E=oe(x);return E.persistence.runTransaction("Save bundle","readwrite",R=>E.Gr.saveBundleMetadata(R,T))}(s.localStore,h),u._completeWith(_.progress),Promise.resolve(_.Pa)}catch(h){return Jn("SyncEngine",`Loading bundle failed with ${h}`),u._failWith(h),Promise.resolve(new Set)}})(r,e,n).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}class Cs{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=ju(e.databaseInfo.databaseId),this.sharedClientState=this.Wa(e),this.persistence=this.Ga(e),await this.persistence.start(),this.localStore=this.za(e),this.gcScheduler=this.ja(e,this.localStore),this.indexBackfillerScheduler=this.Ha(e,this.localStore)}ja(e,n){return null}Ha(e,n){return null}za(e){return uT(this.persistence,new cT,e.initialUser,this.serializer)}Ga(e){return new L_(jf.Zr,this.serializer)}Wa(e){return new _T}async terminate(){var e,n;(e=this.gcScheduler)===null||e===void 0||e.stop(),(n=this.indexBackfillerScheduler)===null||n===void 0||n.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Cs.provider={build:()=>new Cs};class _D extends Cs{constructor(e){super(),this.cacheSizeBytes=e}ja(e,n){ge(this.persistence.referenceDelegate instanceof Gd);const r=this.persistence.referenceDelegate.garbageCollector;return new iT(r,e.asyncQueue,n)}Ga(e){const n=this.cacheSizeBytes!==void 0?an.withCacheSize(this.cacheSizeBytes):an.DEFAULT;return new L_(r=>Gd.Zr(r,n),this.serializer)}}class ev extends Cs{constructor(e,n,r){super(),this.Ja=e,this.cacheSizeBytes=n,this.forceOwnership=r,this.kind="persistent",this.synchronizeTabs=!1}async initialize(e){await super.initialize(e),await this.Ja.initialize(this,e),await X_(this.Ja.syncEngine),await wl(this.Ja.remoteStore),await this.persistence.yi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))}za(e){return uT(this.persistence,new cT,e.initialUser,this.serializer)}ja(e,n){const r=this.persistence.referenceDelegate.garbageCollector;return new iT(r,e.asyncQueue,n)}Ha(e,n){const r=new Fk(n,this.persistence);return new Ok(e.asyncQueue,r)}Ga(e){const n=V_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?an.withCacheSize(this.cacheSizeBytes):an.DEFAULT;return new M_(this.synchronizeTabs,n,e.clientId,r,e.asyncQueue,vT(),od(),this.serializer,this.sharedClientState,!!this.forceOwnership)}Wa(e){return new _T}}class jT extends ev{constructor(e,n){super(e,n,!1),this.Ja=e,this.cacheSizeBytes=n,this.synchronizeTabs=!0}async initialize(e){await super.initialize(e);const n=this.Ja.syncEngine;this.sharedClientState instanceof Fm&&(this.sharedClientState.syncEngine={no:hD.bind(null,n),ro:mD.bind(null,n),io:pD.bind(null,n),Qi:fD.bind(null,n),eo:uD.bind(null,n)},await this.sharedClientState.start()),await this.persistence.yi(async r=>{await dD(this.Ja.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())})}Wa(e){const n=vT();if(!Fm.D(n))throw new te(H.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=V_(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Fm(n,e.asyncQueue,r,e.clientId,e.initialUser)}}class Ps{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>vx(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=aD.bind(null,this.syncEngine),await cg(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return function(){return new $j}()}createDatastore(e){const n=ju(e.databaseInfo.databaseId),r=function(s){return new Sj(s)}(e.databaseInfo);return function(s,a,u,h){return new Nj(s,a,u,h)}(e.authCredentials,e.appCheckCredentials,r,n)}createRemoteStore(e){return function(r,i,s,a,u){return new kj(r,i,s,a,u)}(this.localStore,this.datastore,e.asyncQueue,n=>vx(this.syncEngine,n,0),function(){return dx.D()?new dx:new Ej}())}createSyncEngine(e,n){return function(i,s,a,u,h,m,p){const _=new Zj(i,s,a,u,h,m);return p&&(_.Qa=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){var e,n;await async function(i){const s=oe(i);ee("RemoteStore","RemoteStore shutting down."),s.L_.add(5),await xl(s),s.k_.shutdown(),s.q_.set("Unknown")}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate(),(n=this.eventManager)===null||n===void 0||n.terminate()}}Ps.provider={build:()=>new Ps};function xx(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const r={value:t.slice(n,n+e),done:!1};return n+=e,r}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.resolve()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mf{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ya(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ya(this.observer.error,e):Tt("Uncaught Error in snapshot listener:",e.toString()))}Za(){this.muted=!0}Ya(e,n){setTimeout(()=>{this.muted||e(n)},0)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vD{constructor(e,n){this.Xa=e,this.serializer=n,this.metadata=new Gt,this.buffer=new Uint8Array,this.eu=function(){return new TextDecoder("utf-8")}(),this.tu().then(r=>{r&&r.ua()?this.metadata.resolve(r.aa.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r==null?void 0:r.aa)}`))},r=>this.metadata.reject(r))}close(){return this.Xa.cancel()}async getMetadata(){return this.metadata.promise}async Ua(){return await this.getMetadata(),this.tu()}async tu(){const e=await this.nu();if(e===null)return null;const n=this.eu.decode(e),r=Number(n);isNaN(r)&&this.ru(`length string (${n}) is not valid number`);const i=await this.iu(r);return new Wj(JSON.parse(i),e.length+r)}su(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}async nu(){for(;this.su()<0&&!await this.ou(););if(this.buffer.length===0)return null;const e=this.su();e<0&&this.ru("Reached the end of bundle when a length string is expected.");const n=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),n}async iu(e){for(;this.buffer.length<e;)await this.ou()&&this.ru("Reached the end of bundle when more is expected.");const n=this.eu.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),n}ru(e){throw this.Xa.cancel(),new Error(`Invalid bundle format: ${e}`)}async ou(){const e=await this.Xa.read();if(!e.done){const n=new Uint8Array(this.buffer.length+e.value.length);n.set(this.buffer),n.set(e.value,this.buffer.length),this.buffer=n}return e.done}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yD{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new te(H.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const n=await async function(i,s){const a=oe(i),u={documents:s.map(_=>mu(a.serializer,_))},h=await a.Lo("BatchGetDocuments",a.serializer.databaseId,De.emptyPath(),u,s.length),m=new Map;h.forEach(_=>{const v=MR(a.serializer,_);m.set(v.key.toString(),v)});const p=[];return s.forEach(_=>{const v=m.get(_.toString());ge(!!v),p.push(v)}),p}(this.datastore,e);return n.forEach(r=>this.recordVersion(r)),n}set(e,n){this.write(n.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,n){try{this.write(n.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new yl(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach(n=>{e.delete(n.key.toString())}),e.forEach((n,r)=>{const i=le.fromPath(r);this.mutations.push(new I_(i,this.precondition(i)))}),await async function(r,i){const s=oe(r),a={writes:i.map(u=>pu(s.serializer,u))};await s.Mo("Commit",s.serializer.databaseId,De.emptyPath(),a)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let n;if(e.isFoundDocument())n=e.version;else{if(!e.isNoDocument())throw de();n=_e.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!n.isEqual(r))throw new te(H.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),n)}precondition(e){const n=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&n?n.isEqual(_e.min())?lt.exists(!1):lt.updateTime(n):lt.none()}preconditionForUpdate(e){const n=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&n){if(n.isEqual(_e.min()))throw new te(H.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return lt.updateTime(n)}return lt.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xD{constructor(e,n,r,i,s){this.asyncQueue=e,this.datastore=n,this.options=r,this.updateFunction=i,this.deferred=s,this._u=r.maxAttempts,this.t_=new z_(this.asyncQueue,"transaction_retry")}au(){this._u-=1,this.uu()}uu(){this.t_.Go(async()=>{const e=new yD(this.datastore),n=this.cu(e);n&&n.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.lu(i)}))}).catch(r=>{this.lu(r)})})}cu(e){try{const n=this.updateFunction(e);return!Su(n)&&n.catch&&n.then?n:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(n){return this.deferred.reject(n),null}}lu(e){this._u>0&&this.hu(e)?(this._u-=1,this.asyncQueue.enqueueAndForget(()=>(this.uu(),Promise.resolve()))):this.deferred.reject(e)}hu(e){if(e.name==="FirebaseError"){const n=e.code;return n==="aborted"||n==="failed-precondition"||n==="already-exists"||!DE(n)}return!1}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class wD{constructor(e,n,r,i,s){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=$t.UNAUTHENTICATED,this.clientId=Gb.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(r,async a=>{ee("FirestoreClient","Received user=",a.uid),await this.authCredentialListener(a),this.user=a}),this.appCheckCredentials.start(r,a=>(ee("FirestoreClient","Received new app check token=",a),this.appCheckCredentialListener(a,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Gt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const r=El(n,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Bm(t,e){t.asyncQueue.verifyOperationInProgress(),ee("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async i=>{r.isEqual(i)||(await hT(e.localStore,i),r=i)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function wx(t,e){t.asyncQueue.verifyOperationInProgress();const n=await tv(t);ee("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(r=>fx(e.remoteStore,r)),t.setAppCheckTokenChangeListener((r,i)=>fx(e.remoteStore,i)),t._onlineComponents=e}async function tv(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){ee("FirestoreClient","Using user provided OfflineComponentProvider");try{await Bm(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(i){return i.name==="FirebaseError"?i.code===H.FAILED_PRECONDITION||i.code===H.UNIMPLEMENTED:!(typeof DOMException<"u"&&i instanceof DOMException)||i.code===22||i.code===20||i.code===11}(n))throw n;Jn("Error using user provided cache. Falling back to memory cache: "+n),await Bm(t,new Cs)}}else ee("FirestoreClient","Using default OfflineComponentProvider"),await Bm(t,new Cs);return t._offlineComponents}async function Vf(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(ee("FirestoreClient","Using user provided OnlineComponentProvider"),await wx(t,t._uninitializedComponentsProvider._online)):(ee("FirestoreClient","Using default OnlineComponentProvider"),await wx(t,new Ps))),t._onlineComponents}function DT(t){return tv(t).then(e=>e.persistence)}function Tl(t){return tv(t).then(e=>e.localStore)}function LT(t){return Vf(t).then(e=>e.remoteStore)}function nv(t){return Vf(t).then(e=>e.syncEngine)}function MT(t){return Vf(t).then(e=>e.datastore)}async function sl(t){const e=await Vf(t),n=e.eventManager;return n.onListen=Jj.bind(null,e.syncEngine),n.onUnlisten=Xj.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Yj.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=eD.bind(null,e.syncEngine),n}function bD(t){return t.asyncQueue.enqueue(async()=>{const e=await DT(t),n=await LT(t);return e.setNetworkEnabled(!0),function(i){const s=oe(i);return s.L_.delete(0),Du(s)}(n)})}function ED(t){return t.asyncQueue.enqueue(async()=>{const e=await DT(t),n=await LT(t);return e.setNetworkEnabled(!1),async function(i){const s=oe(i);s.L_.add(0),await xl(s),s.q_.set("Offline")}(n)})}function TD(t,e){const n=new Gt;return t.asyncQueue.enqueueAndForget(async()=>async function(i,s,a){try{const u=await function(m,p){const _=oe(m);return _.persistence.runTransaction("read document","readonly",v=>_.localDocuments.getDocument(v,p))}(i,s);u.isFoundDocument()?a.resolve(u):u.isNoDocument()?a.resolve(null):a.reject(new te(H.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(u){const h=El(u,`Failed to get document '${s} from cache`);a.reject(h)}}(await Tl(t),e,n)),n.promise}function VT(t,e,n={}){const r=new Gt;return t.asyncQueue.enqueueAndForget(async()=>function(s,a,u,h,m){const p=new Mf({next:v=>{p.Za(),a.enqueueAndForget(()=>W_(s,_));const x=v.docs.has(u);!x&&v.fromCache?m.reject(new te(H.UNAVAILABLE,"Failed to get document because the client is offline.")):x&&v.fromCache&&h&&h.source==="server"?m.reject(new te(H.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):m.resolve(v)},error:v=>m.reject(v)}),_=new K_(_l(u.path),p,{includeMetadataChanges:!0,_a:!0});return G_(s,_)}(await sl(t),t.asyncQueue,e,n,r)),r.promise}function ID(t,e){const n=new Gt;return t.asyncQueue.enqueueAndForget(async()=>async function(i,s,a){try{const u=await Wd(i,s,!0),h=new PT(s,u.Ts),m=h.ma(u.documents),p=h.applyChanges(m,!1);a.resolve(p.snapshot)}catch(u){const h=El(u,`Failed to execute query '${s} against cache`);a.reject(h)}}(await Tl(t),e,n)),n.promise}function OT(t,e,n={}){const r=new Gt;return t.asyncQueue.enqueueAndForget(async()=>function(s,a,u,h,m){const p=new Mf({next:v=>{p.Za(),a.enqueueAndForget(()=>W_(s,_)),v.fromCache&&h.source==="server"?m.reject(new te(H.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):m.resolve(v)},error:v=>m.reject(v)}),_=new K_(u,p,{includeMetadataChanges:!0,_a:!0});return G_(s,_)}(await sl(t),t.asyncQueue,e,n,r)),r.promise}function SD(t,e,n){const r=new Gt;return t.asyncQueue.enqueueAndForget(async()=>{try{const i=await MT(t);r.resolve(async function(a,u,h){var m;const p=oe(a),{request:_,ut:v,parent:x}=WE(p.serializer,_E(u),h);p.connection.Fo||delete _.parent;const T=(await p.Lo("RunAggregationQuery",p.serializer.databaseId,x,_,1)).filter(R=>!!R.result);ge(T.length===1);const E=(m=T[0].result)===null||m===void 0?void 0:m.aggregateFields;return Object.keys(E).reduce((R,S)=>(R[v[S]]=E[S],R),{})}(i,e,n))}catch(i){r.reject(i)}}),r.promise}function CD(t,e){const n=new Mf(e);return t.asyncQueue.enqueueAndForget(async()=>function(i,s){oe(i).Y_.add(s),s.next()}(await sl(t),n)),()=>{n.Za(),t.asyncQueue.enqueueAndForget(async()=>function(i,s){oe(i).Y_.delete(s)}(await sl(t),n))}}function PD(t,e,n,r){const i=function(a,u){let h;return h=typeof a=="string"?ME().encode(a):a,function(p,_){return new vD(p,_)}(function(p,_){if(p instanceof Uint8Array)return xx(p,_);if(p instanceof ArrayBuffer)return xx(new Uint8Array(p),_);if(p instanceof ReadableStream)return p.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(h),u)}(n,ju(e));t.asyncQueue.enqueueAndForget(async()=>{gD(await nv(t),i,r)})}function ND(t,e){return t.asyncQueue.enqueue(async()=>function(r,i){const s=oe(r);return s.persistence.runTransaction("Get named query","readonly",a=>s.Gr.getNamedQuery(a,i))}(await Tl(t),e))}function AD(t,e){return t.asyncQueue.enqueue(async()=>async function(r,i){const s=oe(r),a=s.indexManager,u=[];return s.persistence.runTransaction("Configure indexes","readwrite",h=>a.getFieldIndexes(h).next(m=>function(_,v,x,T,E){_=[..._],v=[...v],_.sort(x),v.sort(x);const R=_.length,S=v.length;let C=0,A=0;for(;C<S&&A<R;){const U=x(_[A],v[C]);U<0?E(_[A++]):U>0?T(v[C++]):(C++,A++)}for(;C<S;)T(v[C++]);for(;A<R;)E(_[A++])}(m,i,Dk,p=>{u.push(a.addFieldIndex(h,p))},p=>{u.push(a.deleteFieldIndex(h,p))})).next(()=>q.waitFor(u)))}(await Tl(t),e))}function kD(t,e){return t.asyncQueue.enqueue(async()=>function(r,i){oe(r).ss.zi=i}(await Tl(t),e))}function RD(t){return t.asyncQueue.enqueue(async()=>function(n){const r=oe(n),i=r.indexManager;return r.persistence.runTransaction("Delete All Indexes","readwrite",s=>i.deleteAllFieldIndexes(s))}(await Tl(t)))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function FT(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const bx=new Map;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rv(t,e,n){if(!n)throw new te(H.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function jD(t,e,n,r){if(e===!0&&r===!0)throw new te(H.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Ex(t){if(!le.isDocumentKey(t))throw new te(H.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Tx(t){if(le.isDocumentKey(t))throw new te(H.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function Of(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=function(r){return r.constructor?r.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":de()}function Re(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new te(H.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Of(t);throw new te(H.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function zT(t,e){if(e<=0)throw new te(H.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ix{constructor(e){var n,r;if(e.host===void 0){if(e.ssl!==void 0)throw new te(H.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(n=e.ssl)===null||n===void 0||n;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new te(H.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}jD("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=FT((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new te(H.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new te(H.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new te(H.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Lu{constructor(e,n,r,i){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ix({}),this._settingsFrozen=!1,this._terminateTask="notTerminated"}get app(){if(!this._app)throw new te(H.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new te(H.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ix(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Sk;switch(r.type){case"firstParty":return new Ak(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new te(H.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(n){const r=bx.get(n);r&&(ee("ComponentProvider","Removing Datastore"),bx.delete(n),r.terminate())}(this),Promise.resolve()}}function DD(t,e,n,r={}){var i;const s=(t=Re(t,Lu))._getSettings(),a=`${e}:${n}`;if(s.host!=="firestore.googleapis.com"&&s.host!==a&&Jn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let u,h;if(typeof r.mockUserToken=="string")u=r.mockUserToken,h=$t.MOCK_USER;else{u=s2(r.mockUserToken,(i=t._app)===null||i===void 0?void 0:i.options.projectId);const m=r.mockUserToken.sub||r.mockUserToken.user_id;if(!m)throw new te(H.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new $t(m)}t._authCredentials=new Ck(new $b(u,h))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xt{constructor(e,n,r){this.converter=n,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Xt(this.firestore,e,this._query)}}class Ct{constructor(e,n,r){this.converter=n,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Or(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ct(this.firestore,e,this._key)}}class Or extends Xt{constructor(e,n,r){super(e,n,_l(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ct(this.firestore,null,new le(e))}withConverter(e){return new Or(this.firestore,e,this._path)}}function Um(t,e,...n){if(t=Wt(t),rv("collection","path",e),t instanceof Lu){const r=De.fromString(e,...n);return Tx(r),new Or(t,null,r)}{if(!(t instanceof Ct||t instanceof Or))throw new te(H.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(De.fromString(e,...n));return Tx(r),new Or(t.firestore,null,r)}}function ZL(t,e){if(t=Re(t,Lu),rv("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new te(H.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Xt(t,null,function(r){return new xi(De.emptyPath(),r)}(e))}function dg(t,e,...n){if(t=Wt(t),arguments.length===1&&(e=Gb.newId()),rv("doc","path",e),t instanceof Lu){const r=De.fromString(e,...n);return Ex(r),new Ct(t,null,new le(r))}{if(!(t instanceof Ct||t instanceof Or))throw new te(H.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(De.fromString(e,...n));return Ex(r),new Ct(t.firestore,t instanceof Or?t.converter:null,new le(r))}}function JL(t,e){return t=Wt(t),e=Wt(e),(t instanceof Ct||t instanceof Or)&&(e instanceof Ct||e instanceof Or)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function BT(t,e){return t=Wt(t),e=Wt(e),t instanceof Xt&&e instanceof Xt&&t.firestore===e.firestore&&Pu(t._query,e._query)&&t.converter===e.converter}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sx{constructor(e=Promise.resolve()){this.Pu=[],this.Iu=!1,this.Tu=[],this.Eu=null,this.du=!1,this.Au=!1,this.Ru=[],this.t_=new z_(this,"async_queue_retry"),this.Vu=()=>{const r=od();r&&ee("AsyncQueue","Visibility state changed to "+r.visibilityState),this.t_.jo()},this.mu=e;const n=od();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this.Vu)}get isShuttingDown(){return this.Iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.fu(),this.gu(e)}enterRestrictedMode(e){if(!this.Iu){this.Iu=!0,this.Au=e||!1;const n=od();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this.Vu)}}enqueue(e){if(this.fu(),this.Iu)return new Promise(()=>{});const n=new Gt;return this.gu(()=>this.Iu&&this.Au?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)).then(()=>n.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Pu.push(e),this.pu()))}async pu(){if(this.Pu.length!==0){try{await this.Pu[0](),this.Pu.shift(),this.t_.reset()}catch(e){if(!Ms(e))throw e;ee("AsyncQueue","Operation failed with retryable error: "+e)}this.Pu.length>0&&this.t_.Go(()=>this.pu())}}gu(e){const n=this.mu.then(()=>(this.du=!0,e().catch(r=>{this.Eu=r,this.du=!1;const i=function(a){let u=a.message||"";return a.stack&&(u=a.stack.includes(a.message)?a.stack:a.message+`
`+a.stack),u}(r);throw Tt("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.du=!1,r))));return this.mu=n,n}enqueueAfterDelay(e,n,r){this.fu(),this.Ru.indexOf(e)>-1&&(n=0);const i=q_.createAndSchedule(this,e,n,r,s=>this.yu(s));return this.Tu.push(i),i}fu(){this.Eu&&de()}verifyOperationInProgress(){}async wu(){let e;do e=this.mu,await e;while(e!==this.mu)}Su(e){for(const n of this.Tu)if(n.timerId===e)return!0;return!1}bu(e){return this.wu().then(()=>{this.Tu.sort((n,r)=>n.targetTimeMs-r.targetTimeMs);for(const n of this.Tu)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.wu()})}Du(e){this.Ru.push(e)}yu(e){const n=this.Tu.indexOf(e);this.Tu.splice(n,1)}}function fg(t){return function(n,r){if(typeof n!="object"||n===null)return!1;const i=n;for(const s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(t,["next","error","complete"])}class LD{constructor(){this._progressObserver={},this._taskCompletionResolver=new Gt,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,n,r){this._progressObserver={next:e,error:n,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,n){return this._taskCompletionResolver.promise.then(e,n)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const YL=-1;class Je extends Lu{constructor(e,n,r,i){super(e,n,r,i),this.type="firestore",this._queue=new Sx,this._persistenceKey=(i==null?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Sx(e),this._firestoreClient=void 0,await e}}}function XL(t,e,n){n||(n="(default)");const r=g_(t,"firestore");if(r.isInitialized(n)){const i=r.getImmediate({identifier:n}),s=r.getOptions(n);if(bo(s,e))return i;throw new te(H.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(e.cacheSizeBytes!==void 0&&e.localCache!==void 0)throw new te(H.INVALID_ARGUMENT,"cache and cacheSizeBytes cannot be specified at the same time as cacheSizeBytes willbe deprecated. Instead, specify the cache size in the cache object");if(e.cacheSizeBytes!==void 0&&e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new te(H.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return r.initialize({options:e,instanceIdentifier:n})}function eM(t,e){const n=typeof t=="object"?t:pk(),r=typeof t=="string"?t:e||"(default)",i=g_(n,"firestore").getImmediate({identifier:r});if(!i._initialized){const s=r2("firestore");s&&DD(i,...s)}return i}function gt(t){if(t._terminated)throw new te(H.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||UT(t),t._firestoreClient}function UT(t){var e,n,r;const i=t._freezeSettings(),s=function(u,h,m,p){return new oR(u,h,m,p.host,p.ssl,p.experimentalForceLongPolling,p.experimentalAutoDetectLongPolling,FT(p.experimentalLongPollingOptions),p.useFetchStreams)}(t._databaseId,((e=t._app)===null||e===void 0?void 0:e.options.appId)||"",t._persistenceKey,i);t._componentsProvider||!((n=i.localCache)===null||n===void 0)&&n._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(t._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),t._firestoreClient=new wD(t._authCredentials,t._appCheckCredentials,t._queue,s,t._componentsProvider&&function(u){const h=u==null?void 0:u._online.build();return{_offline:u==null?void 0:u._offline.build(h),_online:h}}(t._componentsProvider))}function tM(t,e){Jn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const n=t._freezeSettings();return $T(t,Ps.provider,{build:r=>new ev(r,n.cacheSizeBytes,e==null?void 0:e.forceOwnership)}),Promise.resolve()}async function nM(t){Jn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");const e=t._freezeSettings();$T(t,Ps.provider,{build:n=>new jT(n,e.cacheSizeBytes)})}function $T(t,e,n){if((t=Re(t,Je))._firestoreClient||t._terminated)throw new te(H.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.");if(t._componentsProvider||t._getSettings().localCache)throw new te(H.FAILED_PRECONDITION,"SDK cache is already specified.");t._componentsProvider={_online:e,_offline:n},UT(t)}function rM(t){if(t._initialized&&!t._terminated)throw new te(H.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Gt;return t._queue.enqueueAndForgetEvenWhileRestricted(async()=>{try{await async function(r){if(!Mr.D())return Promise.resolve();const i=r+"main";await Mr.delete(i)}(V_(t._databaseId,t._persistenceKey)),e.resolve()}catch(n){e.reject(n)}}),e.promise}function iM(t){return function(n){const r=new Gt;return n.asyncQueue.enqueueAndForget(async()=>sD(await nv(n),r)),r.promise}(gt(t=Re(t,Je)))}function sM(t){return bD(gt(t=Re(t,Je)))}function oM(t){return ED(gt(t=Re(t,Je)))}function aM(t){return ck(t.app,"firestore",t._databaseId.database),t._delete()}function lM(t,e){const n=gt(t=Re(t,Je)),r=new LD;return PD(n,t._databaseId,e,r),r}function cM(t,e){return ND(gt(t=Re(t,Je)),e).then(n=>n?new Xt(t,null,n.query):null)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class gu{constructor(e="count",n){this._internalFieldPath=n,this.type="AggregateField",this.aggregateType=e}}class MD{constructor(e,n,r){this._userDataWriter=n,this._data=r,this.type="AggregateQuerySnapshot",this.query=e}data(){return this._userDataWriter.convertObjectMap(this._data)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ro{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ro(yt.fromBase64String(e))}catch(n){throw new te(H.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Ro(yt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Lo{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new te(H.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new at(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}function uM(){return new Lo("__name__")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mo{constructor(e){this._methodName=e}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iv{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new te(H.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new te(H.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return be(this._lat,e._lat)||be(this._long,e._long)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ff{constructor(e){this._values=(e||[]).map(n=>n)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(r,i){if(r.length!==i.length)return!1;for(let s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(this._values,e._values)}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const VD=/^__.*__$/;class OD{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return this.fieldMask!==null?new bi(e,this.data,this.fieldMask,n,this.fieldTransforms):new vl(e,this.data,n,this.fieldTransforms)}}class qT{constructor(e,n,r){this.data=e,this.fieldMask=n,this.fieldTransforms=r}toMutation(e,n){return new bi(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function GT(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw de()}}class zf{constructor(e,n,r,i,s,a){this.settings=e,this.databaseId=n,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.vu(),this.fieldTransforms=s||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Cu(){return this.settings.Cu}Fu(e){return new zf(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Mu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.Fu({path:r,xu:!1});return i.Ou(e),i}Nu(e){var n;const r=(n=this.path)===null||n===void 0?void 0:n.child(e),i=this.Fu({path:r,xu:!1});return i.vu(),i}Lu(e){return this.Fu({path:void 0,xu:!0})}Bu(e){return Zd(e,this.settings.methodName,this.settings.ku||!1,this.path,this.settings.qu)}contains(e){return this.fieldMask.find(n=>e.isPrefixOf(n))!==void 0||this.fieldTransforms.find(n=>e.isPrefixOf(n.field))!==void 0}vu(){if(this.path)for(let e=0;e<this.path.length;e++)this.Ou(this.path.get(e))}Ou(e){if(e.length===0)throw this.Bu("Document fields must not be empty");if(GT(this.Cu)&&VD.test(e))throw this.Bu('Document fields cannot begin and end with "__"')}}class FD{constructor(e,n,r){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=r||ju(e)}Qu(e,n,r,i=!1){return new zf({Cu:e,methodName:n,qu:r,path:at.emptyPath(),xu:!1,ku:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Vo(t){const e=t._freezeSettings(),n=ju(t._databaseId);return new FD(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Bf(t,e,n,r,i,s={}){const a=t.Qu(s.merge||s.mergeFields?2:0,e,n,i);hv("Data must be an object, but it was:",a,r);const u=KT(r,a);let h,m;if(s.merge)h=new bn(a.fieldMask),m=a.fieldTransforms;else if(s.mergeFields){const p=[];for(const _ of s.mergeFields){const v=_u(e,_,n);if(!a.contains(v))throw new te(H.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);ZT(p,v)||p.push(v)}h=new bn(p),m=a.fieldTransforms.filter(_=>h.covers(_.field))}else h=null,m=a.fieldTransforms;return new OD(new Zt(u),h,m)}class Mu extends Mo{_toFieldTransform(e){if(e.Cu!==2)throw e.Cu===1?e.Bu(`${this._methodName}() can only appear at the top level of your update data`):e.Bu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Mu}}function WT(t,e,n){return new zf({Cu:3,qu:e.settings.qu,methodName:t._methodName,xu:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class sv extends Mo{_toFieldTransform(e){return new Au(e.path,new Ja)}isEqual(e){return e instanceof sv}}class ov extends Mo{constructor(e,n){super(e),this.Ku=n}_toFieldTransform(e){const n=WT(this,e,!0),r=this.Ku.map(s=>Oo(s,n)),i=new Co(r);return new Au(e.path,i)}isEqual(e){return e instanceof ov&&bo(this.Ku,e.Ku)}}class av extends Mo{constructor(e,n){super(e),this.Ku=n}_toFieldTransform(e){const n=WT(this,e,!0),r=this.Ku.map(s=>Oo(s,n)),i=new Po(r);return new Au(e.path,i)}isEqual(e){return e instanceof av&&bo(this.Ku,e.Ku)}}class lv extends Mo{constructor(e,n){super(e),this.$u=n}_toFieldTransform(e){const n=new Ya(e.serializer,SE(e.serializer,this.$u));return new Au(e.path,n)}isEqual(e){return e instanceof lv&&this.$u===e.$u}}function cv(t,e,n,r){const i=t.Qu(1,e,n);hv("Data must be an object, but it was:",i,r);const s=[],a=Zt.empty();Vs(r,(h,m)=>{const p=Uf(e,h,n);m=Wt(m);const _=i.Nu(p);if(m instanceof Mu)s.push(p);else{const v=Oo(m,_);v!=null&&(s.push(p),a.set(p,v))}});const u=new bn(s);return new qT(a,u,i.fieldTransforms)}function uv(t,e,n,r,i,s){const a=t.Qu(1,e,n),u=[_u(e,r,n)],h=[i];if(s.length%2!=0)throw new te(H.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<s.length;v+=2)u.push(_u(e,s[v])),h.push(s[v+1]);const m=[],p=Zt.empty();for(let v=u.length-1;v>=0;--v)if(!ZT(m,u[v])){const x=u[v];let T=h[v];T=Wt(T);const E=a.Nu(x);if(T instanceof Mu)m.push(x);else{const R=Oo(T,E);R!=null&&(m.push(x),p.set(x,R))}}const _=new bn(m);return new qT(p,_,a.fieldTransforms)}function HT(t,e,n,r=!1){return Oo(n,t.Qu(r?4:3,e))}function Oo(t,e){if(QT(t=Wt(t)))return hv("Unsupported field value:",e,t),KT(t,e);if(t instanceof Mo)return function(r,i){if(!GT(i.Cu))throw i.Bu(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Bu(`${r._methodName}() is not currently supported inside arrays`);const s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.xu&&e.Cu!==4)throw e.Bu("Nested arrays are not supported");return function(r,i){const s=[];let a=0;for(const u of r){let h=Oo(u,i.Lu(a));h==null&&(h={nullValue:"NULL_VALUE"}),s.push(h),a++}return{arrayValue:{values:s}}}(t,e)}return function(r,i){if((r=Wt(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return SE(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const s=ct.fromDate(r);return{timestampValue:Xa(i.serializer,s)}}if(r instanceof ct){const s=new ct(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Xa(i.serializer,s)}}if(r instanceof iv)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Ro)return{bytesValue:FE(i.serializer,r._byteString)};if(r instanceof Ct){const s=i.databaseId,a=r.firestore._databaseId;if(!a.isEqual(s))throw i.Bu(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:A_(r.firestore._databaseId||i.databaseId,r._key.path)}}if(r instanceof Ff)return function(a,u){return{mapValue:{fields:{__type__:{stringValue:"__vector__"},value:{arrayValue:{values:a.toArray().map(h=>{if(typeof h!="number")throw u.Bu("VectorValues must only contain numeric values.");return T_(u.serializer,h)})}}}}}}(r,i);throw i.Bu(`Unsupported field value: ${Of(r)}`)}(t,e)}function KT(t,e){const n={};return iE(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Vs(t,(r,i)=>{const s=Oo(i,e.Mu(r));s!=null&&(n[r]=s)}),{mapValue:{fields:n}}}function QT(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof ct||t instanceof iv||t instanceof Ro||t instanceof Ct||t instanceof Mo||t instanceof Ff)}function hv(t,e,n){if(!QT(n)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(n)){const r=Of(n);throw r==="an object"?e.Bu(t+" a custom object"):e.Bu(t+" "+r)}}function _u(t,e,n){if((e=Wt(e))instanceof Lo)return e._internalPath;if(typeof e=="string")return Uf(t,e);throw Zd("Field path arguments must be of type string or ",t,!1,void 0,n)}const zD=new RegExp("[~\\*/\\[\\]]");function Uf(t,e,n){if(e.search(zD)>=0)throw Zd(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Lo(...e.split("."))._internalPath}catch{throw Zd(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Zd(t,e,n,r,i){const s=r&&!r.isEmpty(),a=i!==void 0;let u=`Function ${e}() called with invalid data`;n&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(s||a)&&(h+=" (found",s&&(h+=` in field ${r}`),a&&(h+=` in document ${i}`),h+=")"),new te(H.INVALID_ARGUMENT,u+t+h)}function ZT(t,e){return t.some(n=>n.isEqual(e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vu{constructor(e,n,r,i,s){this._firestore=e,this._userDataWriter=n,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Ct(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new BD(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field($f("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class BD extends vu{data(){return super.data()}}function $f(t,e){return typeof e=="string"?Uf(t,e):e instanceof Lo?e._internalPath:e._delegate._internalPath}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function JT(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new te(H.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class dv{}class Vu extends dv{}function Cx(t,e,...n){let r=[];e instanceof dv&&r.push(e),r=r.concat(n),function(s){const a=s.filter(h=>h instanceof Il).length,u=s.filter(h=>h instanceof Ou).length;if(a>1||a>0&&u>0)throw new te(H.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)t=i._apply(t);return t}class Ou extends Vu{constructor(e,n,r){super(),this._field=e,this._op=n,this._value=r,this.type="where"}static _create(e,n,r){return new Ou(e,n,r)}_apply(e){const n=this._parse(e);return XT(e._query,n),new Xt(e.firestore,e.converter,eg(e._query,n))}_parse(e){const n=Vo(e.firestore);return function(s,a,u,h,m,p,_){let v;if(m.isKeyField()){if(p==="array-contains"||p==="array-contains-any")throw new te(H.INVALID_ARGUMENT,`Invalid Query. You can't perform '${p}' queries on documentId().`);if(p==="in"||p==="not-in"){Ax(_,p);const x=[];for(const T of _)x.push(Nx(h,s,T));v={arrayValue:{values:x}}}else v=Nx(h,s,_)}else p!=="in"&&p!=="not-in"&&p!=="array-contains-any"||Ax(_,p),v=HT(u,a,_,p==="in"||p==="not-in");return Me.create(m,p,v)}(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function Px(t,e,n){const r=e,i=$f("where",t);return Ou._create(i,r,n)}class Il extends dv{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new Il(e,n)}_parse(e){const n=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return n.length===1?n[0]:We.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:(function(i,s){let a=i;const u=s.getFlattenedFilters();for(const h of u)XT(a,h),a=eg(a,h)}(e._query,n),new Xt(e.firestore,e.converter,eg(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function hM(...t){return t.forEach(e=>eI("or",e)),Il._create("or",t)}function dM(...t){return t.forEach(e=>eI("and",e)),Il._create("and",t)}class fv extends Vu{constructor(e,n){super(),this._field=e,this._direction=n,this.type="orderBy"}static _create(e,n){return new fv(e,n)}_apply(e){const n=function(i,s,a){if(i.startAt!==null)throw new te(H.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new te(H.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new fu(s,a)}(e._query,this._field,this._direction);return new Xt(e.firestore,e.converter,function(i,s){const a=i.explicitOrderBy.concat([s]);return new xi(i.path,i.collectionGroup,a,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,n))}}function fM(t,e="asc"){const n=e,r=$f("orderBy",t);return fv._create(r,n)}class qf extends Vu{constructor(e,n,r){super(),this.type=e,this._limit=n,this._limitType=r}static _create(e,n,r){return new qf(e,n,r)}_apply(e){return new Xt(e.firestore,e.converter,zd(e._query,this._limit,this._limitType))}}function mM(t){return zT("limit",t),qf._create("limit",t,"F")}function pM(t){return zT("limitToLast",t),qf._create("limitToLast",t,"L")}class Gf extends Vu{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new Gf(e,n,r)}_apply(e){const n=YT(e,this.type,this._docOrFields,this._inclusive);return new Xt(e.firestore,e.converter,function(i,s){return new xi(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,n))}}function gM(...t){return Gf._create("startAt",t,!0)}function _M(...t){return Gf._create("startAfter",t,!1)}class Wf extends Vu{constructor(e,n,r){super(),this.type=e,this._docOrFields=n,this._inclusive=r}static _create(e,n,r){return new Wf(e,n,r)}_apply(e){const n=YT(e,this.type,this._docOrFields,this._inclusive);return new Xt(e.firestore,e.converter,function(i,s){return new xi(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,n))}}function vM(...t){return Wf._create("endBefore",t,!1)}function yM(...t){return Wf._create("endAt",t,!0)}function YT(t,e,n,r){if(n[0]=Wt(n[0]),n[0]instanceof vu)return function(s,a,u,h,m){if(!h)throw new te(H.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const p=[];for(const _ of Da(s))if(_.field.isKeyField())p.push(Io(a,h.key));else{const v=h.data.field(_.field);if(If(v))throw new te(H.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+_.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(v===null){const x=_.field.canonicalString();throw new te(H.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${x}' (used as the orderBy) does not exist.`)}p.push(v)}return new Is(p,m)}(t._query,t.firestore._databaseId,e,n[0]._document,r);{const i=Vo(t.firestore);return function(a,u,h,m,p,_){const v=a.explicitOrderBy;if(p.length>v.length)throw new te(H.INVALID_ARGUMENT,`Too many arguments provided to ${m}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const x=[];for(let T=0;T<p.length;T++){const E=p[T];if(v[T].field.isKeyField()){if(typeof E!="string")throw new te(H.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${m}(), but got a ${typeof E}`);if(!b_(a)&&E.indexOf("/")!==-1)throw new te(H.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${m}() must be a plain document ID, but '${E}' contains a slash.`);const R=a.path.child(De.fromString(E));if(!le.isDocumentKey(R))throw new te(H.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${m}() must result in a valid document path, but '${R}' is not because it contains an odd number of segments.`);const S=new le(R);x.push(Io(u,S))}else{const R=HT(h,m,E);x.push(R)}}return new Is(x,_)}(t._query,t.firestore._databaseId,i,e,n,r)}}function Nx(t,e,n){if(typeof(n=Wt(n))=="string"){if(n==="")throw new te(H.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!b_(e)&&n.indexOf("/")!==-1)throw new te(H.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const r=e.path.child(De.fromString(n));if(!le.isDocumentKey(r))throw new te(H.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Io(t,new le(r))}if(n instanceof Ct)return Io(t,n._key);throw new te(H.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Of(n)}.`)}function Ax(t,e){if(!Array.isArray(t)||t.length===0)throw new te(H.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function XT(t,e){const n=function(i,s){for(const a of i)for(const u of a.getFlattenedFilters())if(s.indexOf(u.op)>=0)return u.op;return null}(t.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(n!==null)throw n===e.op?new te(H.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new te(H.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}function eI(t,e){if(!(e instanceof Ou||e instanceof Il))throw new te(H.INVALID_ARGUMENT,`Function ${t}() requires AppliableConstraints created with a call to 'where(...)', 'or(...)', or 'and(...)'.`)}class tI{convertValue(e,n="none"){switch(Es(e)){case 0:return null;case 1:return e.booleanValue;case 2:return st(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(_i(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw de()}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const r={};return Vs(e,(i,s)=>{r[i]=this.convertValue(s,n)}),r}convertVectorValue(e){var n,r,i;const s=(i=(r=(n=e.fields)===null||n===void 0?void 0:n.value.arrayValue)===null||r===void 0?void 0:r.values)===null||i===void 0?void 0:i.map(a=>st(a.doubleValue));return new Ff(s)}convertGeoPoint(e){return new iv(st(e.latitude),st(e.longitude))}convertArray(e,n){return(e.values||[]).map(r=>this.convertValue(r,n))}convertServerTimestamp(e,n){switch(n){case"previous":const r=Sf(e);return r==null?null:this.convertValue(r,n);case"estimate":return this.convertTimestamp(uu(e));default:return null}}convertTimestamp(e){const n=gi(e);return new ct(n.seconds,n.nanos)}convertDocumentKey(e,n){const r=De.fromString(e);ge(ZE(r));const i=new To(r.get(1),r.get(3)),s=new le(r.popFirst(5));return i.isEqual(n)||Tt(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),s}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hf(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}class UD extends tI{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ro(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Ct(this.firestore,null,n)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xM(t){return new gu("sum",_u("sum",t))}function wM(t){return new gu("avg",_u("average",t))}function $D(){return new gu("count")}function bM(t,e){var n,r;return t instanceof gu&&e instanceof gu&&t.aggregateType===e.aggregateType&&((n=t._internalFieldPath)===null||n===void 0?void 0:n.canonicalString())===((r=e._internalFieldPath)===null||r===void 0?void 0:r.canonicalString())}function EM(t,e){return BT(t.query,e.query)&&bo(t.data(),e.data())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ho{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ol extends vu{constructor(e,n,r,i,s,a){super(e,n,r,i,a),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new ad(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const r=this._document.data.field($f("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,n.serverTimestamps)}}}class ad extends ol{data(e={}){return super.data(e)}}class al{constructor(e,n,r,i){this._firestore=e,this._userDataWriter=n,this._snapshot=i,this.metadata=new ho(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(n=>e.push(n)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach(r=>{e.call(n,new ad(this._firestore,this._userDataWriter,r.key,r,new ho(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new te(H.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let a=0;return i._snapshot.docChanges.map(u=>{const h=new ad(i._firestore,i._userDataWriter,u.doc.key,u.doc,new ho(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}})}{let a=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>s||u.type!==3).map(u=>{const h=new ad(i._firestore,i._userDataWriter,u.doc.key,u.doc,new ho(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let m=-1,p=-1;return u.type!==0&&(m=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),p=a.indexOf(u.doc.key)),{type:qD(u.type),doc:h,oldIndex:m,newIndex:p}})}}(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}}function qD(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return de()}}function TM(t,e){return t instanceof ol&&e instanceof ol?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(t._document===null?e._document===null:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof al&&e instanceof al&&t._firestore===e._firestore&&BT(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IM(t){t=Re(t,Ct);const e=Re(t.firestore,Je);return VT(gt(e),t._key).then(n=>mv(e,t,n))}class Fs extends tI{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ro(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Ct(this.firestore,null,n)}}function SM(t){t=Re(t,Ct);const e=Re(t.firestore,Je),n=gt(e),r=new Fs(e);return TD(n,t._key).then(i=>new ol(e,r,t._key,i,new ho(i!==null&&i.hasLocalMutations,!0),t.converter))}function CM(t){t=Re(t,Ct);const e=Re(t.firestore,Je);return VT(gt(e),t._key,{source:"server"}).then(n=>mv(e,t,n))}function kx(t){t=Re(t,Xt);const e=Re(t.firestore,Je),n=gt(e),r=new Fs(e);return JT(t._query),OT(n,t._query).then(i=>new al(e,r,t,i))}function PM(t){t=Re(t,Xt);const e=Re(t.firestore,Je),n=gt(e),r=new Fs(e);return ID(n,t._query).then(i=>new al(e,r,t,i))}function NM(t){t=Re(t,Xt);const e=Re(t.firestore,Je),n=gt(e),r=new Fs(e);return OT(n,t._query,{source:"server"}).then(i=>new al(e,r,t,i))}function GD(t,e,n){t=Re(t,Ct);const r=Re(t.firestore,Je),i=Hf(t.converter,e,n);return Fu(r,[Bf(Vo(r),"setDoc",t._key,i,t.converter!==null,n).toMutation(t._key,lt.none())])}function WD(t,e,n,...r){t=Re(t,Ct);const i=Re(t.firestore,Je),s=Vo(i);let a;return a=typeof(e=Wt(e))=="string"||e instanceof Lo?uv(s,"updateDoc",t._key,e,n,r):cv(s,"updateDoc",t._key,e),Fu(i,[a.toMutation(t._key,lt.exists(!0))])}function AM(t){return Fu(Re(t.firestore,Je),[new yl(t._key,lt.none())])}function kM(t,e){const n=Re(t.firestore,Je),r=dg(t),i=Hf(t.converter,e);return Fu(n,[Bf(Vo(t.firestore),"addDoc",r._key,i,t.converter!==null,{}).toMutation(r._key,lt.exists(!1))]).then(()=>r)}function RM(t,...e){var n,r,i;t=Wt(t);let s={includeMetadataChanges:!1,source:"default"},a=0;typeof e[a]!="object"||fg(e[a])||(s=e[a],a++);const u={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(fg(e[a])){const _=e[a];e[a]=(n=_.next)===null||n===void 0?void 0:n.bind(_),e[a+1]=(r=_.error)===null||r===void 0?void 0:r.bind(_),e[a+2]=(i=_.complete)===null||i===void 0?void 0:i.bind(_)}let h,m,p;if(t instanceof Ct)m=Re(t.firestore,Je),p=_l(t._key.path),h={next:_=>{e[a]&&e[a](mv(m,t,_))},error:e[a+1],complete:e[a+2]};else{const _=Re(t,Xt);m=Re(_.firestore,Je),p=_._query;const v=new Fs(m);h={next:x=>{e[a]&&e[a](new al(m,v,_,x))},error:e[a+1],complete:e[a+2]},JT(t._query)}return function(v,x,T,E){const R=new Mf(E),S=new K_(x,R,T);return v.asyncQueue.enqueueAndForget(async()=>G_(await sl(v),S)),()=>{R.Za(),v.asyncQueue.enqueueAndForget(async()=>W_(await sl(v),S))}}(gt(m),p,u,h)}function jM(t,e){return CD(gt(t=Re(t,Je)),fg(e)?e:{next:e})}function Fu(t,e){return function(r,i){const s=new Gt;return r.asyncQueue.enqueueAndForget(async()=>tD(await nv(r),i,s)),s.promise}(gt(t),e)}function mv(t,e,n){const r=n.docs.get(e._key),i=new Fs(t);return new ol(t,i,e._key,r,new ho(n.hasPendingWrites,n.fromCache),e.converter)}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function DM(t){return HD(t,{count:$D()})}function HD(t,e){const n=Re(t.firestore,Je),r=gt(n),i=rE(e,(s,a)=>new jE(a,s.aggregateType,s._internalFieldPath));return SD(r,t._query,i).then(s=>function(u,h,m){const p=new Fs(u);return new MD(h,p,m)}(n,t,s))}class KD{constructor(e){this.kind="memory",this._onlineComponentProvider=Ps.provider,e!=null&&e.garbageCollector?this._offlineComponentProvider=e.garbageCollector._offlineComponentProvider:this._offlineComponentProvider=Cs.provider}toJSON(){return{kind:this.kind}}}class QD{constructor(e){let n;this.kind="persistent",e!=null&&e.tabManager?(e.tabManager._initialize(e),n=e.tabManager):(n=eL(void 0),n._initialize(e)),this._onlineComponentProvider=n._onlineComponentProvider,this._offlineComponentProvider=n._offlineComponentProvider}toJSON(){return{kind:this.kind}}}class ZD{constructor(){this.kind="memoryEager",this._offlineComponentProvider=Cs.provider}toJSON(){return{kind:this.kind}}}class JD{constructor(e){this.kind="memoryLru",this._offlineComponentProvider={build:()=>new _D(e)}}toJSON(){return{kind:this.kind}}}function LM(){return new ZD}function MM(t){return new JD(t==null?void 0:t.cacheSizeBytes)}function VM(t){return new KD(t)}function OM(t){return new QD(t)}class YD{constructor(e){this.forceOwnership=e,this.kind="persistentSingleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Ps.provider,this._offlineComponentProvider={build:n=>new ev(n,e==null?void 0:e.cacheSizeBytes,this.forceOwnership)}}}class XD{constructor(){this.kind="PersistentMultipleTab"}toJSON(){return{kind:this.kind}}_initialize(e){this._onlineComponentProvider=Ps.provider,this._offlineComponentProvider={build:n=>new jT(n,e==null?void 0:e.cacheSizeBytes)}}}function eL(t){return new YD(t==null?void 0:t.forceOwnership)}function FM(){return new XD}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tL={maxAttempts:5};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nL{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=Vo(e)}set(e,n,r){this._verifyNotCommitted();const i=is(e,this._firestore),s=Hf(i.converter,n,r),a=Bf(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(a.toMutation(i._key,lt.none())),this}update(e,n,r,...i){this._verifyNotCommitted();const s=is(e,this._firestore);let a;return a=typeof(n=Wt(n))=="string"||n instanceof Lo?uv(this._dataReader,"WriteBatch.update",s._key,n,r,i):cv(this._dataReader,"WriteBatch.update",s._key,n),this._mutations.push(a.toMutation(s._key,lt.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=is(e,this._firestore);return this._mutations=this._mutations.concat(new yl(n._key,lt.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new te(H.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function is(t,e){if((t=Wt(t)).firestore!==e)throw new te(H.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *//**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rL extends class{constructor(n,r){this._firestore=n,this._transaction=r,this._dataReader=Vo(n)}get(n){const r=is(n,this._firestore),i=new UD(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return de();const a=s[0];if(a.isFoundDocument())return new vu(this._firestore,i,a.key,a,r.converter);if(a.isNoDocument())return new vu(this._firestore,i,r._key,null,r.converter);throw de()})}set(n,r,i){const s=is(n,this._firestore),a=Hf(s.converter,r,i),u=Bf(this._dataReader,"Transaction.set",s._key,a,s.converter!==null,i);return this._transaction.set(s._key,u),this}update(n,r,i,...s){const a=is(n,this._firestore);let u;return u=typeof(r=Wt(r))=="string"||r instanceof Lo?uv(this._dataReader,"Transaction.update",a._key,r,i,s):cv(this._dataReader,"Transaction.update",a._key,r),this._transaction.update(a._key,u),this}delete(n){const r=is(n,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,n){super(e,n),this._firestore=e}get(e){const n=is(e,this._firestore),r=new Fs(this._firestore);return super.get(e).then(i=>new ol(this._firestore,r,n._key,i._document,new ho(!1,!1),n.converter))}}function BM(t,e,n){t=Re(t,Je);const r=Object.assign(Object.assign({},tL),n);return function(s){if(s.maxAttempts<1)throw new te(H.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,a,u){const h=new Gt;return s.asyncQueue.enqueueAndForget(async()=>{const m=await MT(s);new xD(s.asyncQueue,m,u,a,h).au()}),h.promise}(gt(t),i=>e(new rL(t,i)),r)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function UM(){return new Mu("deleteField")}function $M(){return new sv("serverTimestamp")}function qM(...t){return new ov("arrayUnion",t)}function GM(...t){return new av("arrayRemove",t)}function WM(t){return new lv("increment",t)}function HM(t){return new Ff(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function KM(t){return gt(t=Re(t,Je)),new nL(t,e=>Fu(t,e))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function QM(t,e){const n=gt(t=Re(t,Je));if(!n._uninitializedComponentsProvider||n._uninitializedComponentsProvider._offline.kind==="memory")return Jn("Cannot enable indexes when persistence is disabled"),Promise.resolve();const r=function(s){const a=typeof s=="string"?function(m){try{return JSON.parse(m)}catch(p){throw new te(H.INVALID_ARGUMENT,"Failed to parse JSON: "+(p==null?void 0:p.message))}}(s):s,u=[];if(Array.isArray(a.indexes))for(const h of a.indexes){const m=Rx(h,"collectionGroup"),p=[];if(Array.isArray(h.fields))for(const _ of h.fields){const v=Uf("setIndexConfiguration",Rx(_,"fieldPath"));_.arrayConfig==="CONTAINS"?p.push(new go(v,2)):_.order==="ASCENDING"?p.push(new go(v,0)):_.order==="DESCENDING"&&p.push(new go(v,1))}u.push(new Ha(Ha.UNKNOWN_ID,m,p,Ka.empty()))}return u}(e);return AD(n,r)}function Rx(t,e){if(typeof t[e]!="string")throw new te(H.INVALID_ARGUMENT,"Missing string value for: "+e);return t[e]}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class iL{constructor(e){this._firestore=e,this.type="PersistentCacheIndexManager"}}function ZM(t){var e;t=Re(t,Je);const n=jx.get(t);if(n)return n;if(((e=gt(t)._uninitializedComponentsProvider)===null||e===void 0?void 0:e._offline.kind)!=="persistent")return null;const r=new iL(t);return jx.set(t,r),r}function JM(t){nI(t,!0)}function YM(t){nI(t,!1)}function XM(t){RD(gt(t._firestore)).then(e=>ee("deleting all persistent cache indexes succeeded")).catch(e=>Jn("deleting all persistent cache indexes failed",e))}function nI(t,e){kD(gt(t._firestore),e).then(n=>ee(`setting persistent cache index auto creation isEnabled=${e} succeeded`)).catch(n=>Jn(`setting persistent cache index auto creation isEnabled=${e} failed`,n))}const jx=new WeakMap;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function eV(t){var e;const n=(e=gt(Re(t.firestore,Je))._onlineComponents)===null||e===void 0?void 0:e.datastore.serializer;return n===void 0?null:Af(n,un(t._query))._t}function tV(t,e){var n;const r=rE(e,(s,a)=>new jE(a,s.aggregateType,s._internalFieldPath)),i=(n=gt(Re(t.firestore,Je))._onlineComponents)===null||n===void 0?void 0:n.datastore.serializer;return i===void 0?null:WE(i,_E(t._query),r,!0).request}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nV{constructor(){throw new Error("instances of this class should not be created")}static onExistenceFilterMismatch(e){return pv.instance.onExistenceFilterMismatch(e)}}class pv{constructor(){this.Uu=new Map}static get instance(){return zh||(zh=new pv,function(n){if(Bd)throw new Error("a TestingHooksSpi instance is already set");Bd=n}(zh)),zh}et(e){this.Uu.forEach(n=>n(e))}onExistenceFilterMismatch(e){const n=Symbol(),r=this.Uu;return r.set(n,e),()=>r.delete(n)}}let zh=null;(function(e,n=!0){(function(i){gl=i})(fk),Vd(new iu("firestore",(r,{instanceIdentifier:i,options:s})=>{const a=r.getProvider("app").getImmediate(),u=new Je(new Pk(r.getProvider("auth-internal")),new kk(r.getProvider("app-check-internal")),function(m,p){if(!Object.prototype.hasOwnProperty.apply(m.options,["projectId"]))throw new te(H.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new To(m.options.projectId,p)}(a,i),a);return s=Object.assign({useFetchStreams:n},s),u._setSettings(s),u},"PUBLIC").setMultipleInstances(!0)),ja(y0,"4.7.3",e),ja(y0,"4.7.3","esm2017")})();class sL{constructor(){Pr(this,"collectionName","registries")}async getRegistryByCaseId(e){console.log("Registry service: Getting registry for case",e);try{if(ui.demoMode)return this.getMockRegistryByCaseId(e);const n=Um(Sa,this.collectionName),r=Cx(n,Px("caseId","==",e)),i=await kx(r);if(!i.empty){const s=i.docs[0];return{id:s.id,...s.data()}}return null}catch(n){throw console.error("Failed to get registry:",n),n}}async saveRegistry(e){console.log("Registry service: Saving registry",e);try{if(ui.demoMode)return this.saveMockRegistry(e);const n=ct.now(),r={...e,updatedAt:n};if(e.id){const i=dg(Sa,this.collectionName,e.id);return await WD(i,r),e.id}else{r.createdAt=n;const i=dg(Um(Sa,this.collectionName));return await GD(i,r),i.id}}catch(n){throw console.error("Failed to save registry:",n),n}}async getCompletedRegistries(){console.log("Registry service: Getting completed registries");try{if(ui.demoMode)return this.getMockCompletedRegistries();const e=Um(Sa,this.collectionName),n=Cx(e,Px("isCompleted","==",!0));return(await kx(n)).docs.map(i=>({id:i.id,...i.data()}))}catch(e){throw console.error("Failed to get completed registries:",e),e}}async exportRegistriesToCSV(e){const n=["レジストリ番号","患者番号","年齢","性別","医療機関","ドクターカー覚知時刻","ドクターカー現着時刻","ドクターカー接触時刻","ドクターカー現発時刻","ドクターカー病着時刻","出動要請基準","発症前ADL","現場アクセス","出動番地","発生場所","GCS合計","GCS-E","GCS-V","GCS-M","血圧","脈拍","呼吸","体温","SpO2","酸素","瞳孔","対光反射","搬送先","該当分類","推定病名","ドクターカー活動の問題点"],r=e.map(s=>{var a,u,h,m,p,_,v,x,T,E,R,S,C,A,U,Z,V,k,N,D,M,F,z,j,me,Ve,Te,se,W,fe,X,Y;return[s.registryNumber||"",s.patientNumber||"",((a=s.patientAge)==null?void 0:a.toString())||"",this.formatGender(s.patientGender),this.formatMedicalInstitution(s.medicalInstitution),this.formatTimestamp((u=s.timelineDoctorCar)==null?void 0:u.awareness),this.formatTimestamp((h=s.timelineDoctorCar)==null?void 0:h.arrival),this.formatTimestamp((m=s.timelineDoctorCar)==null?void 0:m.contact),this.formatTimestamp((p=s.timelineDoctorCar)==null?void 0:p.departure),this.formatTimestamp((_=s.timelineDoctorCar)==null?void 0:_.hospitalArrival),this.formatDispatchCriteria(s.dispatchCriteria),this.formatPreOnsetADL(s.preOnsetADL),this.formatSceneAccess(s.sceneAccess),s.dispatchVehicle||"",this.formatLocation(s.location),((T=(x=(v=s.vitals)==null?void 0:v.gcs)==null?void 0:x.total)==null?void 0:T.toString())||"",((S=(R=(E=s.vitals)==null?void 0:E.gcs)==null?void 0:R.eye)==null?void 0:S.toString())||"",((U=(A=(C=s.vitals)==null?void 0:C.gcs)==null?void 0:A.verbal)==null?void 0:U.toString())||"",((k=(V=(Z=s.vitals)==null?void 0:Z.gcs)==null?void 0:V.motor)==null?void 0:k.toString())||"",this.formatBloodPressure((N=s.vitals)==null?void 0:N.bloodPressure),((M=(D=s.vitals)==null?void 0:D.pulse)==null?void 0:M.toString())||"",((z=(F=s.vitals)==null?void 0:F.respiration)==null?void 0:z.toString())||"",((me=(j=s.vitals)==null?void 0:j.temperature)==null?void 0:me.toString())||"",((Te=(Ve=s.vitals)==null?void 0:Ve.spo2)==null?void 0:Te.toString())||"",((W=(se=s.vitals)==null?void 0:se.oxygen)==null?void 0:W.toString())||"",((fe=s.vitals)==null?void 0:fe.pupil)||"",((X=s.vitals)==null?void 0:X.lightReflex)||"",this.formatDestination(s.destination),s.category||"",((Y=s.estimatedDiagnosis)==null?void 0:Y.join("; "))||"",s.activityProblems||""]});return[n.join(","),...r.map(s=>s.map(a=>`"${a}"`).join(","))].join(`
`)}getMockRegistryByCaseId(e){const n=localStorage.getItem(`registry_${e}`);return n?JSON.parse(n):null}saveMockRegistry(e){const n=e.id||`registry_${Date.now()}`,r={...e,id:n,updatedAt:{toDate:()=>new Date}};return localStorage.setItem(`registry_${e.caseId}`,JSON.stringify(r)),n}getMockCompletedRegistries(){const e=[];for(let n=0;n<localStorage.length;n++){const r=localStorage.key(n);if(r!=null&&r.startsWith("registry_")){const i=JSON.parse(localStorage.getItem(r));i.isCompleted&&e.push(i)}}return e}formatTimestamp(e){if(!e)return"";try{return(e instanceof Date?e:e.toDate?e.toDate():new Date(e)).toLocaleString("ja-JP")}catch{return""}}formatGender(e){switch(e){case"male":return"男性";case"female":return"女性";default:return""}}formatMedicalInstitution(e){switch(e){case"disaster":return"災害";case"medical-dental":return"医科歯科";case"nagayama":return"永山";case"sengaki":return"千駄木";default:return""}}formatDispatchCriteria(e){var r,i,s,a,u;if(!e)return"";const n=[];if(e.category1&&n.push("I心停止"),(r=e.category2)!=null&&r.selected){const h=[];e.category2.breathing&&h.push("呼吸異常"),e.category2.circulation&&h.push("循環異常"),e.category2.consciousness&&h.push("意識異常"),n.push(`II心停止寸前(${h.join(",")})`)}if((i=e.category3)!=null&&i.selected){const h=[];e.category3.fall&&h.push("転落墜落"),e.category3.traffic&&h.push("交通事故"),e.category3.weapon&&h.push("銃創刺創"),e.category3.amputation&&h.push("四肢切断"),e.category3.trapped&&h.push("要救助挟まり"),e.category3.burn&&h.push("重度熱傷"),e.category3.multiple&&h.push("多数傷者"),n.push(`III外因(${h.join(",")})`)}if((s=e.category4)!=null&&s.selected){const h=[];e.category4.stroke&&h.push("脳卒中"),e.category4.cardiac&&h.push("心疾患"),e.category4.other&&h.push("その他"),n.push(`IV内因(${h.join(",")})`)}if((a=e.category5)!=null&&a.selected){const h=[];e.category5.fireCommand&&h.push("警防本部判断"),n.push(`Vその他(${h.join(",")})`)}if((u=e.category6)!=null&&u.selected){const h=[];e.category6.paramedic&&h.push("救急隊長判断"),n.push(`VIDMAT(${h.join(",")})`)}return n.join(", ")}formatPreOnsetADL(e){switch(e){case"independent":return"自立";case"care-required":return"要介護";case"unknown":return"不明";default:return""}}formatSceneAccess(e){switch(e){case"easy":return"容易";case"rescue-needed":return"レスキュー隊必要";case"difficult":return"困難";case"unknown":return"不明";default:return""}}formatLocation(e){if(!e)return"";const r={"home-house":"自宅（戸建）","home-apartment-low":"自宅（共同住宅10F以下）","home-apartment-high":"自宅（共同住宅11F以上）",station:"駅",commercial:"商業施設",office:"オフィス",factory:"工場",road:"路上",school:"学校",other:"その他"}[e.type]||"";return e.details?`${r} (${e.details})`:r}formatBloodPressure(e){return!e||!e.systolic||!e.diastolic?"":`${e.systolic}/${e.diastolic}`}formatDestination(e){return e&&{"own-tertiary":"自院三次","own-secondary":"自院二次","other-tertiary":"他院三次","other-secondary":"他院二次","cancel-before-arrival":"現着前キャンセル","cancel-mild":"軽症キャンセル","social-death":"社会死",other:"その他"}[e.type]||""}}const Jd=new sL,Yd=[{id:"member-001",name:"田中 太郎",role:"doctor",qualification:"救急科専門医",employeeId:"D001",department:"救急科"},{id:"member-002",name:"佐藤 花子",role:"doctor",qualification:"内科専門医",employeeId:"D002",department:"内科"},{id:"member-003",name:"山田 一郎",role:"doctor",qualification:"外科専門医",employeeId:"D003",department:"外科"},{id:"member-004",name:"高橋 美咲",role:"emergency-nurse",qualification:"救急看護認定看護師",employeeId:"N001",department:"救急科"},{id:"member-005",name:"鈴木 健太",role:"emergency-nurse",qualification:"ICLSインストラクター",employeeId:"N002",department:"救急科"},{id:"member-006",name:"伊藤 雅人",role:"resident",qualification:"初期研修医2年目",employeeId:"R001",department:"研修医科"},{id:"member-007",name:"小川 麻衣",role:"resident",qualification:"後期研修医1年目",employeeId:"R002",department:"救急科"},{id:"member-008",name:"中村 由美",role:"nurse",qualification:"看護師",employeeId:"N003",department:"手術室"},{id:"member-009",name:"加藤 直樹",role:"nurse",qualification:"看護師",employeeId:"N004",department:"ICU"},{id:"member-010",name:"渡辺 恵子",role:"nurse",qualification:"看護師",employeeId:"N005",department:"病棟"},{id:"member-011",name:"松本 隆",role:"other",qualification:"臨床工学技士",employeeId:"T001",department:"ME室"},{id:"member-012",name:"林 真理子",role:"other",qualification:"薬剤師",employeeId:"P001",department:"薬剤部"}],$m={doctor:"医師","emergency-nurse":"救命救急師",resident:"研修医",nurse:"看護師",other:"その他"},Dx={doctor:"bg-red-100 text-red-800","emergency-nurse":"bg-orange-100 text-orange-800",resident:"bg-blue-100 text-blue-800",nurse:"bg-green-100 text-green-800",other:"bg-gray-100 text-gray-800"},oL=t=>Yd.filter(e=>e.role===t),aL=t=>{const e=t.toLowerCase();return Yd.filter(n=>{var r,i;return n.name.toLowerCase().includes(e)||((r=n.qualification)==null?void 0:r.toLowerCase().includes(e))||((i=n.department)==null?void 0:i.toLowerCase().includes(e))})},lL=({selectedMembers:t,onMembersChange:e,className:n=""})=>{const[r,i]=B.useState(!1),[s,a]=B.useState(""),[u,h]=B.useState([]),[m,p]=B.useState("all");B.useEffect(()=>{let E=Yd;m!=="all"&&(E=oL(m)),s&&(E=aL(s));const R=t.map(S=>S.memberId);E=E.filter(S=>!R.includes(S.id)),h(E)},[s,m,t]);const _=E=>{const R={memberId:E.id,member:E,arrivalTime:{toDate:()=>new Date},primaryRole:E.role==="doctor"?"主治医":E.role==="emergency-nurse"?"主担当看護師":"支援"};e([...t,R]),i(!1),a("")},v=E=>{e(t.filter(R=>R.memberId!==E))},x=(E,R)=>{const S=t.map(C=>C.memberId===E?{...C,...R}:C);e(S)},T=E=>E?(E.toDate?E.toDate():new Date(E)).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}):"";return c.jsxs("div",{className:`space-y-4 ${n}`,children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"現場活動メンバー"}),t.length>0&&c.jsx("div",{className:"mb-4 space-y-2",children:t.map(E=>c.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border",children:[c.jsxs("div",{className:"flex items-center justify-between mb-2",children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"font-medium",children:E.member.name}),c.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${Dx[E.member.role]}`,children:$m[E.member.role]}),E.member.qualification&&c.jsx("span",{className:"text-xs text-gray-500",children:E.member.qualification})]}),c.jsx("button",{type:"button",onClick:()=>v(E.memberId),className:"text-red-600 hover:text-red-800 text-sm",children:"削除"})]}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2 text-sm",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-xs text-gray-500",children:"現場での役割"}),c.jsx("input",{type:"text",value:E.primaryRole,onChange:R=>x(E.memberId,{primaryRole:R.target.value}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"例：主治医、主担当看護師"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-xs text-gray-500",children:"到着時刻"}),c.jsx("input",{type:"time",value:T(E.arrivalTime),onChange:R=>{const[S,C]=R.target.value.split(":"),A=new Date;A.setHours(parseInt(S),parseInt(C),0,0),x(E.memberId,{arrivalTime:{toDate:()=>A}})},className:"w-full px-2 py-1 border border-gray-300 rounded text-sm"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-xs text-gray-500",children:"特記事項"}),c.jsx("input",{type:"text",value:E.notes||"",onChange:R=>x(E.memberId,{notes:R.target.value}),className:"w-full px-2 py-1 border border-gray-300 rounded text-sm",placeholder:"特記事項があれば入力"})]})]})]},E.memberId))}),c.jsxs("div",{className:"relative",children:[c.jsxs("button",{type:"button",onClick:()=>i(!r),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-left bg-white hover:bg-gray-50 flex items-center justify-between",children:[c.jsx("span",{className:"text-gray-500",children:"メンバーを追加..."}),c.jsx("svg",{className:"h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})]}),r&&c.jsxs("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg",children:[c.jsxs("div",{className:"p-3 border-b border-gray-200",children:[c.jsx("input",{type:"text",value:s,onChange:E=>a(E.target.value),placeholder:"名前・資格・部署で検索...",className:"w-full px-3 py-2 border border-gray-300 rounded mb-2 text-sm"}),c.jsxs("div",{className:"flex space-x-1 overflow-x-auto",children:[c.jsx("button",{type:"button",onClick:()=>p("all"),className:`px-2 py-1 text-xs rounded whitespace-nowrap ${m==="all"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700"}`,children:"全て"}),Object.entries($m).map(([E,R])=>c.jsx("button",{type:"button",onClick:()=>p(E),className:`px-2 py-1 text-xs rounded whitespace-nowrap ${m===E?"bg-blue-500 text-white":"bg-gray-100 text-gray-700"}`,children:R},E))]})]}),c.jsx("div",{className:"max-h-64 overflow-y-auto",children:u.length===0?c.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:t.length===Yd.length?"全てのメンバーが選択済みです":"条件に合うメンバーがいません"}):c.jsx("div",{className:"py-1",children:u.map(E=>c.jsx("button",{type:"button",onClick:()=>_(E),className:"w-full px-4 py-2 text-left hover:bg-gray-50 focus:bg-gray-50 focus:outline-none",children:c.jsx("div",{className:"flex items-center justify-between",children:c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx("span",{className:"font-medium text-sm",children:E.name}),c.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${Dx[E.role]}`,children:$m[E.role]})]}),c.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[E.qualification," • ",E.department]})]})})},E.id))})})]})]})]}),r&&c.jsx("div",{className:"fixed inset-0 z-40",onClick:()=>i(!1)})]})},cL=()=>{const{caseId:t}=eb(),e=js(),{currentCase:n}=vf(),{userInfo:r}=Ds(),[i,s]=B.useState(!1),[a,u]=B.useState(!1),[h,m]=B.useState({}),[p,_]=B.useState("basic");B.useEffect(()=>{t&&v()},[t]);const v=async()=>{if(t){s(!0);try{const R=await Jd.getRegistryByCaseId(t);if(R)m(R);else{const S=new Date,C=A=>({toDate:()=>{const U=new Date(S);return U.setMinutes(U.getMinutes()+A),U}});m({caseId:t,registryNumber:x(),createdBy:(r==null?void 0:r.uid)||"",isCompleted:!1,teamMembers:[],timelineEms:{awareness:C(0),arrival:C(10),contact:C(15),departure:C(45),hospitalArrival:C(60)},timelineDoctorCar:{awareness:C(5),arrival:C(15),contact:C(20),departure:C(50),hospitalArrival:C(65)}})}}catch(R){console.error("Failed to load registry:",R)}finally{s(!1)}}},x=()=>{const R=new Date;return`DCR-${R.getFullYear()}${String(R.getMonth()+1).padStart(2,"0")}${String(R.getDate()).padStart(2,"0")}-${String(R.getHours()).padStart(2,"0")}${String(R.getMinutes()).padStart(2,"0")}`},T=R=>{m(S=>({...S,teamMembers:R}))},E=async(R=!1)=>{u(!0);try{const S={...h,isCompleted:R,updatedBy:(r==null?void 0:r.uid)||"",updatedAt:{toDate:()=>new Date}};R&&(S.submittedAt={toDate:()=>new Date}),await Jd.saveRegistry(S),R?(alert("レジストリの提出が完了しました"),e(`/cases/${t}`)):alert("保存しました")}catch(S){console.error("Failed to save registry:",S),alert("保存に失敗しました")}finally{u(!1)}};return i?c.jsx("div",{className:"min-h-screen flex items-center justify-center",children:c.jsx(_r,{size:"lg"})}):c.jsxs("div",{className:"min-h-screen bg-gray-50",children:[c.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:c.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:c.jsxs("div",{className:"flex items-center justify-between h-16",children:[c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("button",{onClick:()=>e(`/cases/${t}`),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:c.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"ドクターカーレジストリ"}),c.jsxs("p",{className:"text-sm text-gray-500",children:[n==null?void 0:n.caseName," | レジストリ番号: ",h.registryNumber]})]})]}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(Le,{variant:"outline",size:"sm",onClick:()=>E(!1),disabled:a,children:"一時保存"}),c.jsx(Le,{size:"sm",onClick:()=>E(!0),disabled:a,children:"提出"})]})]})})}),c.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 mt-4",children:c.jsxs("div",{className:"bg-white rounded-lg shadow",children:[c.jsx("div",{className:"border-b border-gray-200",children:c.jsx("nav",{className:"-mb-px flex space-x-8 px-6",children:[{id:"basic",label:"I 基本情報"},{id:"team",label:"現場メンバー"},{id:"timeline",label:"時間経過・バイタル"},{id:"vitals",label:"搬送先・分類"},{id:"category",label:"II 分類別詳細"},{id:"hospital",label:"III 院内経過"}].map(R=>c.jsx("button",{onClick:()=>_(R.id),className:`py-3 px-1 border-b-2 font-medium text-sm ${p===R.id?"border-medical-primary text-medical-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:R.label},R.id))})}),c.jsxs("div",{className:"p-6",children:[p==="basic"&&c.jsx(uL,{registry:h,setRegistry:m}),p==="team"&&c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"現場活動メンバー"}),c.jsx("p",{className:"text-sm text-gray-600 mb-6",children:"現場に出動したメンバーを選択し、到着時刻や役割を記録してください。"}),c.jsx(lL,{selectedMembers:h.teamMembers||[],onMembersChange:T})]}),p==="timeline"&&c.jsx(hL,{registry:h,setRegistry:m}),p==="vitals"&&c.jsx(dL,{registry:h,setRegistry:m}),p==="category"&&c.jsx(fL,{registry:h,setRegistry:m}),p==="hospital"&&c.jsx(vL,{registry:h,setRegistry:m})]})]})})]})},uL=({registry:t,setRegistry:e})=>{var n,r,i,s,a,u,h,m,p,_,v,x,T,E,R,S,C,A,U,Z;return c.jsxs("div",{className:"space-y-8",children:[c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"患者基本情報"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"患者番号"}),c.jsx(ue,{type:"text",value:t.patientNumber||"",onChange:V=>e({...t,patientNumber:V.target.value})})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"患者年齢"}),c.jsx(ue,{type:"number",value:t.patientAge||"",onChange:V=>e({...t,patientAge:parseInt(V.target.value)})})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"性別"}),c.jsxs("div",{className:"flex space-x-4 mt-1",children:[c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"gender",value:"male",checked:t.patientGender==="male",onChange:()=>e({...t,patientGender:"male"}),className:"mr-2"}),"男"]}),c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"gender",value:"female",checked:t.patientGender==="female",onChange:()=>e({...t,patientGender:"female"}),className:"mr-2"}),"女"]})]})]})]})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"医療機関情報"}),c.jsx("div",{className:"flex flex-wrap gap-4",children:[{value:"disaster",label:"災害"},{value:"medical-dental",label:"医科歯科"},{value:"nagayama",label:"永山"},{value:"sengaki",label:"千駄木"}].map(V=>c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"medicalInstitution",value:V.value,checked:t.medicalInstitution===V.value,onChange:k=>e({...t,medicalInstitution:k.target.value}),className:"mr-2"}),V.label]},V.value))})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"ドクターカー出動要請基準"}),c.jsx("div",{className:"mb-4",children:c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((n=t.dispatchCriteria)==null?void 0:n.category1)||!1,onChange:V=>e({...t,dispatchCriteria:{...t.dispatchCriteria,category1:V.target.checked}}),className:"mr-2"}),c.jsx("span",{className:"font-medium",children:"I 心停止"})]})}),c.jsxs("div",{className:"mb-4",children:[c.jsxs("label",{className:"flex items-center mb-2",children:[c.jsx("input",{type:"checkbox",checked:((i=(r=t.dispatchCriteria)==null?void 0:r.category2)==null?void 0:i.selected)||!1,onChange:V=>{var k;return e({...t,dispatchCriteria:{...t.dispatchCriteria,category2:{...(k=t.dispatchCriteria)==null?void 0:k.category2,selected:V.target.checked}}})},className:"mr-2"}),c.jsx("span",{className:"font-medium",children:"II 心停止寸前を疑う"})]}),c.jsx("div",{className:"ml-6 space-y-2",children:[{key:"breathing",label:"① 呼吸の異常"},{key:"circulation",label:"② 循環の異常"},{key:"consciousness",label:"③ 意識の異常"}].map(V=>{var k,N;return c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((N=(k=t.dispatchCriteria)==null?void 0:k.category2)==null?void 0:N[V.key])||!1,onChange:D=>{var M;return e({...t,dispatchCriteria:{...t.dispatchCriteria,category2:{...(M=t.dispatchCriteria)==null?void 0:M.category2,[V.key]:D.target.checked}}})},className:"mr-2"}),V.label]},V.key)})})]}),c.jsxs("div",{className:"mb-4",children:[c.jsxs("label",{className:"flex items-center mb-2",children:[c.jsx("input",{type:"checkbox",checked:((a=(s=t.dispatchCriteria)==null?void 0:s.category3)==null?void 0:a.selected)||!1,onChange:V=>{var k;return e({...t,dispatchCriteria:{...t.dispatchCriteria,category3:{...(k=t.dispatchCriteria)==null?void 0:k.category3,selected:V.target.checked}}})},className:"mr-2"}),c.jsx("span",{className:"font-medium",children:"III 外因によるもの"})]}),c.jsx("div",{className:"ml-6 space-y-2",children:[{key:"fall",label:"① 転落・墜落"},{key:"traffic",label:"② 交通事故"},{key:"weapon",label:"③ 銃創・刺創"},{key:"amputation",label:"④ 四肢切断"},{key:"trapped",label:"⑤ 要救助の挟まり"},{key:"burn",label:"⑥ 重度熱傷"},{key:"multiple",label:"⑦ 多数傷者発生"}].map(V=>{var k,N;return c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((N=(k=t.dispatchCriteria)==null?void 0:k.category3)==null?void 0:N[V.key])||!1,onChange:D=>{var M;return e({...t,dispatchCriteria:{...t.dispatchCriteria,category3:{...(M=t.dispatchCriteria)==null?void 0:M.category3,[V.key]:D.target.checked}}})},className:"mr-2"}),V.label]},V.key)})})]}),c.jsxs("div",{className:"mb-4",children:[c.jsxs("label",{className:"flex items-center mb-2",children:[c.jsx("input",{type:"checkbox",checked:((h=(u=t.dispatchCriteria)==null?void 0:u.category4)==null?void 0:h.selected)||!1,onChange:V=>{var k;return e({...t,dispatchCriteria:{...t.dispatchCriteria,category4:{...(k=t.dispatchCriteria)==null?void 0:k.category4,selected:V.target.checked}}})},className:"mr-2"}),c.jsx("span",{className:"font-medium",children:"IV 内因によるもの"})]}),c.jsx("div",{className:"ml-6 space-y-2",children:[{key:"stroke",label:"① 脳卒中疑い・意識障害"},{key:"cardiac",label:"② 心疾患疑い"},{key:"other",label:"③ その他"}].map(V=>{var k,N;return c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((N=(k=t.dispatchCriteria)==null?void 0:k.category4)==null?void 0:N[V.key])||!1,onChange:D=>{var M;return e({...t,dispatchCriteria:{...t.dispatchCriteria,category4:{...(M=t.dispatchCriteria)==null?void 0:M.category4,[V.key]:D.target.checked}}})},className:"mr-2"}),V.label]},V.key)})})]}),c.jsxs("div",{className:"mb-4",children:[c.jsxs("label",{className:"flex items-center mb-2",children:[c.jsx("input",{type:"checkbox",checked:((p=(m=t.dispatchCriteria)==null?void 0:m.category5)==null?void 0:p.selected)||!1,onChange:V=>{var k;return e({...t,dispatchCriteria:{...t.dispatchCriteria,category5:{...(k=t.dispatchCriteria)==null?void 0:k.category5,selected:V.target.checked}}})},className:"mr-2"}),c.jsx("span",{className:"font-medium",children:"V その他"})]}),c.jsx("div",{className:"ml-6 space-y-2",children:c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((v=(_=t.dispatchCriteria)==null?void 0:_.category5)==null?void 0:v.fireCommand)||!1,onChange:V=>{var k;return e({...t,dispatchCriteria:{...t.dispatchCriteria,category5:{...(k=t.dispatchCriteria)==null?void 0:k.category5,fireCommand:V.target.checked}}})},className:"mr-2"}),"① 警防本部が効果的と判断したもの"]})})]}),c.jsxs("div",{className:"mb-4",children:[c.jsxs("label",{className:"flex items-center mb-2",children:[c.jsx("input",{type:"checkbox",checked:((T=(x=t.dispatchCriteria)==null?void 0:x.category6)==null?void 0:T.selected)||!1,onChange:V=>{var k;return e({...t,dispatchCriteria:{...t.dispatchCriteria,category6:{...(k=t.dispatchCriteria)==null?void 0:k.category6,selected:V.target.checked}}})},className:"mr-2"}),c.jsx("span",{className:"font-medium",children:"VI DMAT"})]}),c.jsx("div",{className:"ml-6 space-y-2",children:c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((R=(E=t.dispatchCriteria)==null?void 0:E.category6)==null?void 0:R.paramedic)||!1,onChange:V=>{var k;return e({...t,dispatchCriteria:{...t.dispatchCriteria,category6:{...(k=t.dispatchCriteria)==null?void 0:k.category6,paramedic:V.target.checked}}})},className:"mr-2"}),"② 救急隊現着時救急隊長が効果的と判断したもの"]})})]})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"発症前のADL"}),c.jsx("div",{className:"flex flex-wrap gap-4",children:[{value:"independent",label:"自立"},{value:"care-required",label:"要介護"},{value:"unknown",label:"不明"}].map(V=>c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"preOnsetADL",value:V.value,checked:t.preOnsetADL===V.value,onChange:k=>e({...t,preOnsetADL:k.target.value}),className:"mr-2"}),V.label]},V.value))})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"現場へのアクセス"}),c.jsx("div",{className:"flex flex-wrap gap-4",children:[{value:"easy",label:"容易（車を降りて直ぐ）"},{value:"rescue-needed",label:"レスキュー隊が必要"},{value:"difficult",label:"困難で有るがレスキュー隊は不要"},{value:"unknown",label:"不明"}].map(V=>c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"sceneAccess",value:V.value,checked:t.sceneAccess===V.value,onChange:k=>e({...t,sceneAccess:k.target.value}),className:"mr-2"}),V.label]},V.value))})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"PA連携（ポンプ隊と救急隊の連携）の有無"}),c.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"paCooperation",value:"present",checked:((S=t.paCooperation)==null?void 0:S.present)===!0,onChange:()=>e({...t,paCooperation:{...t.paCooperation,present:!0}}),className:"mr-2"}),"有"]}),c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"paCooperation",value:"absent",checked:((C=t.paCooperation)==null?void 0:C.present)===!1,onChange:()=>e({...t,paCooperation:{...t.paCooperation,present:!1}}),className:"mr-2"}),"無"]})]}),((A=t.paCooperation)==null?void 0:A.present)&&c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ポンプ隊現着時間"}),c.jsx(ue,{type:"datetime-local",value:((U=t.paCooperation)==null?void 0:U.pumpArrivalTime)||"",onChange:V=>e({...t,paCooperation:{...t.paCooperation,pumpArrivalTime:V.target.value}})})]})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"出動番地"}),c.jsx(ue,{type:"text",value:t.dispatchVehicle||"",onChange:V=>e({...t,dispatchVehicle:V.target.value}),placeholder:"出動番地を入力してください"})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"発生場所"}),c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-4",children:[{value:"home-house",label:"自宅（戸建）"},{value:"home-apartment-low",label:"自宅（共同住宅10F以下）"},{value:"home-apartment-high",label:"自宅（共同住宅11F以上）"},{value:"station",label:"駅"},{value:"commercial",label:"商業施設"},{value:"office",label:"オフィス"},{value:"factory",label:"工場"},{value:"road",label:"路上"},{value:"school",label:"学校"},{value:"other",label:"その他"}].map(V=>{var k;return c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"locationType",value:V.value,checked:((k=t.location)==null?void 0:k.type)===V.value,onChange:N=>e({...t,location:{...t.location,type:N.target.value}}),className:"mr-2"}),V.label]},V.value)})}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"発生場所—その他詳細"}),c.jsx(ue,{type:"text",value:((Z=t.location)==null?void 0:Z.details)||"",onChange:V=>e({...t,location:{...t.location,details:V.target.value}})})]})]})]})},hL=({registry:t,setRegistry:e})=>{var i,s,a,u,h,m,p,_,v,x,T,E,R,S,C,A,U,Z,V,k,N,D,M,F,z,j,me,Ve,Te;const n=(se=0)=>{const W=new Date;return W.setMinutes(W.getMinutes()+se),W.toISOString().slice(0,16)},r=(se,W,fe=0)=>{if(se!=null&&se[W])try{return(se[W].toDate?se[W].toDate():new Date(se[W])).toISOString().slice(0,16)}catch{return n(fe)}return n(fe)};return c.jsxs("div",{className:"space-y-8",children:[c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"時間経過"}),c.jsx("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:c.jsx("p",{className:"text-sm text-blue-700",children:"💡 デフォルトで本日の日付が設定されています。必要に応じて日時を修正してください。"})}),c.jsx("div",{className:"overflow-x-auto",children:c.jsxs("table",{className:"min-w-full border border-gray-300",children:[c.jsx("thead",{children:c.jsxs("tr",{className:"bg-gray-50",children:[c.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"項目"}),c.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"救急隊"}),c.jsx("th",{className:"border border-gray-300 px-4 py-2 text-left",children:"ドクターカー"})]})}),c.jsx("tbody",{children:[{key:"awareness",label:"覚知日時",defaultOffset:0},{key:"arrival",label:"現着日時",defaultOffset:10},{key:"contact",label:"接触日時",defaultOffset:15},{key:"departure",label:"現発日時",defaultOffset:45},{key:"hospitalArrival",label:"病着日時",defaultOffset:60}].map(se=>c.jsxs("tr",{children:[c.jsx("td",{className:"border border-gray-300 px-4 py-2 font-medium",children:se.label}),c.jsx("td",{className:"border border-gray-300 px-4 py-2",children:c.jsx(ue,{type:"datetime-local",className:"w-full",value:r(t.timelineEms,se.key,se.defaultOffset),onChange:W=>e({...t,timelineEms:{...t.timelineEms,[se.key]:new Date(W.target.value)}})})}),c.jsx("td",{className:"border border-gray-300 px-4 py-2",children:c.jsx(ue,{type:"datetime-local",className:"w-full",value:r(t.timelineDoctorCar,se.key,se.defaultOffset+5),onChange:W=>e({...t,timelineDoctorCar:{...t.timelineDoctorCar,[se.key]:new Date(W.target.value)}})})})]},se.key))})]})}),c.jsxs("div",{className:"mt-4 p-3 bg-gray-50 border border-gray-200 rounded-lg",children:[c.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"活動時間（自動計算）"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-gray-600",children:"総活動時間（覚知から病院収容まで）"}),c.jsx(ue,{type:"number",value:t.totalActivityTime||"",onChange:se=>e({...t,totalActivityTime:parseInt(se.target.value)}),placeholder:"分"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-gray-600",children:"医師接触までの時間"}),c.jsx(ue,{type:"number",value:t.doctorContactTime||"",onChange:se=>e({...t,doctorContactTime:parseInt(se.target.value)}),placeholder:"分"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-gray-600",children:"現場活動時間"}),c.jsx(ue,{type:"number",value:t.sceneActivityTime||"",onChange:se=>e({...t,sceneActivityTime:parseInt(se.target.value)}),placeholder:"分"})]})]})]})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"患者バイタル"}),c.jsxs("div",{className:"mb-6",children:[c.jsx("h4",{className:"text-md font-medium text-gray-800 mb-3",children:"GCS（Glasgow Coma Scale）"}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"GCS 合計"}),c.jsx(ue,{type:"number",min:"3",max:"15",value:((s=(i=t.vitals)==null?void 0:i.gcs)==null?void 0:s.total)||"",onChange:se=>{var W;return e({...t,vitals:{...t.vitals,gcs:{...(W=t.vitals)==null?void 0:W.gcs,total:parseInt(se.target.value)||0}}})},placeholder:"3-15"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E（開眼）"}),c.jsx(ue,{type:"number",min:"1",max:"4",value:((u=(a=t.vitals)==null?void 0:a.gcs)==null?void 0:u.eye)||"",onChange:se=>{var W;return e({...t,vitals:{...t.vitals,gcs:{...(W=t.vitals)==null?void 0:W.gcs,eye:parseInt(se.target.value)||0}}})},placeholder:"1-4"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"V（言語）"}),c.jsx(ue,{type:"number",min:"1",max:"5",value:((m=(h=t.vitals)==null?void 0:h.gcs)==null?void 0:m.verbal)||"",onChange:se=>{var W;return e({...t,vitals:{...t.vitals,gcs:{...(W=t.vitals)==null?void 0:W.gcs,verbal:parseInt(se.target.value)||0}}})},placeholder:"1-5"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"M（運動）"}),c.jsx(ue,{type:"number",min:"1",max:"6",value:((_=(p=t.vitals)==null?void 0:p.gcs)==null?void 0:_.motor)||"",onChange:se=>{var W;return e({...t,vitals:{...t.vitals,gcs:{...(W=t.vitals)==null?void 0:W.gcs,motor:parseInt(se.target.value)||0}}})},placeholder:"1-6"})]})]})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx("h4",{className:"text-md font-medium text-gray-800 mb-3",children:"バイタルサイン"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"血圧（収縮期/拡張期）"}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(ue,{type:"number",value:((x=(v=t.vitals)==null?void 0:v.bloodPressure)==null?void 0:x.systolic)||"",onChange:se=>{var W;return e({...t,vitals:{...t.vitals,bloodPressure:{...(W=t.vitals)==null?void 0:W.bloodPressure,systolic:parseInt(se.target.value)||0}}})},placeholder:"収縮期"}),c.jsx("span",{className:"text-gray-500",children:"/"}),c.jsx(ue,{type:"number",value:((E=(T=t.vitals)==null?void 0:T.bloodPressure)==null?void 0:E.diastolic)||"",onChange:se=>{var W;return e({...t,vitals:{...t.vitals,bloodPressure:{...(W=t.vitals)==null?void 0:W.bloodPressure,diastolic:parseInt(se.target.value)||0}}})},placeholder:"拡張期"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"脈拍（回/分）"}),c.jsx(ue,{type:"number",value:((R=t.vitals)==null?void 0:R.pulse)||"",onChange:se=>e({...t,vitals:{...t.vitals,pulse:parseInt(se.target.value)||0}}),placeholder:"例：80"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"呼吸（回/分）"}),c.jsx(ue,{type:"number",value:((S=t.vitals)==null?void 0:S.respiration)||"",onChange:se=>e({...t,vitals:{...t.vitals,respiration:parseInt(se.target.value)||0}}),placeholder:"例：20"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"体温（℃）"}),c.jsx(ue,{type:"number",step:"0.1",value:((C=t.vitals)==null?void 0:C.temperature)||"",onChange:se=>e({...t,vitals:{...t.vitals,temperature:parseFloat(se.target.value)||0}}),placeholder:"例：36.5"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SpO2（%）"}),c.jsx(ue,{type:"number",min:"0",max:"100",value:((A=t.vitals)==null?void 0:A.spo2)||"",onChange:se=>e({...t,vitals:{...t.vitals,spo2:parseInt(se.target.value)||0}}),placeholder:"例：98"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"酸素（L/分）"}),c.jsx(ue,{type:"number",step:"0.1",value:((U=t.vitals)==null?void 0:U.oxygen)||"",onChange:se=>e({...t,vitals:{...t.vitals,oxygen:parseFloat(se.target.value)||0}}),placeholder:"例：2.0"})]})]})]}),c.jsxs("div",{className:"mb-6",children:[c.jsx("h4",{className:"text-md font-medium text-gray-800 mb-3",children:"神経学的所見"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"瞳孔（右, 左）mm"}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(ue,{type:"text",value:((k=(V=(Z=t.vitals)==null?void 0:Z.pupil)==null?void 0:V.split(",")[0])==null?void 0:k.trim())||"",onChange:se=>{var X,Y,ce;const W=((Y=(X=t.vitals)==null?void 0:X.pupil)==null?void 0:Y.split(","))||["",""],fe=[se.target.value,((ce=W[1])==null?void 0:ce.trim())||""].join(", ");e({...t,vitals:{...t.vitals,pupil:fe}})},placeholder:"右瞳孔"}),c.jsx("span",{className:"text-gray-500",children:","}),c.jsx(ue,{type:"text",value:((M=(D=(N=t.vitals)==null?void 0:N.pupil)==null?void 0:D.split(",")[1])==null?void 0:M.trim())||"",onChange:se=>{var X,Y,ce;const fe=[((ce=(((Y=(X=t.vitals)==null?void 0:X.pupil)==null?void 0:Y.split(","))||["",""])[0])==null?void 0:ce.trim())||"",se.target.value].join(", ");e({...t,vitals:{...t.vitals,pupil:fe}})},placeholder:"左瞳孔"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"対光反射（右, 左）"}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(ue,{type:"text",value:((j=(z=(F=t.vitals)==null?void 0:F.lightReflex)==null?void 0:z.split(",")[0])==null?void 0:j.trim())||"",onChange:se=>{var X,Y,ce;const W=((Y=(X=t.vitals)==null?void 0:X.lightReflex)==null?void 0:Y.split(","))||["",""],fe=[se.target.value,((ce=W[1])==null?void 0:ce.trim())||""].join(", ");e({...t,vitals:{...t.vitals,lightReflex:fe}})},placeholder:"右反射"}),c.jsx("span",{className:"text-gray-500",children:","}),c.jsx(ue,{type:"text",value:((Te=(Ve=(me=t.vitals)==null?void 0:me.lightReflex)==null?void 0:Ve.split(",")[1])==null?void 0:Te.trim())||"",onChange:se=>{var X,Y,ce;const fe=[((ce=(((Y=(X=t.vitals)==null?void 0:X.lightReflex)==null?void 0:Y.split(","))||["",""])[0])==null?void 0:ce.trim())||"",se.target.value].join(", ");e({...t,vitals:{...t.vitals,lightReflex:fe}})},placeholder:"左反射"})]})]})]})]})]})]})},dL=({registry:t,setRegistry:e})=>{var n;return c.jsxs("div",{className:"space-y-8",children:[c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"搬送先"}),c.jsx("div",{className:"space-y-4",children:[{value:"own-tertiary",label:"自院三次"},{value:"own-secondary",label:"自院二次"},{value:"other-tertiary",label:"他院三次"},{value:"other-secondary",label:"他院二次"},{value:"cancel-before-arrival",label:"現着前にキャンセル"},{value:"cancel-mild",label:"現着後に軽症の為キャンセル"},{value:"social-death",label:"社会死（死亡確認）"},{value:"other",label:"その他"}].map(r=>{var i,s,a,u,h,m,p,_,v,x,T,E,R,S,C,A,U,Z,V,k,N,D,M,F,z;return c.jsxs("div",{children:[c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"destinationType",value:r.value,checked:((i=t.destination)==null?void 0:i.type)===r.value,onChange:j=>e({...t,destination:{...t.destination,type:j.target.value}}),className:"mr-2"}),r.label]}),((s=t.destination)==null?void 0:s.type)==="cancel-before-arrival"&&r.value==="cancel-before-arrival"&&c.jsxs("div",{className:"ml-6 mt-2",children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"キャンセル理由"}),c.jsx(ue,{type:"text",value:((a=t.destination)==null?void 0:a.cancelReason)||"",onChange:j=>e({...t,destination:{...t.destination,cancelReason:j.target.value}}),placeholder:"キャンセル理由を入力してください"})]}),((u=t.destination)==null?void 0:u.type)==="social-death"&&r.value==="social-death"&&c.jsxs("div",{className:"ml-6 mt-2 space-y-3",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"社会死の判断は不要な搬送を減らすことに貢献したか"}),c.jsxs("div",{className:"flex space-x-4",children:[c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"socialDeathHelpful",value:"true",checked:((m=(h=t.destination)==null?void 0:h.socialDeathContribution)==null?void 0:m.helpful)===!0,onChange:()=>{var j;return e({...t,destination:{...t.destination,socialDeathContribution:{...(j=t.destination)==null?void 0:j.socialDeathContribution,helpful:!0}}})},className:"mr-1"}),"はい"]}),c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"socialDeathHelpful",value:"false",checked:((_=(p=t.destination)==null?void 0:p.socialDeathContribution)==null?void 0:_.helpful)===!1,onChange:()=>{var j;return e({...t,destination:{...t.destination,socialDeathContribution:{...(j=t.destination)==null?void 0:j.socialDeathContribution,helpful:!1}}})},className:"mr-1"}),"いいえ"]})]})]}),((x=(v=t.destination)==null?void 0:v.socialDeathContribution)==null?void 0:x.helpful)===!0&&c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"選択理由"}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((R=(E=(T=t.destination)==null?void 0:T.socialDeathContribution)==null?void 0:E.reasons)==null?void 0:R.emsJudgment)||!1,onChange:j=>{var me,Ve,Te;return e({...t,destination:{...t.destination,socialDeathContribution:{...(me=t.destination)==null?void 0:me.socialDeathContribution,reasons:{...(Te=(Ve=t.destination)==null?void 0:Ve.socialDeathContribution)==null?void 0:Te.reasons,emsJudgment:j.target.checked}}}})},className:"mr-2"}),"救急隊の判断に寄与"]}),c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((A=(C=(S=t.destination)==null?void 0:S.socialDeathContribution)==null?void 0:C.reasons)==null?void 0:A.familyAcceptance)||!1,onChange:j=>{var me,Ve,Te;return e({...t,destination:{...t.destination,socialDeathContribution:{...(me=t.destination)==null?void 0:me.socialDeathContribution,reasons:{...(Te=(Ve=t.destination)==null?void 0:Ve.socialDeathContribution)==null?void 0:Te.reasons,familyAcceptance:j.target.checked}}}})},className:"mr-2"}),"家族が納得"]}),c.jsxs("div",{children:[c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((V=(Z=(U=t.destination)==null?void 0:U.socialDeathContribution)==null?void 0:Z.reasons)==null?void 0:V.other)||!1,onChange:j=>{var me,Ve,Te;return e({...t,destination:{...t.destination,socialDeathContribution:{...(me=t.destination)==null?void 0:me.socialDeathContribution,reasons:{...(Te=(Ve=t.destination)==null?void 0:Ve.socialDeathContribution)==null?void 0:Te.reasons,other:j.target.checked}}}})},className:"mr-2"}),"その他"]}),((D=(N=(k=t.destination)==null?void 0:k.socialDeathContribution)==null?void 0:N.reasons)==null?void 0:D.other)&&c.jsx("div",{className:"ml-6 mt-1",children:c.jsx(ue,{type:"text",value:((z=(F=(M=t.destination)==null?void 0:M.socialDeathContribution)==null?void 0:F.reasons)==null?void 0:z.otherReason)||"",onChange:j=>{var me,Ve,Te;return e({...t,destination:{...t.destination,socialDeathContribution:{...(me=t.destination)==null?void 0:me.socialDeathContribution,reasons:{...(Te=(Ve=t.destination)==null?void 0:Ve.socialDeathContribution)==null?void 0:Te.reasons,otherReason:j.target.value}}}})},placeholder:"その他の理由を入力してください"})})]})]})]})]})]},r.value)})})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"該当分類"}),c.jsx("div",{className:"flex space-x-6",children:["C","T","S","M"].map(r=>c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"category",value:r,checked:t.category===r,onChange:i=>e({...t,category:i.target.value}),className:"mr-2"}),r]},r))})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"推定病名"}),c.jsx("textarea",{className:"w-full p-3 border border-gray-300 rounded-lg resize-none",rows:3,value:((n=t.estimatedDiagnosis)==null?void 0:n.join(`
`))||"",onChange:r=>e({...t,estimatedDiagnosis:r.target.value.split(`
`).filter(i=>i.trim())}),placeholder:"推定病名を入力してください（複数行可）"})]})]})},fL=({registry:t,setRegistry:e})=>{const[n,r]=B.useState("C");return c.jsxs("div",{className:"space-y-6",children:[c.jsx("div",{className:"border-b border-gray-200",children:c.jsx("nav",{className:"flex space-x-8",children:[{key:"C",label:"II-C 心停止"},{key:"T",label:"II-T 外傷"},{key:"S",label:"II-S 脳卒中"},{key:"M",label:"II-M ACS"}].map(i=>c.jsx("button",{onClick:()=>r(i.key),className:`py-2 px-1 border-b-2 font-medium text-sm ${n===i.key?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:i.label},i.key))})}),c.jsxs("div",{children:[n==="C"&&c.jsx(mL,{registry:t,setRegistry:e}),n==="T"&&c.jsx(pL,{registry:t,setRegistry:e}),n==="S"&&c.jsx(gL,{registry:t,setRegistry:e}),n==="M"&&c.jsx(_L,{registry:t,setRegistry:e})]})]})},mL=({registry:t,setRegistry:e})=>{var n,r,i,s,a,u,h,m,p;return c.jsxs("div",{className:"space-y-8",children:[c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"目撃者・バイスタンダーCPR"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"目撃者"}),c.jsx("div",{className:"space-y-2",children:[{value:"present",label:"あり"},{value:"absent",label:"なし"},{value:"unknown",label:"不明"}].map(_=>{var v;return c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"witness",value:_.value,checked:((v=t.cardiacArrest)==null?void 0:v.witness)===_.value,onChange:x=>e({...t,cardiacArrest:{...t.cardiacArrest,witness:x.target.value}}),className:"mr-2"}),_.label]},_.value)})})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"バイスタンダーCPR"}),c.jsx("div",{className:"space-y-2",children:[{value:"present",label:"あり"},{value:"absent",label:"なし"},{value:"unknown",label:"不明"}].map(_=>{var v,x;return c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"bystanderCPR",value:_.value,checked:((x=(v=t.cardiacArrest)==null?void 0:v.bystanderCPR)==null?void 0:x.performed)===_.value,onChange:T=>{var E;return e({...t,cardiacArrest:{...t.cardiacArrest,bystanderCPR:{...(E=t.cardiacArrest)==null?void 0:E.bystanderCPR,performed:T.target.value}}})},className:"mr-2"}),_.label]},_.value)})}),((r=(n=t.cardiacArrest)==null?void 0:n.bystanderCPR)==null?void 0:r.performed)==="present"&&c.jsxs("div",{className:"mt-3 space-y-2",children:[c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((s=(i=t.cardiacArrest)==null?void 0:i.bystanderCPR)==null?void 0:s.chestCompression)||!1,onChange:_=>{var v;return e({...t,cardiacArrest:{...t.cardiacArrest,bystanderCPR:{...(v=t.cardiacArrest)==null?void 0:v.bystanderCPR,chestCompression:_.target.checked}}})},className:"mr-2"}),"胸骨圧迫"]}),c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((u=(a=t.cardiacArrest)==null?void 0:a.bystanderCPR)==null?void 0:u.artificialRespiration)||!1,onChange:_=>{var v;return e({...t,cardiacArrest:{...t.cardiacArrest,bystanderCPR:{...(v=t.cardiacArrest)==null?void 0:v.bystanderCPR,artificialRespiration:_.target.checked}}})},className:"mr-2"}),"人工呼吸"]}),c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((m=(h=t.cardiacArrest)==null?void 0:h.bystanderCPR)==null?void 0:m.aed)||!1,onChange:_=>{var v;return e({...t,cardiacArrest:{...t.cardiacArrest,bystanderCPR:{...(v=t.cardiacArrest)==null?void 0:v.bystanderCPR,aed:_.target.checked}}})},className:"mr-2"}),"AED使用"]})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"消防指導"}),c.jsx("div",{className:"space-y-2",children:[{value:"present",label:"あり"},{value:"absent",label:"なし"},{value:"unknown",label:"不明"}].map(_=>{var v;return c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"fireGuidance",value:_.value,checked:((v=t.cardiacArrest)==null?void 0:v.fireGuidance)===_.value,onChange:x=>e({...t,cardiacArrest:{...t.cardiacArrest,fireGuidance:x.target.value}}),className:"mr-2"}),_.label]},_.value)})})]})]})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"初期心電図波形・時刻"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"初期心電図波形"}),c.jsx("div",{className:"space-y-2",children:[{value:"asystole",label:"Asystole"},{value:"pea",label:"PEA"},{value:"vf",label:"VF"},{value:"pulseless-vt",label:"Pulseless VT"},{value:"pulse-present",label:"脈拍触知可能"}].map(_=>{var v;return c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"initialRhythm",value:_.value,checked:((v=t.cardiacArrest)==null?void 0:v.initialRhythm)===_.value,onChange:x=>e({...t,cardiacArrest:{...t.cardiacArrest,initialRhythm:x.target.value}}),className:"mr-2"}),_.label]},_.value)})})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"推定心停止時刻"}),c.jsx(ue,{type:"time",value:((p=t.cardiacArrest)==null?void 0:p.estimatedArrestTime)||"",onChange:_=>e({...t,cardiacArrest:{...t.cardiacArrest,estimatedArrestTime:_.target.value}})})]})]})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"ROSC・転帰"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"搬送中ROSC"}),c.jsx("div",{className:"space-y-2",children:[{value:"present",label:"あり"},{value:"absent",label:"なし"},{value:"unknown",label:"不明"}].map(_=>{var v,x;return c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"roscDuringTransport",value:_.value,checked:((x=(v=t.cardiacArrest)==null?void 0:v.rosc)==null?void 0:x.duringTransport)===_.value,onChange:T=>{var E;return e({...t,cardiacArrest:{...t.cardiacArrest,rosc:{...(E=t.cardiacArrest)==null?void 0:E.rosc,duringTransport:T.target.value}}})},className:"mr-2"}),_.label]},_.value)})})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"入院"}),c.jsx("div",{className:"space-y-2",children:[{value:"er-death",label:"ER死亡"},{value:"admission",label:"入院"},{value:"transfer",label:"転院"},{value:"unknown",label:"不明"}].map(_=>{var v;return c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"hospitalization",value:_.value,checked:((v=t.cardiacArrest)==null?void 0:v.hospitalization)===_.value,onChange:x=>e({...t,cardiacArrest:{...t.cardiacArrest,hospitalization:x.target.value}}),className:"mr-2"}),_.label]},_.value)})})]})]})]})]})},pL=({registry:t,setRegistry:e})=>{var n,r,i;return c.jsxs("div",{className:"space-y-8",children:[c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"受傷機転"}),c.jsx("div",{className:"space-y-2",children:[{value:"blunt",label:"鈍的外傷"},{value:"penetrating",label:"穿通性外傷"},{value:"burn",label:"熱傷"}].map(s=>{var a;return c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"traumaMechanism",value:s.value,checked:((a=t.trauma)==null?void 0:a.mechanism)===s.value,onChange:u=>e({...t,trauma:{...t.trauma,mechanism:u.target.value}}),className:"mr-2"}),s.label]},s.value)})})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"現場処置"}),c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[{key:"oxygenTherapy",label:"酸素療法"},{key:"intubation",label:"気管挿管"},{key:"thoracentesis",label:"胸腔穿刺"}].map(s=>{var a,u;return c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((u=(a=t.trauma)==null?void 0:a.fieldTreatment)==null?void 0:u[s.key])||!1,onChange:h=>{var m;return e({...t,trauma:{...t.trauma,fieldTreatment:{...(m=t.trauma)==null?void 0:m.fieldTreatment,[s.key]:h.target.checked}}})},className:"mr-2"}),s.label]},s.key)})})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"重症度スコア"}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"ISS"}),c.jsx(ue,{type:"number",min:"0",max:"75",value:((n=t.trauma)==null?void 0:n.iss)||"",onChange:s=>e({...t,trauma:{...t.trauma,iss:parseInt(s.target.value)||0}}),placeholder:"0-75"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"RTS"}),c.jsx(ue,{type:"number",min:"0",max:"12",step:"0.1",value:((r=t.trauma)==null?void 0:r.rts)||"",onChange:s=>e({...t,trauma:{...t.trauma,rts:parseFloat(s.target.value)||0}}),placeholder:"0-12"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ps"}),c.jsx(ue,{type:"number",min:"0",max:"1",step:"0.01",value:((i=t.trauma)==null?void 0:i.ps)||"",onChange:s=>e({...t,trauma:{...t.trauma,ps:parseFloat(s.target.value)||0}}),placeholder:"0-1"})]})]})]})]})},gL=({registry:t,setRegistry:e})=>{var n,r,i,s,a,u,h,m,p,_;return c.jsxs("div",{className:"space-y-8",children:[c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"疑われた病態"}),c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[{key:"infarction",label:"脳梗塞"},{key:"hemorrhage",label:"脳出血"},{key:"sah",label:"くも膜下出血"},{key:"tia",label:"TIA"},{key:"seizure",label:"けいれん"},{key:"hypoglycemia",label:"低血糖"},{key:"metabolic",label:"代謝性疾患"},{key:"alcohol",label:"アルコール"},{key:"poisoning",label:"中毒"},{key:"other",label:"その他"}].map(v=>{var x,T;return c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((T=(x=t.stroke)==null?void 0:x.suspectedCondition)==null?void 0:T[v.key])||!1,onChange:E=>{var R;return e({...t,stroke:{...t.stroke,suspectedCondition:{...(R=t.stroke)==null?void 0:R.suspectedCondition,[v.key]:E.target.checked}}})},className:"mr-2"}),v.label]},v.key)})})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"時間経過"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"発症時刻"}),c.jsx(ue,{type:"time",value:((n=t.stroke)==null?void 0:n.onsetTime)||"",onChange:v=>e({...t,stroke:{...t.stroke,onsetTime:v.target.value}})})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"最終健常確認時刻"}),c.jsx(ue,{type:"time",value:((r=t.stroke)==null?void 0:r.lastSeenNormalTime)||"",onChange:v=>e({...t,stroke:{...t.stroke,lastSeenNormalTime:v.target.value}})})]})]})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"神経学的評価"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[c.jsxs("div",{children:[c.jsx("h4",{className:"text-md font-medium text-gray-800 mb-3",children:"CPSS"}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((s=(i=t.stroke)==null?void 0:i.cpss)==null?void 0:s.facialDrooping)||!1,onChange:v=>{var x;return e({...t,stroke:{...t.stroke,cpss:{...(x=t.stroke)==null?void 0:x.cpss,facialDrooping:v.target.checked}}})},className:"mr-2"}),"顔面下垂"]}),c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((u=(a=t.stroke)==null?void 0:a.cpss)==null?void 0:u.armWeakness)||!1,onChange:v=>{var x;return e({...t,stroke:{...t.stroke,cpss:{...(x=t.stroke)==null?void 0:x.cpss,armWeakness:v.target.checked}}})},className:"mr-2"}),"上肢脱力"]}),c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((m=(h=t.stroke)==null?void 0:h.cpss)==null?void 0:m.speech)||!1,onChange:v=>{var x;return e({...t,stroke:{...t.stroke,cpss:{...(x=t.stroke)==null?void 0:x.cpss,speech:v.target.checked}}})},className:"mr-2"}),"構語障害"]})]})]}),c.jsxs("div",{children:[c.jsx("h4",{className:"text-md font-medium text-gray-800 mb-3",children:"KPSS合計点"}),c.jsx(ue,{type:"number",min:"0",max:"22",value:((_=(p=t.stroke)==null?void 0:p.kpss)==null?void 0:_.total)||"",onChange:v=>{var x;return e({...t,stroke:{...t.stroke,kpss:{...(x=t.stroke)==null?void 0:x.kpss,total:parseInt(v.target.value)||0}}})},placeholder:"0-22"})]})]})]})]})},_L=({registry:t,setRegistry:e})=>{var n,r,i,s,a,u,h,m,p,_,v;return c.jsxs("div",{className:"space-y-8",children:[c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"既往歴"}),c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[{key:"hypertension",label:"高血圧"},{key:"diabetes",label:"糖尿病"},{key:"hyperlipidemia",label:"脂質異常症"},{key:"smoking",label:"喫煙"},{key:"familyHistory",label:"家族歴"},{key:"heartDisease",label:"心疾患"},{key:"respiratoryDisease",label:"呼吸器疾患"}].map(x=>{var T,E;return c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((E=(T=t.acs)==null?void 0:T.medicalHistory)==null?void 0:E[x.key])||!1,onChange:R=>{var S;return e({...t,acs:{...t.acs,medicalHistory:{...(S=t.acs)==null?void 0:S.medicalHistory,[x.key]:R.target.checked}}})},className:"mr-2"}),x.label]},x.key)})})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"病院外12誘導心電図所見"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"心調律"}),c.jsx("div",{className:"space-y-2",children:[{value:"sinus",label:"洞調律"},{value:"af",label:"心房細動"},{value:"junctional",label:"接合部調律"},{value:"other",label:"その他"},{value:"unknown",label:"不明"}].map(x=>{var T,E,R;return c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"ecgRhythm",value:x.value,checked:((R=(E=(T=t.acs)==null?void 0:T.prehospitalFindings)==null?void 0:E.ecgFindings)==null?void 0:R.rhythm)===x.value,onChange:S=>{var C,A,U;return e({...t,acs:{...t.acs,prehospitalFindings:{...(C=t.acs)==null?void 0:C.prehospitalFindings,ecgFindings:{...(U=(A=t.acs)==null?void 0:A.prehospitalFindings)==null?void 0:U.ecgFindings,rhythm:S.target.value}}}})},className:"mr-2"}),x.label]},x.value)})})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"心拍数"}),c.jsx(ue,{type:"number",min:"0",max:"300",value:((i=(r=(n=t.acs)==null?void 0:n.prehospitalFindings)==null?void 0:r.ecgFindings)==null?void 0:i.heartRate)||"",onChange:x=>{var T,E,R;return e({...t,acs:{...t.acs,prehospitalFindings:{...(T=t.acs)==null?void 0:T.prehospitalFindings,ecgFindings:{...(R=(E=t.acs)==null?void 0:E.prehospitalFindings)==null?void 0:R.ecgFindings,heartRate:parseInt(x.target.value)||0}}}})},placeholder:"回/分"})]})]}),c.jsxs("div",{className:"mt-4",children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ST変化"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((h=(u=(a=(s=t.acs)==null?void 0:s.prehospitalFindings)==null?void 0:a.ecgFindings)==null?void 0:u.stChanges)==null?void 0:h.elevation)||!1,onChange:x=>{var T,E,R,S,C,A;return e({...t,acs:{...t.acs,prehospitalFindings:{...(T=t.acs)==null?void 0:T.prehospitalFindings,ecgFindings:{...(R=(E=t.acs)==null?void 0:E.prehospitalFindings)==null?void 0:R.ecgFindings,stChanges:{...(A=(C=(S=t.acs)==null?void 0:S.prehospitalFindings)==null?void 0:C.ecgFindings)==null?void 0:A.stChanges,elevation:x.target.checked}}}}})},className:"mr-2"}),"ST上昇"]}),c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((v=(_=(p=(m=t.acs)==null?void 0:m.prehospitalFindings)==null?void 0:p.ecgFindings)==null?void 0:_.stChanges)==null?void 0:v.depression)||!1,onChange:x=>{var T,E,R,S,C,A;return e({...t,acs:{...t.acs,prehospitalFindings:{...(T=t.acs)==null?void 0:T.prehospitalFindings,ecgFindings:{...(R=(E=t.acs)==null?void 0:E.prehospitalFindings)==null?void 0:R.ecgFindings,stChanges:{...(A=(C=(S=t.acs)==null?void 0:S.prehospitalFindings)==null?void 0:C.ecgFindings)==null?void 0:A.stChanges,depression:x.target.checked}}}}})},className:"mr-2"}),"ST低下"]})]})]})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"疑われた病態・病院診断"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[c.jsxs("div",{children:[c.jsx("h4",{className:"text-md font-medium text-gray-800 mb-3",children:"疑われた病態"}),c.jsx("div",{className:"space-y-2",children:[{key:"ami",label:"急性心筋梗塞"},{key:"angina",label:"狭心症"},{key:"arrhythmia",label:"不整脈"},{key:"otherAcs",label:"その他ACS"},{key:"aorticDissection",label:"大動脈解離"},{key:"acuteHeartFailure",label:"急性心不全"},{key:"other",label:"その他"}].map(x=>{var T,E;return c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((E=(T=t.acs)==null?void 0:T.suspectedCondition)==null?void 0:E[x.key])||!1,onChange:R=>{var S;return e({...t,acs:{...t.acs,suspectedCondition:{...(S=t.acs)==null?void 0:S.suspectedCondition,[x.key]:R.target.checked}}})},className:"mr-2"}),x.label]},x.key)})})]}),c.jsxs("div",{children:[c.jsx("h4",{className:"text-md font-medium text-gray-800 mb-3",children:"病院診断"}),c.jsx("div",{className:"space-y-2",children:[{key:"ami",label:"急性心筋梗塞"},{key:"angina",label:"狭心症"},{key:"arrhythmia",label:"不整脈"},{key:"otherAcs",label:"その他ACS"},{key:"aorticDissection",label:"大動脈解離"},{key:"acuteHeartFailure",label:"急性心不全"},{key:"other",label:"その他"}].map(x=>{var T,E;return c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"checkbox",checked:((E=(T=t.acs)==null?void 0:T.hospitalDiagnosis)==null?void 0:E[x.key])||!1,onChange:R=>{var S;return e({...t,acs:{...t.acs,hospitalDiagnosis:{...(S=t.acs)==null?void 0:S.hospitalDiagnosis,[x.key]:R.target.checked}}})},className:"mr-2"}),x.label]},x.key)})})]})]})]})]})},vL=({registry:t,setRegistry:e})=>{var n,r,i,s,a,u,h,m,p,_,v,x,T,E,R,S,C,A,U,Z,V,k,N,D,M,F,z,j,me,Ve,Te,se,W,fe,X,Y,ce,Ie,Oe,Ne,xe,ut,Cn,zs,Yn,Xn,Vn,vr,Ti,zr,Ii,Br,Ur,Bs,Si,yr,Ci,Us,Pi,Ni,xr,_t,xt,$r,Ai,ki,Fo,er,qr,Ri,ji,wr,zo,Di,Li,Mi,tr,Vi,Oi,On,$s,Gr;return c.jsxs("div",{className:"space-y-8",children:[c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"院内バイタルサイン"}),c.jsxs("div",{className:"mb-6",children:[c.jsx("h4",{className:"text-md font-medium text-gray-800 mb-3",children:"GCS（Glasgow Coma Scale）"}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"GCS 合計"}),c.jsx(ue,{type:"number",min:"3",max:"15",value:((i=(r=(n=t.hospitalCourse)==null?void 0:n.vitals)==null?void 0:r.gcs)==null?void 0:i.total)||"",onChange:ae=>{var J,Be,we;return e({...t,hospitalCourse:{...t.hospitalCourse,vitals:{...(J=t.hospitalCourse)==null?void 0:J.vitals,gcs:{...(we=(Be=t.hospitalCourse)==null?void 0:Be.vitals)==null?void 0:we.gcs,total:parseInt(ae.target.value)||0}}}})},placeholder:"3-15"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"E（開眼）"}),c.jsx(ue,{type:"number",min:"1",max:"4",value:((u=(a=(s=t.hospitalCourse)==null?void 0:s.vitals)==null?void 0:a.gcs)==null?void 0:u.eye)||"",onChange:ae=>{var J,Be,we;return e({...t,hospitalCourse:{...t.hospitalCourse,vitals:{...(J=t.hospitalCourse)==null?void 0:J.vitals,gcs:{...(we=(Be=t.hospitalCourse)==null?void 0:Be.vitals)==null?void 0:we.gcs,eye:parseInt(ae.target.value)||0}}}})},placeholder:"1-4"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"V（言語）"}),c.jsx(ue,{type:"number",min:"1",max:"5",value:((p=(m=(h=t.hospitalCourse)==null?void 0:h.vitals)==null?void 0:m.gcs)==null?void 0:p.verbal)||"",onChange:ae=>{var J,Be,we;return e({...t,hospitalCourse:{...t.hospitalCourse,vitals:{...(J=t.hospitalCourse)==null?void 0:J.vitals,gcs:{...(we=(Be=t.hospitalCourse)==null?void 0:Be.vitals)==null?void 0:we.gcs,verbal:parseInt(ae.target.value)||0}}}})},placeholder:"1-5"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"M（運動）"}),c.jsx(ue,{type:"number",min:"1",max:"6",value:((x=(v=(_=t.hospitalCourse)==null?void 0:_.vitals)==null?void 0:v.gcs)==null?void 0:x.motor)||"",onChange:ae=>{var J,Be,we;return e({...t,hospitalCourse:{...t.hospitalCourse,vitals:{...(J=t.hospitalCourse)==null?void 0:J.vitals,gcs:{...(we=(Be=t.hospitalCourse)==null?void 0:Be.vitals)==null?void 0:we.gcs,motor:parseInt(ae.target.value)||0}}}})},placeholder:"1-6"})]})]})]}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"血圧"}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(ue,{type:"number",value:((R=(E=(T=t.hospitalCourse)==null?void 0:T.vitals)==null?void 0:E.bloodPressure)==null?void 0:R.systolic)||"",onChange:ae=>{var J,Be,we;return e({...t,hospitalCourse:{...t.hospitalCourse,vitals:{...(J=t.hospitalCourse)==null?void 0:J.vitals,bloodPressure:{...(we=(Be=t.hospitalCourse)==null?void 0:Be.vitals)==null?void 0:we.bloodPressure,systolic:parseInt(ae.target.value)||0}}}})},placeholder:"収縮期"}),c.jsx("span",{children:"/"}),c.jsx(ue,{type:"number",value:((A=(C=(S=t.hospitalCourse)==null?void 0:S.vitals)==null?void 0:C.bloodPressure)==null?void 0:A.diastolic)||"",onChange:ae=>{var J,Be,we;return e({...t,hospitalCourse:{...t.hospitalCourse,vitals:{...(J=t.hospitalCourse)==null?void 0:J.vitals,bloodPressure:{...(we=(Be=t.hospitalCourse)==null?void 0:Be.vitals)==null?void 0:we.bloodPressure,diastolic:parseInt(ae.target.value)||0}}}})},placeholder:"拡張期"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"脈拍"}),c.jsx(ue,{type:"number",value:((Z=(U=t.hospitalCourse)==null?void 0:U.vitals)==null?void 0:Z.pulse)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,vitals:{...(J=t.hospitalCourse)==null?void 0:J.vitals,pulse:parseInt(ae.target.value)||0}}})},placeholder:"回/分"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"呼吸"}),c.jsx(ue,{type:"number",value:((k=(V=t.hospitalCourse)==null?void 0:V.vitals)==null?void 0:k.respiration)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,vitals:{...(J=t.hospitalCourse)==null?void 0:J.vitals,respiration:parseInt(ae.target.value)||0}}})},placeholder:"回/分"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"体温"}),c.jsx(ue,{type:"number",step:"0.1",value:((D=(N=t.hospitalCourse)==null?void 0:N.vitals)==null?void 0:D.temperature)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,vitals:{...(J=t.hospitalCourse)==null?void 0:J.vitals,temperature:parseFloat(ae.target.value)||0}}})},placeholder:"℃"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"SpO2"}),c.jsx(ue,{type:"number",min:"0",max:"100",value:((F=(M=t.hospitalCourse)==null?void 0:M.vitals)==null?void 0:F.spo2)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,vitals:{...(J=t.hospitalCourse)==null?void 0:J.vitals,spo2:parseInt(ae.target.value)||0}}})},placeholder:"%"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"酸素"}),c.jsx(ue,{type:"number",value:((j=(z=t.hospitalCourse)==null?void 0:z.vitals)==null?void 0:j.oxygen)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,vitals:{...(J=t.hospitalCourse)==null?void 0:J.vitals,oxygen:parseInt(ae.target.value)||0}}})},placeholder:"L/分"})]})]}),c.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"瞳孔（右, 左）"}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(ue,{type:"text",value:((Te=(Ve=(me=t.hospitalCourse)==null?void 0:me.vitals)==null?void 0:Ve.pupil)==null?void 0:Te.right)||"",onChange:ae=>{var J,Be,we;return e({...t,hospitalCourse:{...t.hospitalCourse,vitals:{...(J=t.hospitalCourse)==null?void 0:J.vitals,pupil:{...(we=(Be=t.hospitalCourse)==null?void 0:Be.vitals)==null?void 0:we.pupil,right:ae.target.value}}}})},placeholder:"右瞳孔"}),c.jsx("span",{className:"text-gray-500",children:","}),c.jsx(ue,{type:"text",value:((fe=(W=(se=t.hospitalCourse)==null?void 0:se.vitals)==null?void 0:W.pupil)==null?void 0:fe.left)||"",onChange:ae=>{var J,Be,we;return e({...t,hospitalCourse:{...t.hospitalCourse,vitals:{...(J=t.hospitalCourse)==null?void 0:J.vitals,pupil:{...(we=(Be=t.hospitalCourse)==null?void 0:Be.vitals)==null?void 0:we.pupil,left:ae.target.value}}}})},placeholder:"左瞳孔"})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"対光反射（右, 左）"}),c.jsxs("div",{className:"flex items-center space-x-2",children:[c.jsx(ue,{type:"text",value:((ce=(Y=(X=t.hospitalCourse)==null?void 0:X.vitals)==null?void 0:Y.lightReflex)==null?void 0:ce.right)||"",onChange:ae=>{var J,Be,we;return e({...t,hospitalCourse:{...t.hospitalCourse,vitals:{...(J=t.hospitalCourse)==null?void 0:J.vitals,lightReflex:{...(we=(Be=t.hospitalCourse)==null?void 0:Be.vitals)==null?void 0:we.lightReflex,right:ae.target.value}}}})},placeholder:"右反射"}),c.jsx("span",{className:"text-gray-500",children:","}),c.jsx(ue,{type:"text",value:((Ne=(Oe=(Ie=t.hospitalCourse)==null?void 0:Ie.vitals)==null?void 0:Oe.lightReflex)==null?void 0:Ne.left)||"",onChange:ae=>{var J,Be,we;return e({...t,hospitalCourse:{...t.hospitalCourse,vitals:{...(J=t.hospitalCourse)==null?void 0:J.vitals,lightReflex:{...(we=(Be=t.hospitalCourse)==null?void 0:Be.vitals)==null?void 0:we.lightReflex,left:ae.target.value}}}})},placeholder:"左反射"})]})]})]})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"血液ガス分析"}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"採血部位"}),c.jsxs("div",{className:"space-y-2",children:[c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"abgType",value:"arterial",checked:((ut=(xe=t.hospitalCourse)==null?void 0:xe.abg)==null?void 0:ut.type)==="arterial",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,abg:{...(J=t.hospitalCourse)==null?void 0:J.abg,type:ae.target.value}}})},className:"mr-2"}),"動脈"]}),c.jsxs("label",{className:"flex items-center",children:[c.jsx("input",{type:"radio",name:"abgType",value:"venous",checked:((zs=(Cn=t.hospitalCourse)==null?void 0:Cn.abg)==null?void 0:zs.type)==="venous",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,abg:{...(J=t.hospitalCourse)==null?void 0:J.abg,type:ae.target.value}}})},className:"mr-2"}),"静脈"]})]})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"FiO2"}),c.jsx(ue,{type:"number",min:"0",max:"1",step:"0.01",value:((Xn=(Yn=t.hospitalCourse)==null?void 0:Yn.abg)==null?void 0:Xn.fio2)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,abg:{...(J=t.hospitalCourse)==null?void 0:J.abg,fio2:parseFloat(ae.target.value)||0}}})},placeholder:"0.21-1.00"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"pH"}),c.jsx(ue,{type:"number",step:"0.01",min:"6.8",max:"7.8",value:((vr=(Vn=t.hospitalCourse)==null?void 0:Vn.abg)==null?void 0:vr.ph)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,abg:{...(J=t.hospitalCourse)==null?void 0:J.abg,ph:parseFloat(ae.target.value)||0}}})},placeholder:"7.35-7.45"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PaCO2"}),c.jsx(ue,{type:"number",step:"0.1",value:((zr=(Ti=t.hospitalCourse)==null?void 0:Ti.abg)==null?void 0:zr.paco2)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,abg:{...(J=t.hospitalCourse)==null?void 0:J.abg,paco2:parseFloat(ae.target.value)||0}}})},placeholder:"mmHg"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PaO2"}),c.jsx(ue,{type:"number",step:"0.1",value:((Br=(Ii=t.hospitalCourse)==null?void 0:Ii.abg)==null?void 0:Br.pao2)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,abg:{...(J=t.hospitalCourse)==null?void 0:J.abg,pao2:parseFloat(ae.target.value)||0}}})},placeholder:"mmHg"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"HCO3-"}),c.jsx(ue,{type:"number",step:"0.1",value:((Bs=(Ur=t.hospitalCourse)==null?void 0:Ur.abg)==null?void 0:Bs.hco3)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,abg:{...(J=t.hospitalCourse)==null?void 0:J.abg,hco3:parseFloat(ae.target.value)||0}}})},placeholder:"mEq/L"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"BE"}),c.jsx(ue,{type:"number",step:"0.1",value:((yr=(Si=t.hospitalCourse)==null?void 0:Si.abg)==null?void 0:yr.be)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,abg:{...(J=t.hospitalCourse)==null?void 0:J.abg,be:parseFloat(ae.target.value)||0}}})},placeholder:"mEq/L"})]})]})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"検査結果"}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"WBC"}),c.jsx(ue,{type:"number",step:"0.1",value:((Us=(Ci=t.hospitalCourse)==null?void 0:Ci.labResults)==null?void 0:Us.wbc)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,labResults:{...(J=t.hospitalCourse)==null?void 0:J.labResults,wbc:parseFloat(ae.target.value)||0}}})},placeholder:"×10³/μL"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hb"}),c.jsx(ue,{type:"number",step:"0.1",value:((Ni=(Pi=t.hospitalCourse)==null?void 0:Pi.labResults)==null?void 0:Ni.hb)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,labResults:{...(J=t.hospitalCourse)==null?void 0:J.labResults,hb:parseFloat(ae.target.value)||0}}})},placeholder:"g/dL"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ht"}),c.jsx(ue,{type:"number",step:"0.1",value:((_t=(xr=t.hospitalCourse)==null?void 0:xr.labResults)==null?void 0:_t.ht)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,labResults:{...(J=t.hospitalCourse)==null?void 0:J.labResults,ht:parseFloat(ae.target.value)||0}}})},placeholder:"%"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Plt"}),c.jsx(ue,{type:"number",value:(($r=(xt=t.hospitalCourse)==null?void 0:xt.labResults)==null?void 0:$r.plt)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,labResults:{...(J=t.hospitalCourse)==null?void 0:J.labResults,plt:parseInt(ae.target.value)||0}}})},placeholder:"×10⁴/μL"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"T.Bil"}),c.jsx(ue,{type:"number",step:"0.1",value:((ki=(Ai=t.hospitalCourse)==null?void 0:Ai.labResults)==null?void 0:ki.tbil)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,labResults:{...(J=t.hospitalCourse)==null?void 0:J.labResults,tbil:parseFloat(ae.target.value)||0}}})},placeholder:"mg/dL"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cre"}),c.jsx(ue,{type:"number",step:"0.01",value:((er=(Fo=t.hospitalCourse)==null?void 0:Fo.labResults)==null?void 0:er.cre)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,labResults:{...(J=t.hospitalCourse)==null?void 0:J.labResults,cre:parseFloat(ae.target.value)||0}}})},placeholder:"mg/dL"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Na"}),c.jsx(ue,{type:"number",value:((Ri=(qr=t.hospitalCourse)==null?void 0:qr.labResults)==null?void 0:Ri.na)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,labResults:{...(J=t.hospitalCourse)==null?void 0:J.labResults,na:parseInt(ae.target.value)||0}}})},placeholder:"mEq/L"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"K"}),c.jsx(ue,{type:"number",step:"0.1",value:((wr=(ji=t.hospitalCourse)==null?void 0:ji.labResults)==null?void 0:wr.k)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,labResults:{...(J=t.hospitalCourse)==null?void 0:J.labResults,k:parseFloat(ae.target.value)||0}}})},placeholder:"mEq/L"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Lactate"}),c.jsx(ue,{type:"number",step:"0.1",value:((Di=(zo=t.hospitalCourse)==null?void 0:zo.labResults)==null?void 0:Di.lactate)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,labResults:{...(J=t.hospitalCourse)==null?void 0:J.labResults,lactate:parseFloat(ae.target.value)||0}}})},placeholder:"mmol/L"})]})]})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"機能的転帰"}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CPC 退院時"}),c.jsx(ue,{type:"number",min:"1",max:"5",value:((Mi=(Li=t.hospitalCourse)==null?void 0:Li.functionalOutcome)==null?void 0:Mi.cpcDischarge)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,functionalOutcome:{...(J=t.hospitalCourse)==null?void 0:J.functionalOutcome,cpcDischarge:parseInt(ae.target.value)||0}}})},placeholder:"1-5"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CPC 3ヶ月後"}),c.jsx(ue,{type:"number",min:"1",max:"5",value:((Vi=(tr=t.hospitalCourse)==null?void 0:tr.functionalOutcome)==null?void 0:Vi.cpcThreeMonth)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,functionalOutcome:{...(J=t.hospitalCourse)==null?void 0:J.functionalOutcome,cpcThreeMonth:parseInt(ae.target.value)||0}}})},placeholder:"1-5"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"mRS 退院時"}),c.jsx(ue,{type:"number",min:"0",max:"6",value:((On=(Oi=t.hospitalCourse)==null?void 0:Oi.functionalOutcome)==null?void 0:On.mrsDischarge)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,functionalOutcome:{...(J=t.hospitalCourse)==null?void 0:J.functionalOutcome,mrsDischarge:parseInt(ae.target.value)||0}}})},placeholder:"0-6"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"mRS 3ヶ月後"}),c.jsx(ue,{type:"number",min:"0",max:"6",value:((Gr=($s=t.hospitalCourse)==null?void 0:$s.functionalOutcome)==null?void 0:Gr.mrsThreeMonth)||"",onChange:ae=>{var J;return e({...t,hospitalCourse:{...t.hospitalCourse,functionalOutcome:{...(J=t.hospitalCourse)==null?void 0:J.functionalOutcome,mrsThreeMonth:parseInt(ae.target.value)||0}}})},placeholder:"0-6"})]})]})]}),c.jsxs("div",{children:[c.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"ドクターカー活動の問題点"}),c.jsx("textarea",{className:"w-full p-3 border border-gray-300 rounded-lg resize-none",rows:4,value:t.activityProblems||"",onChange:ae=>e({...t,activityProblems:ae.target.value}),placeholder:"ドクターカー活動の問題点や改善点について記入してください"})]})]})},yL=()=>c.jsx(cL,{}),xL=()=>{const t=js(),[e,n]=B.useState([]),[r,i]=B.useState(!0),[s,a]=B.useState(!1);B.useEffect(()=>{u()},[]);const u=async()=>{i(!0);try{const x=await Jd.getCompletedRegistries();n(x.sort((T,E)=>{var C,A,U,Z,V,k,N,D;const R=((Z=(U=(A=(C=T.timelineDoctorCar)==null?void 0:C.awareness)==null?void 0:A.toDate)==null?void 0:U.call(A))==null?void 0:Z.getTime())||0;return(((D=(N=(k=(V=E.timelineDoctorCar)==null?void 0:V.awareness)==null?void 0:k.toDate)==null?void 0:N.call(k))==null?void 0:D.getTime())||0)-R}))}catch(x){console.error("Failed to load registries:",x)}finally{i(!1)}},h=async()=>{a(!0);try{const x=await Jd.exportRegistriesToCSV(e),T=new Blob([x],{type:"text/csv;charset=utf-8;"}),E=document.createElement("a"),R=URL.createObjectURL(T);E.setAttribute("href",R),E.setAttribute("download",`doctorcar_registry_${new Date().toISOString().split("T")[0]}.csv`),E.style.visibility="hidden",document.body.appendChild(E),E.click(),document.body.removeChild(E)}catch(x){console.error("Failed to export CSV:",x),alert("CSVエクスポートに失敗しました")}finally{a(!1)}},m=x=>!x||!x.toDate?"-":x.toDate().toLocaleDateString("ja-JP"),p=x=>!x||!x.toDate?"-":x.toDate().toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),_=x=>{switch(x){case"C":return"bg-red-100 text-red-800";case"T":return"bg-orange-100 text-orange-800";case"S":return"bg-blue-100 text-blue-800";case"M":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},v=x=>{switch(x){case"own-tertiary":return"自院三次";case"own-secondary":return"自院二次";case"other-tertiary":return"他院三次";case"other-secondary":return"他院二次";case"cancel-before-arrival":return"現着前キャンセル";case"cancel-mild":return"軽症キャンセル";case"social-death":return"社会死";case"other":return"その他";default:return"-"}};return r?c.jsx("div",{className:"min-h-screen flex items-center justify-center",children:c.jsx(_r,{size:"lg"})}):c.jsxs("div",{className:"min-h-screen bg-gray-50",children:[c.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:c.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:c.jsxs("div",{className:"flex items-center justify-between h-16",children:[c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("button",{onClick:()=>t("/cases"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:c.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"レジストリ一覧"}),c.jsxs("p",{className:"text-sm text-gray-500",children:["完了済みレジストリ: ",e.length,"件"]})]})]}),c.jsx("div",{className:"flex items-center space-x-2",children:c.jsx(Le,{size:"sm",onClick:h,disabled:s||e.length===0,children:"CSVエクスポート"})})]})})}),c.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:c.jsx("div",{className:"px-4 py-6 sm:px-0",children:e.length===0?c.jsx("div",{className:"bg-white rounded-lg shadow p-8 text-center",children:c.jsx("p",{className:"text-gray-500",children:"完了済みのレジストリがありません"})}):c.jsx("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:c.jsx("div",{className:"overflow-x-auto",children:c.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[c.jsx("thead",{className:"bg-gray-50",children:c.jsxs("tr",{children:[c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"レジストリ番号"}),c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"要請日時"}),c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"患者情報"}),c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"推定病名"}),c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"搬送先"}),c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"分類"}),c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"転帰"}),c.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"活動時間"})]})}),c.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:e.map(x=>{var T,E,R,S,C;return c.jsxs("tr",{className:"hover:bg-gray-50",children:[c.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:x.registryNumber}),c.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[c.jsx("div",{children:m((T=x.timelineDoctorCar)==null?void 0:T.awareness)}),c.jsx("div",{className:"text-xs",children:p((E=x.timelineDoctorCar)==null?void 0:E.awareness)})]}),c.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[x.patientAge,"歳",x.patientGender==="male"?"男性":x.patientGender==="female"?"女性":"-"]}),c.jsx("td",{className:"px-6 py-4 text-sm text-gray-500",children:c.jsx("div",{className:"max-w-xs truncate",children:((R=x.estimatedDiagnosis)==null?void 0:R.join(", "))||"-"})}),c.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:v((S=x.destination)==null?void 0:S.type)}),c.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:c.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${_(x.category||void 0)}`,children:x.category||"-"})}),c.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:v((C=x.destination)==null?void 0:C.type)}),c.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:x.totalActivityTime?`${x.totalActivityTime}分`:"-"})]},x.id)})})]})})})})})]})},wL=()=>{var _;const t=js(),[e]=oN(),{analytics:n,isLoading:r,refreshAnalytics:i}=xb(),[s,a]=B.useState(null),[u,h]=B.useState(null);B.useEffect(()=>{const v=e.get("originLat"),x=e.get("originLon"),T=e.get("originName"),E=e.get("destLat"),R=e.get("destLon"),S=e.get("destName");v&&x&&a({latitude:parseFloat(v),longitude:parseFloat(x),name:T||"出発地"}),E&&R&&h({latitude:parseFloat(E),longitude:parseFloat(R),name:S||"目的地"})},[e]);const m=v=>{const x={latitude:35.701835,longitude:139.763417,name:v==="origin"?"東京ドクターカー基地":"東京医科歯科大学病院"};v==="origin"?a(x):h(x)},p=v=>{const x=Math.floor(v/60),T=Math.floor(x/60),E=x%60;return T>0?`${T}時間${E}分`:`${x}分`};return c.jsxs("div",{className:"min-h-screen bg-gray-50",children:[c.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:c.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:c.jsxs("div",{className:"flex items-center justify-between h-16",children:[c.jsxs("div",{className:"flex items-center space-x-4",children:[c.jsx("button",{onClick:()=>t("/cases"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:c.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"xROAD ルート最適化"}),c.jsx("p",{className:"text-sm text-gray-500",children:"リアルタイム交通データによる最適ルート検索"})]})]}),c.jsx("div",{className:"flex items-center space-x-2",children:c.jsx(Le,{size:"sm",variant:"outline",onClick:i,disabled:r,children:"📊 分析更新"})})]})})}),c.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:c.jsxs("div",{className:"px-4 py-6 sm:px-0",children:[c.jsxs("div",{className:"bg-white rounded-lg shadow p-6 mb-6",children:[c.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"位置設定"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"出発地"}),s?c.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("div",{className:"font-medium text-green-900",children:s.name}),c.jsxs("div",{className:"text-sm text-green-600",children:[s.latitude.toFixed(4),", ",s.longitude.toFixed(4)]})]}),c.jsx(Le,{size:"sm",variant:"outline",onClick:()=>a(null),children:"変更"})]})}):c.jsx(Le,{onClick:()=>m("origin"),className:"w-full border-dashed border-2 border-gray-300 text-gray-600",variant:"outline",children:"📍 出発地を設定"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"目的地"}),u?c.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsxs("div",{children:[c.jsx("div",{className:"font-medium text-blue-900",children:u.name}),c.jsxs("div",{className:"text-sm text-blue-600",children:[u.latitude.toFixed(4),", ",u.longitude.toFixed(4)]})]}),c.jsx(Le,{size:"sm",variant:"outline",onClick:()=>h(null),children:"変更"})]})}):c.jsx(Le,{onClick:()=>m("destination"),className:"w-full border-dashed border-2 border-gray-300 text-gray-600",variant:"outline",children:"🏥 目的地を設定"})]})]})]}),c.jsx(wb,{currentLocation:s?{latitude:s.latitude,longitude:s.longitude}:void 0,onRouteSelected:v=>{console.log("Route selected:",v)},onNavigationStart:v=>{console.log("Navigation started:",v),alert("ナビゲーションアプリに連携しました")},className:"mb-6"}),n&&c.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[c.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-6",children:"xROAD活用実績"}),c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[c.jsxs("div",{className:"bg-gradient-to-r from-green-400 to-green-600 rounded-lg p-4 text-white",children:[c.jsx("div",{className:"text-sm opacity-90",children:"ルート最適化"}),c.jsx("div",{className:"text-2xl font-bold",children:n.totalRoutesOptimized}),c.jsx("div",{className:"text-sm opacity-90",children:"回実行"})]}),c.jsxs("div",{className:"bg-gradient-to-r from-blue-400 to-blue-600 rounded-lg p-4 text-white",children:[c.jsx("div",{className:"text-sm opacity-90",children:"予測精度"}),c.jsxs("div",{className:"text-2xl font-bold",children:[Math.round(n.averageAccuracy*100),"%"]}),c.jsx("div",{className:"text-sm opacity-90",children:"平均精度"})]}),c.jsxs("div",{className:"bg-gradient-to-r from-purple-400 to-purple-600 rounded-lg p-4 text-white",children:[c.jsx("div",{className:"text-sm opacity-90",children:"時間短縮"}),c.jsx("div",{className:"text-2xl font-bold",children:p(n.timeSaved)}),c.jsx("div",{className:"text-sm opacity-90",children:"累計短縮"})]}),c.jsxs("div",{className:"bg-gradient-to-r from-orange-400 to-orange-600 rounded-lg p-4 text-white",children:[c.jsx("div",{className:"text-sm opacity-90",children:"最適時間帯"}),c.jsxs("div",{className:"text-2xl font-bold",children:[((_=n.mostEfficientTimeSlots[0])==null?void 0:_.hour)||"--","時"]}),c.jsx("div",{className:"text-sm opacity-90",children:"最効率"})]})]}),c.jsxs("div",{className:"mb-8",children:[c.jsx("h3",{className:"text-md font-medium text-gray-800 mb-4",children:"時間帯別効率性"}),c.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:n.mostEfficientTimeSlots.map((v,x)=>c.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[c.jsxs("div",{className:"text-sm font-medium text-gray-900",children:[v.hour,":00-",v.hour+1,":00"]}),c.jsxs("div",{className:"text-xs text-gray-600 mt-1",children:["平均速度: ",v.averageSpeed.toFixed(0),"km/h"]}),c.jsxs("div",{className:"text-xs text-gray-600",children:["信頼度: ",Math.round(v.reliability*100),"%"]}),c.jsx("div",{className:"mt-2",children:c.jsx("div",{className:"bg-gray-200 rounded-full h-2",children:c.jsx("div",{className:"bg-green-500 h-2 rounded-full",style:{width:`${v.reliability*100}%`}})})})]},x))})]}),c.jsxs("div",{className:"border-t pt-6",children:[c.jsx("h3",{className:"text-md font-medium text-gray-800 mb-4",children:"xROAD API統合状況"}),c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-sm text-gray-600",children:"JARTIC交通量API"}),c.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"🟢 接続中"})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-sm text-gray-600",children:"DRM-PF ルート検索"}),c.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"🟢 接続中"})]}),c.jsxs("div",{className:"flex items-center justify-between",children:[c.jsx("span",{className:"text-sm text-gray-600",children:"リアルタイム更新"}),c.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs rounded-full",children:"🔄 5分間隔"})]})]}),c.jsxs("div",{className:"space-y-3",children:[c.jsxs("div",{className:"text-sm text-gray-600",children:[c.jsx("div",{className:"font-medium mb-1",children:"対象エリア"}),c.jsx("div",{children:"東京都心部 6km × 6km"})]}),c.jsxs("div",{className:"text-sm text-gray-600",children:[c.jsx("div",{className:"font-medium mb-1",children:"交通量観測点"}),c.jsx("div",{children:"約2,600地点（直轄国道）"})]}),c.jsxs("div",{className:"text-sm text-gray-600",children:[c.jsx("div",{className:"font-medium mb-1",children:"データ更新"}),c.jsx("div",{children:"5分値（20分遅延）"})]})]})]})]})]}),r&&c.jsxs("div",{className:"flex justify-center py-8",children:[c.jsx(_r,{size:"lg"}),c.jsx("span",{className:"ml-3 text-gray-600",children:"分析データを読み込み中..."})]})]})})]})},bL=()=>c.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:c.jsxs("div",{className:"text-center",children:[c.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"アクセス権限がありません"}),c.jsx("p",{className:"text-gray-600 mb-6",children:"このページにアクセスする権限がありません。"}),c.jsx("button",{onClick:()=>window.history.back(),className:"bg-medical-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"戻る"})]})});function EL(){const{initialize:t}=HN();return B.useEffect(()=>{console.log("App: initializing stores");try{return t()}catch(e){throw console.error("App initialization error:",e),e}},[]),c.jsx(KN,{children:c.jsx(nN,{children:c.jsxs(KP,{children:[c.jsx(cr,{path:"/login",element:c.jsx(ZN,{})}),c.jsx(cr,{path:"/unauthorized",element:c.jsx(bL,{})}),c.jsx(cr,{path:"/cases",element:c.jsx(ia,{children:c.jsx(XN,{})})}),c.jsx(cr,{path:"/cases/create",element:c.jsx(ia,{children:c.jsx(HA,{})})}),c.jsx(cr,{path:"/cases/:caseId",element:c.jsx(ia,{children:c.jsx($A,{})})}),c.jsx(cr,{path:"/cases/:caseId/registry",element:c.jsx(ia,{children:c.jsx(yL,{})})}),c.jsx(cr,{path:"/registries",element:c.jsx(ia,{children:c.jsx(xL,{})})}),c.jsx(cr,{path:"/route-optimization",element:c.jsx(ia,{children:c.jsx(wL,{})})}),c.jsx(cr,{path:"/",element:c.jsx($a,{to:"/cases",replace:!0})}),c.jsx(cr,{path:"*",element:c.jsx($a,{to:"/cases",replace:!0})})]})})})}qm.createRoot(document.getElementById("root")).render(c.jsx(ys.StrictMode,{children:c.jsx(EL,{})}));export{Um as $,tI as A,Ro as B,Or as C,Ct as D,tV as E,Lo as F,iv as G,eV as H,HL as I,Jn as J,jD as K,LD as L,kM as M,bM as N,EM as O,iL as P,Xt as Q,dM as R,YL as S,ct as T,GM as U,Ff as V,nL as W,qM as X,wM as Y,rM as Z,Gb as _,gu as a,fk as a$,ZL as a0,DD as a1,$D as a2,XM as a3,AM as a4,UM as a5,oM as a6,YM as a7,dg as a8,uM as a9,cM as aA,RM as aB,jM as aC,hM as aD,fM as aE,OM as aF,FM as aG,eL as aH,Cx as aI,BT as aJ,JL as aK,BM as aL,$M as aM,GD as aN,QM as aO,$L as aP,TM as aQ,_M as aR,gM as aS,xM as aT,aM as aU,WD as aV,HM as aW,iM as aX,Px as aY,KM as aZ,ja as a_,tM as aa,nM as ab,sM as ac,JM as ad,yM as ae,vM as af,gt as ag,Fu as ah,HD as ai,DM as aj,IM as ak,SM as al,CM as am,kx as an,PM as ao,NM as ap,eM as aq,ZM as ar,WM as as,XL as at,mM as au,pM as av,lM as aw,LM as ax,VM as ay,MM as az,MD as b,Md as b0,m0 as b1,ML as b2,Eo as b3,OL as b4,ou as b5,g_ as b6,uk as b7,VL as b8,Vd as b9,AL as bA,LL as bB,kL as bC,CL as bD,ck as ba,su as bb,gk as bc,pk as bd,zL as be,mk as bf,FL as bg,BL as bh,UL as bi,pl as bj,kb as bk,Wt as bl,JA as bm,bo as bn,RL as bo,jL as bp,DL as bq,IL as br,n2 as bs,ze as bt,SL as bu,NL as bv,iu as bw,Pb as bx,PL as by,Ga as bz,ol as c,Mo as d,Je as e,te as f,Il as g,Vu as h,ad as i,Wf as j,Ou as k,qf as l,fv as m,al as n,Gf as o,ho as p,rL as q,yt as r,To as s,le as t,GL as u,Sk as v,at as w,nV as x,Re as y,qL as z};
//# sourceMappingURL=index-7ac4a332.js.map
