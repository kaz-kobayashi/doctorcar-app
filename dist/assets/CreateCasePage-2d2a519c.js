import{g as y,u as f,a as v,r as L,j as e,B as n,b as C}from"./index-9b73e8bd.js";import{C as w}from"./index-69f8b09f.js";const A=()=>{const m=y(),{createCase:h,loading:p}=f(),{userInfo:a}=v(),[s,d]=L.useState({caseName:"",patientAge:"",patientGender:"male",patientName:"",sceneLatitude:"",sceneLongitude:"",hospitalLatitude:"",hospitalLongitude:"",description:""}),l=(t,i)=>{d({...s,[t]:i})},j=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(t=>{d({...s,sceneLatitude:t.coords.latitude.toString(),sceneLongitude:t.coords.longitude.toString()})},t=>{console.error("位置情報の取得に失敗しました:",t),alert("位置情報の取得に失敗しました。手動で座標を入力してください。")}):alert("このブラウザでは位置情報がサポートされていません。")},c=(t,i)=>{const o={渋谷駅:{lat:"35.658584",lng:"139.701442"},新宿駅:{lat:"35.689487",lng:"139.691706"},品川駅:{lat:"35.627701",lng:"139.740689"},東京大学病院:{lat:"35.665498",lng:"139.686567"},慶應義塾大学病院:{lat:"35.649519",lng:"139.701754"},東京医科大学病院:{lat:"35.693176",lng:"139.705148"}}[i];o&&d(t==="scene"?{...s,sceneLatitude:o.lat,sceneLongitude:o.lng}:{...s,hospitalLatitude:o.lat,hospitalLongitude:o.lng})},b=async t=>{if(t.preventDefault(),!s.caseName.trim()){alert("事案名を入力してください");return}if(!s.sceneLatitude||!s.sceneLongitude){alert("現場の位置情報を入力してください");return}if(!s.hospitalLatitude||!s.hospitalLongitude){alert("搬送先病院の位置情報を入力してください");return}try{const i=(r,x)=>({latitude:r,longitude:x,isEqual:g=>g.latitude===r&&g.longitude===x,toJSON:()=>({latitude:r,longitude:x})}),u=r=>({toDate:()=>r,toMillis:()=>r.getTime(),seconds:Math.floor(r.getTime()/1e3),nanoseconds:r.getTime()%1e3*1e6}),o={caseName:s.caseName.trim(),status:w.DISPATCHED,teamId:(a==null?void 0:a.uid)||"demo-user",patientInfo:{age:s.patientAge?parseInt(s.patientAge):void 0,gender:s.patientGender,name:s.patientName.trim()||void 0},sceneLocation:i(parseFloat(s.sceneLatitude),parseFloat(s.sceneLongitude)),hospitalLocation:i(parseFloat(s.hospitalLatitude),parseFloat(s.hospitalLongitude)),createdAt:u(new Date),updatedAt:u(new Date)},N=await h(o);alert("新規事案を作成しました"),m(`/cases/${N}`)}catch(i){console.error("事案作成エラー:",i),alert("事案の作成に失敗しました")}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>m("/cases"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"新規事案作成"})]}),e.jsx("div",{className:"text-sm text-gray-700",children:e.jsx("span",{className:"font-medium",children:a==null?void 0:a.name})})]})})}),e.jsx("main",{className:"max-w-4xl mx-auto py-6 sm:px-6 lg:px-8",children:e.jsx("div",{className:"px-4 py-6 sm:px-0",children:e.jsxs("form",{onSubmit:b,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"基本情報"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["事案名 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:s.caseName,onChange:t=>l("caseName",t.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"例: 2024-06-14 渋谷駅前 交通外傷"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"担当チーム"}),e.jsx("input",{type:"text",value:(a==null?void 0:a.team)||"",className:"w-full px-3 py-2 border rounded-lg bg-gray-50",disabled:!0})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"患者情報"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"患者氏名"}),e.jsx("input",{type:"text",value:s.patientName,onChange:t=>l("patientName",t.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"氏名（任意）"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"年齢"}),e.jsx("input",{type:"number",value:s.patientAge,onChange:t=>l("patientAge",t.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"年齢",min:"0",max:"150"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"性別"}),e.jsxs("select",{value:s.patientGender,onChange:t=>l("patientGender",t.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",children:[e.jsx("option",{value:"male",children:"男性"}),e.jsx("option",{value:"female",children:"女性"}),e.jsx("option",{value:"other",children:"その他"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"現場位置"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(n,{type:"button",variant:"outline",size:"sm",onClick:j,children:"現在地を取得"}),e.jsx(n,{type:"button",variant:"outline",size:"sm",onClick:()=>c("scene","渋谷駅"),children:"渋谷駅"}),e.jsx(n,{type:"button",variant:"outline",size:"sm",onClick:()=>c("scene","新宿駅"),children:"新宿駅"}),e.jsx(n,{type:"button",variant:"outline",size:"sm",onClick:()=>c("scene","品川駅"),children:"品川駅"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["緯度 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",step:"any",value:s.sceneLatitude,onChange:t=>l("sceneLatitude",t.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"35.658584"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["経度 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",step:"any",value:s.sceneLongitude,onChange:t=>l("sceneLongitude",t.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"139.701442"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"搬送先病院"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(n,{type:"button",variant:"outline",size:"sm",onClick:()=>c("hospital","東京大学病院"),children:"東京大学病院"}),e.jsx(n,{type:"button",variant:"outline",size:"sm",onClick:()=>c("hospital","慶應義塾大学病院"),children:"慶應義塾大学病院"}),e.jsx(n,{type:"button",variant:"outline",size:"sm",onClick:()=>c("hospital","東京医科大学病院"),children:"東京医科大学病院"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["緯度 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",step:"any",value:s.hospitalLatitude,onChange:t=>l("hospitalLatitude",t.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"35.665498"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["経度 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",step:"any",value:s.hospitalLongitude,onChange:t=>l("hospitalLongitude",t.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"139.686567"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(n,{type:"button",variant:"outline",onClick:()=>m("/cases"),children:"キャンセル"}),e.jsxs(n,{type:"submit",disabled:p,className:"flex items-center",children:[p&&e.jsx(C,{size:"sm",className:"mr-2"}),"事案を作成"]})]})]})})})]})};export{A as CreateCasePage};
//# sourceMappingURL=CreateCasePage-2d2a519c.js.map
