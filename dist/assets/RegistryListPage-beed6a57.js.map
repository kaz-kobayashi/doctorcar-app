{"version":3,"file":"RegistryListPage-beed6a57.js","sources":["../../src/pages/RegistryListPage.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Button, LoadingSpinner } from '@/components/common';\nimport { DoctorCarRegistry } from '@/types/registry';\nimport { registryService } from '@/services/registryService';\n\nexport const RegistryListPage: React.FC = () => {\n  const navigate = useNavigate();\n  const [registries, setRegistries] = useState<DoctorCarRegistry[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [exporting, setExporting] = useState(false);\n\n  useEffect(() => {\n    loadRegistries();\n  }, []);\n\n  const loadRegistries = async () => {\n    setLoading(true);\n    try {\n      const data = await registryService.getCompletedRegistries();\n      setRegistries(data.sort((a, b) => {\n        const aTime = a.timelineDoctorCar?.awareness?.toDate?.()?.getTime() || 0;\n        const bTime = b.timelineDoctorCar?.awareness?.toDate?.()?.getTime() || 0;\n        return bTime - aTime;\n      }));\n    } catch (error) {\n      console.error('Failed to load registries:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleExportCSV = async () => {\n    setExporting(true);\n    try {\n      const csv = await registryService.exportRegistriesToCSV(registries);\n      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n      const link = document.createElement('a');\n      const url = URL.createObjectURL(blob);\n      link.setAttribute('href', url);\n      link.setAttribute('download', `doctorcar_registry_${new Date().toISOString().split('T')[0]}.csv`);\n      link.style.visibility = 'hidden';\n      document.body.appendChild(link);\n      link.click();\n      document.body.removeChild(link);\n    } catch (error) {\n      console.error('Failed to export CSV:', error);\n      alert('CSVエクスポートに失敗しました');\n    } finally {\n      setExporting(false);\n    }\n  };\n\n  const formatDate = (timestamp: any): string => {\n    if (!timestamp || !timestamp.toDate) return '-';\n    return timestamp.toDate().toLocaleDateString('ja-JP');\n  };\n\n  const formatTime = (timestamp: any): string => {\n    if (!timestamp || !timestamp.toDate) return '-';\n    return timestamp.toDate().toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });\n  };\n\n  const getCategoryColor = (category?: string): string => {\n    switch (category) {\n      case 'C': return 'bg-red-100 text-red-800';\n      case 'T': return 'bg-orange-100 text-orange-800';\n      case 'S': return 'bg-blue-100 text-blue-800';\n      case 'M': return 'bg-green-100 text-green-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  const getDestinationText = (type?: string): string => {\n    switch (type) {\n      case 'own-tertiary': return '自院三次';\n      case 'own-secondary': return '自院二次';\n      case 'other-tertiary': return '他院三次';\n      case 'other-secondary': return '他院二次';\n      case 'cancel-before-arrival': return '現着前キャンセル';\n      case 'cancel-mild': return '軽症キャンセル';\n      case 'social-death': return '社会死';\n      case 'other': return 'その他';\n      default: return '-';\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <LoadingSpinner size=\"lg\" />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* ヘッダー */}\n      <header className=\"bg-white shadow-sm border-b border-gray-200\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex items-center justify-between h-16\">\n            <div className=\"flex items-center space-x-4\">\n              <button\n                onClick={() => navigate('/cases')}\n                className=\"p-2 text-gray-400 hover:text-gray-600 transition-colors\"\n              >\n                <svg className=\"h-5 w-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth=\"2\" d=\"M15 19l-7-7 7-7\" />\n                </svg>\n              </button>\n              \n              <div>\n                <h1 className=\"text-xl font-semibold text-gray-900\">レジストリ一覧</h1>\n                <p className=\"text-sm text-gray-500\">\n                  完了済みレジストリ: {registries.length}件\n                </p>\n              </div>\n            </div>\n            \n            <div className=\"flex items-center space-x-2\">\n              <Button\n                size=\"sm\"\n                onClick={handleExportCSV}\n                disabled={exporting || registries.length === 0}\n              >\n                CSVエクスポート\n              </Button>\n            </div>\n          </div>\n        </div>\n      </header>\n\n      {/* レジストリ一覧 */}\n      <main className=\"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8\">\n        <div className=\"px-4 py-6 sm:px-0\">\n          {registries.length === 0 ? (\n            <div className=\"bg-white rounded-lg shadow p-8 text-center\">\n              <p className=\"text-gray-500\">完了済みのレジストリがありません</p>\n            </div>\n          ) : (\n            <div className=\"bg-white shadow overflow-hidden sm:rounded-lg\">\n              <div className=\"overflow-x-auto\">\n                <table className=\"min-w-full divide-y divide-gray-200\">\n                  <thead className=\"bg-gray-50\">\n                    <tr>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        レジストリ番号\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        要請日時\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        患者情報\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        推定病名\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        搬送先\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        分類\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        転帰\n                      </th>\n                      <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                        活動時間\n                      </th>\n                    </tr>\n                  </thead>\n                  <tbody className=\"bg-white divide-y divide-gray-200\">\n                    {registries.map((registry) => (\n                      <tr key={registry.id} className=\"hover:bg-gray-50\">\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900\">\n                          {registry.registryNumber}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                          <div>{formatDate(registry.timelineDoctorCar?.awareness)}</div>\n                          <div className=\"text-xs\">{formatTime(registry.timelineDoctorCar?.awareness)}</div>\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                          {registry.patientAge}歳 \n                          {registry.patientGender === 'male' ? '男性' : \n                           registry.patientGender === 'female' ? '女性' : '-'}\n                        </td>\n                        <td className=\"px-6 py-4 text-sm text-gray-500\">\n                          <div className=\"max-w-xs truncate\">\n                            {registry.estimatedDiagnosis?.join(', ') || '-'}\n                          </div>\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                          {getDestinationText(registry.destination?.type)}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap\">\n                          <span className={`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${getCategoryColor(registry.category || undefined)}`}>\n                            {registry.category || '-'}\n                          </span>\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                          {getDestinationText(registry.destination?.type)}\n                        </td>\n                        <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                          {registry.totalActivityTime ? `${registry.totalActivityTime}分` : '-'}\n                        </td>\n                      </tr>\n                    ))}\n                  </tbody>\n                </table>\n              </div>\n            </div>\n          )}\n        </div>\n      </main>\n    </div>\n  );\n};"],"names":["RegistryListPage","navigate","useNavigate","registries","setRegistries","useState","loading","setLoading","exporting","setExporting","useEffect","loadRegistries","data","registryService","b","aTime","_d","_c","_b","_a","_h","_g","_f","_e","error","handleExportCSV","csv","blob","link","url","formatDate","timestamp","formatTime","getCategoryColor","category","getDestinationText","type","jsx","LoadingSpinner","jsxs","Button","registry"],"mappings":"uHAMO,MAAMA,EAA6B,IAAM,CAC9C,MAAMC,EAAWC,IACX,CAACC,EAAYC,CAAa,EAAIC,EAAA,SAA8B,CAAE,CAAA,EAC9D,CAACC,EAASC,CAAU,EAAIF,WAAS,EAAI,EACrC,CAACG,EAAWC,CAAY,EAAIJ,WAAS,EAAK,EAEhDK,EAAAA,UAAU,IAAM,CACCC,GACjB,EAAG,CAAE,CAAA,EAEL,MAAMA,EAAiB,SAAY,CACjCJ,EAAW,EAAI,EACX,GAAA,CACI,MAAAK,EAAO,MAAMC,EAAgB,yBACnCT,EAAcQ,EAAK,KAAK,CAAC,EAAGE,IAAM,qBAChC,MAAMC,IAAQC,GAAAC,GAAAC,GAAAC,EAAA,EAAE,oBAAF,YAAAA,EAAqB,YAArB,YAAAD,EAAgC,SAAhC,YAAAD,EAAA,KAAAC,KAAA,YAAAF,EAA4C,YAAa,EAEvE,SADcI,GAAAC,GAAAC,GAAAC,EAAAT,EAAE,oBAAF,YAAAS,EAAqB,YAArB,YAAAD,EAAgC,SAAhC,YAAAD,EAAA,KAAAC,KAAA,YAAAF,EAA4C,YAAa,GACxDL,CAChB,CAAA,CAAC,QACKS,EAAO,CACN,QAAA,MAAM,6BAA8BA,CAAK,CAAA,QACjD,CACAjB,EAAW,EAAK,CAClB,CAAA,EAGIkB,EAAkB,SAAY,CAClChB,EAAa,EAAI,EACb,GAAA,CACF,MAAMiB,EAAM,MAAMb,EAAgB,sBAAsBV,CAAU,EAC5DwB,EAAO,IAAI,KAAK,CAACD,CAAG,EAAG,CAAE,KAAM,yBAAA,CAA2B,EAC1DE,EAAO,SAAS,cAAc,GAAG,EACjCC,EAAM,IAAI,gBAAgBF,CAAI,EAC/BC,EAAA,aAAa,OAAQC,CAAG,EAC7BD,EAAK,aAAa,WAAY,sBAAsB,IAAI,KAAK,EAAE,YAAY,EAAE,MAAM,GAAG,EAAE,CAAC,CAAC,MAAM,EAChGA,EAAK,MAAM,WAAa,SACf,SAAA,KAAK,YAAYA,CAAI,EAC9BA,EAAK,MAAM,EACF,SAAA,KAAK,YAAYA,CAAI,QACvBJ,EAAO,CACN,QAAA,MAAM,wBAAyBA,CAAK,EAC5C,MAAM,kBAAkB,CAAA,QACxB,CACAf,EAAa,EAAK,CACpB,CAAA,EAGIqB,EAAcC,GACd,CAACA,GAAa,CAACA,EAAU,OAAe,IACrCA,EAAU,OAAA,EAAS,mBAAmB,OAAO,EAGhDC,EAAcD,GACd,CAACA,GAAa,CAACA,EAAU,OAAe,IACrCA,EAAU,SAAS,mBAAmB,QAAS,CAAE,KAAM,UAAW,OAAQ,SAAA,CAAW,EAGxFE,EAAoBC,GAA8B,CACtD,OAAQA,EAAU,CAChB,IAAK,IAAY,MAAA,0BACjB,IAAK,IAAY,MAAA,gCACjB,IAAK,IAAY,MAAA,4BACjB,IAAK,IAAY,MAAA,8BACjB,QAAgB,MAAA,2BAClB,CAAA,EAGIC,EAAsBC,GAA0B,CACpD,OAAQA,EAAM,CACZ,IAAK,eAAuB,MAAA,OAC5B,IAAK,gBAAwB,MAAA,OAC7B,IAAK,iBAAyB,MAAA,OAC9B,IAAK,kBAA0B,MAAA,OAC/B,IAAK,wBAAgC,MAAA,WACrC,IAAK,cAAsB,MAAA,UAC3B,IAAK,eAAuB,MAAA,MAC5B,IAAK,QAAgB,MAAA,MACrB,QAAgB,MAAA,GAClB,CAAA,EAGF,OAAI9B,EAEA+B,EAAA,IAAC,OAAI,UAAU,gDACb,eAACC,EAAe,CAAA,KAAK,IAAK,CAAA,CAC5B,CAAA,EAKFC,EAAA,KAAC,MAAI,CAAA,UAAU,0BAEb,SAAA,CAACF,EAAA,IAAA,SAAA,CAAO,UAAU,8CAChB,SAACA,EAAA,IAAA,MAAA,CAAI,UAAU,yCACb,SAAAE,OAAC,MAAI,CAAA,UAAU,yCACb,SAAA,CAACA,EAAAA,KAAA,MAAA,CAAI,UAAU,8BACb,SAAA,CAAAF,EAAA,IAAC,SAAA,CACC,QAAS,IAAMpC,EAAS,QAAQ,EAChC,UAAU,0DAEV,SAAAoC,EAAA,IAAC,OAAI,UAAU,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,YACjE,eAAC,OAAK,CAAA,cAAc,QAAQ,eAAe,QAAQ,YAAY,IAAI,EAAE,kBAAkB,CACzF,CAAA,CAAA,CACF,SAEC,MACC,CAAA,SAAA,CAACA,EAAA,IAAA,KAAA,CAAG,UAAU,sCAAsC,SAAO,UAAA,EAC3DE,EAAAA,KAAC,IAAE,CAAA,UAAU,wBAAwB,SAAA,CAAA,cACvBpC,EAAW,OAAO,GAAA,EAChC,CAAA,EACF,CAAA,EACF,EAEAkC,EAAAA,IAAC,MAAI,CAAA,UAAU,8BACb,SAAAA,EAAA,IAACG,EAAA,CACC,KAAK,KACL,QAASf,EACT,SAAUjB,GAAaL,EAAW,SAAW,EAC9C,SAAA,WAAA,CAAA,EAGH,CAAA,CACF,CAAA,CACF,CAAA,EACF,EAGCkC,MAAA,OAAA,CAAK,UAAU,yCACd,eAAC,MAAI,CAAA,UAAU,oBACZ,SAAAlC,EAAW,SAAW,EACpBkC,EAAAA,IAAA,MAAA,CAAI,UAAU,6CACb,SAAAA,EAAA,IAAC,IAAE,CAAA,UAAU,gBAAgB,SAAA,kBAAA,CAAgB,CAC/C,CAAA,QAEC,MAAI,CAAA,UAAU,gDACb,SAAAA,EAAA,IAAC,OAAI,UAAU,kBACb,SAACE,OAAA,QAAA,CAAM,UAAU,sCACf,SAAA,CAAAF,MAAC,QAAM,CAAA,UAAU,aACf,SAAAE,EAAA,KAAC,KACC,CAAA,SAAA,CAACF,EAAA,IAAA,KAAA,CAAG,UAAU,iFAAiF,SAE/F,UAAA,EACCA,EAAA,IAAA,KAAA,CAAG,UAAU,iFAAiF,SAE/F,OAAA,EACCA,EAAA,IAAA,KAAA,CAAG,UAAU,iFAAiF,SAE/F,OAAA,EACCA,EAAA,IAAA,KAAA,CAAG,UAAU,iFAAiF,SAE/F,OAAA,EACCA,EAAA,IAAA,KAAA,CAAG,UAAU,iFAAiF,SAE/F,MAAA,EACCA,EAAA,IAAA,KAAA,CAAG,UAAU,iFAAiF,SAE/F,KAAA,EACCA,EAAA,IAAA,KAAA,CAAG,UAAU,iFAAiF,SAE/F,KAAA,EACCA,EAAA,IAAA,KAAA,CAAG,UAAU,iFAAiF,SAE/F,OAAA,CAAA,CAAA,CACF,CACF,CAAA,EACAA,EAAA,IAAC,QAAM,CAAA,UAAU,oCACd,SAAAlC,EAAW,IAAKsC,GACf,eAAAF,OAAAA,EAAA,KAAC,KAAqB,CAAA,UAAU,mBAC9B,SAAA,CAAAF,EAAA,IAAC,KAAG,CAAA,UAAU,gEACX,SAAAI,EAAS,eACZ,EACAF,EAAAA,KAAC,KAAG,CAAA,UAAU,oDACZ,SAAA,CAAAF,MAAC,MAAK,CAAA,SAAAP,GAAWX,EAAAsB,EAAS,oBAAT,YAAAtB,EAA4B,SAAS,EAAE,EACxDkB,EAAAA,IAAC,OAAI,UAAU,UAAW,YAAWnB,EAAAuB,EAAS,oBAAT,YAAAvB,EAA4B,SAAS,EAAE,CAAA,EAC9E,EACAqB,EAAAA,KAAC,KAAG,CAAA,UAAU,oDACX,SAAA,CAASE,EAAA,WAAW,IACpBA,EAAS,gBAAkB,OAAS,KACpCA,EAAS,gBAAkB,SAAW,KAAO,GAAA,EAChD,EACCJ,EAAA,IAAA,KAAA,CAAG,UAAU,kCACZ,eAAC,MAAI,CAAA,UAAU,oBACZ,WAAApB,EAAAwB,EAAS,qBAAT,YAAAxB,EAA6B,KAAK,QAAS,GAC9C,CAAA,EACF,EACAoB,EAAAA,IAAC,MAAG,UAAU,oDACX,YAAmBrB,EAAAyB,EAAS,cAAT,YAAAzB,EAAsB,IAAI,EAChD,QACC,KAAG,CAAA,UAAU,8BACZ,SAAAqB,EAAAA,IAAC,QAAK,UAAW,iEAAiEJ,EAAiBQ,EAAS,UAAY,MAAS,CAAC,GAC/H,SAASA,EAAA,UAAY,GACxB,CAAA,EACF,EACAJ,EAAAA,IAAC,MAAG,UAAU,oDACX,YAAmBd,EAAAkB,EAAS,cAAT,YAAAlB,EAAsB,IAAI,EAChD,EACAc,EAAAA,IAAC,KAAG,CAAA,UAAU,oDACX,SAAAI,EAAS,kBAAoB,GAAGA,EAAS,iBAAiB,IAAM,GACnE,CAAA,CA/BO,CAAA,EAAAA,EAAS,EAgClB,EACD,EACH,CACF,CAAA,CAAA,CACF,CAAA,EACF,CAAA,CAEJ,CACF,CAAA,CACF,CAAA,CAAA,CAEJ"}