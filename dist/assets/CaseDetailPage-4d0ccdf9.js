var L=Object.defineProperty;var $=(t,l,s)=>l in t?L(t,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[l]=s;var D=(t,l,s)=>($(t,typeof l!="symbol"?l+"":l,s),s);import{r as g,j as e,B as v,a as R,f as T,b as B,e as A,c as z,u as E,N as P}from"./index-0a82833a.js";import{C as k}from"./index-69f8b09f.js";import{M as _,R as F}from"./RouteOptimizationComponent-1a80bf7d.js";import"./emergencyHospitals-4754c14f.js";const I=()=>{const t=new Date;return{id:`vital-${Date.now()}`,timestamp:{toDate:()=>t,toMillis:()=>t.getTime(),seconds:Math.floor(t.getTime()/1e3),nanoseconds:0},hr:60+Math.floor(Math.random()*40),bp_s:110+Math.floor(Math.random()*30),bp_d:60+Math.floor(Math.random()*20),spo2:94+Math.floor(Math.random()*6),recordedBy:"demo-user",caseId:""}},G=({caseId:t,className:l=""})=>{const[s,x]=g.useState([]),[m,c]=g.useState(!1),[o,n]=g.useState({hr:"",bp_s:"",bp_d:"",spo2:""});g.useEffect(()=>{{const r=[I(),I(),I()];x(r)}},[]);const a=()=>{if(!o.hr||!o.bp_s||!o.bp_d||!o.spo2){alert("すべての項目を入力してください");return}const r={id:`vital-${Date.now()}`,timestamp:{toDate:()=>new Date,toMillis:()=>Date.now(),seconds:Math.floor(Date.now()/1e3),nanoseconds:0},hr:parseInt(o.hr),bp_s:parseInt(o.bp_s),bp_d:parseInt(o.bp_d),spo2:parseInt(o.spo2),recordedBy:"current-user",caseId:t};x([r,...s]),n({hr:"",bp_s:"",bp_d:"",spo2:""}),c(!1)},d=r=>(r.toDate?r.toDate():new Date(r.seconds*1e3)).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"});return e.jsxs("div",{className:`${l}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"バイタルサイン"}),e.jsx(v,{size:"sm",variant:"outline",onClick:()=>c(!m),children:"記録追加"})]}),m&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"心拍数 (bpm)"}),e.jsx("input",{type:"number",value:o.hr,onChange:r=>n({...o,hr:r.target.value}),className:"w-full px-2 py-1 text-sm border rounded",placeholder:"70"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"SpO2 (%)"}),e.jsx("input",{type:"number",value:o.spo2,onChange:r=>n({...o,spo2:r.target.value}),className:"w-full px-2 py-1 text-sm border rounded",placeholder:"98"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"収縮期血圧"}),e.jsx("input",{type:"number",value:o.bp_s,onChange:r=>n({...o,bp_s:r.target.value}),className:"w-full px-2 py-1 text-sm border rounded",placeholder:"120"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"拡張期血圧"}),e.jsx("input",{type:"number",value:o.bp_d,onChange:r=>n({...o,bp_d:r.target.value}),className:"w-full px-2 py-1 text-sm border rounded",placeholder:"80"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-3",children:[e.jsx(v,{size:"sm",variant:"outline",onClick:()=>{c(!1),n({hr:"",bp_s:"",bp_d:"",spo2:""})},children:"キャンセル"}),e.jsx(v,{size:"sm",onClick:a,children:"保存"})]})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:s.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"バイタルサインの記録がありません"}):s.map(r=>e.jsx("div",{className:"bg-gray-50 rounded p-3 text-sm",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"HR:"})," ",e.jsxs("span",{className:"font-medium",children:[r.hr," bpm"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"SpO2:"})," ",e.jsxs("span",{className:"font-medium",children:[r.spo2,"%"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"BP:"})," ",e.jsxs("span",{className:"font-medium",children:[r.bp_s,"/",r.bp_d," mmHg"]})]})]}),e.jsx("span",{className:"text-xs text-gray-500",children:d(r.timestamp)})]})},r.id))})]})},H=["現場到着しました","患者接触しました","搬送開始します","病院到着しました","処置開始しました","追加支援が必要です"],O=()=>{const t=new Date;return[{id:"msg-1",timestamp:{toDate:()=>new Date(t.getTime()-15*60*1e3),toMillis:()=>t.getTime()-15*60*1e3,seconds:Math.floor((t.getTime()-15*60*1e3)/1e3),nanoseconds:0},senderId:"doctor-001",senderName:"山田 太郎",text:"現場に向かっています。到着予定時刻は10:15です。",caseId:"",messageType:"text"},{id:"msg-2",timestamp:{toDate:()=>new Date(t.getTime()-10*60*1e3),toMillis:()=>t.getTime()-10*60*1e3,seconds:Math.floor((t.getTime()-10*60*1e3)/1e3),nanoseconds:0},senderId:"hospital-001",senderName:"佐藤 花子",text:"了解しました。受け入れ準備を開始します。",caseId:"",messageType:"text"},{id:"msg-3",timestamp:{toDate:()=>new Date(t.getTime()-5*60*1e3),toMillis:()=>t.getTime()-5*60*1e3,seconds:Math.floor((t.getTime()-5*60*1e3)/1e3),nanoseconds:0},senderId:"doctor-001",senderName:"山田 太郎",text:"現場到着しました",caseId:"",messageType:"preset"}]},V=({caseId:t,className:l=""})=>{const{userInfo:s}=R(),[x,m]=g.useState([]),[c,o]=g.useState(""),[n,a]=g.useState(!1),[d,r]=g.useState(!1),[h,f]=g.useState(null),i=g.useRef(null);g.useEffect(()=>{m(O())},[]),g.useEffect(()=>{if(typeof window<"u"&&"webkitSpeechRecognition"in window){const p=window.webkitSpeechRecognition,b=new p;b.continuous=!1,b.interimResults=!1,b.lang="ja-JP",b.onresult=w=>{const u=w.results[0][0].transcript;o(u),r(!1)},b.onend=()=>{r(!1)},b.onerror=w=>{console.error("Speech recognition error:",w.error),r(!1)},f(b)}},[]),g.useEffect(()=>{var p;(p=i.current)==null||p.scrollIntoView({behavior:"smooth"})},[x]);const j=p=>(p.toDate?p.toDate():new Date(p.seconds*1e3)).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),y=(p,b="text")=>{if(!p.trim())return;const w={id:`msg-${Date.now()}`,timestamp:{toDate:()=>new Date,toMillis:()=>Date.now(),seconds:Math.floor(Date.now()/1e3),nanoseconds:0},senderId:(s==null?void 0:s.uid)||"demo-user",senderName:(s==null?void 0:s.name)||"デモユーザー",text:p.trim(),caseId:t,messageType:b};m([...x,w]),o(""),a(!1)},M=p=>{p.key==="Enter"&&!p.shiftKey&&(p.preventDefault(),y(c))},S=()=>{h&&!d&&(r(!0),h.start())},C=()=>{h&&d&&(h.stop(),r(!1))};return e.jsxs("div",{className:`flex flex-col h-full ${l}`,children:[e.jsxs("div",{className:"flex-1 overflow-y-auto mb-4 space-y-2 min-h-0",children:[x.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-8",children:"メッセージがありません"}):x.map(p=>{const b=p.senderId===(s==null?void 0:s.uid);return e.jsx("div",{className:`flex ${b?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${b?"bg-medical-primary text-white":"bg-gray-200 text-gray-900"}`,children:[e.jsxs("div",{className:"text-xs opacity-75 mb-1",children:[p.senderName," - ",j(p.timestamp)]}),e.jsxs("div",{className:"text-sm break-words",children:[p.messageType==="preset"&&e.jsx("span",{className:"inline-block mr-1",children:"📌"}),p.text]})]})},p.id)}),e.jsx("div",{ref:i})]}),n&&e.jsxs("div",{className:"mb-2 p-2 bg-gray-50 rounded-lg",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-2",children:"定型メッセージ:"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:H.map(p=>e.jsx("button",{onClick:()=>y(p,"preset"),className:"text-left text-sm px-3 py-2 bg-white border rounded hover:bg-gray-50 transition-colors",children:p},p))})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(v,{size:"sm",variant:"outline",onClick:()=>a(!n),className:"flex-shrink-0",children:"定型"}),h&&e.jsx(v,{size:"sm",variant:d?"danger":"outline",onClick:d?C:S,className:"flex-shrink-0",title:d?"録音停止":"音声入力",children:d?e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("rect",{x:"7",y:"7",width:"6",height:"6",rx:"1"})}):e.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M7 4a3 3 0 016 0v4a3 3 0 11-6 0V4zm4 10.93A7.001 7.001 0 0017 8a1 1 0 10-2 0A5 5 0 015 8a1 1 0 00-2 0 7.001 7.001 0 006 6.93V17H6a1 1 0 100 2h8a1 1 0 100-2h-3v-2.07z",clipRule:"evenodd"})})}),e.jsx("input",{type:"text",value:c,onChange:p=>o(p.target.value),onKeyPress:M,placeholder:d?"音声入力中...":"メッセージを入力...",className:"flex-1 px-3 py-2 text-sm border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",disabled:d}),e.jsx(v,{size:"sm",onClick:()=>y(c),disabled:!c.trim()||d,children:"送信"})]}),d&&e.jsxs("div",{className:"mt-2 text-xs text-gray-600 flex items-center",children:[e.jsx("div",{className:"w-2 h-2 bg-red-600 rounded-full mr-2 animate-pulse"}),"音声を認識しています..."]}),!h&&e.jsx("div",{className:"mt-2 text-xs text-gray-500",children:"※ このブラウザでは音声認識がサポートされていません"})]})]})},W=["バイタル測定","酸素投与開始","静脈路確保","心電図モニタリング開始","体位変換","体温管理","創部処置","疼痛管理","薬剤投与","気道確保"],U=()=>{const t=new Date;return[{id:"treatment-1",timestamp:{toDate:()=>new Date(t.getTime()-20*60*1e3),toMillis:()=>t.getTime()-20*60*1e3,seconds:Math.floor((t.getTime()-20*60*1e3)/1e3),nanoseconds:0},name:"バイタル測定",details:"HR: 85bpm, BP: 120/80mmHg, SpO2: 98%",recordedBy:"山田 太郎",caseId:""},{id:"treatment-2",timestamp:{toDate:()=>new Date(t.getTime()-15*60*1e3),toMillis:()=>t.getTime()-15*60*1e3,seconds:Math.floor((t.getTime()-15*60*1e3)/1e3),nanoseconds:0},name:"酸素投与開始",details:"マスク 4L/min",recordedBy:"山田 太郎",caseId:""}]},J=({caseId:t,className:l=""})=>{const[s,x]=g.useState([]),[m,c]=g.useState(!1),[o,n]=g.useState(!1),[a,d]=g.useState({name:"",details:""});g.useEffect(()=>{x(U())},[]);const r=i=>(i.toDate?i.toDate():new Date(i.seconds*1e3)).toLocaleTimeString("ja-JP",{hour:"2-digit",minute:"2-digit"}),h=(i,j="")=>{if(!i.trim()){alert("処置名を入力してください");return}const y={id:`treatment-${Date.now()}`,timestamp:{toDate:()=>new Date,toMillis:()=>Date.now(),seconds:Math.floor(Date.now()/1e3),nanoseconds:0},name:i.trim(),details:j.trim(),recordedBy:"current-user",caseId:t};x([y,...s]),d({name:"",details:""}),c(!1),n(!1)},f=i=>{d({...a,name:i}),n(!1)};return e.jsxs("div",{className:`${l}`,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"処置記録"}),e.jsx(v,{size:"sm",variant:"outline",onClick:()=>c(!m),children:"記録追加"})]}),m&&e.jsxs("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"処置名"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("input",{type:"text",value:a.name,onChange:i=>d({...a,name:i.target.value}),className:"flex-1 px-2 py-1 text-sm border rounded",placeholder:"処置名を入力"}),e.jsx(v,{size:"sm",variant:"outline",onClick:()=>n(!o),children:"選択"})]}),o&&e.jsxs("div",{className:"mt-2 p-2 bg-white border rounded max-h-32 overflow-y-auto",children:[e.jsx("div",{className:"text-xs text-gray-600 mb-1",children:"処置を選択:"}),e.jsx("div",{className:"space-y-1",children:W.map(i=>e.jsx("button",{onClick:()=>f(i),className:"block w-full text-left text-sm px-2 py-1 hover:bg-gray-100 rounded",children:i},i))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-600 mb-1",children:"詳細・備考"}),e.jsx("textarea",{value:a.details,onChange:i=>d({...a,details:i.target.value}),className:"w-full px-2 py-1 text-sm border rounded resize-none",rows:2,placeholder:"詳細や数値など"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-3",children:[e.jsx(v,{size:"sm",variant:"outline",onClick:()=>{c(!1),n(!1),d({name:"",details:""})},children:"キャンセル"}),e.jsx(v,{size:"sm",onClick:()=>h(a.name,a.details),children:"保存"})]})]}),e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:s.length===0?e.jsx("p",{className:"text-sm text-gray-500 text-center py-4",children:"処置記録がありません"}):s.map(i=>e.jsxs("div",{className:"bg-gray-50 rounded p-3 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-start mb-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:i.name}),e.jsx("span",{className:"text-xs text-gray-500",children:r(i.timestamp)})]}),i.details&&e.jsx("div",{className:"text-gray-600 text-xs mb-1",children:i.details}),e.jsxs("div",{className:"text-xs text-gray-500",children:["記録者: ",i.recordedBy]})]},i.id))})]})},K=(t={})=>{const[l,s]=g.useState({location:null,error:null,loading:!0}),{enableHighAccuracy:x=!0,timeout:m=1e4,maximumAge:c=6e4,watch:o=!1}=t;return g.useEffect(()=>{if(!navigator.geolocation){s({location:null,error:"Geolocation is not supported by this browser.",loading:!1});return}const a=f=>{s({location:{latitude:f.coords.latitude,longitude:f.coords.longitude,accuracy:f.coords.accuracy},error:null,loading:!1})},d=f=>{let i="Unknown error occurred.";switch(f.code){case f.PERMISSION_DENIED:i="位置情報へのアクセスが拒否されました。";break;case f.POSITION_UNAVAILABLE:i="位置情報を取得できませんでした。";break;case f.TIMEOUT:i="位置情報の取得がタイムアウトしました。";break}s({location:null,error:i,loading:!1})},r={enableHighAccuracy:x,timeout:m,maximumAge:c};s(f=>({...f,loading:!0}));let h;return o?h=navigator.geolocation.watchPosition(a,d,r):navigator.geolocation.getCurrentPosition(a,d,r),()=>{h!==void 0&&navigator.geolocation.clearWatch(h)}},[x,m,c,o]),{...l,getCurrentPosition:()=>{if(!navigator.geolocation){s(a=>({...a,error:"Geolocation is not supported by this browser.",loading:!1}));return}s(a=>({...a,loading:!0,error:null})),navigator.geolocation.getCurrentPosition(a=>{s({location:{latitude:a.coords.latitude,longitude:a.coords.longitude,accuracy:a.coords.accuracy},error:null,loading:!1})},a=>{let d="Unknown error occurred.";switch(a.code){case a.PERMISSION_DENIED:d="位置情報へのアクセスが拒否されました。";break;case a.POSITION_UNAVAILABLE:d="位置情報を取得できませんでした。";break;case a.TIMEOUT:d="位置情報の取得がタイムアウトしました。";break}s({location:null,error:d,loading:!1})},{enableHighAccuracy:x,timeout:m,maximumAge:c})}}},q=({className:t="",onLocationUpdate:l})=>{const[s,x]=g.useState(!1),{location:m,error:c,loading:o,getCurrentPosition:n}=K({watch:s,enableHighAccuracy:!0,timeout:1e4,maximumAge:3e4});g.useEffect(()=>{m&&l&&l(m)},[m,l]);const a=()=>{x(!s)},d=()=>{n()},r=f=>f.toFixed(6),h=()=>new Date().toLocaleTimeString("ja-JP");return e.jsxs("div",{className:`bg-white rounded-lg border p-4 ${t}`,children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"現在地追跡"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(v,{size:"sm",variant:"outline",onClick:d,disabled:o,children:"更新"}),e.jsx(v,{size:"sm",variant:s?"danger":"primary",onClick:a,children:s?"停止":"開始"})]})]}),o&&e.jsx("div",{className:"text-sm text-gray-600 mb-2",children:"位置情報を取得中..."}),c&&e.jsxs("div",{className:"text-sm text-red-600 mb-2",children:["エラー: ",c]}),m&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"緯度:"}),e.jsx("div",{className:"font-mono",children:r(m.latitude)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"経度:"}),e.jsx("div",{className:"font-mono",children:r(m.longitude)})]})]}),m.accuracy&&e.jsxs("div",{className:"text-xs text-gray-500",children:["精度: ±",Math.round(m.accuracy),"m"]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["最終更新: ",h()]}),s&&e.jsxs("div",{className:"flex items-center text-xs text-green-600",children:[e.jsx("div",{className:"w-2 h-2 bg-green-600 rounded-full mr-2 animate-pulse"}),"追跡中"]})]}),!m&&!o&&!c&&e.jsx("div",{className:"text-sm text-gray-500 text-center py-4",children:"位置情報を取得してください"})]})};class Q{constructor(){D(this,"mockData",[{id:"building-1",name:"東京駅",type:"station",address:"東京都千代田区丸の内1丁目",floors:3,basement:4,elevators:[{id:"elv-1",location:"丸の内中央口",capacity:20,maxWeight:1350,floors:[-4,-3,-2,-1,1,2,3],isAccessible:!0,status:"working"},{id:"elv-2",location:"八重洲中央口",capacity:15,maxWeight:1e3,floors:[-2,-1,1,2],isAccessible:!0,status:"working"}],staircases:[{id:"stair-1",location:"丸の内北口階段",type:"normal",floors:[-1,1,2],width:"wide"},{id:"stair-2",location:"八重洲南口階段",type:"normal",floors:[-1,1],width:"standard"}],exits:[{id:"exit-1",name:"丸の内中央口",type:"main",floor:1,direction:"西側",isAccessible:!0,nearbyLandmarks:["皇居","丸ビル"]},{id:"exit-2",name:"八重洲中央口",type:"main",floor:1,direction:"東側",isAccessible:!0,nearbyLandmarks:["大丸東京店","グランルーフ"]},{id:"exit-3",name:"丸の内北口",type:"main",floor:1,direction:"北西",isAccessible:!0,nearbyLandmarks:["KITTE","東京中央郵便局"]}],accessibility:{wheelchairAccessible:!0,elevatorToAllFloors:!0,accessibleParking:!1,accessibleRestrooms:!0,guidanceForVisuallyImpaired:!0},emergencyContact:"03-3212-2345",location:this.createMockGeoPoint(35.6812,139.7671),lastUpdated:new Date("2024-01-15")},{id:"building-2",name:"新宿パークタワー",type:"office",address:"東京都新宿区西新宿3丁目7-1",floors:52,basement:3,elevators:[{id:"elv-3",location:"低層用エレベーター",capacity:20,maxWeight:1350,floors:[-3,-2,-1,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],isAccessible:!0,status:"working"},{id:"elv-4",location:"高層用エレベーター",capacity:20,maxWeight:1350,floors:[1,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52],isAccessible:!0,status:"working"},{id:"elv-5",location:"非常用エレベーター",capacity:17,maxWeight:1150,floors:[-3,-2,-1,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52],isAccessible:!0,status:"working"}],staircases:[{id:"stair-3",location:"北側非常階段",type:"emergency",floors:[-3,-2,-1,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52],width:"standard"},{id:"stair-4",location:"南側非常階段",type:"emergency",floors:[-3,-2,-1,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52],width:"standard"}],exits:[{id:"exit-4",name:"メインエントランス",type:"main",floor:1,direction:"南側",isAccessible:!0,nearbyLandmarks:["新宿中央公園","ハイアットリージェンシー東京"]},{id:"exit-5",name:"北側出口",type:"emergency",floor:1,direction:"北側",isAccessible:!1}],accessibility:{wheelchairAccessible:!0,elevatorToAllFloors:!0,accessibleParking:!0,accessibleRestrooms:!0,guidanceForVisuallyImpaired:!1},emergencyContact:"03-5322-1234",location:this.createMockGeoPoint(35.6879,139.6917),lastUpdated:new Date("2024-02-01")},{id:"building-3",name:"渋谷スカイ",type:"shopping",address:"東京都渋谷区渋谷2丁目24-12",floors:14,basement:2,elevators:[{id:"elv-6",location:"中央エレベーター",capacity:24,maxWeight:1600,floors:[-2,-1,1,2,3,4,5,6,7,8,9,10,11,12,13,14],isAccessible:!0,status:"working"}],staircases:[{id:"stair-5",location:"エスカレーター",type:"escalator",floors:[-2,-1,1,2,3,4,5,6,7,8,9,10,11,12,13,14],width:"wide"}],exits:[{id:"exit-6",name:"JR渋谷駅直結",type:"main",floor:2,direction:"東側",isAccessible:!0,nearbyLandmarks:["渋谷駅","ハチ公"]}],accessibility:{wheelchairAccessible:!0,elevatorToAllFloors:!0,accessibleParking:!1,accessibleRestrooms:!0,guidanceForVisuallyImpaired:!0},location:this.createMockGeoPoint(35.658,139.7016),lastUpdated:new Date("2024-01-20")}])}createMockGeoPoint(l,s){return{latitude:l,longitude:s,isEqual:x=>Math.abs(l-x.latitude)<1e-4&&Math.abs(s-x.longitude)<1e-4}}calculateDistance(l,s){const m=l.latitude*Math.PI/180,c=s.latitude*Math.PI/180,o=(s.latitude-l.latitude)*Math.PI/180,n=(s.longitude-l.longitude)*Math.PI/180,a=Math.sin(o/2)*Math.sin(o/2)+Math.cos(m)*Math.cos(c)*Math.sin(n/2)*Math.sin(n/2);return 6371e3*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))}async getBuildingInfoByLocation(l,s={}){console.log("Building service: Getting building info for location",l);try{return T.demoMode?this.getMockBuildingInfo(l,s):{building:null,confidence:0}}catch(x){return console.error("Failed to get building info:",x),{building:null,confidence:0}}}getMockBuildingInfo(l,s){const x=s.radius||100;let m=null,c=1/0;for(const o of this.mockData){const n=this.calculateDistance(l,o.location);if(n<=x&&n<c){if(s.buildingTypes&&!s.buildingTypes.includes(o.type)||s.requireAccessibility&&!o.accessibility.wheelchairAccessible)continue;m=o,c=n}}return{building:m,distance:m?c:void 0,confidence:m?Math.max(.1,1-c/x):0}}async searchBuildings(l){console.log("Building service: Searching buildings with query",l);try{return T.demoMode?this.mockData.filter(s=>s.name.toLowerCase().includes(l.toLowerCase())||s.address.toLowerCase().includes(l.toLowerCase())):[]}catch(s){return console.error("Failed to search buildings:",s),[]}}async updateBuildingInfo(l,s){console.log("Building service: Updating building info",l,s);try{if(T.demoMode){const x=this.mockData.findIndex(m=>m.id===l);x!==-1&&(this.mockData[x]={...this.mockData[x],...s});return}}catch(x){throw console.error("Failed to update building info:",x),x}}}const X=new Q,Y=({elevator:t})=>{const l=m=>{switch(m){case"working":return"text-green-600 bg-green-50";case"maintenance":return"text-yellow-600 bg-yellow-50";case"unknown":default:return"text-gray-600 bg-gray-50"}},s=m=>{switch(m){case"working":return"稼働中";case"maintenance":return"メンテナンス中";case"unknown":default:return"状況不明"}},x=m=>{const c=[...m].sort((d,r)=>d-r),o=[];let n=c[0],a=c[0];for(let d=1;d<c.length;d++)if(c[d]===a+1)a=c[d];else{if(n===a)o.push(n===0?"G":n<0?`B${Math.abs(n)}`:`${n}`);else{const r=n===0?"G":n<0?`B${Math.abs(n)}`:`${n}`,h=a===0?"G":a<0?`B${Math.abs(a)}`:`${a}`;o.push(`${r}-${h}`)}n=c[d],a=c[d]}if(n===a)o.push(n===0?"G":n<0?`B${Math.abs(n)}`:`${n}`);else{const d=n===0?"G":n<0?`B${Math.abs(n)}`:`${n}`,r=a===0?"G":a<0?`B${Math.abs(a)}`:`${a}`;o.push(`${d}-${r}`)}return o.join(", ")+"F"};return e.jsxs("div",{className:"bg-gray-50 rounded p-3 text-xs",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.location}),e.jsxs("div",{className:"text-gray-600 mt-1",children:["定員: ",t.capacity,"人 | 最大: ",t.maxWeight,"kg"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[t.isAccessible&&e.jsxs("div",{className:"flex items-center text-blue-600",children:[e.jsx("svg",{className:"h-3 w-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{children:"車椅子対応"})]}),t.status&&e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium ${l(t.status)}`,children:s(t.status)})]})]}),e.jsxs("div",{className:"text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"停止階:"})," ",x(t.floors)]})]})},Z=({staircase:t})=>{const l=n=>{switch(n){case"escalator":return e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 7l5 5-5 5M6 12h12"})});case"emergency":return e.jsx("svg",{className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})});default:return e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 10l7-7m0 0l7 7m-7-7v18"})})}},s=n=>{switch(n){case"escalator":return"エスカレーター";case"emergency":return"非常階段";default:return"一般階段"}},x=n=>{switch(n){case"escalator":return"text-blue-600";case"emergency":return"text-red-600";default:return"text-gray-600"}},m=n=>{switch(n){case"narrow":return"狭い";case"wide":return"広い";default:return"標準"}},c=n=>{switch(n){case"narrow":return"text-red-600";case"wide":return"text-green-600";default:return"text-gray-600"}},o=n=>{const a=[...n].sort((f,i)=>f-i),d=[];let r=a[0],h=a[0];for(let f=1;f<a.length;f++)if(a[f]===h+1)h=a[f];else{if(r===h)d.push(r===0?"G":r<0?`B${Math.abs(r)}`:`${r}`);else{const i=r===0?"G":r<0?`B${Math.abs(r)}`:`${r}`,j=h===0?"G":h<0?`B${Math.abs(h)}`:`${h}`;d.push(`${i}-${j}`)}r=a[f],h=a[f]}if(r===h)d.push(r===0?"G":r<0?`B${Math.abs(r)}`:`${r}`);else{const f=r===0?"G":r<0?`B${Math.abs(r)}`:`${r}`,i=h===0?"G":h<0?`B${Math.abs(h)}`:`${h}`;d.push(`${f}-${i}`)}return d.join(", ")+"F"};return e.jsxs("div",{className:"bg-gray-50 rounded p-3 text-xs",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.location}),e.jsxs("div",{className:"text-gray-600 mt-1",children:["接続階: ",o(t.floors)]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:`flex items-center ${x(t.type)}`,children:[l(t.type),e.jsx("span",{className:"ml-1",children:s(t.type)})]}),e.jsxs("div",{className:`${c(t.width)}`,children:["幅: ",m(t.width)]})]})]}),t.type==="emergency"&&e.jsx("div",{className:"mt-2 p-2 bg-red-50 rounded text-red-700",children:e.jsxs("div",{className:"flex items-center text-xs",children:[e.jsx("svg",{className:"h-3 w-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),"緊急時専用"]})}),t.type==="escalator"&&e.jsx("div",{className:"mt-2 p-2 bg-blue-50 rounded text-blue-700",children:e.jsxs("div",{className:"flex items-center text-xs",children:[e.jsx("svg",{className:"h-3 w-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),"ストレッチャー移送時は利用不可"]})})]})},ee=({exit:t})=>{const l=c=>{switch(c){case"main":return e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})});case"emergency":return e.jsx("svg",{className:"h-4 w-4",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})});case"service":return e.jsxs("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]});default:return e.jsx("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 16l4-4m0 0l-4-4m4 4H7"})})}},s=c=>{switch(c){case"main":return"メイン出入口";case"emergency":return"非常口";case"service":return"サービス出入口";default:return"出入口"}},x=c=>{switch(c){case"main":return"text-blue-600 bg-blue-50";case"emergency":return"text-red-600 bg-red-50";case"service":return"text-gray-600 bg-gray-50";default:return"text-gray-600 bg-gray-50"}},m=c=>c===0?"G階":c<0?`B${Math.abs(c)}階`:`${c}階`;return e.jsxs("div",{className:"bg-gray-50 rounded p-3 text-xs",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("div",{className:"font-medium text-gray-900",children:t.name}),t.isAccessible&&e.jsxs("div",{className:"flex items-center text-blue-600",children:[e.jsx("svg",{className:"h-3 w-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),e.jsx("span",{children:"バリアフリー"})]})]}),e.jsxs("div",{className:"text-gray-600",children:[m(t.floor)," | ",t.direction]})]}),e.jsxs("div",{className:`flex items-center px-2 py-1 rounded text-xs font-medium ${x(t.type)}`,children:[l(t.type),e.jsx("span",{className:"ml-1",children:s(t.type)})]})]}),t.nearbyLandmarks&&t.nearbyLandmarks.length>0&&e.jsx("div",{className:"mt-2 p-2 bg-green-50 rounded",children:e.jsxs("div",{className:"text-green-700",children:[e.jsx("span",{className:"font-medium",children:"近くの目印:"})," ",t.nearbyLandmarks.join(", ")]})}),t.type==="emergency"&&e.jsx("div",{className:"mt-2 p-2 bg-red-50 rounded text-red-700",children:e.jsxs("div",{className:"flex items-center text-xs",children:[e.jsx("svg",{className:"h-3 w-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),"緊急時専用出入口"]})}),t.type==="main"&&e.jsx("div",{className:"mt-2 p-2 bg-blue-50 rounded text-blue-700",children:e.jsxs("div",{className:"flex items-center text-xs",children:[e.jsx("svg",{className:"h-3 w-3 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),"患者搬送推奨ルート"]})})]})},se=({accessibility:t,className:l=""})=>{const x=(()=>{let a=0;return t.wheelchairAccessible&&a++,t.elevatorToAllFloors&&a++,t.accessibleParking&&a++,t.accessibleRestrooms&&a++,t.guidanceForVisuallyImpaired&&a++,a})(),m=5,c=()=>{const a=x/m;return a>=.8?"bg-green-100 text-green-800 border-green-200":a>=.6?"bg-yellow-100 text-yellow-800 border-yellow-200":a>=.4?"bg-orange-100 text-orange-800 border-orange-200":"bg-red-100 text-red-800 border-red-200"},o=()=>{const a=x/m;return a>=.8?"バリアフリー対応":a>=.6?"一部バリアフリー":a>=.4?"限定的対応":"要注意"},n=()=>t.wheelchairAccessible?e.jsx("svg",{className:"h-3 w-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):e.jsx("svg",{className:"h-3 w-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})});return e.jsxs("div",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${c()} ${l}`,children:[n(),e.jsx("span",{className:"ml-1",children:o()}),e.jsxs("span",{className:"ml-1 opacity-75",children:["(",x,"/",m,")"]})]})},te=({location:t,className:l=""})=>{const[s,x]=g.useState(null),[m,c]=g.useState(!1),[o,n]=g.useState(null),[a,d]=g.useState(!1);g.useEffect(()=>{r()},[t]);const r=async()=>{if(t){c(!0),n(null);try{const j=await X.getBuildingInfoByLocation(t,{radius:200});x(j)}catch(j){console.error("Failed to load building info:",j),n("建物情報の取得に失敗しました")}finally{c(!1)}}},h=j=>j?j<1e3?`${Math.round(j)}m`:`${(j/1e3).toFixed(1)}km`:"",f=j=>j>=.8?"text-green-600":j>=.5?"text-yellow-600":"text-red-600";if(m)return e.jsx("div",{className:`bg-white rounded-lg border p-4 ${l}`,children:e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx(B,{size:"sm"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"建物情報を取得中..."})]})});if(o)return e.jsxs("div",{className:`bg-white rounded-lg border p-4 ${l}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"建物情報"})}),e.jsx("div",{className:"text-sm text-red-600",children:o})]});if(!(s!=null&&s.building))return e.jsxs("div",{className:`bg-white rounded-lg border p-4 ${l}`,children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:"建物情報"})}),e.jsx("div",{className:"text-sm text-gray-500",children:"現場周辺に建物情報が見つかりませんでした"})]});const i=s.building;return e.jsxs("div",{className:`bg-white rounded-lg border p-4 border-red-500 ${l}`,style:{backgroundColor:"#fff2f2"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900",children:i.name}),e.jsx(se,{accessibility:i.accessibility})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:i.address}),s.distance&&e.jsxs("div",{className:"text-xs text-gray-500",children:["現場から",h(s.distance),e.jsxs("span",{className:`ml-1 ${f(s.confidence)}`,children:["(信頼度: ",Math.round(s.confidence*100),"%)"]})]})]}),e.jsx("button",{onClick:()=>d(!a),className:"p-1 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:`h-4 w-4 transition-transform ${a?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-xs mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"建物種別:"}),e.jsxs("div",{className:"font-medium",children:[i.type==="office"&&"オフィスビル",i.type==="hospital"&&"病院",i.type==="station"&&"駅",i.type==="shopping"&&"商業施設",i.type==="residential"&&"住宅",i.type==="school"&&"学校",i.type==="other"&&"その他"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"階層:"}),e.jsxs("div",{className:"font-medium",children:[i.basement?`B${i.basement}F-`:"",i.floors,"F"]})]})]}),i.emergencyContact&&e.jsxs("div",{className:"mb-4 p-2 bg-red-50 rounded text-xs",children:[e.jsx("span",{className:"text-red-600 font-medium",children:"緊急時連絡先:"}),e.jsx("div",{className:"text-red-800 font-mono",children:i.emergencyContact})]}),a&&e.jsxs("div",{className:"space-y-4 border-t pt-4",children:[i.elevators.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-800 mb-2",children:"エレベーター"}),e.jsx("div",{className:"space-y-2",children:i.elevators.map(j=>e.jsx(Y,{elevator:j},j.id))})]}),i.staircases.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-800 mb-2",children:"階段・エスカレーター"}),e.jsx("div",{className:"space-y-2",children:i.staircases.map(j=>e.jsx(Z,{staircase:j},j.id))})]}),i.exits.length>0&&e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium text-gray-800 mb-2",children:"出入口"}),e.jsx("div",{className:"space-y-2",children:i.exits.map(j=>e.jsx(ee,{exit:j},j.id))})]}),i.lastUpdated&&e.jsxs("div",{className:"text-xs text-gray-400 pt-2 border-t",children:["最終更新: ",i.lastUpdated.toLocaleDateString("ja-JP")]})]})]})},ce=()=>{const{caseId:t}=A(),l=z(),{currentCase:s,loading:x,error:m,loadCurrentCase:c,startObservingCase:o,stopObservingCase:n,updateStatus:a}=E(),{userInfo:d}=R(),r=g.useRef(!0),[h,f]=g.useState("vitals"),[i,j]=g.useState(null),[y,M]=g.useState(null),[S,C]=g.useState(null),p=async u=>{if(t)try{await a(t,u)}catch(N){console.error("Status update failed:",N),alert("ステータス更新に失敗しました")}},b=u=>{switch(u){case k.DISPATCHED:return{status:k.ON_SCENE,label:"現場到着"};case k.ON_SCENE:return{status:k.TRANSPORTING,label:"搬送開始"};case k.TRANSPORTING:return{status:k.COMPLETED,label:"搬送完了"};default:return null}},w=u=>{j(u)};return g.useEffect(()=>(r.current=!0,t?((async()=>{try{r.current&&(await c(t),r.current&&o(t))}catch(N){console.error("Failed to load case:",N)}})(),()=>{r.current=!1;try{n()}catch(N){console.error("Cleanup error:",N)}}):void 0),[t]),g.useEffect(()=>()=>{r.current=!1},[]),t?x?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx(B,{size:"lg"})}):m?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"エラーが発生しました"}),e.jsx("p",{className:"text-gray-600 mb-6",children:m}),e.jsx("button",{onClick:()=>{r.current=!1;try{n()}catch(u){console.error("Stop observing error:",u)}setTimeout(()=>{try{l("/cases")}catch(u){console.error("Navigation error:",u),window.location.href="/cases"}},100)},className:"bg-medical-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"事案一覧に戻る"})]})}):s?e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>{r.current=!1;try{n()}catch(u){console.error("Stop observing error:",u)}setTimeout(()=>{try{l("/cases")}catch(u){console.error("Navigation error:",u),window.location.href="/cases"}},100)},className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:s.caseName}),e.jsxs("p",{className:"text-sm text-gray-500",children:["ステータス: ",s.status," | 担当: ",s.teamId]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[(()=>{const u=b(s.status);return u?e.jsx(v,{size:"sm",onClick:()=>p(u.status),children:u.label}):null})(),e.jsx(v,{size:"sm",variant:"outline",onClick:()=>l(`/cases/${t}/registry`),children:"レジストリ入力"}),e.jsx("div",{className:"text-sm text-gray-700",children:e.jsx("span",{className:"font-medium",children:d==null?void 0:d.name})})]})]})})}),e.jsx("main",{className:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"px-4 py-6 sm:px-0",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"位置情報"}),e.jsx("div",{className:"h-64",children:e.jsx(_,{sceneLocation:s.sceneLocation,hospitalLocation:s.hospitalLocation,currentLocation:i||void 0,selectedRoute:y,selectedHospital:S,showFullscreenButton:!0})}),e.jsx("div",{className:"mt-3 text-sm text-gray-600",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-600 rounded-full mr-1"}),e.jsx("span",{children:"現場"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full mr-1"}),e.jsx("span",{children:"搬送先病院"})]}),i&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 rounded-full mr-1"}),e.jsx("span",{children:"現在地"})]}),y&&e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-1 bg-blue-500 rounded mr-1"}),e.jsx("span",{children:"ルート"})]})]}),e.jsx("div",{className:"text-xs text-gray-500",children:"📱 右上ボタンで全画面表示"})]})}),e.jsx("div",{className:"mt-4",children:e.jsx(q,{onLocationUpdate:w})}),s.patientInfo.buildingInfo&&e.jsxs("div",{className:"mt-4 bg-blue-50 rounded-lg p-4 border border-blue-200",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"📍 現場情報"}),e.jsxs("div",{className:"text-sm text-blue-800",children:[e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"建物:"})," ",s.patientInfo.buildingInfo.buildingName]}),e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"階数:"})," ",s.patientInfo.buildingInfo.floor,"階"]}),s.patientInfo.buildingInfo.description&&e.jsxs("div",{className:"mb-1",children:[e.jsx("span",{className:"font-medium",children:"詳細:"})," ",s.patientInfo.buildingInfo.description]}),s.patientInfo.buildingInfo.accessNotes&&e.jsxs("div",{className:"mt-2 p-2 bg-blue-100 rounded",children:[e.jsx("span",{className:"font-medium",children:"アクセス情報:"}),e.jsx("br",{}),s.patientInfo.buildingInfo.accessNotes]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx(te,{location:s.sceneLocation})}),e.jsxs("div",{className:"mt-6 border-t pt-4",children:[e.jsx("h4",{className:"text-md font-medium text-gray-900 mb-4",children:"🚗 ルート最適化"}),e.jsx(F,{currentLocation:i||void 0,sceneLocation:{latitude:s.sceneLocation.latitude,longitude:s.sceneLocation.longitude},onRouteSelected:u=>{var N;console.log("Route selected:",u),console.log("Route coordinates:",u==null?void 0:u.coordinates),console.log("Route coordinates length:",(N=u==null?void 0:u.coordinates)==null?void 0:N.length),M(u)},onNavigationStart:u=>{console.log("Navigation started:",u),alert("ナビゲーションを開始しました")},onHospitalSelected:u=>{console.log("Hospital selected:",u),C(u)}})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"患者情報"}),s.patientInfo.name&&e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"氏名: "}),e.jsx("span",{className:"text-sm text-gray-900",children:s.patientInfo.name})]}),s.patientInfo.age&&e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"年齢: "}),e.jsxs("span",{className:"text-sm text-gray-900",children:[s.patientInfo.age,"歳"]})]}),s.patientInfo.gender&&e.jsxs("div",{className:"mb-3",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500",children:"性別: "}),e.jsx("span",{className:"text-sm text-gray-900",children:s.patientInfo.gender==="male"?"男性":s.patientInfo.gender==="female"?"女性":"その他"})]}),e.jsx("div",{className:"mt-6 border-b border-gray-200",children:e.jsxs("nav",{className:"-mb-px flex space-x-8",children:[e.jsx("button",{onClick:()=>f("vitals"),className:`py-2 px-1 border-b-2 font-medium text-sm ${h==="vitals"?"border-medical-primary text-medical-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"バイタル"}),e.jsx("button",{onClick:()=>f("treatments"),className:`py-2 px-1 border-b-2 font-medium text-sm ${h==="treatments"?"border-medical-primary text-medical-primary":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:"処置記録"})]})}),e.jsx("div",{className:"mt-4",children:h==="vitals"?e.jsx(G,{caseId:t}):e.jsx(J,{caseId:t})})]})]}),e.jsxs("div",{className:"mt-6 bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"コミュニケーション"}),e.jsx("div",{className:"h-64",children:e.jsx(V,{caseId:t})})]})]})})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"事案が見つかりません"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"指定された事案は存在しないか、アクセス権限がありません。"}),e.jsx("button",{onClick:()=>{r.current=!1;try{n()}catch(u){console.error("Stop observing error:",u)}setTimeout(()=>{try{l("/cases")}catch(u){console.error("Navigation error:",u),window.location.href="/cases"}},100)},className:"bg-medical-primary text-white px-4 py-2 rounded-lg hover:bg-blue-700",children:"事案一覧に戻る"})]})}):e.jsx(P,{to:"/cases",replace:!0})};export{ce as CaseDetailPage};
//# sourceMappingURL=CaseDetailPage-4d0ccdf9.js.map
