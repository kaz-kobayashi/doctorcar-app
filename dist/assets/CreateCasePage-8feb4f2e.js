import{c as k,u as w,a as C,r as T,j as e,B as u,b as S}from"./index-12ba5e1e.js";import{C as M}from"./index-69f8b09f.js";import{e as x}from"./emergencyHospitals-0f7a254e.js";const h={latitude:35.701835,longitude:139.763417,name:"基地病院"},A=[{id:"scene-001",name:"東京大学本郷キャンパス",latitude:35.7122,longitude:139.7629,address:"東京都文京区本郷7-3-1",locationType:"public",landmarks:["安田講堂","赤門","正門"],accessNotes:"正門から入構可能"},{id:"scene-002",name:"上野公園",latitude:35.7156,longitude:139.7745,address:"東京都台東区上野公園",locationType:"public",landmarks:["上野動物園","国立博物館","西郷隆盛像"],accessNotes:"複数の入口あり、噴水広場が目印"},{id:"scene-003",name:"秋葉原駅周辺",latitude:35.6984,longitude:139.7732,address:"東京都千代田区外神田1丁目",locationType:"commercial",landmarks:["秋葉原駅","ヨドバシカメラ","電気街"],accessNotes:"駅前ロータリー利用可能"},{id:"scene-004",name:"皇居東御苑",latitude:35.6862,longitude:139.7571,address:"東京都千代田区千代田1-1",locationType:"public",landmarks:["大手門","三の丸尚蔵館","本丸跡"],accessNotes:"大手門から入場、警備員に要連絡"},{id:"scene-005",name:"銀座中央通り",latitude:35.6706,longitude:139.7641,address:"東京都中央区銀座4丁目",locationType:"commercial",landmarks:["銀座四丁目交差点","三越","和光"],accessNotes:"歩行者天国時間に注意"},{id:"scene-006",name:"東京スカイツリー周辺",latitude:35.7101,longitude:139.8107,address:"東京都墨田区押上1丁目",locationType:"commercial",landmarks:["東京スカイツリー","ソラマチ","押上駅"],accessNotes:"観光バス駐車場利用可能"},{id:"scene-007",name:"日本橋地区",latitude:35.6833,longitude:139.7731,address:"東京都中央区日本橋1丁目",locationType:"commercial",landmarks:["日本橋","三越本店","コレド日本橋"],accessNotes:"首都高下、道路状況に注意"},{id:"scene-008",name:"浅草寺境内",latitude:35.7148,longitude:139.7967,address:"東京都台東区浅草2-3-1",locationType:"public",landmarks:["雷門","五重塔","本堂"],accessNotes:"仲見世通りは車両進入不可"},{id:"scene-009",name:"神田駅周辺",latitude:35.6918,longitude:139.7708,address:"東京都千代田区内神田3丁目",locationType:"commercial",landmarks:["神田駅","神田明神","万世橋"],accessNotes:"駅前タクシー乗り場利用可能"},{id:"scene-010",name:"後楽園・東京ドーム",latitude:35.7056,longitude:139.7523,address:"東京都文京区後楽1丁目",locationType:"public",landmarks:["東京ドーム","後楽園遊園地","ラクーア"],accessNotes:"イベント開催時は交通規制あり"},{id:"scene-011",name:"新宿区役所周辺",latitude:35.6938,longitude:139.7035,address:"東京都新宿区歌舞伎町1丁目",locationType:"public",landmarks:["新宿区役所","新宿中央公園","都庁"],accessNotes:"区役所駐車場利用可能"},{id:"scene-012",name:"築地場外市場",latitude:35.6654,longitude:139.7707,address:"東京都中央区築地4丁目",locationType:"commercial",landmarks:["築地本願寺","場外市場","築地川公園"],accessNotes:"早朝は市場関係車両に注意"},{id:"scene-013",name:"錦糸町駅前",latitude:35.6967,longitude:139.8147,address:"東京都墨田区江東橋3丁目",locationType:"transport",landmarks:["錦糸町駅","アルカキット","オリナス"],accessNotes:"南口ロータリー利用推奨"},{id:"scene-014",name:"品川区役所周辺",latitude:35.6092,longitude:139.7301,address:"東京都品川区広町2丁目",locationType:"public",landmarks:["品川区役所","しながわ中央公園"],accessNotes:"区役所正面駐車場利用可能"},{id:"scene-015",name:"亀戸天神社",latitude:35.697,longitude:139.8256,address:"東京都江東区亀戸3-6-1",locationType:"public",landmarks:["亀戸天神社","スカイツリー展望","藤の花"],accessNotes:"参拝者駐車場あり（祭事時除く）"}],D=(c,i)=>{const n=(c-h.latitude)*Math.PI/180,a=(i-h.longitude)*Math.PI/180,o=Math.sin(n/2)*Math.sin(n/2)+Math.cos(h.latitude*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(a/2)*Math.sin(a/2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))},P=(c=6)=>A.map(i=>({...i,distance:D(i.latitude,i.longitude)})).filter(i=>i.distance<=c).sort((i,m)=>i.distance-m.distance),B=()=>{const c=k(),{createCase:i,loading:m}=w(),{userInfo:n}=C(),[a,o]=T.useState({caseName:"",patientAge:"",patientGender:"male",patientName:"",sceneLatitude:"",sceneLongitude:"",hospitalLatitude:"",hospitalLongitude:"",description:""}),l=(s,t)=>{o({...a,[s]:t})},b=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(s=>{o({...a,sceneLatitude:s.coords.latitude.toString(),sceneLongitude:s.coords.longitude.toString()})},s=>{console.error("位置情報の取得に失敗しました:",s),alert("位置情報の取得に失敗しました。手動で座標を入力してください。")}):alert("このブラウザでは位置情報がサポートされていません。")},y=s=>{o({...a,sceneLatitude:s.latitude.toString(),sceneLongitude:s.longitude.toString()})},N=s=>{const t=x.find(r=>r.id===s);t&&o({...a,hospitalLatitude:t.latitude.toString(),hospitalLongitude:t.longitude.toString()})},g=P(6),f=async s=>{if(s.preventDefault(),!a.caseName.trim()){alert("事案名を入力してください");return}if(!a.sceneLatitude||!a.sceneLongitude){alert("現場の位置情報を入力してください");return}if(!a.hospitalLatitude||!a.hospitalLongitude){alert("搬送先病院の位置情報を入力してください");return}try{const t=(d,p)=>({latitude:d,longitude:p,isEqual:j=>j.latitude===d&&j.longitude===p,toJSON:()=>({latitude:d,longitude:p})}),r=d=>({toDate:()=>d,toMillis:()=>d.getTime(),seconds:Math.floor(d.getTime()/1e3),nanoseconds:d.getTime()%1e3*1e6}),v={caseName:a.caseName.trim(),status:M.DISPATCHED,teamId:(n==null?void 0:n.uid)||"demo-user",patientInfo:{age:a.patientAge?parseInt(a.patientAge):void 0,gender:a.patientGender,name:a.patientName.trim()||void 0},sceneLocation:t(parseFloat(a.sceneLatitude),parseFloat(a.sceneLongitude)),hospitalLocation:t(parseFloat(a.hospitalLatitude),parseFloat(a.hospitalLongitude)),createdAt:r(new Date),updatedAt:r(new Date)},L=await i(v);alert("新規事案を作成しました"),c(`/cases/${L}`)}catch(t){console.error("事案作成エラー:",t),alert("事案の作成に失敗しました")}};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white shadow-sm border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-16",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>c("/cases"),className:"p-2 text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx("svg",{className:"h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 19l-7-7 7-7"})})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900",children:"新規事案作成"})]}),e.jsx("div",{className:"text-sm text-gray-700",children:e.jsx("span",{className:"font-medium",children:n==null?void 0:n.name})})]})})}),e.jsx("main",{className:"max-w-4xl mx-auto py-6 sm:px-6 lg:px-8",children:e.jsx("div",{className:"px-4 py-6 sm:px-0",children:e.jsxs("form",{onSubmit:f,className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"基本情報"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["事案名 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:a.caseName,onChange:s=>l("caseName",s.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"例: 2024-06-14 渋谷駅前 交通外傷"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"担当チーム"}),e.jsx("input",{type:"text",value:(n==null?void 0:n.team)||"",className:"w-full px-3 py-2 border rounded-lg bg-gray-50",disabled:!0})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"患者情報"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"患者氏名"}),e.jsx("input",{type:"text",value:a.patientName,onChange:s=>l("patientName",s.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"氏名（任意）"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"年齢"}),e.jsx("input",{type:"number",value:a.patientAge,onChange:s=>l("patientAge",s.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"年齢",min:"0",max:"150"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"性別"}),e.jsxs("select",{value:a.patientGender,onChange:s=>l("patientGender",s.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",children:[e.jsx("option",{value:"male",children:"男性"}),e.jsx("option",{value:"female",children:"女性"}),e.jsx("option",{value:"other",children:"その他"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["現場位置",e.jsx("span",{className:"text-sm text-gray-500 ml-2",children:"(基地病院から6km以内)"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"事案発生場所を選択"}),e.jsxs("select",{value:"",onChange:s=>{const t=g.find(r=>r.id===s.target.value);t&&y(t)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary mb-2",children:[e.jsx("option",{value:"",children:"-- 場所を選択してください --"}),g.map(s=>{var t;return e.jsxs("option",{value:s.id,children:[s.name," (",(t=s.distance)==null?void 0:t.toFixed(1),"km) - ",s.address]},s.id)})]})]}),e.jsxs("div",{className:"flex space-x-2 flex-wrap gap-2",children:[e.jsx(u,{type:"button",variant:"outline",size:"sm",onClick:b,children:"📍 現在地を取得"}),g.slice(0,4).map(s=>e.jsx(u,{type:"button",variant:"outline",size:"sm",onClick:()=>y(s),className:"text-xs",children:s.name},s.id))]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["緯度 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",step:"any",value:a.sceneLatitude,onChange:s=>l("sceneLatitude",s.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"35.658584"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["経度 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",step:"any",value:a.sceneLongitude,onChange:s=>l("sceneLongitude",s.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"139.701442"})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"搬送先病院"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"救急対応病院を選択"}),e.jsxs("select",{value:"",onChange:s=>{s.target.value&&N(s.target.value)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary mb-2",children:[e.jsx("option",{value:"",children:"-- 病院を選択してください --"}),x.map(s=>e.jsxs("option",{value:s.id,children:[s.name," (",s.emergencyLevel==="tertiary"?"三次救急":s.emergencyLevel==="secondary"?"二次救急":"一次救急",") - ",s.address]},s.id))]})]}),e.jsx("div",{className:"flex space-x-2 flex-wrap gap-2",children:x.slice(0,3).map(s=>e.jsx(u,{type:"button",variant:"outline",size:"sm",onClick:()=>N(s.id),className:"text-xs",children:s.name},s.id))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["緯度 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",step:"any",value:a.hospitalLatitude,onChange:s=>l("hospitalLatitude",s.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"35.665498"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["経度 ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"number",step:"any",value:a.hospitalLongitude,onChange:s=>l("hospitalLongitude",s.target.value),className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-medical-primary",placeholder:"139.686567"})]})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-4",children:[e.jsx(u,{type:"button",variant:"outline",onClick:()=>c("/cases"),children:"キャンセル"}),e.jsxs(u,{type:"submit",disabled:m,className:"flex items-center",children:[m&&e.jsx(S,{size:"sm",className:"mr-2"}),"事案を作成"]})]})]})})})]})};export{B as CreateCasePage};
//# sourceMappingURL=CreateCasePage-8feb4f2e.js.map
